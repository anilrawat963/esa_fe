import {
  d as d3,
  i as i6,
  v
} from "./chunk-IJEEAMVP.js";
import {
  o
} from "./chunk-GD2WNXFD.js";
import "./chunk-KRLDYUK3.js";
import {
  O as O2
} from "./chunk-UQ4NKDVH.js";
import {
  i as i5
} from "./chunk-VEW6BMSK.js";
import {
  r
} from "./chunk-ZS4Q4DJE.js";
import "./chunk-6SXRWZMX.js";
import "./chunk-N3OIGAM3.js";
import "./chunk-E77VVW2C.js";
import "./chunk-PG3227VO.js";
import {
  M
} from "./chunk-FNGWHAZ7.js";
import {
  s as s3
} from "./chunk-QHEXZ62Z.js";
import {
  l as l2
} from "./chunk-62W3XEE6.js";
import "./chunk-2XM57LB5.js";
import {
  i as i4
} from "./chunk-UXLDVCDU.js";
import "./chunk-JGWZMI5Q.js";
import {
  i2 as i3
} from "./chunk-43423NKQ.js";
import {
  b as b3
} from "./chunk-T5PAMHK6.js";
import {
  d as d2
} from "./chunk-PZZ55S55.js";
import {
  n as n2
} from "./chunk-ALLCMCHO.js";
import "./chunk-NNZE65VM.js";
import "./chunk-RZOWZMPW.js";
import "./chunk-7LPDSYJP.js";
import "./chunk-MJIAJDWR.js";
import "./chunk-XQWYTOXM.js";
import {
  a as a2
} from "./chunk-EQUB4K44.js";
import {
  n
} from "./chunk-RRK2YVM5.js";
import "./chunk-VIDAPS4J.js";
import "./chunk-FTN6U6TO.js";
import "./chunk-QTS3W27E.js";
import "./chunk-3RABUJDL.js";
import "./chunk-WJ3E33GQ.js";
import "./chunk-U3B7YMY7.js";
import "./chunk-F75XORHS.js";
import {
  H as H2,
  I,
  j
} from "./chunk-5RPEIJ7N.js";
import {
  U as U2,
  m2
} from "./chunk-NQDCX3PB.js";
import "./chunk-QW7RJMQR.js";
import "./chunk-CJAJ4FML.js";
import "./chunk-2GRS3IMC.js";
import "./chunk-GVFNGMIY.js";
import "./chunk-RQGBRVDD.js";
import "./chunk-JPZOLUPV.js";
import "./chunk-DRHU543D.js";
import "./chunk-F7RQDGE7.js";
import "./chunk-GG4AQJJO.js";
import "./chunk-OGWYK5MD.js";
import "./chunk-4V63WUXV.js";
import "./chunk-TWE24CRT.js";
import "./chunk-Y3GEZC7J.js";
import "./chunk-U5TTP5E5.js";
import "./chunk-CXUJAI27.js";
import "./chunk-QENBEP2X.js";
import "./chunk-VZQ643XD.js";
import "./chunk-SMJWJAIA.js";
import "./chunk-WFCLXKCE.js";
import "./chunk-FHCV4NTV.js";
import "./chunk-M5JMVUW2.js";
import "./chunk-SIUG2XLL.js";
import "./chunk-XTEXJOLG.js";
import "./chunk-NH6FXYCM.js";
import "./chunk-YE4E5JCT.js";
import "./chunk-SXZO7ULH.js";
import "./chunk-VNSHGTPN.js";
import "./chunk-S5ZM63JC.js";
import "./chunk-XHNYLMJC.js";
import "./chunk-NHFKDWOM.js";
import "./chunk-ALR6N4CF.js";
import "./chunk-4X4BOGIG.js";
import "./chunk-EK7HOTRR.js";
import "./chunk-ODQ5APZK.js";
import "./chunk-BA6HYZ35.js";
import "./chunk-VGXUPJSS.js";
import "./chunk-ZVTEFYZX.js";
import "./chunk-LPUPM55U.js";
import "./chunk-IRBX64M6.js";
import {
  Z
} from "./chunk-2HGIYEIL.js";
import "./chunk-XX3OKYJS.js";
import "./chunk-OTCNIJ2H.js";
import "./chunk-JGA5YJWL.js";
import "./chunk-GCI4MA3M.js";
import "./chunk-SJ2OBYX2.js";
import "./chunk-MDJNYPVI.js";
import "./chunk-Z6VKIQV2.js";
import "./chunk-4PXNA4MD.js";
import "./chunk-VX2NEBRT.js";
import "./chunk-IXRRTVLJ.js";
import "./chunk-EKM7KERW.js";
import "./chunk-WKTI47FV.js";
import {
  e as e2
} from "./chunk-T3SYSTKO.js";
import "./chunk-LQPKVYW2.js";
import "./chunk-U55FA2EK.js";
import "./chunk-7CDU3B2L.js";
import "./chunk-B5A4L35M.js";
import "./chunk-52SEOH5H.js";
import "./chunk-JUZ3H47H.js";
import "./chunk-UYMV6HXW.js";
import "./chunk-AJGINJLG.js";
import "./chunk-JE2NJSBU.js";
import "./chunk-7HTU7ZUX.js";
import "./chunk-QNVJVDYZ.js";
import "./chunk-WDTGOP77.js";
import "./chunk-VYMBX5H5.js";
import "./chunk-BPTFV5VM.js";
import "./chunk-YP3WVJP3.js";
import "./chunk-M24KZOVI.js";
import {
  b as b2
} from "./chunk-647DAMHU.js";
import "./chunk-O6G3PPOK.js";
import "./chunk-ZKNZTIAS.js";
import "./chunk-OJMISN3F.js";
import "./chunk-EFV6H5NA.js";
import "./chunk-6VL5D5UP.js";
import "./chunk-6QHY54HZ.js";
import "./chunk-GXJJY3ND.js";
import "./chunk-5ONGWFJ3.js";
import "./chunk-PLNHHGHL.js";
import "./chunk-DFK6QMLO.js";
import "./chunk-4WTOIJXV.js";
import "./chunk-BBYMM7CM.js";
import "./chunk-EM7Y2JZC.js";
import "./chunk-QZQPB5XR.js";
import "./chunk-AQFRVV3U.js";
import "./chunk-BUQC3CLV.js";
import "./chunk-63LDVRFI.js";
import {
  i as i2
} from "./chunk-TJTOV6JD.js";
import {
  _ as _2
} from "./chunk-C3FRY5U4.js";
import "./chunk-JNJX34GB.js";
import "./chunk-3STJRSDT.js";
import "./chunk-67Q6KVC6.js";
import "./chunk-23NJHA5Q.js";
import "./chunk-4LA6K4VI.js";
import "./chunk-KEZCWFAR.js";
import "./chunk-JZUJ34RR.js";
import "./chunk-PMGS7UDU.js";
import "./chunk-3GHCGAH2.js";
import "./chunk-HWUOAPTX.js";
import "./chunk-QHCKOBU7.js";
import "./chunk-K2OZ6WVC.js";
import "./chunk-MC6NAKKX.js";
import "./chunk-TF6255HN.js";
import "./chunk-GD4FJL3C.js";
import "./chunk-C5OQVQZF.js";
import "./chunk-F7DKSAOI.js";
import "./chunk-4SOQWNPG.js";
import "./chunk-LTULADK2.js";
import "./chunk-35ST7YRB.js";
import "./chunk-EDA5QFHZ.js";
import "./chunk-2LC2762W.js";
import "./chunk-W6HOAVT4.js";
import "./chunk-DTZUXJMD.js";
import "./chunk-YLAGKT2D.js";
import "./chunk-6YRQYUCY.js";
import "./chunk-UDHS2MGH.js";
import "./chunk-MHV23XAQ.js";
import "./chunk-V2X4OKYI.js";
import "./chunk-LPZUGJNG.js";
import "./chunk-XLOINTMG.js";
import "./chunk-MA3QDRC3.js";
import "./chunk-W6J7XCPU.js";
import "./chunk-ONXWBTTM.js";
import "./chunk-T7F6Q6JJ.js";
import {
  O
} from "./chunk-YDTPM7OQ.js";
import "./chunk-75XOUSSS.js";
import "./chunk-TH4EQWJJ.js";
import "./chunk-7P2ANHQ3.js";
import "./chunk-XCKT47LJ.js";
import "./chunk-3FUHCAX3.js";
import "./chunk-PZ5RULLK.js";
import "./chunk-OPJX4KXH.js";
import "./chunk-LTPHDYPK.js";
import "./chunk-3OVERDFX.js";
import "./chunk-FPMLKIDB.js";
import "./chunk-AZXJIEZ6.js";
import "./chunk-Q75WYS7K.js";
import {
  z
} from "./chunk-H74Q4SYB.js";
import {
  U,
  l,
  w
} from "./chunk-2OFHDVO5.js";
import "./chunk-TFJXG32O.js";
import "./chunk-DDOCCRD4.js";
import "./chunk-5UPBUJPC.js";
import "./chunk-THQO67BJ.js";
import "./chunk-4YDOPHTZ.js";
import "./chunk-YY5PITIH.js";
import "./chunk-CCQFL76O.js";
import "./chunk-CSMCPN64.js";
import "./chunk-GY6YF4EN.js";
import "./chunk-7H3U4IJR.js";
import "./chunk-SMWUT52Z.js";
import {
  _
} from "./chunk-AXZMNHTN.js";
import "./chunk-5T3MJDSR.js";
import {
  A
} from "./chunk-NMQNUPE4.js";
import "./chunk-6KIXN4DJ.js";
import "./chunk-7DGJB37R.js";
import "./chunk-234CIOHE.js";
import {
  H2 as H
} from "./chunk-V2H77UEV.js";
import "./chunk-WRA2WBYC.js";
import "./chunk-XWE6BM2U.js";
import "./chunk-SOIZOFSB.js";
import "./chunk-XXLHAM2M.js";
import {
  b,
  m
} from "./chunk-5EI5H4QX.js";
import {
  a2 as a
} from "./chunk-ZIE53VIV.js";
import {
  __decorate
} from "./chunk-SS5CLIUY.js";
import "./chunk-R54Q5TGA.js";
import "./chunk-6SSZNBOK.js";
import "./chunk-LZ2XTYP2.js";
import "./chunk-45CFSCQX.js";
import "./chunk-A5XN2VFT.js";
import "./chunk-65HD3WXL.js";
import "./chunk-4DGC7CBY.js";
import {
  L,
  d,
  e,
  s as s2
} from "./chunk-GNMPGHLQ.js";
import {
  i3 as i,
  s2 as s
} from "./chunk-QY7XKUIV.js";
import {
  N,
  has
} from "./chunk-AL6YUTZM.js";
import "./chunk-G26ADAPQ.js";

// node_modules/@arcgis/core/views/2d/layers/imagery/ImageryView2D.js
var g = class extends b {
  constructor() {
    super(...arguments), this.attached = false, this.container = new n2(), this.updateRequested = false, this.pixelHighlights = [], this.type = "imagery", this._bitmapView = new s3();
  }
  destroy() {
    this.attached && (this.detach(), this.attached = false), this.updateRequested = false;
  }
  get updating() {
    return !this.attached || this.isUpdating();
  }
  update(t) {
    this.strategy.update(t).catch((t2) => {
      d(t2) || i.getLogger(this).error(t2);
    });
  }
  hitTest(t) {
    return new _2({ attributes: {}, geometry: t.clone(), layer: this.layer });
  }
  attach() {
    this.container.addChild(this._bitmapView);
    const t = this.layer.version >= 10, e3 = this.layer.version >= 10.1 ? this.layer.imageMaxHeight : 2048, i7 = this.layer.version >= 10.1 ? this.layer.imageMaxWidth : 2048;
    this.strategy = new M({ container: this._bitmapView, imageNormalizationSupported: t, imageMaxHeight: e3, imageMaxWidth: i7, fetchSource: this._fetchImage.bind(this), requestUpdate: () => this.requestUpdate() });
  }
  detach() {
    this.strategy.destroy(), this._bitmapView.removeAllChildren(), this.container.removeAllChildren(), this.updateRequested = false;
  }
  redraw() {
    this.strategy.updateExports(async (t) => {
      const { source: e3 } = t;
      if (!e3 || e3 instanceof ImageBitmap) return;
      const i7 = e3.originalPixelBlock ?? e3.pixelBlock, { pixelHighlights: r2 } = this, s5 = r2.length > 0, a3 = await this.layer.applyRenderer({ extent: e3.extent, pixelBlock: i7, isRawData: s5 }), o2 = a3.pixelBlock;
      s5 && i7 && o2 && await this.layer.highlightPixels({ pixelBlock: i7, renderedPixelBlock: o2, highlightOptions: r2 }), e3.filter = (t2) => this.layer.pixelFilter ? this.layer.applyFilter(t2) : { ...a3, extent: e3.extent };
    }).catch((t) => {
      d(t) || i.getLogger(this).error(t);
    });
  }
  requestUpdate() {
    this.updateRequested || (this.updateRequested = true, this.view.requestUpdate());
  }
  isUpdating() {
    return this.strategy.updating || this.updateRequested;
  }
  getPixelData() {
    if (this.updating) return null;
    const t = this.strategy.bitmaps;
    if (1 === t.length && t[0].source) return { extent: t[0].source.extent, pixelBlock: t[0].source.originalPixelBlock };
    if (t.length > 1) {
      const e3 = this.view.extent, i7 = t.map((t2) => t2.source).filter((t2) => t2.extent && t2.extent.intersects(e3)).map((t2) => ({ extent: t2.extent, pixelBlock: t2.originalPixelBlock })), r2 = U2(i7, e3);
      return null != r2 ? { extent: r2.extent, pixelBlock: r2.pixelBlock } : null;
    }
    return null;
  }
  async _fetchImage(t, e3, i7, r2) {
    (r2 = r2 || {}).timeExtent = this.timeExtent;
    const s5 = this.pixelHighlights.length > 0;
    r2.requestAsImageElement = !s5, r2.returnImageBitmap = !s5, r2.requestRawData = s5;
    const a3 = await this.layer.internalFetchImage(t, e3, i7, r2);
    if (a3.imageBitmap) return a3.imageBitmap;
    const o2 = await this.layer.applyRenderer({ ...a3.pixelData, isRawData: s5 }, { signal: r2.signal }), l3 = a3.pixelData.pixelBlock, p = o2.pixelBlock;
    s5 && l3 && p && await this.layer.highlightPixels({ pixelBlock: l3, renderedPixelBlock: p, highlightOptions: this.pixelHighlights });
    const n3 = new l2(p, o2.extent?.clone(), l3);
    return n3.filter = (t2) => this.layer.applyFilter(t2), n3;
  }
};
__decorate([m()], g.prototype, "attached", void 0), __decorate([m()], g.prototype, "container", void 0), __decorate([m()], g.prototype, "layer", void 0), __decorate([m()], g.prototype, "strategy", void 0), __decorate([m()], g.prototype, "timeExtent", void 0), __decorate([m()], g.prototype, "view", void 0), __decorate([m()], g.prototype, "updateRequested", void 0), __decorate([m()], g.prototype, "updating", null), __decorate([m()], g.prototype, "pixelHighlights", void 0), __decorate([m()], g.prototype, "type", void 0), g = __decorate([a("esri.views.2d.layers.imagery.ImageryView2D")], g);

// node_modules/@arcgis/core/views/2d/engine/imagery/RasterVFContainer.js
var s4 = class extends i3 {
  constructor() {
    super(...arguments), this.symbolTypes = ["triangle"];
  }
  prepareRenderPasses(r2) {
    const s5 = r2.registerRenderPass({ name: "imagery (vf)", brushes: [i6], target: () => this.children, drawPhase: 1 });
    return [...super.prepareRenderPasses(r2), s5];
  }
  doRender(e3) {
    this.visible && 1 === e3.drawPhase && this.symbolTypes.forEach((r2) => {
      e3.renderPass = r2, super.doRender(e3);
    });
  }
};

// node_modules/@arcgis/core/views/2d/layers/imagery/ImageryVFStrategy.js
var c = class extends b {
  constructor(e3) {
    super(e3), this._loading = null, this.update = L((e4, t) => this._update(e4, t).catch((e5) => {
      d(e5) || i.getLogger(this).error(e5);
    }));
  }
  get updating() {
    return !!this._loading;
  }
  redraw(e3) {
    if (!this.container.children.length) return;
    const t = this.container.children[0];
    t.symbolizerParameters = e3, t.invalidateVAO(), this.container.symbolTypes = "wind_speed" === e3.style ? ["scalar", "triangle"] : "simple_scalar" === e3.style ? ["scalar"] : ["triangle"], this.container.requestRender();
  }
  async _update(e3, t, i7) {
    if (!e3.stationary) return;
    const { extent: r2, spatialReference: o2 } = e3.state, s5 = new z({ xmin: r2.xmin, ymin: r2.ymin, xmax: r2.xmax, ymax: r2.ymax, spatialReference: o2 }), [a3, l3] = e3.state.size;
    this._loading = this.fetchPixels(s5, a3, l3, i7);
    const c2 = await this._loading;
    this._addToDisplay(c2, t, e3.state), this._loading = null;
  }
  _addToDisplay(e3, t, i7) {
    if (null == e3.pixelBlock) return this.container.children.forEach((e4) => e4.destroy()), void this.container.removeAllChildren();
    const { extent: r2, pixelBlock: o2 } = e3, s5 = new v(o2);
    s5.offset = [0, 0], s5.symbolizerParameters = t, s5.rawPixelData = e3, s5.invalidateVAO(), s5.x = r2.xmin, s5.y = r2.ymax, s5.pixelRatio = i7.pixelRatio, s5.rotation = i7.rotation, s5.resolution = i7.resolution, s5.width = o2.width * t.symbolTileSize, s5.height = o2.height * t.symbolTileSize, this.container.children.forEach((e4) => e4.destroy()), this.container.removeAllChildren(), this.container.symbolTypes = "wind_speed" === t.style ? ["scalar", "triangle"] : "simple_scalar" === t.style ? ["scalar"] : ["triangle"], this.container.addChild(s5);
  }
};
__decorate([m()], c.prototype, "fetchPixels", void 0), __decorate([m()], c.prototype, "container", void 0), __decorate([m()], c.prototype, "_loading", void 0), __decorate([m()], c.prototype, "updating", null), c = __decorate([a("esri.views.2d.layers.imagery.ImageryVFStrategy")], c);

// node_modules/@arcgis/core/views/2d/layers/imagery/VectorFieldView2D.js
var x = class extends b {
  constructor() {
    super(...arguments), this.attached = false, this.container = new s4(), this.type = "imageryVF", this._dataParameters = { exportParametersVersion: 0, bbox: "", symbolTileSize: 0, time: "" }, this._fetchpixels = async (t, e3, r2, i7) => {
      const o2 = await this._projectFullExtentPromise, { layer: s5 } = this, { symbolTileSize: a3 } = s5.renderer, { extent: n3, width: l3, height: c2 } = m2(t, e3, r2, a3, o2);
      if (null != o2 && !o2.intersects(t)) return { extent: n3, pixelBlock: null };
      const m3 = { bbox: `${n3.xmin}, ${n3.ymin}, ${n3.xmax}, ${n3.ymax}`, exportParametersVersion: s5.exportImageServiceParameters.version, symbolTileSize: a3, time: JSON.stringify(this.timeExtent || "") };
      if (this._canReuseVectorFieldData(m3)) {
        const t2 = this.getPixelData();
        if (null != t2) {
          if (`${t2.extent.xmin}, ${t2.extent.ymin}, ${t2.extent.xmax}, ${t2.extent.ymax}` === m3.bbox) return t2;
        }
      }
      const { pixelBlock: p } = await s5.fetchPixels(n3, l3, c2, { timeExtent: this.timeExtent, interpolation: s5.interpolation, signal: i7 });
      if (this._dataParameters = m3, null == p) return { extent: n3, pixelBlock: null };
      const { dataType: h } = s5.rasterInfo;
      return { extent: n3, pixelBlock: "vector-uv" === h && p ? await s5.convertVectorFieldData(p, "vector-uv", { signal: i7 }) : p };
    };
  }
  get updating() {
    return !this.attached || this._strategy.updating;
  }
  attach() {
    this._projectFullExtentPromise = this._getProjectedFullExtent(this.view.spatialReference), this._strategy = new c({ container: this.container, fetchPixels: this._fetchpixels }), this.addHandles(l(() => this.layer.renderer, (t) => this._updateSymbolizerParams(t), w), "attach");
  }
  detach() {
    this._strategy.destroy(), this.container.children.forEach((t) => t.destroy()), this.container.removeAllChildren(), this.removeHandles("attach"), this._strategy = this.container = this._projectFullExtentPromise = null;
  }
  getPixelData() {
    const t = this.container.children[0]?.rawPixelData;
    if (this.updating || !t) return null;
    const { extent: e3, pixelBlock: r2 } = t;
    return { extent: e3, pixelBlock: r2 };
  }
  hitTest(t) {
    return new _2({ attributes: {}, geometry: t.clone(), layer: this.layer });
  }
  update(t) {
    this._strategy.update(t, this._symbolizerParams).catch((t2) => {
      d(t2) || i.getLogger(this).error(t2);
    });
  }
  redraw() {
    const { renderer: t } = this.layer;
    t && (this._updateSymbolizerParams(t), this._strategy.redraw(this._symbolizerParams));
  }
  _canReuseVectorFieldData(t) {
    const e3 = this._dataParameters.exportParametersVersion === t.exportParametersVersion, r2 = this._dataParameters.time === t.time, i7 = this._dataParameters.symbolTileSize === t.symbolTileSize, o2 = this._dataParameters.bbox === t.bbox;
    return e3 && r2 && i7 && o2;
  }
  async _getProjectedFullExtent(t) {
    try {
      return H2(this.layer.fullExtent, t);
    } catch (e3) {
      try {
        const e4 = (await H(this.layer.url, { query: { option: "footprints", outSR: A(t), f: "json" } })).data.featureCollection.layers[0].layerDefinition.extent;
        return e4 ? z.fromJSON(e4) : null;
      } catch {
        return null;
      }
    }
  }
  _updateSymbolizerParams(t) {
    "vector-field" === t?.type && (this._symbolizerParams = this.layer.symbolizer.generateWebGLParameters({ pixelBlock: null }));
  }
};
__decorate([m()], x.prototype, "attached", void 0), __decorate([m()], x.prototype, "container", void 0), __decorate([m()], x.prototype, "layer", void 0), __decorate([m()], x.prototype, "timeExtent", void 0), __decorate([m()], x.prototype, "type", void 0), __decorate([m()], x.prototype, "view", void 0), __decorate([m()], x.prototype, "updating", null), x = __decorate([a("esri.views.2d.layers.imagery.VectorFieldView2D")], x);

// node_modules/@arcgis/core/views/layers/ImageryLayerView.js
var y = (y2) => {
  const d4 = y2;
  let f = class extends d4 {
    constructor(...e3) {
      super(...e3), this.view = null;
    }
    get timeExtent() {
      return i5(this.layer, this.view?.timeExtent, this._get("timeExtent"));
    }
    async fetchPopupFeaturesAtLocation(e3, o2) {
      const { layer: s5 } = this;
      if (!e3) throw new s("imagerylayerview:fetchPopupFeatures", "Nothing to fetch without area", { layer: s5 });
      const { popupEnabled: n3 } = s5, l3 = n(s5, o2);
      if (!n3 || null == l3) return [];
      const m3 = await l3.getRequiredFields(null, { index: new Z(s5.rasterFields), partitions: /* @__PURE__ */ new Map([["$pixel", s5.rasterFields.filter((e4) => e4.name.startsWith(a2)).map((e4) => e4.name)], ["$imageCollectionItem", s5.fields.map((e4) => e4.name)]]) });
      s2(o2);
      const y3 = new b2();
      y3.timeExtent = this.timeExtent, y3.geometry = e3, y3.outFields = m3, y3.outSpatialReference = e3.spatialReference;
      const { resolution: d5, spatialReference: f2 } = this.view, h = "2d" === this.view.type ? new _(d5, d5, f2) : new _(0.5 * d5, 0.5 * d5, f2), { returnTopmostRaster: w2, showNoDataRecords: R } = l3.layerOptions || { returnTopmostRaster: true, showNoDataRecords: false }, j2 = { returnDomainValues: true, returnTopmostRaster: w2, pixelSize: h, showNoDataRecords: R, signal: o2?.signal };
      return s5.queryVisibleRasters(y3, j2);
    }
    async getSourceScale() {
      return await j(), await this.layer.load(), I(this.layer.serviceRasterInfo, this.view.spatialReference);
    }
    canResume() {
      return !!super.canResume() && !this.timeExtent?.isEmpty;
    }
  };
  return __decorate([m()], f.prototype, "layer", void 0), __decorate([m()], f.prototype, "suspended", void 0), __decorate([m({ readOnly: true })], f.prototype, "timeExtent", null), __decorate([m()], f.prototype, "view", void 0), f = __decorate([a("esri.views.layers.ImageryLayerView")], f), f;
};

// node_modules/@arcgis/core/views/2d/layers/ImageryLayerView2D.js
var _3 = class extends y(i4(b3(d2))) {
  constructor() {
    super(...arguments), this._exportImageVersion = -1, this._highlightGraphics = new i2(), this._highlightView = void 0, this._pixelHighlights = [], this.layer = null, this.subview = null;
  }
  get pixelData() {
    const { subview: i7 } = this;
    return this.updating || !i7 ? null : "getPixelData" in i7 ? i7.getPixelData() : null;
  }
  update(i7) {
    this.subview?.update(i7);
  }
  attach() {
    this.layer.increaseRasterJobHandlerUsage(), this._setSubView(), this.view && (this._highlightView = new O2({ view: this.view, graphics: this._highlightGraphics, requestUpdateCallback: () => this.requestUpdate(), container: new o(this.view.featuresTilingScheme) }), this.container.addChild(this._highlightView.container)), this.addAttachHandles([l(() => this.layer.exportImageServiceParameters.version, (i7) => {
      i7 && this._exportImageVersion !== i7 && (this._exportImageVersion = i7, this.requestUpdate());
    }, U), l(() => this.timeExtent, (i7) => {
      const { subview: t } = this;
      t && (t.timeExtent = i7, "redraw" in t ? this.requestUpdate() : t.redrawOrRefetch());
    }, U), this.layer.on("redraw", () => {
      const { subview: i7 } = this;
      i7 && ("redraw" in i7 ? i7.redraw() : i7.redrawOrRefetch());
    }), l(() => this.layer.renderer, () => this._setSubView()), l(() => this.view.highlights.items.map(({ name: i7, color: t }) => ({ name: i7, color: t })), () => this._updateHighlightOptions(this.subview))]);
  }
  detach() {
    this.layer.decreaseRasterJobHandlerUsage(), this.container.removeAllChildren(), this._detachSubview(this.subview), this.subview?.destroy(), this.subview = null, this._highlightView?.destroy(), this._exportImageVersion = -1;
  }
  viewChange() {
  }
  moveEnd() {
    this.requestUpdate();
  }
  highlight(i7, h) {
    if (i7 && "pixelRanges" in i7 && i7.pixelRanges.length) return this._highlightPixels(i7, h);
    if (!((Array.isArray(i7) ? i7[0] : O.isCollection(i7) ? i7.at(0) : i7) instanceof _2)) return e();
    let a3 = [];
    Array.isArray(i7) || O.isCollection(i7) ? a3 = i7.map((i8) => i8.clone()) : i7 instanceof _2 && (a3 = [i7.clone()]);
    const o2 = a3?.filter(N);
    if (!o2?.length) return e();
    const l3 = r(h);
    return this._addHighlightGraphics(a3, l3), e(() => !this.destroyed && this._removeHighlightGraphics(a3, l3));
  }
  _highlightPixels(i7, t) {
    const e3 = { target: i7, options: t };
    return this._pixelHighlights.push(e3), this._updateHighlightOptions(this.subview), e(() => {
      const i8 = this._pixelHighlights.indexOf(e3);
      i8 > -1 && (this._pixelHighlights.splice(i8, 1), this._updateHighlightOptions(this.subview));
    });
  }
  _addHighlightGraphics(i7, t) {
    this._highlightGraphics.addMany(i7), this._addHighlights(i7.map((i8) => i8.uid), t);
  }
  _removeHighlightGraphics(i7, t) {
    this._highlightGraphics.removeMany(i7), this._removeHighlights(i7.map((i8) => i8.uid), t);
  }
  async doRefresh() {
    this.requestUpdate();
  }
  isUpdating() {
    const i7 = !this.subview || this.subview.updating || !!this._highlightView?.updating;
    return has("esri-2d-log-updating") && console.log(`Updating ImageryLayerView2D (${this.layer.id}): ${i7}
-> subview ${!this.subview || this.subview.updating}
-> higlightView ${this._highlightView?.updating}
`), i7;
  }
  _processHighlight() {
    const i7 = this._getHighlights();
    this._highlightView?.setHighlight(i7);
  }
  _setSubView() {
    if (!this.view) return;
    const i7 = this.layer.renderer?.type;
    let t = "imagery";
    if ("vector-field" === i7 ? t = "imageryVF" : "flow" === i7 && (t = "flow"), this.subview) {
      const { type: i8 } = this.subview;
      if (i8 === t) return this._attachSubview(this.subview), void ("flow" === i8 ? this.subview.redrawOrRefetch() : "imagery" === i8 && "lerc" === this.layer.format ? this.subview.redraw() : this.requestUpdate());
      this._detachSubview(this.subview), this.subview?.destroy();
    }
    "imagery" === t ? (this.subview = new g({ layer: this.layer, view: this.view, timeExtent: this.timeExtent }), this._updateHighlightOptions(this.subview)) : this.subview = "imageryVF" === t ? new x({ layer: this.layer, view: this.view, timeExtent: this.timeExtent }) : new d3({ layer: this.layer, layerView: this }), this._attachSubview(this.subview), this.requestUpdate();
  }
  _attachSubview(i7) {
    i7 && !i7.attached && (i7.attach(), i7.attached = true, this.container.addChildAt(i7.container, 0));
  }
  _detachSubview(i7) {
    i7?.attached && (this.container.removeChild(i7.container), i7.detach(), i7.attached = false);
  }
  _updateHighlightOptions(i7) {
    const t = this.view.highlights;
    this._pixelHighlights.sort((i8, e4) => t.findIndex(({ name: i9 }) => i9 === r(e4.options)) - t.findIndex(({ name: t2 }) => t2 === r(i8.options)));
    const e3 = this._pixelHighlights.map(({ target: i8, options: e4 }) => {
      const s5 = r(e4), r2 = t.find((i9) => i9.name === s5)?.color ?? e2, { pixelRanges: h, bandId: a3 } = i8;
      return { ranges: h, bandId: a3 ?? 0, color: r2.toArray() };
    });
    "imagery" === i7?.type && (i7.pixelHighlights = e3, i7.attached && ("lerc" === this.layer.format ? i7.redraw() : this.requestUpdate()));
  }
};
__decorate([m()], _3.prototype, "pixelData", null), __decorate([m()], _3.prototype, "subview", void 0), _3 = __decorate([a("esri.views.2d.layers.ImageryLayerView2D")], _3);
var x2 = _3;
export {
  x2 as default
};
//# sourceMappingURL=ImageryLayerView2D-JKQQ6RVQ.js.map
