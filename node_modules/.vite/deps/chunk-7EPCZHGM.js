import {
  U,
  V,
  Y,
  ee
} from "./chunk-JCMADXBT.js";
import {
  _
} from "./chunk-IRBX64M6.js";
import {
  n
} from "./chunk-234CIOHE.js";
import {
  H2 as H,
  Z
} from "./chunk-V2H77UEV.js";
import {
  s2 as s
} from "./chunk-QY7XKUIV.js";

// node_modules/@arcgis/core/libs/parquet/loadParquetModule.js
var n2 = null;
async function s2() {
  return n2 || (n2 = a()), n2;
}
async function a() {
  const n3 = await import("./bundle-KW4UJHUI.js");
  return await n3.default({ module_or_path: n("esri/libs/parquet/pkg/bundle_bg.wasm") }), n3;
}

// node_modules/@arcgis/core/libs/parquet/parquet.js
var c = new _({ concurrency: 8, process: async (t) => {
  const { data: r } = await H(t.url, t.options);
  return r;
} });
var l = (e) => async function(t, r, n3, o) {
  const a2 = e?.(), s3 = a2 ?? {};
  return await c.push({ url: t, options: { responseType: "array-buffer", query: s3, headers: { range: `bytes=${r}-${n3}` } } });
};
var p = (t) => async function(r) {
  if (Z(r)) {
    const { data: t2 } = await H(r, { responseType: "blob" });
    return t2.size;
  }
  const { data: o } = await H(r, { responseType: "native", method: "head", query: t?.() }), a2 = o.headers.get("Content-Length");
  if (null == a2) throw new Error("Unable to parse content length");
  return parseInt(a2, 10);
};
function m(e) {
  switch (e) {
    case "esriGeometryPoint":
      return U.Point;
    case "esriGeometryPolygon":
      return U.Polygon;
    case "esriGeometryPolyline":
      return U.Polyline;
    case "esriGeometryMultipoint":
      return U.Multipoint;
    default:
      throw new s("parquet", `Found unexpected GeometryType: ${e}`);
  }
}
function f(e) {
  switch (e.encoding.type) {
    case "wkb":
      return ee.fromWkb(e.encoding.field);
    case "location": {
      const { yField: t, xField: r } = e.encoding;
      return ee.fromLocation(t, r);
    }
  }
}
function y(e, r) {
  const n3 = e.spatialReference.wkid, o = r.wkid;
  if (!n3 || !o) throw new s("parquet", "Unable to create ParquetFile, in and out wkid must be specified");
  const i = m(e.geometryType), u = f(e), c2 = [];
  if ("xz" === e.displayOptimization?.mode) {
    const t = e.displayOptimization.multiscale;
    for (const e2 of t.levels ?? []) {
      const [t2, r2] = e2.transform.translate, [n4, o2] = e2.transform.scale, s3 = new Float64Array([t2, r2]), i2 = new Float64Array([n4, o2]);
      c2.push(Y.new(e2.level, e2.column, s3, i2));
    }
  }
  return V.new(i, n3, o, u, c2);
}
async function d(e, t = {}) {
  const { ParquetFile: r } = await s2(), n3 = l(t.getCustomParameters), a2 = p(t.getCustomParameters), s3 = t.geometryInfo ? y(t.geometryInfo, t.outSpatialReference ?? t.geometryInfo.spatialReference) : null;
  return r.fromUrl(e, n3, a2, s3);
}
function w(e) {
  const t = e.keyValueMetadata("geo");
  return null != t ? JSON.parse(t) : null;
}
function g(e) {
  const t = e.keyValueMetadata("esri");
  return null != t ? JSON.parse(t) : null;
}

export {
  d,
  w,
  g
};
//# sourceMappingURL=chunk-7EPCZHGM.js.map
