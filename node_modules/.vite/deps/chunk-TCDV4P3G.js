import {
  a as a2
} from "./chunk-7YH7T6CS.js";
import {
  O
} from "./chunk-YDTPM7OQ.js";
import {
  U
} from "./chunk-2OFHDVO5.js";
import {
  s
} from "./chunk-WRA2WBYC.js";
import {
  i3 as i2,
  m
} from "./chunk-5EI5H4QX.js";
import {
  a2 as a
} from "./chunk-ZIE53VIV.js";
import {
  __decorate
} from "./chunk-SS5CLIUY.js";
import {
  L,
  y
} from "./chunk-GNMPGHLQ.js";
import {
  i3 as i
} from "./chunk-QY7XKUIV.js";

// node_modules/@arcgis/core/layers/mixins/refresh.js
var n = new O();
var o = /* @__PURE__ */ new WeakMap();
function f(e) {
  i3(e) && n.push(new WeakRef(e));
}
function s2(e) {
  const r = n.find((r2) => r2.deref() === e);
  r && n.remove(r);
}
function i3(e) {
  return null != e && "object" == typeof e && "refreshInterval" in e && "refresh" in e;
}
function c(e, r) {
  return Number.isFinite(e) && Number.isFinite(r) ? r <= 0 ? e : c(r, e % r) : 0;
}
var l = 0;
var a3 = 0;
function u() {
  const e = Date.now();
  let r = false;
  for (const t of n) {
    const n2 = t.deref();
    if (n2) {
      if (n2.refreshInterval) {
        e - (o.get(n2) ?? 0) + 5 >= 6e4 * n2.refreshInterval && (o.set(n2, e), n2.refresh(e));
      }
    } else r = true;
  }
  if (r) for (let t = n.length - 1; t >= 0; t--) {
    n.at(t).deref() || n.removeAt(t);
  }
}
i2(() => {
  const e = Date.now();
  let r = 0;
  for (const t of n) {
    const n2 = t.deref();
    n2 && (r = c(Math.round(6e4 * n2.refreshInterval), r), n2.refreshInterval ? o.get(n2) || o.set(n2, e) : o.delete(n2));
  }
  if (r !== a3) {
    if (a3 = r, clearInterval(l), 0 === a3) return void (l = 0);
    l = setInterval(u, a3);
  }
}, U);

// node_modules/@arcgis/core/layers/mixins/RefreshableLayer.js
var c2 = 0.1;
var f2 = (m2) => {
  const f3 = m2;
  let l2 = class extends f3 {
    constructor(...e) {
      super(...e), this.refreshInterval = 0, this.refreshTimestamp = 0, this._debounceHasDataChanged = L(() => this.hasDataChanged()), this.when().then(() => {
        this.destroyed || f(this);
      }, () => {
      });
    }
    destroy() {
      s2(this);
    }
    castRefreshInterval(e) {
      return e >= c2 ? e : e <= 0 ? 0 : c2;
    }
    get refreshParameters() {
      return { _ts: this.refreshTimestamp || null };
    }
    refresh(e = Date.now()) {
      y(this._debounceHasDataChanged()).then((r) => {
        r && this._set("refreshTimestamp", e), this.emit("refresh", { dataChanged: r });
      }, (e2) => {
        i.getLogger(this).error(e2), this.emit("refresh", { dataChanged: false, error: e2 });
      });
    }
    async hasDataChanged() {
      return true;
    }
    get test() {
    }
  };
  return __decorate([m({ type: Number, json: { write: true, origins: { "web-scene": { write: { enabled: true, layerContainerTypes: a2 } } } } })], l2.prototype, "refreshInterval", void 0), __decorate([s("refreshInterval")], l2.prototype, "castRefreshInterval", null), __decorate([m({ readOnly: true })], l2.prototype, "refreshTimestamp", void 0), __decorate([m({ readOnly: true })], l2.prototype, "refreshParameters", null), l2 = __decorate([a("esri.layers.mixins.RefreshableLayer")], l2), l2;
};

export {
  f2 as f
};
//# sourceMappingURL=chunk-TCDV4P3G.js.map
