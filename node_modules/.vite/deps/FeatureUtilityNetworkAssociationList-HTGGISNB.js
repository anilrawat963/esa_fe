import {
  s as s3,
  v
} from "./chunk-4UD25MCJ.js";
import "./chunk-WT2BW5KP.js";
import "./chunk-3U5UUY3S.js";
import "./chunk-HCTBVF3W.js";
import "./chunk-VJ5FUG6T.js";
import "./chunk-U73R3I4U.js";
import {
  e as e2
} from "./chunk-2O6SPRT2.js";
import "./chunk-647DAMHU.js";
import "./chunk-O6G3PPOK.js";
import "./chunk-ZKNZTIAS.js";
import "./chunk-OJMISN3F.js";
import "./chunk-EFV6H5NA.js";
import {
  s as s2
} from "./chunk-4WTOIJXV.js";
import "./chunk-QZQPB5XR.js";
import "./chunk-AQFRVV3U.js";
import {
  B,
  c as c3,
  e
} from "./chunk-TMVLBQMP.js";
import {
  i2 as i,
  n2 as n
} from "./chunk-6IHS6RYH.js";
import "./chunk-OJBEN6CV.js";
import "./chunk-TU5E6NPS.js";
import "./chunk-RKNCTZBL.js";
import "./chunk-C3FRY5U4.js";
import "./chunk-JNJX34GB.js";
import "./chunk-3STJRSDT.js";
import "./chunk-67Q6KVC6.js";
import "./chunk-23NJHA5Q.js";
import "./chunk-4LA6K4VI.js";
import "./chunk-KEZCWFAR.js";
import "./chunk-JZUJ34RR.js";
import "./chunk-PMGS7UDU.js";
import "./chunk-3GHCGAH2.js";
import "./chunk-HWUOAPTX.js";
import "./chunk-QHCKOBU7.js";
import "./chunk-K2OZ6WVC.js";
import "./chunk-MC6NAKKX.js";
import "./chunk-TF6255HN.js";
import "./chunk-GD4FJL3C.js";
import "./chunk-C5OQVQZF.js";
import "./chunk-F7DKSAOI.js";
import "./chunk-4SOQWNPG.js";
import "./chunk-LTULADK2.js";
import "./chunk-35ST7YRB.js";
import "./chunk-EDA5QFHZ.js";
import "./chunk-CNYNCKEV.js";
import "./chunk-C5M24ACM.js";
import "./chunk-L4A2QJG4.js";
import {
  s
} from "./chunk-6KDQMJAI.js";
import {
  c as c2
} from "./chunk-UDHS2MGH.js";
import "./chunk-QF7FRVN6.js";
import "./chunk-ENINOZUZ.js";
import "./chunk-P6IKJIMO.js";
import "./chunk-MHV23XAQ.js";
import "./chunk-V2X4OKYI.js";
import "./chunk-LPZUGJNG.js";
import "./chunk-XLOINTMG.js";
import "./chunk-MA3QDRC3.js";
import "./chunk-W6J7XCPU.js";
import "./chunk-ONXWBTTM.js";
import "./chunk-T7F6Q6JJ.js";
import "./chunk-YDTPM7OQ.js";
import "./chunk-75XOUSSS.js";
import "./chunk-TH4EQWJJ.js";
import "./chunk-7P2ANHQ3.js";
import "./chunk-XCKT47LJ.js";
import "./chunk-3FUHCAX3.js";
import "./chunk-PZ5RULLK.js";
import "./chunk-OPJX4KXH.js";
import "./chunk-LTPHDYPK.js";
import "./chunk-3OVERDFX.js";
import "./chunk-FPMLKIDB.js";
import "./chunk-AZXJIEZ6.js";
import "./chunk-Q75WYS7K.js";
import "./chunk-H74Q4SYB.js";
import {
  l
} from "./chunk-2OFHDVO5.js";
import "./chunk-TFJXG32O.js";
import "./chunk-DDOCCRD4.js";
import "./chunk-5UPBUJPC.js";
import "./chunk-THQO67BJ.js";
import "./chunk-4YDOPHTZ.js";
import "./chunk-YY5PITIH.js";
import "./chunk-CCQFL76O.js";
import "./chunk-CSMCPN64.js";
import "./chunk-GY6YF4EN.js";
import "./chunk-7H3U4IJR.js";
import "./chunk-SMWUT52Z.js";
import "./chunk-AXZMNHTN.js";
import "./chunk-5T3MJDSR.js";
import "./chunk-NMQNUPE4.js";
import "./chunk-6KIXN4DJ.js";
import "./chunk-7DGJB37R.js";
import "./chunk-234CIOHE.js";
import "./chunk-V2H77UEV.js";
import "./chunk-WRA2WBYC.js";
import "./chunk-XWE6BM2U.js";
import "./chunk-SOIZOFSB.js";
import "./chunk-XXLHAM2M.js";
import {
  m
} from "./chunk-5EI5H4QX.js";
import {
  a2 as a
} from "./chunk-ZIE53VIV.js";
import {
  __decorate
} from "./chunk-SS5CLIUY.js";
import "./chunk-R54Q5TGA.js";
import "./chunk-6SSZNBOK.js";
import "./chunk-LZ2XTYP2.js";
import "./chunk-45CFSCQX.js";
import "./chunk-A5XN2VFT.js";
import "./chunk-65HD3WXL.js";
import "./chunk-4DGC7CBY.js";
import "./chunk-GNMPGHLQ.js";
import {
  c
} from "./chunk-QY7XKUIV.js";
import "./chunk-AL6YUTZM.js";
import "./chunk-G26ADAPQ.js";

// node_modules/@arcgis/core/widgets/support/UtilityNetworkAssociations/UtilityNetworkAssociationList.js
var d = "esri-utility-network-association-list";
var p = { featureObserver: `${d}__feature-observer`, filterContainer: `${d}__filter-container`, limitNoticeContainer: `${d}__limit-notice-container`, loadingContainer: `${d}__loading-container` };
var m2 = class extends B {
  constructor(e3, o) {
    super(e3, o), this._isFeatureCountNoticeOpen = true, this._observer = new IntersectionObserver(([e4]) => {
      e4?.isIntersecting && this._increaseFeaturePage();
    }, { root: window.document }), this._observerNode = null, this.featuresPerPage = 50, this.filterText = "", this.headingLevel = 5, this.maxFeatureCount = 1e3, this.messagesFeature = null, this.messagesCommon = null, this.selectedLayer = null, this.tooltipReferenceMap = new s2(), this.viewModel = new v();
  }
  initialize() {
    this.setUpObserver();
  }
  loadDependencies() {
    return c3({ icon: () => import("./calcite-icon-YAZUXSRW.js"), input: () => import("./calcite-input-L7IBNUSF.js"), loader: () => import("./calcite-loader-WDQKP4UK.js"), notice: () => import("./calcite-notice-NKUYWCPL.js") });
  }
  destroy() {
    this.tooltipReferenceMap.clear();
  }
  get associatedFeatureCount() {
    const e3 = this.viewModel.associationViewModels, t = this.selectedLayer ? e3.get(this.selectedLayer) : null;
    return t ? t.length : 0;
  }
  set currentFeaturePage(e3) {
    const { featuresPerPage: t, associatedFeatureCount: o } = this, i2 = Math.ceil(o / t) || 1, r = Math.max(Math.min(e3, i2), 1);
    this._set("currentFeaturePage", r);
  }
  get currentFeaturePage() {
    return this._get("currentFeaturePage") ?? 1;
  }
  get endIndex() {
    const { currentFeaturePage: e3, featuresPerPage: t, maxFeatureCount: o } = this;
    return Math.min(e3 * t, o);
  }
  renderConnectivityIcon(e3, t) {
    const { tooltipReferenceMap: o } = this;
    let i2;
    switch (e3) {
      case "junction-edge-from-connectivity":
        i2 = "connection-end-left";
        break;
      case "junction-edge-to-connectivity":
        i2 = "connection-end-right";
        break;
      case "junction-edge-midspan-connectivity":
        i2 = "connection-middle";
        break;
      default:
        i2 = "connection-to-connection";
    }
    return n("calcite-icon", { afterCreate: (e4) => o.set(t, e4), afterRemoved: () => o.delete(t), icon: i2, scale: "s", slot: "content-start" });
  }
  renderFeatureCountWarning() {
    const { associatedFeatureCount: e3, maxFeatureCount: t, messagesFeature: o } = this;
    return e3 > t ? n("calcite-notice", { class: this._isFeatureCountNoticeOpen ? p.limitNoticeContainer : void 0, closable: true, icon: "information", kind: "info", open: true, scale: "s", width: "full", onCalciteNoticeBeforeOpen: () => this._isFeatureCountNoticeOpen = true, onCalciteNoticeClose: () => this._isFeatureCountNoticeOpen = false }, n("div", { slot: "title" }, o.associationsLimitNoticeTitle), n("div", { slot: "message" }, s(o.associationsLimitNoticeMessage, { number: t }))) : null;
  }
  renderFeatureObserver() {
    return n("div", { afterCreate: this._onObserverCreate, bind: this, class: p.featureObserver, key: "feature-observer" });
  }
  renderFilter() {
    return n("div", { class: p.filterContainer, key: "filter" }, n("calcite-input", { icon: "search", placeholder: this.messagesFeature.associationFilterPlaceholder, type: "search", onCalciteInputInput: (e3) => {
      this.filterText = e3.currentTarget.value.trim().toLowerCase(), this.currentFeaturePage = 1;
    } }));
  }
  renderLoading() {
    return n("div", { class: p.loadingContainer, key: "loading-container" }, this.renderLoadingIcon());
  }
  renderLoadingIcon() {
    return n("calcite-loader", { inline: true, label: this.messagesCommon.loading });
  }
  getConnectivityTooltip(e3) {
    const { messagesFeature: t } = this;
    switch (e3) {
      case "connectivity":
      case "junction-junction-connectivity":
        return t.associationsJunctionJunction;
      case "junction-edge-from-connectivity":
        return t.associationsJunctionEdgeFrom;
      case "junction-edge-midspan-connectivity":
        return t.associationsJunctionEdgeMidspan;
      case "junction-edge-to-connectivity":
        return t.associationsJunctionEdgeTo;
      default:
        return "";
    }
  }
  setUpObserver() {
    this.addHandles(l(() => this._observerNode, () => this._onObserverChange()));
  }
  _increaseFeaturePage() {
    this.currentFeaturePage++;
  }
  _onObserverChange() {
    this._observerNode && this._observer.unobserve(this._observerNode);
    const { state: e3, showAllEnabled: t } = this.viewModel;
    this._observerNode && "ready" === e3 && t && this._observer.observe(this._observerNode);
  }
  _onObserverCreate(e3) {
    this._observerNode = e3;
  }
};
__decorate([m()], m2.prototype, "_observer", void 0), __decorate([m()], m2.prototype, "_observerNode", void 0), __decorate([m()], m2.prototype, "associatedFeatureCount", null), __decorate([m()], m2.prototype, "currentFeaturePage", null), __decorate([m()], m2.prototype, "endIndex", null), __decorate([m()], m2.prototype, "featuresPerPage", void 0), __decorate([m()], m2.prototype, "filterText", void 0), __decorate([m()], m2.prototype, "headingLevel", void 0), __decorate([m()], m2.prototype, "maxFeatureCount", void 0), __decorate([m(), e("esri/widgets/Feature/t9n/Feature")], m2.prototype, "messagesFeature", void 0), __decorate([m(), e("esri/t9n/common")], m2.prototype, "messagesCommon", void 0), __decorate([m()], m2.prototype, "selectedLayer", void 0), __decorate([m()], m2.prototype, "tooltipReferenceMap", void 0), __decorate([m({ type: v })], m2.prototype, "viewModel", void 0), m2 = __decorate([a("esri.widgets.support.UtilityNetworkAssociations.UtilityNetworkAssociationList")], m2);

// node_modules/@arcgis/core/widgets/support/UtilityNetworkAssociations/utils/formatPercentAlong.js
function n2(n5) {
  const { percentAlong: r } = n5;
  return null == r ? "" : c2(r, { style: "percent", maximumFractionDigits: 2 });
}

// node_modules/@arcgis/core/widgets/support/UtilityNetworkAssociations/utils/isConnectivity.js
function n3(n5) {
  const { associationType: t } = n5;
  return "connectivity" === t || "junction-junction-connectivity" === t || "junction-edge-from-connectivity" === t || "junction-edge-midspan-connectivity" === t || "junction-edge-to-connectivity" === t;
}

// node_modules/@arcgis/core/widgets/support/UtilityNetworkAssociations/utils/isConnectivityMidspan.js
function n4(n5) {
  return "junction-edge-midspan-connectivity" === n5.associationType;
}

// node_modules/@arcgis/core/widgets/Feature/FeatureUtilityNetworkAssociationList.js
var w;
var y = "esri-feature-utility-network-associations";
var f = { base: y, listItemHidden: `${y}__list-item--hidden` };
var b = "nested";
var v2 = w = class extends m2 {
  constructor(e3, t) {
    super(e3, t), this.description = null, this.flowItems = null, this.flowType = "feature-utility-network-association-type", this.listType = null, this.parentFeatureViewModel = null, this.title = null, this.viewModel = new v(), this.visibleElements = new s3();
  }
  initialize() {
    this.setUpObserver();
  }
  loadDependencies() {
    return c3({ chip: () => import("./calcite-chip-665D3ZV7.js"), icon: () => import("./calcite-icon-YAZUXSRW.js"), list: () => import("./calcite-list-Z3O7DTQI.js"), "list-item": () => import("./calcite-list-item-C7623NT4.js"), tooltip: () => import("./calcite-tooltip-4VAZVIB5.js") });
  }
  destroy() {
    this.tooltipReferenceMap.clear();
  }
  render() {
    const e3 = this.viewModel.associationViewModels, { state: t, showAllEnabled: i2 } = this.viewModel, { state: s4 } = this.parentFeatureViewModel ?? {};
    return n("div", { class: this.classes(f.base, e2.widget) }, "loading" === t || "querying" === t || "loading" === s4 ? this.renderLoading() : n("calcite-list", { displayMode: b, label: this.selectedLayer?.title ?? this.messagesCommon.untitled }, i2 && this.selectedLayer ? n(i, null, this.renderFilter(), this.renderFeatureCountWarning(), this._renderAssociatedFeatureListPage(), this.renderFeatureObserver()) : Array.from(e3.keys(), (t2) => this._renderTypeList(t2, e3.get(t2)))));
  }
  _showAllAssociations(e3) {
    const { flowItems: t, viewModel: i2, description: s4 } = this;
    if (!t || !e3) return;
    i2.showAllEnabled = true;
    const l2 = new w({ selectedLayer: e3, title: e3?.title, flowItems: t, parentFeatureViewModel: this.parentFeatureViewModel, featureVisibleElements: this.featureVisibleElements, description: s4, visibleElements: new s3({ title: false, description: false }), viewModel: i2 });
    t.push(l2);
  }
  _renderAssociatedFeatureListPage() {
    const e3 = this.viewModel.associationViewModels.get(this.selectedLayer).filter((e4) => e4.title.toLowerCase().includes(this.filterText)).slice(0, this.endIndex);
    return [...this._renderTooltips(e3), ...this._renderAssociatedFeatureList(e3)];
  }
  _renderItemTooltip(e3) {
    const { tooltipReferenceMap: t } = this;
    return n3(e3.association) ? n("calcite-tooltip", { key: `tooltip-${e3.featureViewModel.uid}`, overlayPositioning: "fixed", referenceElement: t.get(e3.featureViewModel.uid) }, this.getConnectivityTooltip(e3.association.associationType)) : null;
  }
  _renderAssociatedFeature(e3) {
    const { featureViewModel: i2, title: s4 } = e3, o = "loading" === i2.state, l2 = this._findFlowItem(i2), r = l2 < 0 && this._isParentFeature(i2), a2 = r || l2 >= 0;
    return n("calcite-list-item", { class: o ? f.listItemHidden : void 0, description: c(e3.terminalName ?? ""), key: `associated-feature-type-${i2.uid}`, label: c(s4), onCalciteListItemSelect: () => this._handleFeatureClick(r, l2, i2) }, n3(e3.association) ? this.renderConnectivityIcon(e3.association.associationType, e3.featureViewModel.uid) : null, n4(e3.association) ? n("calcite-chip", { label: n2(e3.association), scale: "s", slot: "content-end" }, n2(e3.association)) : null, this._renderChevronIconNode(a2));
  }
  async _selectAssociation(e3) {
    const { flowItems: t, featureVisibleElements: i2 } = this;
    if (!t) return;
    e3.abilities = { utilityNetworkAssociationsContent: true };
    const { default: s4 } = await import("./Feature-7YZTA6BM.js");
    t.push(new s4({ flowItems: t, flowType: "feature-association", viewModel: e3, visibleElements: i2 }));
  }
  _handleFeatureClick(e3, t, i2) {
    if (e3) this.flowItems.drain((e4) => {
      "showAllEnabled" in e4.viewModel && (e4.viewModel.showAllEnabled = false), e4.viewModel = null, e4.destroy();
    });
    else if (t < 0 || !this.flowItems) this._selectAssociation(i2);
    else for (; this.flowItems.length > t + 1; ) {
      const e4 = this.flowItems.pop();
      e4 && ("showAllEnabled" in e4.viewModel && (e4.viewModel.showAllEnabled = false), e4.viewModel = null, e4.destroy());
    }
  }
  _featureViewModelMatch(e3, t) {
    const i2 = e3.graphic, s4 = i2?.layer;
    let o = null;
    "subtype-sublayer" === s4?.type && s4.parent ? o = s4.parent.globalIdField ?? null : s4 && "globalIdField" in s4 && (o = s4.globalIdField);
    const l2 = o ? i2?.attributes[o] : null, r = t.graphic, n5 = r?.layer;
    let a2 = null;
    "subtype-sublayer" === n5?.type && n5.parent ? a2 = n5.parent.globalIdField ?? null : n5 && "globalIdField" in n5 && (a2 = n5.globalIdField);
    const c4 = a2 ? r?.attributes[a2] : null;
    return l2 && c4 && l2 === c4;
  }
  _isParentFeature(e3) {
    const t = this.flowItems?.getItemAt(0);
    if (!t) return false;
    const i2 = t.parentFeatureViewModel;
    return this._featureViewModelMatch(i2, e3);
  }
  _findFlowItem(e3) {
    return this.flowItems?.findIndex((t) => {
      if ("feature-association" !== t.flowType) return false;
      const i2 = t.viewModel;
      return this._featureViewModelMatch(i2, e3);
    }) ?? -1;
  }
  _renderTooltips(e3) {
    return e3.toArray().map((e4) => this._renderItemTooltip(e4));
  }
  _renderAssociatedFeatureList(e3) {
    return e3.toArray().map((e4) => this._renderAssociatedFeature(e4));
  }
  _renderChevronIconNode(e3) {
    return n("calcite-icon", { flipRtl: true, icon: e3 ? "move-up" : "chevron-right", scale: "s", slot: "content-end" });
  }
  _renderTypeList(e3, t) {
    const { messagesFeature: i2 } = this, { displayCount: s4 } = this.viewModel, o = t.slice(0, s4), l2 = o.length < t.length;
    return n("calcite-list-item", { expanded: true, key: "show-all", label: e3.title, value: e3.id }, n("calcite-chip", { label: String(t.length), scale: "s", slot: "content-end" }, t.length), n("calcite-list", { group: e3.id, label: e3.title ?? "" }, [this._renderTooltips(o), this._renderAssociatedFeatureList(o)], l2 ? n("calcite-list-item", { description: s(i2?.numberRecords, { number: t.length.toString() }), key: "show-all-item", label: i2.showAll, onCalciteListItemSelect: () => this._showAllAssociations(e3) }, n("calcite-icon", { icon: "list", scale: "s", slot: "content-end" })) : null));
  }
};
__decorate([m()], v2.prototype, "description", void 0), __decorate([m()], v2.prototype, "featureVisibleElements", void 0), __decorate([m()], v2.prototype, "flowItems", void 0), __decorate([m()], v2.prototype, "flowType", void 0), __decorate([m()], v2.prototype, "listType", void 0), __decorate([m()], v2.prototype, "parentFeatureViewModel", void 0), __decorate([m()], v2.prototype, "title", void 0), __decorate([m({ type: v })], v2.prototype, "viewModel", void 0), __decorate([m({ type: s3, nonNullable: true })], v2.prototype, "visibleElements", void 0), v2 = w = __decorate([a("esri.widgets.Feature.FeatureUtilityNetworkAssociationList")], v2);
var g = v2;
export {
  g as default
};
//# sourceMappingURL=FeatureUtilityNetworkAssociationList-HTGGISNB.js.map
