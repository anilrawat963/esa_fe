{
  "version": 3,
  "sources": ["../../@arcgis/core/chunks/Laserlines.glsl.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{deg2rad as e}from\"../core/mathUtils.js\";import{set as i}from\"../core/libs/gl-matrix-2/math/vec2.js\";import{create as t}from\"../core/libs/gl-matrix-2/factories/vec2f64.js\";import{t as n,e as a,n as o,b as r,k as l,d as s,i as c,g as d}from\"./vec32.js\";import{create as f}from\"../core/libs/gl-matrix-2/factories/vec3f64.js\";import{t as p}from\"./vec42.js\";import{create as g}from\"../core/libs/gl-matrix-2/factories/vec4f64.js\";import{pointAt as h}from\"../geometry/support/lineSegment.js\";import{fromPositionAndNormal as m,create as u}from\"../geometry/support/plane.js\";import{y as w,e as x,c as b}from\"./sphere.js\";import{Laserline as v}from\"../views/3d/webgl-engine/core/shaderLibrary/Laserline.glsl.js\";import{ScreenSpacePass as P}from\"../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl.js\";import{Float2PassUniform as D}from\"../views/3d/webgl-engine/core/shaderModules/Float2PassUniform.js\";import{Float3BindUniform as M}from\"../views/3d/webgl-engine/core/shaderModules/Float3BindUniform.js\";import{Float3PassUniform as S}from\"../views/3d/webgl-engine/core/shaderModules/Float3PassUniform.js\";import{Float4PassUniform as C}from\"../views/3d/webgl-engine/core/shaderModules/Float4PassUniform.js\";import{FloatBindUniform as L}from\"../views/3d/webgl-engine/core/shaderModules/FloatBindUniform.js\";import{FloatPassUniform as A}from\"../views/3d/webgl-engine/core/shaderModules/FloatPassUniform.js\";import{glsl as j}from\"../views/3d/webgl-engine/core/shaderModules/glsl.js\";import{ShaderBuilder as V}from\"../views/webgl/ShaderBuilder.js\";const y=e(6);function O(e){const i=new V;i.include(P),i.include(v,e);const t=i.fragment;if(e.lineVerticalPlaneEnabled||e.heightManifoldEnabled)if(t.uniforms.add(new A(\"maxPixelDistance\",(i,t)=>e.heightManifoldEnabled?2*t.camera.computeScreenPixelSizeAt(i.heightManifoldTarget):2*t.camera.computeScreenPixelSizeAt(i.lineVerticalPlaneSegment.origin))),t.code.add(j`float planeDistancePixels(vec4 plane, vec3 pos) {\nfloat dist = dot(plane.xyz, pos) + plane.w;\nfloat width = fwidth(dist);\ndist /= min(width, maxPixelDistance);\nreturn abs(dist);\n}`),e.spherical){const e=(e,i,t)=>n(e,i.heightManifoldTarget,t.camera.viewMatrix),i=(e,i)=>n(e,[0,0,0],i.camera.viewMatrix);t.uniforms.add(new C(\"heightManifoldOrigin\",(t,n)=>(e(G,t,n),i(_,n),a(_,_,G),o(W,_),W[3]=r(_),W)),new M(\"globalOrigin\",e=>i(G,e)),new A(\"cosSphericalAngleThreshold\",(e,i)=>1-Math.max(2,l(i.camera.eye,e.heightManifoldTarget)*i.camera.perRenderPixelRatio)/r(e.heightManifoldTarget))),t.code.add(j`float globeDistancePixels(float posInGlobalOriginLength) {\nfloat dist = abs(posInGlobalOriginLength - heightManifoldOrigin.w);\nfloat width = fwidth(dist);\ndist /= min(width, maxPixelDistance);\nreturn abs(dist);\n}\nfloat heightManifoldDistancePixels(vec4 heightPlane, vec3 pos) {\nvec3 posInGlobalOriginNorm = normalize(globalOrigin - pos);\nfloat cosAngle = dot(posInGlobalOriginNorm, heightManifoldOrigin.xyz);\nvec3 posInGlobalOrigin = globalOrigin - pos;\nfloat posInGlobalOriginLength = length(posInGlobalOrigin);\nfloat sphericalDistance = globeDistancePixels(posInGlobalOriginLength);\nfloat planarDistance = planeDistancePixels(heightPlane, pos);\nreturn cosAngle < cosSphericalAngleThreshold ? sphericalDistance : planarDistance;\n}`)}else t.code.add(j`float heightManifoldDistancePixels(vec4 heightPlane, vec3 pos) {\nreturn planeDistancePixels(heightPlane, pos);\n}`);if(e.pointDistanceEnabled&&(t.uniforms.add(new A(\"maxPixelDistance\",(e,i)=>2*i.camera.computeScreenPixelSizeAt(e.pointDistanceTarget))),t.code.add(j`float sphereDistancePixels(vec4 sphere, vec3 pos) {\nfloat dist = distance(sphere.xyz, pos) - sphere.w;\nfloat width = fwidth(dist);\ndist /= min(width, maxPixelDistance);\nreturn abs(dist);\n}`)),e.intersectsLineEnabled&&t.uniforms.add(new L(\"perScreenPixelRatio\",e=>e.camera.perScreenPixelRatio)).code.add(j`float lineDistancePixels(vec3 start, vec3 dir, float radius, vec3 pos) {\nfloat dist = length(cross(dir, pos - start)) / (length(pos) * perScreenPixelRatio);\nreturn abs(dist) - radius;\n}`),(e.lineVerticalPlaneEnabled||e.intersectsLineEnabled)&&t.code.add(j`bool pointIsWithinLine(vec3 pos, vec3 start, vec3 end) {\nvec3 dir = end - start;\nfloat t2 = dot(dir, pos - start);\nfloat l2 = dot(dir, dir);\nreturn t2 >= 0.0 && t2 <= l2;\n}`),t.main.add(j`vec3 pos;\nvec3 normal;\nfloat angleCutoffAdjust;\nfloat depthDiscontinuityAlpha;\nif (!laserlineReconstructFromDepth(pos, normal, angleCutoffAdjust, depthDiscontinuityAlpha)) {\nfragColor = vec4(0.0);\nreturn;\n}\nvec4 color = vec4(0.0);`),e.heightManifoldEnabled){t.uniforms.add(new D(\"angleCutoff\",e=>E(e)),new C(\"heightPlane\",(e,i)=>U(e.heightManifoldTarget,e.renderCoordsHelper.worldUpAtPosition(e.heightManifoldTarget,G),i.camera.viewMatrix)));const i=e.spherical?j`normalize(globalOrigin - pos)`:j`heightPlane.xyz`;t.main.add(j`\n      vec2 angleCutoffAdjusted = angleCutoff - angleCutoffAdjust;\n      // Fade out laserlines on flat surfaces\n      float heightManifoldAlpha = 1.0 - smoothstep(angleCutoffAdjusted.x, angleCutoffAdjusted.y, abs(dot(normal, ${i})));\n      vec4 heightManifoldColor = laserlineProfile(heightManifoldDistancePixels(heightPlane, pos));\n      color = max(color, heightManifoldColor * heightManifoldAlpha);`)}return e.pointDistanceEnabled&&(t.uniforms.add(new D(\"angleCutoff\",e=>E(e)),new C(\"pointDistanceSphere\",(e,i)=>w(z(e,i)))),t.main.add(j`float pointDistanceSphereDistance = sphereDistancePixels(pointDistanceSphere, pos);\nvec4 pointDistanceSphereColor = laserlineProfile(pointDistanceSphereDistance);\nfloat pointDistanceSphereAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, normalize(pos - pointDistanceSphere.xyz))));\ncolor = max(color, pointDistanceSphereColor * pointDistanceSphereAlpha);`)),e.lineVerticalPlaneEnabled&&(t.uniforms.add(new D(\"angleCutoff\",e=>E(e)),new C(\"lineVerticalPlane\",(e,i)=>I(e,i)),new S(\"lineVerticalStart\",(e,i)=>T(e,i)),new S(\"lineVerticalEnd\",(e,i)=>R(e,i))),t.main.add(j`if (pointIsWithinLine(pos, lineVerticalStart, lineVerticalEnd)) {\nfloat lineVerticalDistance = planeDistancePixels(lineVerticalPlane, pos);\nvec4 lineVerticalColor = laserlineProfile(lineVerticalDistance);\nfloat lineVerticalAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, lineVerticalPlane.xyz)));\ncolor = max(color, lineVerticalColor * lineVerticalAlpha);\n}`)),e.intersectsLineEnabled&&(t.uniforms.add(new D(\"angleCutoff\",e=>E(e)),new S(\"intersectsLineStart\",(e,i)=>n(G,e.lineStartWorld,i.camera.viewMatrix)),new S(\"intersectsLineEnd\",(e,i)=>n(G,e.lineEndWorld,i.camera.viewMatrix)),new S(\"intersectsLineDirection\",(e,i)=>(s(W,e.intersectsLineSegment.vector),W[3]=0,o(G,p(W,W,i.camera.viewMatrix)))),new A(\"intersectsLineRadius\",e=>e.intersectsLineRadius)),t.main.add(j`if (pointIsWithinLine(pos, intersectsLineStart, intersectsLineEnd)) {\nfloat intersectsLineDistance = lineDistancePixels(intersectsLineStart, intersectsLineDirection, intersectsLineRadius, pos);\nvec4 intersectsLineColor = laserlineProfile(intersectsLineDistance);\nfloat intersectsLineAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, 1.0 - abs(dot(normal, intersectsLineDirection)));\ncolor = max(color, intersectsLineColor * intersectsLineAlpha);\n}`)),t.main.add(j`fragColor = laserlineOutput(color * depthDiscontinuityAlpha);`),i}function E(t){return i(F,Math.cos(t.angleCutoff),Math.cos(Math.max(0,t.angleCutoff-e(2))))}function z(e,i){const t=n(k,e.pointDistanceOrigin,i.camera.viewMatrix),a=l(e.pointDistanceOrigin,e.pointDistanceTarget);return x($,t,a)}function I(e,i){const t=h(e.lineVerticalPlaneSegment,.5,G),n=e.renderCoordsHelper.worldUpAtPosition(t,H),a=o(_,e.lineVerticalPlaneSegment.vector),r=c(G,n,a);return o(r,r),U(e.lineVerticalPlaneSegment.origin,r,i.camera.viewMatrix)}function T(e,i){const t=s(G,e.lineVerticalPlaneSegment.origin);return e.renderCoordsHelper.setAltitude(t,0),n(t,t,i.camera.viewMatrix)}function R(e,i){const t=d(G,e.lineVerticalPlaneSegment.origin,e.lineVerticalPlaneSegment.vector);return e.renderCoordsHelper.setAltitude(t,0),n(t,t,i.camera.viewMatrix)}function U(e,i,t){return n(B,e,t),s(W,i),W[3]=0,p(W,W,t),m(B,W,N)}const F=t(),G=f(),W=g(),H=f(),_=f(),B=f(),N=u(),k=f(),$=b(),q=Object.freeze(Object.defineProperty({__proto__:null,build:O,defaultAngleCutoff:y},Symbol.toStringTag,{value:\"Module\"}));export{q as L,O as b,y as d};\n"],
  "mappings": "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",
  "names": ["e", "s", "o", "p", "t", "r", "i", "n", "_", "E", "U", "z", "H"]
}
