import {
  f
} from "./chunk-QW7RJMQR.js";
import {
  n
} from "./chunk-5ONGWFJ3.js";
import {
  E,
  l,
  y
} from "./chunk-FPMLKIDB.js";

// node_modules/@arcgis/core/views/3d/support/flow/FlowQuery3D.js
function r(t, e, n2) {
  const { extent: i2, valid: o2 } = t, [r2, l3, s2, a2] = i2;
  return !(n2 < l3 || n2 > a2) && (null != o2 && r2 > s2 ? e >= s2 || e <= r2 : e >= r2 && e <= s2);
}
function l2(n2, i2, o2, r2) {
  const { extent: l3, modelSize: s2, valid: u } = n2, [c, f3, x2] = l3, m = a(c, x2, u);
  let p = i2 / s2[0] * m + c;
  if (null != u && r2) {
    p = new n(u[0], u[1]).normalize(p);
  }
  return [p, (s2[1] - o2) / s2[1] * y(l3) + f3];
}
function a(t, e, n2) {
  if (null != n2 && t > e) {
    const [i2, o2] = n2;
    return o2 - t + (e - i2);
  }
  return e - t;
}

// node_modules/@arcgis/core/views/3d/support/flow/loadUtils.js
function f2(t) {
  return t ? 4 : 3;
}
function x(r2, o2, s2) {
  const [f3, a2] = s2.modelSize;
  let c = null;
  const h2 = /* @__PURE__ */ new Map();
  o2.forEach((t) => {
    h2.set(t.lij, f(r2, t));
  });
  const m = (n2, e, r3) => E(n2.extent, e, r3);
  return (t, l3) => {
    const d = Math.round(t), p = Math.round(l3);
    if (!r2.wrapAround && (d < 0 || d >= f3 || p < 0 || p >= a2)) return [0, 0];
    const [x2, j] = l2(s2, t, l3, true);
    if (!r(s2, x2, j)) return [0, 0];
    if (null == c || !m(c, x2, j)) {
      c = null;
      for (const [t2, n2] of o2) if (m(n2, x2, j)) {
        c = n2;
        break;
      }
    }
    if (null == c?.data) return [0, 0];
    const g = h2.get(c.lij);
    if (null == g) return [0, 0];
    const { width: w, height: M, extent: y2 } = c;
    return g((x2 - y2[0]) / l(y2) * w, M - (j - y2[1]) / y(y2) * M);
  };
}

export {
  f2 as f,
  x
};
//# sourceMappingURL=chunk-FTN6U6TO.js.map
