{
  "version": 3,
  "sources": ["../../@arcgis/core/core/workers/WorkerHandle.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{remove as e}from\"../arrayUtils.js\";import{makeHandle as t}from\"../handleUtils.js\";import s from\"../Logger.js\";import{throwIfAborted as r}from\"../promiseUtils.js\";import{open as i}from\"./workers.js\";class o{constructor(e,t,r,o,h={}){this._mainMethod=t,this._transferLists=r,this._listeners=[],this._promise=i(e,{...h,schedule:o}).then(e=>{if(void 0===this._thread){this._thread=e,this._promise=null,h.hasInitialize&&this.broadcast({},\"initialize\");for(const e of this._listeners)this._connectListener(e)}else e.close()}),this._promise.catch(t=>s.getLogger(\"esri.core.workers.WorkerHandle\").error(`Failed to initialize ${e} worker: ${t}`))}on(s,r){const i={removed:!1,eventName:s,callback:r,threadHandle:null};return this._listeners.push(i),this._connectListener(i),t(()=>{i.removed=!0,e(this._listeners,i),this._thread&&null!=i.threadHandle&&i.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null,this._listeners.length=0,this._transferLists={}}invoke(e,t,s){return this.invokeMethod(this._mainMethod,e,t,s)}invokeMethod(e,t,s,i){if(this._thread){const r=this._transferLists[e],o=r?r(t):[];return this._thread.invoke(e,t,{transferList:o,signal:s,priority:i})}return this._promise?this._promise.then(()=>(r(s),this.invokeMethod(e,t,s))):Promise.reject(null)}broadcast(e,t){return this._thread?Promise.all(this._thread.broadcast(t,e)).then(h):this._promise?this._promise.then(()=>this.broadcast(e,t)):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then(t=>{e.removed||(e.threadHandle=t)})}}function h(){}export{o as WorkerHandle};\n"],
  "mappings": ";;;;;;;;;;;;;;;AAI6M,IAAM,IAAN,MAAO;AAAA,EAAC,YAAYA,IAAE,GAAE,GAAEC,IAAEC,KAAE,CAAC,GAAE;AAAC,SAAK,cAAY,GAAE,KAAK,iBAAe,GAAE,KAAK,aAAW,CAAC,GAAE,KAAK,WAAS,EAAEF,IAAE,EAAC,GAAGE,IAAE,UAASD,GAAC,CAAC,EAAE,KAAK,CAAAD,OAAG;AAAC,UAAG,WAAS,KAAK,SAAQ;AAAC,aAAK,UAAQA,IAAE,KAAK,WAAS,MAAKE,GAAE,iBAAe,KAAK,UAAU,CAAC,GAAE,YAAY;AAAE,mBAAUF,MAAK,KAAK,WAAW,MAAK,iBAAiBA,EAAC;AAAA,MAAC,MAAM,CAAAA,GAAE,MAAM;AAAA,IAAC,CAAC,GAAE,KAAK,SAAS,MAAM,CAAAG,OAAG,EAAE,UAAU,gCAAgC,EAAE,MAAM,wBAAwBH,EAAC,YAAYG,EAAC,EAAE,CAAC;AAAA,EAAC;AAAA,EAAC,GAAGC,IAAE,GAAE;AAAC,UAAMC,KAAE,EAAC,SAAQ,OAAG,WAAUD,IAAE,UAAS,GAAE,cAAa,KAAI;AAAE,WAAO,KAAK,WAAW,KAAKC,EAAC,GAAE,KAAK,iBAAiBA,EAAC,GAAE,EAAE,MAAI;AAAC,MAAAA,GAAE,UAAQ,MAAG,EAAE,KAAK,YAAWA,EAAC,GAAE,KAAK,WAAS,QAAMA,GAAE,gBAAcA,GAAE,aAAa,OAAO;AAAA,IAAC,CAAC;AAAA,EAAC;AAAA,EAAC,UAAS;AAAC,SAAK,YAAU,KAAK,QAAQ,MAAM,GAAE,KAAK,UAAQ,OAAM,KAAK,WAAS,MAAK,KAAK,WAAW,SAAO,GAAE,KAAK,iBAAe,CAAC;AAAA,EAAC;AAAA,EAAC,OAAOL,IAAE,GAAEI,IAAE;AAAC,WAAO,KAAK,aAAa,KAAK,aAAYJ,IAAE,GAAEI,EAAC;AAAA,EAAC;AAAA,EAAC,aAAaJ,IAAE,GAAEI,IAAEC,IAAE;AAAC,QAAG,KAAK,SAAQ;AAAC,YAAM,IAAE,KAAK,eAAeL,EAAC,GAAEC,KAAE,IAAE,EAAE,CAAC,IAAE,CAAC;AAAE,aAAO,KAAK,QAAQ,OAAOD,IAAE,GAAE,EAAC,cAAaC,IAAE,QAAOG,IAAE,UAASC,GAAC,CAAC;AAAA,IAAC;AAAC,WAAO,KAAK,WAAS,KAAK,SAAS,KAAK,OAAK,EAAED,EAAC,GAAE,KAAK,aAAaJ,IAAE,GAAEI,EAAC,EAAE,IAAE,QAAQ,OAAO,IAAI;AAAA,EAAC;AAAA,EAAC,UAAUJ,IAAE,GAAE;AAAC,WAAO,KAAK,UAAQ,QAAQ,IAAI,KAAK,QAAQ,UAAU,GAAEA,EAAC,CAAC,EAAE,KAAK,CAAC,IAAE,KAAK,WAAS,KAAK,SAAS,KAAK,MAAI,KAAK,UAAUA,IAAE,CAAC,CAAC,IAAE,QAAQ,OAAO;AAAA,EAAC;AAAA,EAAC,IAAI,UAAS;AAAC,WAAO,KAAK;AAAA,EAAQ;AAAA,EAAC,iBAAiBA,IAAE;AAAC,SAAK,WAAS,KAAK,QAAQ,GAAGA,GAAE,WAAUA,GAAE,QAAQ,EAAE,KAAK,OAAG;AAAC,MAAAA,GAAE,YAAUA,GAAE,eAAa;AAAA,IAAE,CAAC;AAAA,EAAC;AAAC;AAAC,SAAS,IAAG;AAAC;",
  "names": ["e", "o", "h", "t", "s", "i"]
}
