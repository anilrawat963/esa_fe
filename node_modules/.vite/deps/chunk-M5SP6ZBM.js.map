{
  "version": 3,
  "sources": ["../../@arcgis/core/core/MemCache.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport has from\"./has.js\";const t=-3,s=t-1,i=!!has(\"esri-tests-disable-gpu-memory-measurements\");class e{constructor(t,s,i,e=0){this.name=t,this._storage=s,this.removeFunc=i,this._defaultPriority=e,this.id=`${o++}${n}`,this.size=0,this._hit=0,this._miss=0,this._storage.register(this)}destroy(){this._storage.deregister(this),this._storage=r}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(t){return this._storage.getSize(this,t)}set maxSize(t){this._storage.setMaxSize(this,t)}resetHitRate(){this._hit=this._miss=0}put(t,s,i=this._defaultPriority){this._storage.put(this,t,s,s.usedMemory,i)}pop(t){const s=this._storage.pop(this,t);return void 0===s?++this._miss:++this._hit,s}get(t){const s=this._storage.get(this,t);return void 0===s?++this._miss:++this._hit,s}peek(t){return this._storage.peek(this,t)}updateSize(t){this._storage.updateSize(this,t)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}*[Symbol.iterator](){yield*this._storage.values(this)}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}}class h{get size(){return this._size}constructor(t=10485760){this._maxSize=t,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._users=new Map,this._sizeLimits=new Map}destroy(){this.clearAll(),this._sizeLimits.clear(),this._users.clear(),this._db=null}register(t){this._users.set(t.id.slice(0,-1),t)}deregister(t){this.clear(t),this._sizeLimits.delete(t),this._users.delete(t.id.slice(0,-1))}get maxSize(){return this._maxSize}set maxSize(t){this._maxSize=Math.max(t,-1),this._checkSize()}getSize(t,s){const i=this._db.get(t.id+s);return i?.size??0}put(e,h,r,o,n){h=e.id+h;const a=this._db.get(h);if(a&&(this._size-=a.size,e.size-=a.size,this._db.delete(h),a.entry!==r&&this._notifyRemove(h,a.entry,a.size,0)),o>this._maxSize)return void this._notifyRemove(h,r,o,0);if(void 0===r)return void console.warn(\"Refusing to cache undefined entry \");if(!o||o<0)return i||console.warn(`Refusing to cache entry with size ${o} for key ${h}`),void this._notifyRemove(h,r,0,0);const c=1+Math.max(n,s)-t;this._db.set(h,new _(r,o,c)),this._size+=o,e.size+=o,this._checkSize()}updateSize(t,s){s=t.id+s;const i=this._db.get(s);if(!i)return;this._size-=i.size,t.size-=i.size;let e=i.entry.usedMemory;for(;e>this._maxSize;){const t=this._notifyRemove(s,i.entry,e,1);if(!(null!=t&&t>0))return void this._db.delete(s);e=t}i.size=e,this._size+=e,t.size+=e,this._checkSize()}pop(t,s){s=t.id+s;const i=this._db.get(s);if(i)return this._size-=i.size,t.size-=i.size,this._db.delete(s),++this._hit,i.entry;++this._miss}get(t,s){s=t.id+s;const i=this._db.get(s);if(void 0!==i)return this._db.delete(s),i.lives=i.lifetime,this._db.set(s,i),++this._hit,i.entry;++this._miss}peek(t,s){const i=this._db.get(t.id+s);return i?++this._hit:++this._miss,i?.entry}get performanceInfo(){const s={Size:Math.round(this._size/1048576)+\"/\"+Math.round(this._maxSize/1048576)+\"MB\",\"Hit rate\":Math.round(100*this._getHitRate())+\"%\",Entries:this._db.size.toString()},i={},e=new Array;this._db.forEach((t,s)=>{const h=t.lifetime;e[h]=(e[h]||0)+t.size,this._users.forEach(e=>{const{id:h,name:r}=e;if(s.startsWith(h)){const s=i[r]||0;i[r]=s+t.size}})});const h={};this._users.forEach(t=>{const s=t.name;if(\"hitRate\"in t&&\"number\"==typeof t.hitRate&&!isNaN(t.hitRate)&&t.hitRate>0){const e=i[s]||0;i[s]=e,h[s]=Math.round(100*t.hitRate)+\"%\"}else h[s]=\"0%\"});const r=Object.keys(i);r.sort((t,s)=>i[s]-i[t]),r.forEach(t=>s[t]=Math.round(i[t]/2**20)+\"MB / \"+h[t]);for(let o=e.length-1;o>=0;--o){const i=e[o];i&&(s[\"Priority \"+(o+t-1)]=Math.round(i/this._size*100)+\"%\")}return s}resetStats(){this._hit=this._miss=0,this._users.forEach(t=>t.resetHitRate())}clear(t){const s=t.id;this._db.forEach((t,i)=>{i.startsWith(s)&&(this._size-=t.size,this._db.delete(i),this._notifyRemove(i,t.entry,t.size,0))}),t.size=0}clearAll(){this._db.forEach((t,s)=>this._notifyRemove(s,t.entry,t.size,0)),this._users.forEach(t=>t.size=0),this._size=0,this._db.clear()}*values(t){for(const[s,i]of this._db)s.startsWith(t.id)&&(yield i.entry)}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(t,s,i,e){const h=this._users.get(t.split(n)[0])?.removeFunc,r=h?.(s,e,i);return\"number\"==typeof r?r:null}_checkSize(){this._sizeLimits.forEach((t,s)=>this._checkSizeLimits(t,s)),this._checkSizeLimits(this.maxSize)}setMaxSize(t,s){null==s||s<=0?this._sizeLimits.delete(t):this._sizeLimits.set(t,s)}_checkSizeLimits(t,s){const i=s??this;if(i.size<=t)return;const e=s?.id;let h=!0;for(;h;){h=!1;for(const[r,o]of this._db)if(0===o.lifetime&&(!e||r.startsWith(e))){const e=s??this._users.get(r.split(n)[0]);if(this._purgeItem(r,o,e),i.size<=.9*t)return;h||=this._db.has(r)}}for(const[r,o]of this._db)if(!e||r.startsWith(e)){const e=s??this._users.get(r.split(n)[0]);if(this._purgeItem(r,o,e),i.size<=.9*t)return}}_purgeItem(t,s,i){if(this._db.delete(t),s.lives<=1){this._size-=s.size,i&&(i.size-=s.size);const e=this._notifyRemove(t,s.entry,s.size,1);null!=e&&e>0&&(this._size+=e,i&&(i.size+=e),s.lives=s.lifetime,s.size=e,this._db.set(t,s))}else--s.lives,this._db.set(t,s)}}const r=new h(0);let o=0;class _{constructor(t,s,i){this.entry=t,this.size=s,this.lifetime=i,this.lives=i}}const n=\":\";export{e as MemCache,h as MemCacheStorage,t as MinPriority,s as NoPriority};\n"],
  "mappings": "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",
  "names": ["t", "s", "i", "h", "r", "n", "e", "t", "s", "i"]
}
