import {
  y
} from "./chunk-OVY2L7EL.js";
import "./chunk-INJCHY4H.js";
import {
  h,
  le,
  m as m3
} from "./chunk-JDUZCRWC.js";
import {
  r as r3
} from "./chunk-G7FTSXBC.js";
import {
  t as t2
} from "./chunk-TG6K2MFM.js";
import "./chunk-2QMXQ3D5.js";
import "./chunk-GIKMBX7P.js";
import "./chunk-TF4EQP5K.js";
import "./chunk-ZUQ2O3KU.js";
import "./chunk-4KVWUPLK.js";
import "./chunk-NOLINR6O.js";
import "./chunk-HIGI45S6.js";
import "./chunk-2KBTJPSU.js";
import {
  t as t3
} from "./chunk-JVMNF6GR.js";
import {
  o as o3
} from "./chunk-SL3GC7WV.js";
import {
  l as l3
} from "./chunk-CJZPTLIZ.js";
import {
  i
} from "./chunk-2U5X5TIX.js";
import "./chunk-5D65KWSM.js";
import "./chunk-ABHLEPDK.js";
import "./chunk-4FQUAV7M.js";
import "./chunk-EVZ7KLPS.js";
import {
  l as l4
} from "./chunk-JSH3APTG.js";
import "./chunk-WQT2KLDB.js";
import "./chunk-UVDECGZC.js";
import "./chunk-VKFTCFFM.js";
import {
  s as s2
} from "./chunk-ZETARPSI.js";
import {
  f as f2
} from "./chunk-TCDV4P3G.js";
import {
  b2 as b,
  y as y2
} from "./chunk-CZOYDK6P.js";
import "./chunk-RS755KXS.js";
import "./chunk-TMUM75KQ.js";
import "./chunk-KY5OS6CK.js";
import "./chunk-3U5UUY3S.js";
import "./chunk-UOYGMZIS.js";
import "./chunk-RXH2WNPA.js";
import "./chunk-TWU3GKHX.js";
import "./chunk-BGIBV6LL.js";
import "./chunk-UQXJMFRI.js";
import "./chunk-DY7N5RAZ.js";
import {
  j
} from "./chunk-6TCXGIIN.js";
import {
  l as l2
} from "./chunk-NP2TBOXH.js";
import "./chunk-WFCLXKCE.js";
import "./chunk-WX3525ER.js";
import "./chunk-FHCV4NTV.js";
import "./chunk-HCTBVF3W.js";
import "./chunk-NH6FXYCM.js";
import "./chunk-YE4E5JCT.js";
import "./chunk-SXZO7ULH.js";
import "./chunk-H34D76ZQ.js";
import "./chunk-QTRET3PG.js";
import "./chunk-FMOL5XMB.js";
import "./chunk-VNSHGTPN.js";
import "./chunk-OEBAFVQK.js";
import "./chunk-76V6RN4F.js";
import "./chunk-S5K4XWUR.js";
import "./chunk-QNW4D2V2.js";
import "./chunk-XAI6T5FU.js";
import "./chunk-QNDHLVDC.js";
import "./chunk-ZT4KW2M5.js";
import "./chunk-FHQNDU7E.js";
import "./chunk-IOJ4QFRL.js";
import "./chunk-EK7HOTRR.js";
import "./chunk-GCTH5LET.js";
import "./chunk-TTLSEJNG.js";
import "./chunk-ZVTEFYZX.js";
import "./chunk-LPUPM55U.js";
import "./chunk-EKZRA6TO.js";
import "./chunk-M5SP6ZBM.js";
import "./chunk-2HGIYEIL.js";
import "./chunk-XX3OKYJS.js";
import "./chunk-OTCNIJ2H.js";
import "./chunk-JGA5YJWL.js";
import "./chunk-GCI4MA3M.js";
import "./chunk-SJ2OBYX2.js";
import "./chunk-MDJNYPVI.js";
import "./chunk-Z6VKIQV2.js";
import "./chunk-4PXNA4MD.js";
import "./chunk-7HTU7ZUX.js";
import "./chunk-647DAMHU.js";
import "./chunk-O6G3PPOK.js";
import "./chunk-ZKNZTIAS.js";
import "./chunk-OJMISN3F.js";
import "./chunk-EFV6H5NA.js";
import "./chunk-6VL5D5UP.js";
import "./chunk-6QHY54HZ.js";
import "./chunk-GXJJY3ND.js";
import "./chunk-5ONGWFJ3.js";
import "./chunk-PLNHHGHL.js";
import "./chunk-QZQPB5XR.js";
import "./chunk-AQFRVV3U.js";
import {
  p
} from "./chunk-PEL3D3ZN.js";
import "./chunk-Q5KWD3VQ.js";
import "./chunk-BUQC3CLV.js";
import {
  t
} from "./chunk-W5S3VUFT.js";
import "./chunk-7YH7T6CS.js";
import {
  c
} from "./chunk-3T4IXPP4.js";
import "./chunk-XTZAIV4X.js";
import "./chunk-63LDVRFI.js";
import "./chunk-C3FRY5U4.js";
import "./chunk-JNJX34GB.js";
import "./chunk-3STJRSDT.js";
import "./chunk-67Q6KVC6.js";
import "./chunk-23NJHA5Q.js";
import "./chunk-4LA6K4VI.js";
import "./chunk-KEZCWFAR.js";
import "./chunk-JZUJ34RR.js";
import "./chunk-PMGS7UDU.js";
import "./chunk-3GHCGAH2.js";
import "./chunk-HWUOAPTX.js";
import "./chunk-QHCKOBU7.js";
import "./chunk-K2OZ6WVC.js";
import "./chunk-MC6NAKKX.js";
import "./chunk-TF6255HN.js";
import "./chunk-GD4FJL3C.js";
import "./chunk-C5OQVQZF.js";
import "./chunk-F7DKSAOI.js";
import "./chunk-4SOQWNPG.js";
import "./chunk-LTULADK2.js";
import "./chunk-35ST7YRB.js";
import "./chunk-EDA5QFHZ.js";
import {
  l
} from "./chunk-RO646JIV.js";
import "./chunk-XXBJY7RN.js";
import "./chunk-CNYNCKEV.js";
import "./chunk-XL5QPCXN.js";
import "./chunk-2LC2762W.js";
import "./chunk-W6HOAVT4.js";
import "./chunk-DTZUXJMD.js";
import "./chunk-YLAGKT2D.js";
import "./chunk-6YRQYUCY.js";
import "./chunk-W75DBJD7.js";
import "./chunk-QF7FRVN6.js";
import {
  b as b2
} from "./chunk-P6IKJIMO.js";
import {
  m as m2
} from "./chunk-MHV23XAQ.js";
import "./chunk-V2X4OKYI.js";
import "./chunk-LPZUGJNG.js";
import "./chunk-XLOINTMG.js";
import "./chunk-MA3QDRC3.js";
import "./chunk-W6J7XCPU.js";
import "./chunk-ONXWBTTM.js";
import "./chunk-T7F6Q6JJ.js";
import "./chunk-YDTPM7OQ.js";
import "./chunk-75XOUSSS.js";
import "./chunk-TH4EQWJJ.js";
import "./chunk-7P2ANHQ3.js";
import "./chunk-XCKT47LJ.js";
import "./chunk-3FUHCAX3.js";
import "./chunk-PZ5RULLK.js";
import "./chunk-OPJX4KXH.js";
import "./chunk-LTPHDYPK.js";
import "./chunk-3OVERDFX.js";
import "./chunk-FPMLKIDB.js";
import "./chunk-AZXJIEZ6.js";
import "./chunk-Q75WYS7K.js";
import {
  z
} from "./chunk-H74Q4SYB.js";
import "./chunk-2OFHDVO5.js";
import "./chunk-TFJXG32O.js";
import "./chunk-DDOCCRD4.js";
import "./chunk-5UPBUJPC.js";
import {
  a as a2
} from "./chunk-THQO67BJ.js";
import "./chunk-4YDOPHTZ.js";
import "./chunk-YY5PITIH.js";
import "./chunk-CCQFL76O.js";
import "./chunk-CSMCPN64.js";
import "./chunk-GY6YF4EN.js";
import "./chunk-7H3U4IJR.js";
import "./chunk-SMWUT52Z.js";
import "./chunk-AXZMNHTN.js";
import "./chunk-5T3MJDSR.js";
import {
  A,
  ae,
  o2
} from "./chunk-NMQNUPE4.js";
import "./chunk-6KIXN4DJ.js";
import "./chunk-7DGJB37R.js";
import "./chunk-234CIOHE.js";
import {
  H2 as H
} from "./chunk-V2H77UEV.js";
import "./chunk-WRA2WBYC.js";
import {
  o
} from "./chunk-XWE6BM2U.js";
import {
  r as r2
} from "./chunk-SOIZOFSB.js";
import "./chunk-XXLHAM2M.js";
import {
  m,
  r3 as r
} from "./chunk-5EI5H4QX.js";
import {
  a2 as a,
  x
} from "./chunk-ZIE53VIV.js";
import {
  __decorate
} from "./chunk-SS5CLIUY.js";
import "./chunk-R54Q5TGA.js";
import "./chunk-6SSZNBOK.js";
import "./chunk-LZ2XTYP2.js";
import "./chunk-45CFSCQX.js";
import "./chunk-A5XN2VFT.js";
import "./chunk-65HD3WXL.js";
import "./chunk-4DGC7CBY.js";
import {
  L,
  d,
  f2 as f
} from "./chunk-GNMPGHLQ.js";
import {
  s2 as s
} from "./chunk-QY7XKUIV.js";
import "./chunk-AL6YUTZM.js";
import "./chunk-G26ADAPQ.js";

// node_modules/@arcgis/core/layers/MapImageLayer.js
var G = class extends p(l4(t(m3(h(l3(b(j(l2(f2(o3(s2(b2)))))))))))) {
  constructor(...e) {
    super(...e), this._exportImageParameters = new y({ layer: this }), this.dateFieldsTimeZone = null, this.datesInUnknownTimezone = false, this.dpi = 96, this.elevationInfo = new c({ mode: "on-the-ground" }), this.gdbVersion = null, this.imageFormat = "png24", this.imageMaxHeight = 2048, this.imageMaxWidth = 2048, this.imageTransparency = true, this.isReference = null, this.labelsVisible = false, this.operationalLayerType = "ArcGISMapServiceLayer", this.preferredTimeZone = null, this.sourceJSON = null, this.sublayers = null, this.type = "map-image", this.url = null, this._debouncedSaveOperations = L(async (e2, r4, t4) => {
      const { save: i2, saveAs: s3 } = await import("./mapImageLayerUtils-4LYMPTO6.js");
      switch (e2) {
        case 0:
          return i2(this, r4);
        case 1:
          return s3(this, t4, r4);
      }
    });
  }
  normalizeCtorArgs(e, r4) {
    return "string" == typeof e ? { url: e, ...r4 } : e;
  }
  load(e) {
    const r4 = null != e ? e.signal : null;
    return this.addResolvingPromise(this.loadFromPortal({ supportedTypes: ["Map Service"] }, e).catch(f).then(() => this._fetchService(r4))), Promise.resolve(this);
  }
  destroy() {
    this._exportImageParameters.destroy();
  }
  readImageFormat(e, r4) {
    const t4 = r4.supportedImageFormatTypes;
    return t4 && t4.includes("PNG32") ? "png32" : "png24";
  }
  get loaded() {
    return super.loaded;
  }
  set portalItem(e) {
    super.portalItem = e;
  }
  writeSublayers(e, r4, t4, i2) {
    if (!this.loaded || !e) return;
    const s3 = e.slice().reverse().flatten(({ sublayers: e2 }) => e2 && e2.toArray().reverse()).toArray();
    let o4 = false;
    const a3 = r(i2.origin);
    let p2;
    if (this.capabilities?.operations.supportsExportMap && this.capabilities?.exportMap?.supportsDynamicLayers) {
      if (3 === a3) {
        const e2 = this.createSublayersForOrigin("service").sublayers;
        o4 = r3(s3, e2, 2);
      } else if (a3 > 3) {
        const e2 = this.createSublayersForOrigin("portal-item");
        o4 = r3(s3, e2.sublayers, r(e2.origin)), p2 = e2.originWithPartialOverrides;
      }
    }
    const n = [], m4 = { writeSublayerStructure: o4, ...i2, minimumWritableOrigin: p2 };
    let l5 = o4 || this.hasVisibleLayersForOrigin(a3);
    s3.forEach((e2) => {
      const r5 = e2.write({}, m4);
      n.push(r5), l5 = l5 || "user" === e2.originOf("visible");
    });
    n.some((e2) => Object.keys(e2).length > 1) && (r4.layers = n), l5 && (r4.visibleLayers = s3.filter((e2) => e2.visible).map((e2) => e2.id));
  }
  createExportImageParameters(e, r4, t4, i2) {
    const s3 = i2?.pixelRatio || 1;
    e && this.version >= 10 && (e = e.clone().shiftCentralMeridian()), this._exportImageParameters.floors = i2?.floors ?? null, this._exportImageParameters.scale = i2?.scale || i({ extent: e, width: r4 }) * s3;
    const o4 = this._exportImageParameters.toJSON(), a3 = !i2?.rotation || this.version < 10.3 ? {} : { rotation: -i2.rotation }, p2 = e?.spatialReference, l5 = A(p2);
    if (i2?.scale && e) {
      const t5 = e.width / r4 * (ae(e?.spatialReference) * o2);
      o4.dpi = i2.scale / t5;
    }
    o4.dpi *= s3;
    const c2 = {};
    if (i2?.timeExtent) {
      const { start: e2, end: r5 } = i2.timeExtent.toJSON();
      c2.time = e2 && r5 && e2 === r5 ? "" + e2 : `${e2 ?? "null"},${r5 ?? "null"}`;
    } else this.timeInfo && !this.timeInfo.hasLiveData && (c2.time = "null,null");
    return { bbox: e ? e.xmin + "," + e.ymin + "," + e.xmax + "," + e.ymax : void 0, bboxSR: l5, imageSR: l5, size: r4 + "," + t4, ...o4, ...a3, ...c2 };
  }
  async fetchImage(e, r4, t4, i2) {
    const { data: s3 } = await this._fetchImage("image", e, r4, t4, i2);
    return s3;
  }
  async fetchImageBitmap(e, r4, t4, i2) {
    const { data: s3, url: o4 } = await this._fetchImage("blob", e, r4, t4, i2);
    return t2(s3, o4, i2?.signal);
  }
  async fetchRecomputedExtents(e = {}) {
    const t4 = { ...e, query: { returnUpdates: true, f: "json", ...this.customParameters, token: this.apiKey } }, { data: i2 } = await H(this.url, t4), { extent: s3, fullExtent: o4, timeExtent: a3 } = i2, p2 = s3 || o4;
    return { fullExtent: p2 && z.fromJSON(p2), timeExtent: a3 && m2.fromJSON({ start: a3[0], end: a3[1] }) };
  }
  loadAll() {
    return l(this, (e) => {
      e(this.allSublayers), e(this.subtables);
    });
  }
  async save(e) {
    return this._debouncedSaveOperations(0, e);
  }
  async saveAs(e, r4) {
    return this._debouncedSaveOperations(1, r4, e);
  }
  serviceSupportsSpatialReference(e) {
    return t3(this, e);
  }
  async _fetchImage(e, i2, s3, o4, a3) {
    const n = { responseType: e, signal: a3?.signal ?? null, query: { ...this.parsedUrl.query, ...this.createExportImageParameters(i2, s3, o4, a3), f: "image", ...this.refreshParameters, ...this.customParameters, token: this.apiKey } }, m4 = this.parsedUrl.path + "/export";
    if (null != n.query?.dynamicLayers && !this.capabilities?.exportMap?.supportsDynamicLayers) throw new s("mapimagelayer:dynamiclayer-not-supported", `service ${this.url} doesn't support dynamic layers, which is required to be able to change the sublayer's order, rendering, labeling or source.`, { query: n.query });
    try {
      const { data: e2 } = await H(m4, n);
      return { data: e2, url: m4 };
    } catch (l5) {
      if (d(l5)) throw l5;
      throw new s("mapimagelayer:image-fetch-error", `Unable to load image: ${m4}`, { error: l5 });
    }
  }
  async _fetchService(e) {
    if (this.sourceJSON) return void this.read(this.sourceJSON, { origin: "service", url: this.parsedUrl });
    const { data: t4, ssl: i2 } = await H(this.parsedUrl.path, { query: { f: "json", ...this.parsedUrl.query, ...this.customParameters, token: this.apiKey }, signal: e });
    i2 && (this.url = this.url.replace(/^http:/i, "https:")), this.sourceJSON = t4, this.read(t4, { origin: "service", url: this.parsedUrl });
  }
  hasVisibleLayersForOrigin(e) {
    return !(null == e || !this.sublayersSourceJSON[e]?.visibleLayers);
  }
};
__decorate([m(a2("dateFieldsTimeReference"))], G.prototype, "dateFieldsTimeZone", void 0), __decorate([m({ type: Boolean })], G.prototype, "datesInUnknownTimezone", void 0), __decorate([m()], G.prototype, "dpi", void 0), __decorate([m()], G.prototype, "elevationInfo", void 0), __decorate([m()], G.prototype, "gdbVersion", void 0), __decorate([m()], G.prototype, "imageFormat", void 0), __decorate([o("imageFormat", ["supportedImageFormatTypes"])], G.prototype, "readImageFormat", null), __decorate([m({ json: { origins: { service: { read: { source: "maxImageHeight" } } } } })], G.prototype, "imageMaxHeight", void 0), __decorate([m({ json: { origins: { service: { read: { source: "maxImageWidth" } } } } })], G.prototype, "imageMaxWidth", void 0), __decorate([m()], G.prototype, "imageTransparency", void 0), __decorate([m({ type: Boolean, json: { read: false, write: { enabled: true, overridePolicy: () => ({ enabled: false }) } } })], G.prototype, "isReference", void 0), __decorate([m({ json: { read: false, write: false } })], G.prototype, "labelsVisible", void 0), __decorate([m({ type: ["ArcGISMapServiceLayer"] })], G.prototype, "operationalLayerType", void 0), __decorate([m({ json: { read: false, write: false } })], G.prototype, "popupEnabled", void 0), __decorate([m(a2("preferredTimeReference"))], G.prototype, "preferredTimeZone", void 0), __decorate([m()], G.prototype, "sourceJSON", void 0), __decorate([m({ json: { write: { ignoreOrigin: true } } })], G.prototype, "sublayers", void 0), __decorate([r2("sublayers", { layers: { type: [le] }, visibleLayers: { type: [x] } })], G.prototype, "writeSublayers", null), __decorate([m({ type: ["show", "hide", "hide-children"], json: { origins: { "portal-item": { read: false, write: false } } } })], G.prototype, "listMode", void 0), __decorate([m({ json: { read: false }, readOnly: true, value: "map-image" })], G.prototype, "type", void 0), __decorate([m(y2)], G.prototype, "url", void 0), G = __decorate([a("esri.layers.MapImageLayer")], G);
var V = G;
export {
  V as default
};
//# sourceMappingURL=MapImageLayer-VQUQ2MO2.js.map
