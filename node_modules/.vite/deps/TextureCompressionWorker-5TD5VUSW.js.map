{
  "version": 3,
  "sources": ["../../@arcgis/core/libs/basisu/BasisUEncoder.js", "../../@arcgis/core/libs/dxtEncoder/DXTEncoder.js", "../../@arcgis/core/views/support/TextureCompressionWorker.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{getAssetUrl as i}from\"../../assets.js\";function s(){return t??=(async()=>{const s=await import(\"../../chunks/basis_encoder.js\"),t=await s.default({locateFile:s=>i(`esri/libs/basisu/${s}`)});return t.initializeBasis(),t})(),t}let t;function a(){t=null}export{a as destroyBasisEncoder,s as getBasisEncoder};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{getAssetUrl as t}from\"../../assets.js\";function e(){return n??=(async()=>{const e=await import(\"../../chunks/dxt_encoder.js\");return await e.default({locateFile:e=>t(`esri/libs/dxtEncoder/${e}`)})})(),n}let n;function r(){n=null}export{r as destroyDXTEncoder,e as getDXTEncoder};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{getBasisEncoder as e,destroyBasisEncoder as t}from\"../../libs/basisu/BasisUEncoder.js\";import{getDXTEncoder as n,destroyDXTEncoder as r}from\"../../libs/dxtEncoder/DXTEncoder.js\";import{CompressedTextureFormat as a}from\"../webgl/enums.js\";let l,s,i=null,o=null;class u{constructor(e,t){this.internalFormat=e,this.compressedTexture=t}}function c(){i=null,l=null,o=null,s=null,t(),r()}async function h(e){let t;t=e.data instanceof ImageBitmap?w(e.data):y(e.data,e.width,e.height,e.components,e.needsFlip);try{if(e.hasS3TC){o||await d();const n=new Uint8Array(t.length);if(o?.encode(t,e.width,e.height,e.preMultiplyAlpha,n)){const e=U(n,!0),t=[n.buffer];return{result:new u(e?.internalFormat??null,e?.textureData??null),transferList:t}}return{result:new u(null,null)}}if(e.hasETC){if(i||await f(),e.preMultiplyAlpha&&!o&&await d(),e.preMultiplyAlpha){const n=new Uint8ClampedArray(t.length);o?.premultiply(new Uint8Array(t),e.width,e.height,n),t=n}const n=p(t,e.width,e.height,e.hasMipmap),r=n?m(n):null,a=r?.compressedTexture?.levels.map(e=>e.buffer)||[];return{result:new u(r?.internalFormat??null,r?.compressedTexture??null),transferList:a}}return{result:new u(null,null)}}finally{t instanceof ImageBitmap&&t.close()}}async function f(){i||(i=await(l??=e()),l=null)}async function d(){o||(o=await(s??=n()),s=null)}function p(e,t,n,r,a=255,l=0,s=!1,o=!1){if(!i)return null;const u=new i.BasisEncoder;u.setPerceptual(!o),u.setCheckForAlpha(!0),u.setForceAlpha(!1),u.setRenormalize(o),u.setMipGen(r),u.setMipSRGB(!o),u.setCreateKTX2File(!0),u.setKTX2SRGBTransferFunc(!o),u.setQualityLevel(a),u.setCompressionLevel(l);const c=new Uint8Array(e.byteLength);u.setSliceSourceImage(0,new Uint8Array(e),t,n,s);const h=u.encode(c),f=new Uint8Array(c.buffer,0,h),d=new i.KTX2File(new Uint8Array(f));return d.isValid()?(u.delete(),f):(d.close(),d.delete(),u.delete(),null)}function m(e){if(!i)return new u(null,null);const t=new i.KTX2File(new Uint8Array(e));t.startTranscoding();const[n,r]=t.getHasAlpha()?[1,a.COMPRESSED_RGBA8_ETC2_EAC]:[0,a.COMPRESSED_RGB8_ETC2],l=t.getLevels(),s=[];for(let a=0;a<l;a++)s.push(new Uint8Array(t.getImageTranscodedSizeInBytes(a,0,0,n))),t.transcodeImage(s[a],a,0,0,n,0,-1,-1);return t.close(),t.delete(),{internalFormat:r,compressedTexture:{type:\"compressed\",levels:s}}}function w(e){const t=new OffscreenCanvas(e.width,e.height),n=t.getContext(\"2d\");n.drawImage(e,0,0);return n.getImageData(0,0,t.width,t.height).data}function y(e,t,n,r,a){const l=new Uint8ClampedArray(e).subarray(0,t*n*r);if(!a)return l;const s=new Uint8ClampedArray(l.length),i=t*r;for(let o=0;o<n;o++){const e=o*i,t=(n-o-1)*i;s.set(l.subarray(e,e+i),t)}return s}const T=31,A=1,g=2,C=3,E=4,S=7,b=21,_=131072;function D(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}const M=D(\"DXT1\"),X=D(\"DXT3\"),R=D(\"DXT5\");function U(e,t){const n=new Int32Array(e.buffer,e.byteOffset,T);let r,l;switch(n[b]){case M:r=8,l=a.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case X:r=16,l=a.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case R:r=16,l=a.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return null}let s=1,i=n[E],o=n[C];(3&i||3&o)&&(i=i+3&-4,o=o+3&-4);const u=i,c=o;let h,f;n[g]&_&&!1!==t&&(s=Math.max(1,n[S]));let d=e.byteOffset+n[A]+4;const p=[];for(let a=0;a<s;++a)f=(i+3>>2)*(o+3>>2)*r,h=new Uint8Array(e.buffer,d,f),p.push(h),d+=f,i=Math.max(1,i>>1),o=Math.max(1,o>>1);return{textureData:{type:\"compressed\",levels:p},internalFormat:l,width:u,height:c}}export{u as TextureCompressionWorkerOutput,h as compress,p as compressRGBADataToKTX2,m as createTextureDataKTX2,c as destroy,f as initializeBasisEncoder,d as initializeDXTEncoder};\n"],
  "mappings": "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",
  "names": ["s", "t", "n", "e", "s", "e", "t", "n", "r", "a", "l", "o", "u", "c", "h", "f", "d", "i", "p"]
}
