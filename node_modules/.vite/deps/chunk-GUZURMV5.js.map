{
  "version": 3,
  "sources": ["../../@arcgis/core/layers/support/featurePopupQueryUtils.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{sqlAnd as e}from\"../../core/sql.js\";import{unpackFieldNames as t,featureHasFields as o}from\"./fieldUtils.js\";import{loadArcade as i}from\"../../support/loadArcade.js\";async function n(i,n,s,r){const u=new Array(n.length),l=new Map,c=new Map,a=t(i.fieldsIndex,s.outFields),d=!0===i.capabilities?.operations?.supportsQuery&&null!=i.queryFeatures,f=r?.hasRequiredFields??o;for(let e=0;e<n.length;e++){const t=n[e];if(d&&!t.isAggregate){if(s.returnGeometry||!f(t,a)){const o=t.getObjectId();if(null!=o){l.set(o,{graphic:t,index:e});continue}const i=t.getGlobalId();if(null!=i){c.set(i,{graphic:t,index:e});continue}}u[e]=t}else u[e]=t}if(!d||!i.queryFeatures||0===l.size&&0===c.size)return u.filter(Boolean);const p=[],y=(e,t)=>{t&&(e.outFields??=[],e.outFields.includes(t)||e.outFields.push(t))};if(l.size>0){const e=s.clone();y(e,i.objectIdField),\"uniqueIdFields\"in i&&i.uniqueIdFields?.length&&(e.outFields??=[],e.outFields.push(...i.uniqueIdFields)),e.objectIds=Array.from(l.keys()),p.push({type:\"object-id\",query:e,map:l})}const g=\"globalIdField\"in i?i.globalIdField:null;if(null!=g&&c.size>0){const t=s.clone();y(t,g);const o=Array.from(c.keys());t.where=e(s.where,`${g} IN (${o.map(e=>`'${e}'`).join(\",\")})`),p.push({type:\"global-id\",query:t,map:c})}const b=r?.updateSourceAttributes??!1;for(const{type:e,query:t,map:o}of p)try{const n=await i.queryFeatures(t,r);for(const t of n.features){const i=\"object-id\"===e?t.getObjectId():t.getGlobalId();if(null==i)continue;const n=o.get(i);if(!n)continue;const{graphic:s,index:r}=n;if(b&&t.attributes){s.attributes??={};for(const e of a)e in t.attributes&&(s.attributes[e]=t.attributes[e])}const{geometry:l,origin:c}=s;t.geometry||=l,t.origin=c,u[r]=t}}catch{}return u.filter(Boolean)}async function s(e){if(e.expressionInfos?.length||Array.isArray(e.content)&&e.content.some(e=>\"expression\"===e.type))return i()}export{n as fetchFeaturePopupFeatures,s as loadFeaturePopupArcadeModules};\n"],
  "mappings": "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",
  "names": ["n", "s", "l", "e", "i", "t", "r", "c"]
}
