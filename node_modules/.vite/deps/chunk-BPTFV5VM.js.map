{
  "version": 3,
  "sources": ["../../@arcgis/core/core/support/UpdatingHandles.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{__decorate as e}from\"tslib\";import s from\"../Accessor.js\";import{makeHandle as t}from\"../handleUtils.js\";import{watch as i,when as n,on as d,sync as a}from\"../reactiveUtils.js\";import{schedule as r}from\"../scheduling.js\";import{property as o}from\"../accessorSupport/decorators/property.js\";import{subclass as l}from\"../accessorSupport/decorators/subclass.js\";let h=class extends s{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll()}add(e,s,t={}){return this._installWatch(e,s,t,i)}addWhen(e,s,t={}){return this._installWatch(e,s,t,n)}addOnCollectionChange(e,s,{initial:i=!1,final:n=!1}={}){const r=++this._handleId;return this.addHandles([d(e,\"after-changes\",this._createSyncUpdatingCallback(),a),d(e,\"change\",s,{onListenerAdd:i?e=>s({added:e.toArray(),removed:[]}):void 0,onListenerRemove:n?e=>s({added:[],removed:e.toArray()}):void 0})],r),t(()=>this.removeHandles(r))}addPromise(e){if(null==e)return e;const s=++this._handleId;this.addHandles(t(()=>{this._pendingPromises.delete(e)&&(0!==this._pendingPromises.size||this.hasHandles(c)||this._set(\"updating\",!1))}),s),this._pendingPromises.add(e),this._set(\"updating\",!0);const i=()=>this.removeHandles(s);return e.then(i,i),e}removeAll(){this._pendingPromises.clear(),this.removeAllHandles(),this._set(\"updating\",!1)}_installWatch(e,s,i={},n){const d=++this._handleId;i.sync||this._installSyncUpdatingWatch(e,d);const a=n(e,s,i);return this.addHandles(a,d),t(()=>this.removeHandles(d))}_installSyncUpdatingWatch(e,s){const t=this._createSyncUpdatingCallback(),n=i(e,t,{sync:!0,equals:()=>!1});return this.addHandles(n,s),n}_createSyncUpdatingCallback(){return()=>{this.removeHandles(c),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get(\"updating\")||this._set(\"updating\",!0),this.addHandles(r(()=>{e===this._scheduleHandleId&&(this._set(\"updating\",this._pendingPromises.size>0),this.removeHandles(c))}),c)}}};e([o({readOnly:!0})],h.prototype,\"updating\",void 0),h=e([l(\"esri.core.support.UpdatingHandles\")],h);const c=-42;export{h as UpdatingHandles};\n"],
  "mappings": "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",
  "names": ["e", "a"]
}
