import {
  i3 as i,
  s2 as s
} from "./chunk-QY7XKUIV.js";

// node_modules/@arcgis/core/views/webgl/ShaderBuilder.js
var r = () => i.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");
var n = class {
  constructor() {
    this._includedModules = /* @__PURE__ */ new Map();
  }
  include(e, t) {
    this._includedModules.has(e) ? this._includedModules.get(e) : (this._includedModules.set(e, t), e(this.builder, t));
  }
};
var s2 = class extends n {
  constructor() {
    super(...arguments), this.vertex = new u(), this.fragment = new u(), this.attributes = new c(), this.varyings = new h(), this.extensions = new m(), this.outputs = new _();
  }
  get fragmentUniforms() {
    return this.fragment.uniforms.entries;
  }
  get attributeNames() {
    return this.attributes.names;
  }
  get builder() {
    return this;
  }
  generate(e, t = false) {
    const r2 = this.extensions.generateSource(e), n2 = this.attributes.generateSource(e), s3 = this.varyings.generateSource(e), i3 = "vertex" === e ? this.vertex : this.fragment, a2 = i3.uniforms.generateSource(), o2 = i3.code.generateSource(), u2 = i3.main.generateSource(t), c2 = "vertex" === e ? p : l, h2 = i3.constants.generateSource(), m2 = this.outputs.generateSource(e);
    return `#version 300 es
${r2.join("\n")}
${c2}
${h2.join("\n")}
${a2.join("\n")}
${n2.join("\n")}
${s3.join("\n")}
${m2.join("\n")}
${o2.join("\n")}
${u2.join("\n")}`;
  }
  generateBind(e) {
    const t = /* @__PURE__ */ new Map();
    this.vertex.uniforms.entries.forEach((e2) => {
      const r3 = e2.bind[0];
      r3 && t.set(e2.name, r3);
    }), this.fragment.uniforms.entries.forEach((e2) => {
      const r3 = e2.bind[0];
      r3 && t.set(e2.name, r3);
    });
    const r2 = Array.from(t.values()), n2 = r2.length;
    return (t2) => {
      for (let s3 = 0; s3 < n2; ++s3) r2[s3](e, t2);
    };
  }
  generateBindPass(e) {
    const t = /* @__PURE__ */ new Map();
    this.vertex.uniforms.entries.forEach((e2) => {
      const r3 = e2.bind[1];
      r3 && t.set(e2.name, r3);
    }), this.fragment.uniforms.entries.forEach((e2) => {
      const r3 = e2.bind[1];
      r3 && t.set(e2.name, r3);
    });
    const r2 = Array.from(t.values()), n2 = r2.length;
    return (t2, s3) => {
      for (let i3 = 0; i3 < n2; ++i3) r2[i3](e, t2, s3);
    };
  }
  generateBindDraw(e) {
    const t = /* @__PURE__ */ new Map();
    this.vertex.uniforms.entries.forEach((e2) => {
      const r3 = e2.bind[2];
      r3 && t.set(e2.name, r3);
    }), this.fragment.uniforms.entries.forEach((e2) => {
      const r3 = e2.bind[2];
      r3 && t.set(e2.name, r3);
    });
    const r2 = Array.from(t.values()), n2 = r2.length;
    return (t2, s3, i3) => {
      for (let a2 = 0; a2 < n2; ++a2) r2[a2](e, i3, t2, s3);
    };
  }
};
var i2 = class {
  constructor(e) {
    this._stage = e, this._entries = /* @__PURE__ */ new Map();
  }
  add(...e) {
    for (const t of e) this._add(t);
    return this._stage;
  }
  get(e) {
    return this._entries.get(e);
  }
  _add(t) {
    if (null != t) {
      if (this._entries.has(t.name) && !this._entries.get(t.name).equals(t)) throw new s("shaderbuilder:duplicate-uniform", `Duplicate uniform name ${t.name} for different uniform type`);
      this._entries.set(t.name, t);
    } else r().error(`Trying to add null Uniform from ${new Error().stack}.`);
  }
  generateSource() {
    return Array.from(this._entries.values()).map(({ name: e, arraySize: t, type: r2 }) => null != t ? `uniform ${r2} ${e}[${t}];` : `uniform ${r2} ${e};`);
  }
  get entries() {
    return Array.from(this._entries.values());
  }
};
var a = class {
  constructor(e) {
    this._stage = e, this._bodies = new Array();
  }
  add(e) {
    return this._bodies.push(e), this._stage;
  }
  generateSource(t) {
    if (this._bodies.length > 0) return [`void main() {
 ${this._bodies.join("\n") || ""} 
}`];
    if (t) throw new s("shaderbuilder:missing-main", "Shader does not contain main function body.");
    return [];
  }
};
var o = class {
  constructor(e) {
    this._stage = e, this._entries = new Array();
  }
  add(e) {
    return this._entries.push(e), this._stage;
  }
  generateSource() {
    return this._entries;
  }
};
var u = class extends n {
  constructor() {
    super(...arguments), this.uniforms = new i2(this), this.main = new a(this), this.code = new o(this), this.constants = new d(this);
  }
  get builder() {
    return this;
  }
};
var c = class {
  constructor() {
    this._entries = new Array();
  }
  add(e, t) {
    this._entries.push([e, t]);
  }
  generateSource(e) {
    return "fragment" === e ? [] : this._entries.map((e2) => `in ${e2[1]} ${e2[0]};`);
  }
  get names() {
    return this._entries.map(([e]) => e);
  }
};
var h = class {
  constructor() {
    this._entries = /* @__PURE__ */ new Map();
  }
  add(e, t, n2) {
    this._entries.has(e) ? r().warn(`Ignoring duplicate varying ${t} ${e}`) : this._entries.set(e, { type: t, invariant: n2?.invariant ?? false });
  }
  generateSource(e) {
    const t = new Array();
    return this._entries.forEach((r2, n2) => t.push((r2.invariant && "vertex" === e ? "invariant " : "") + ("int" === r2.type ? "flat " : "") + ("vertex" === e ? "out" : "in") + ` ${r2.type} ${n2};`)), t;
  }
};
var _m = class _m {
  constructor() {
    this._entries = /* @__PURE__ */ new Set();
  }
  add(e) {
    this._entries.add(e);
  }
  generateSource(e) {
    const t = "vertex" === e ? _m.ALLOWLIST_VERTEX : _m.ALLOWLIST_FRAGMENT;
    return Array.from(this._entries).filter((e2) => t.includes(e2)).map((e2) => `#extension ${e2} : enable`);
  }
};
_m.ALLOWLIST_FRAGMENT = ["GL_EXT_shader_texture_lod", "GL_OES_standard_derivatives"];
_m.ALLOWLIST_VERTEX = [];
var m = _m;
var __ = class __ {
  constructor() {
    this._entries = /* @__PURE__ */ new Map();
  }
  add(e, t, n2 = 0) {
    const s3 = this._entries.get(n2);
    s3?.name !== e || s3?.type !== t ? this._entries.set(n2, { name: e, type: t }) : r().warn(`Fragment shader output location ${n2} occupied`);
  }
  generateSource(e) {
    if ("vertex" === e) return [];
    0 === this._entries.size && this._entries.set(0, { name: __.DEFAULT_NAME, type: __.DEFAULT_TYPE });
    const t = new Array();
    return this._entries.forEach((e2, r2) => t.push(`layout(location = ${r2}) out ${e2.type} ${e2.name};`)), t;
  }
};
__.DEFAULT_TYPE = "vec4";
__.DEFAULT_NAME = "fragColor";
var _ = __;
var d = class _d {
  constructor(e) {
    this._stage = e, this._entries = /* @__PURE__ */ new Set();
  }
  add(e, t, r2) {
    let n2 = "ERROR_CONSTRUCTOR_STRING";
    switch (t) {
      case "float":
        n2 = _d._numberToFloatStr(r2);
        break;
      case "int":
        n2 = _d._numberToIntStr(r2);
        break;
      case "bool":
        n2 = r2.toString();
        break;
      case "vec2":
        n2 = `vec2(${_d._numberToFloatStr(r2[0])},                            ${_d._numberToFloatStr(r2[1])})`;
        break;
      case "vec3":
        n2 = `vec3(${_d._numberToFloatStr(r2[0])},                            ${_d._numberToFloatStr(r2[1])},                            ${_d._numberToFloatStr(r2[2])})`;
        break;
      case "vec4":
        n2 = `vec4(${_d._numberToFloatStr(r2[0])},                            ${_d._numberToFloatStr(r2[1])},                            ${_d._numberToFloatStr(r2[2])},                            ${_d._numberToFloatStr(r2[3])})`;
        break;
      case "ivec2":
        n2 = `ivec2(${_d._numberToIntStr(r2[0])},                             ${_d._numberToIntStr(r2[1])})`;
        break;
      case "ivec3":
        n2 = `ivec3(${_d._numberToIntStr(r2[0])},                             ${_d._numberToIntStr(r2[1])},                             ${_d._numberToIntStr(r2[2])})`;
        break;
      case "ivec4":
        n2 = `ivec4(${_d._numberToIntStr(r2[0])},                             ${_d._numberToIntStr(r2[1])},                             ${_d._numberToIntStr(r2[2])},                             ${_d._numberToIntStr(r2[3])})`;
        break;
      case "uvec2":
        n2 = `uvec2(${_d._numberToIntStr(r2[0])},                             ${_d._numberToIntStr(r2[1])})`;
        break;
      case "uvec3":
        n2 = `uvec3(${_d._numberToIntStr(r2[0])},                             ${_d._numberToIntStr(r2[1])},                             ${_d._numberToIntStr(r2[2])})`;
        break;
      case "uvec4":
        n2 = `uvec4(${_d._numberToIntStr(r2[0])},                             ${_d._numberToIntStr(r2[1])},                             ${_d._numberToIntStr(r2[2])},                             ${_d._numberToIntStr(r2[3])})`;
        break;
      case "mat2":
      case "mat3":
      case "mat4":
        n2 = `${t}(${Array.prototype.map.call(r2, (e2) => _d._numberToFloatStr(e2)).join(", ")})`;
    }
    return this._entries.add(`const ${t} ${e} = ${n2};`), this._stage;
  }
  static _numberToIntStr(e) {
    return e.toFixed(0);
  }
  static _numberToFloatStr(e) {
    return Number.isInteger(e) ? e.toFixed(1) : e.toString();
  }
  generateSource() {
    return Array.from(this._entries);
  }
};
var l = "#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp int;\n  precision highp sampler2D;\n  precision highp usampler2D;\n  precision highp sampler2DArray;\n  precision highp sampler2DShadow;\n#else\n  precision mediump float;\n  precision mediump int;\n  precision mediump sampler2D;\n  precision mediump usampler2D;\n  precision mediump sampler2DArray;\n  precision mediump sampler2DShadow;\n#endif";
var p = "precision highp float;\n precision highp sampler2D;\n precision highp usampler2D;\n precision highp sampler2DArray;\n precision highp sampler2DShadow;\n\n\n invariant gl_Position;\n ";

export {
  s2 as s
};
//# sourceMappingURL=chunk-WJ3E33GQ.js.map
