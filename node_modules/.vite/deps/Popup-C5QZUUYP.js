import {
  F as F2
} from "./chunk-MSFUE7MW.js";
import {
  t as t2
} from "./chunk-X4ZPIDID.js";
import {
  F,
  e as e4,
  i as i3,
  n as n3,
  ne,
  s as s3,
  t
} from "./chunk-6NPAKFS5.js";
import {
  l as l3
} from "./chunk-CUJ626VQ.js";
import "./chunk-V4S4W4OB.js";
import "./chunk-IGRCAVBL.js";
import "./chunk-BHTGT37R.js";
import "./chunk-WAYU35CW.js";
import "./chunk-XBGTYNWI.js";
import "./chunk-4UD25MCJ.js";
import "./chunk-4HUNJ2YS.js";
import "./chunk-C6XCOYU5.js";
import "./chunk-BTFBYI67.js";
import "./chunk-D3G5WIRR.js";
import "./chunk-Q3JOE7TC.js";
import "./chunk-S34IG7TQ.js";
import "./chunk-4274EV24.js";
import {
  n as n2
} from "./chunk-VIDAPS4J.js";
import "./chunk-WT2BW5KP.js";
import "./chunk-ZUQ2O3KU.js";
import "./chunk-TF5RNCNY.js";
import "./chunk-WQW6HIRX.js";
import "./chunk-U2MAPSMR.js";
import "./chunk-QPBITBUR.js";
import "./chunk-PJJUVY7C.js";
import "./chunk-7VJQTJLO.js";
import "./chunk-PUWBFCEG.js";
import "./chunk-VVMIB6RA.js";
import "./chunk-A7O5R67Z.js";
import "./chunk-SQ4OSZIG.js";
import "./chunk-MA6OR5A6.js";
import "./chunk-RCHRSC54.js";
import "./chunk-ZEI5DZXH.js";
import "./chunk-RGWH5UES.js";
import "./chunk-4KVWUPLK.js";
import "./chunk-NOLINR6O.js";
import "./chunk-HIGI45S6.js";
import "./chunk-2KBTJPSU.js";
import "./chunk-JVMNF6GR.js";
import "./chunk-SL3GC7WV.js";
import "./chunk-CJZPTLIZ.js";
import "./chunk-2U5X5TIX.js";
import "./chunk-5D65KWSM.js";
import "./chunk-ABHLEPDK.js";
import "./chunk-4FQUAV7M.js";
import "./chunk-EVZ7KLPS.js";
import "./chunk-JSH3APTG.js";
import "./chunk-WQT2KLDB.js";
import "./chunk-UVDECGZC.js";
import "./chunk-VKFTCFFM.js";
import "./chunk-ZETARPSI.js";
import "./chunk-TCDV4P3G.js";
import "./chunk-CZOYDK6P.js";
import "./chunk-RS755KXS.js";
import "./chunk-TMUM75KQ.js";
import "./chunk-OC3OQ2CI.js";
import "./chunk-KY5OS6CK.js";
import "./chunk-3U5UUY3S.js";
import "./chunk-UOYGMZIS.js";
import "./chunk-RXH2WNPA.js";
import "./chunk-TWU3GKHX.js";
import "./chunk-BGIBV6LL.js";
import "./chunk-UQXJMFRI.js";
import "./chunk-DY7N5RAZ.js";
import "./chunk-6TCXGIIN.js";
import "./chunk-NP2TBOXH.js";
import "./chunk-CXUJAI27.js";
import "./chunk-WBYRWTBX.js";
import "./chunk-WFCLXKCE.js";
import "./chunk-WX3525ER.js";
import "./chunk-FHCV4NTV.js";
import "./chunk-NKFEI62F.js";
import "./chunk-HCTBVF3W.js";
import "./chunk-XTEXJOLG.js";
import "./chunk-NH6FXYCM.js";
import "./chunk-YE4E5JCT.js";
import "./chunk-SXZO7ULH.js";
import "./chunk-5BAQPFKY.js";
import "./chunk-H34D76ZQ.js";
import "./chunk-VJ5FUG6T.js";
import "./chunk-IR5QDMME.js";
import "./chunk-O5UBEIJA.js";
import "./chunk-FNMK6NUG.js";
import "./chunk-QTRET3PG.js";
import "./chunk-FMOL5XMB.js";
import "./chunk-VNSHGTPN.js";
import "./chunk-OEBAFVQK.js";
import "./chunk-76V6RN4F.js";
import "./chunk-Y3FKYMXQ.js";
import "./chunk-S5K4XWUR.js";
import "./chunk-QNW4D2V2.js";
import "./chunk-XAI6T5FU.js";
import "./chunk-QNDHLVDC.js";
import "./chunk-ZT4KW2M5.js";
import "./chunk-FHQNDU7E.js";
import "./chunk-IOJ4QFRL.js";
import "./chunk-EK7HOTRR.js";
import "./chunk-GCTH5LET.js";
import "./chunk-TTLSEJNG.js";
import "./chunk-U73R3I4U.js";
import "./chunk-ZVTEFYZX.js";
import "./chunk-LPUPM55U.js";
import "./chunk-EKZRA6TO.js";
import "./chunk-M5SP6ZBM.js";
import "./chunk-ZGTANDVY.js";
import "./chunk-2HGIYEIL.js";
import "./chunk-OTCNIJ2H.js";
import "./chunk-JGA5YJWL.js";
import "./chunk-GCI4MA3M.js";
import "./chunk-SJ2OBYX2.js";
import "./chunk-MDJNYPVI.js";
import "./chunk-Z6VKIQV2.js";
import "./chunk-4PXNA4MD.js";
import {
  i as i4
} from "./chunk-TITL4X6H.js";
import "./chunk-2BP3TIB4.js";
import "./chunk-HOJHSMLY.js";
import {
  e as e3
} from "./chunk-2O6SPRT2.js";
import "./chunk-ZCI5A4FF.js";
import "./chunk-ET5EDAFM.js";
import "./chunk-B5A4L35M.js";
import "./chunk-52SEOH5H.js";
import "./chunk-2D47RURG.js";
import "./chunk-7HTU7ZUX.js";
import "./chunk-647DAMHU.js";
import "./chunk-O6G3PPOK.js";
import "./chunk-ZKNZTIAS.js";
import "./chunk-OJMISN3F.js";
import "./chunk-EFV6H5NA.js";
import "./chunk-6VL5D5UP.js";
import "./chunk-6QHY54HZ.js";
import "./chunk-GXJJY3ND.js";
import "./chunk-5ONGWFJ3.js";
import "./chunk-PLNHHGHL.js";
import "./chunk-4WTOIJXV.js";
import "./chunk-BBYMM7CM.js";
import "./chunk-EM7Y2JZC.js";
import "./chunk-QZQPB5XR.js";
import "./chunk-AQFRVV3U.js";
import "./chunk-MUBG7EZN.js";
import {
  B,
  c as c3,
  e as e2
} from "./chunk-TMVLBQMP.js";
import {
  L as L2,
  i2,
  j as j2,
  n2 as n
} from "./chunk-6IHS6RYH.js";
import "./chunk-OJBEN6CV.js";
import "./chunk-TU5E6NPS.js";
import "./chunk-RKNCTZBL.js";
import "./chunk-PEL3D3ZN.js";
import "./chunk-Q5KWD3VQ.js";
import "./chunk-BUQC3CLV.js";
import "./chunk-W5S3VUFT.js";
import "./chunk-7YH7T6CS.js";
import "./chunk-3T4IXPP4.js";
import "./chunk-XTZAIV4X.js";
import "./chunk-63LDVRFI.js";
import {
  _ as _2
} from "./chunk-C3FRY5U4.js";
import {
  a2 as a3,
  c2 as c4,
  p2 as p
} from "./chunk-JNJX34GB.js";
import "./chunk-3STJRSDT.js";
import "./chunk-67Q6KVC6.js";
import "./chunk-23NJHA5Q.js";
import "./chunk-4LA6K4VI.js";
import "./chunk-KEZCWFAR.js";
import {
  m as m3
} from "./chunk-JZUJ34RR.js";
import "./chunk-PMGS7UDU.js";
import "./chunk-3GHCGAH2.js";
import "./chunk-HWUOAPTX.js";
import "./chunk-QHCKOBU7.js";
import "./chunk-K2OZ6WVC.js";
import "./chunk-MC6NAKKX.js";
import "./chunk-TF6255HN.js";
import "./chunk-GD4FJL3C.js";
import "./chunk-C5OQVQZF.js";
import "./chunk-F7DKSAOI.js";
import "./chunk-4SOQWNPG.js";
import "./chunk-LTULADK2.js";
import "./chunk-35ST7YRB.js";
import "./chunk-EDA5QFHZ.js";
import "./chunk-JW6DU3OK.js";
import "./chunk-CNYNCKEV.js";
import "./chunk-XL5QPCXN.js";
import {
  N as N2,
  W,
  X
} from "./chunk-2LC2762W.js";
import "./chunk-W6HOAVT4.js";
import "./chunk-DTZUXJMD.js";
import "./chunk-YLAGKT2D.js";
import "./chunk-6YRQYUCY.js";
import "./chunk-C5M24ACM.js";
import "./chunk-L4A2QJG4.js";
import "./chunk-W75DBJD7.js";
import {
  s as s2
} from "./chunk-6KDQMJAI.js";
import {
  c as c2
} from "./chunk-UDHS2MGH.js";
import "./chunk-QF7FRVN6.js";
import "./chunk-ENINOZUZ.js";
import "./chunk-P6IKJIMO.js";
import "./chunk-MHV23XAQ.js";
import "./chunk-V2X4OKYI.js";
import "./chunk-LPZUGJNG.js";
import "./chunk-XLOINTMG.js";
import "./chunk-MA3QDRC3.js";
import "./chunk-W6J7XCPU.js";
import "./chunk-ONXWBTTM.js";
import "./chunk-T7F6Q6JJ.js";
import {
  O
} from "./chunk-YDTPM7OQ.js";
import "./chunk-75XOUSSS.js";
import "./chunk-TH4EQWJJ.js";
import "./chunk-7P2ANHQ3.js";
import "./chunk-XCKT47LJ.js";
import "./chunk-3FUHCAX3.js";
import {
  o3 as o
} from "./chunk-PZ5RULLK.js";
import "./chunk-OPJX4KXH.js";
import "./chunk-LTPHDYPK.js";
import "./chunk-3OVERDFX.js";
import "./chunk-FPMLKIDB.js";
import "./chunk-AZXJIEZ6.js";
import "./chunk-Q75WYS7K.js";
import "./chunk-H74Q4SYB.js";
import {
  U as U2,
  a as a2,
  f,
  h,
  j,
  l as l2
} from "./chunk-2OFHDVO5.js";
import {
  l
} from "./chunk-TFJXG32O.js";
import "./chunk-DDOCCRD4.js";
import "./chunk-5UPBUJPC.js";
import {
  e
} from "./chunk-THQO67BJ.js";
import "./chunk-4YDOPHTZ.js";
import "./chunk-YY5PITIH.js";
import "./chunk-CCQFL76O.js";
import "./chunk-CSMCPN64.js";
import "./chunk-GY6YF4EN.js";
import "./chunk-7H3U4IJR.js";
import "./chunk-SMWUT52Z.js";
import {
  _,
  j as j3
} from "./chunk-AXZMNHTN.js";
import {
  f as f2
} from "./chunk-5T3MJDSR.js";
import "./chunk-NMQNUPE4.js";
import "./chunk-6KIXN4DJ.js";
import "./chunk-7DGJB37R.js";
import "./chunk-234CIOHE.js";
import "./chunk-V2H77UEV.js";
import "./chunk-WRA2WBYC.js";
import "./chunk-XWE6BM2U.js";
import "./chunk-SOIZOFSB.js";
import "./chunk-XXLHAM2M.js";
import {
  b,
  m
} from "./chunk-5EI5H4QX.js";
import {
  a2 as a
} from "./chunk-ZIE53VIV.js";
import {
  __decorate
} from "./chunk-SS5CLIUY.js";
import {
  U
} from "./chunk-R54Q5TGA.js";
import "./chunk-6SSZNBOK.js";
import "./chunk-LZ2XTYP2.js";
import "./chunk-45CFSCQX.js";
import "./chunk-A5XN2VFT.js";
import "./chunk-65HD3WXL.js";
import "./chunk-4DGC7CBY.js";
import {
  L,
  T,
  d,
  m2,
  y
} from "./chunk-GNMPGHLQ.js";
import {
  c,
  i3 as i,
  s2 as s
} from "./chunk-QY7XKUIV.js";
import {
  N
} from "./chunk-AL6YUTZM.js";
import "./chunk-G26ADAPQ.js";

// node_modules/@arcgis/core/geometry/support/geometryUtils.js
function o2(e8) {
  switch (e8?.type) {
    case "point":
      return e8;
    case "extent":
      return e8.center;
    case "polygon": {
      const r2 = o(e8);
      return r2 ? _.fromJSON(r2) : null;
    }
    case "multipoint":
    case "polyline":
      return e8.extent?.center;
    default:
      return null;
  }
}

// node_modules/@arcgis/core/support/actions/actionUtils.js
var e5 = () => c3({ action: () => import("./calcite-action-ZSODFWAI.js") });
function n4(t5, o5, e8) {
  const { title: n7, textEnabled: c9 } = o5, { type: s6, active: r2, uid: d3, disabled: l7, indicator: u2 } = t5;
  return t5.visible ? n("calcite-action", { ...o5, active: "toggle" === s6 && t5.value, appearance: "solid", "data-action-id": t5.id, "data-action-uid": d3, disabled: l7, icon: a4(t5), indicator: u2, loading: r2, scale: "s", text: n7 ?? "", title: c9 ? void 0 : n7 }, e8) : null;
}
function a4(t5) {
  return t5.icon ? t5.icon : "image" in t5 && t5.image || t5.className ? void 0 : "question";
}
function c5(t5) {
  return t5 ? { backgroundImage: `url(${t5})` } : {};
}
function s4({ action: t5, feature: i6 }) {
  const e8 = i6?.attributes, n7 = "image" in t5 ? t5.image : void 0;
  return n7 && e8 ? s2(n7, e8) : n7 ?? "";
}

// node_modules/@arcgis/core/widgets/support/AnchorElementViewModel.js
var c6 = class extends l {
  constructor(e8) {
    super(e8), this.location = null, this.screenLocationEnabled = false, this.view = null, this.addHandles([f(() => {
      const e9 = this.screenLocationEnabled ? this.view : null;
      return e9 ? [e9.size, "3d" === e9.type ? e9.camera : e9.viewpoint] : null;
    }, () => this.notifyChange("screenLocation")), l2(() => this.screenLocation, (e9, o5) => {
      null != e9 && null != o5 && this.emit("view-change");
    })]);
  }
  destroy() {
    this.view = null;
  }
  get screenLocation() {
    const { location: e8, view: o5, screenLocationEnabled: t5 } = this, r2 = o5?.spatialReference, s6 = r2 ? X(e8, r2).geometry : null;
    return t5 && s6 && o5?.ready ? o5.toScreen(s6) : null;
  }
};
__decorate([m()], c6.prototype, "location", void 0), __decorate([m()], c6.prototype, "screenLocation", null), __decorate([m()], c6.prototype, "screenLocationEnabled", void 0), __decorate([m()], c6.prototype, "view", void 0), c6 = __decorate([a("esri.widgets.support.AnchorElementViewModel")], c6);

// node_modules/@arcgis/core/widgets/Spinner/SpinnerViewModel.js
var t3 = class extends c6 {
  constructor(o5) {
    super(o5), this.visible = false;
  }
};
__decorate([m()], t3.prototype, "visible", void 0), t3 = __decorate([a("esri.widgets.Spinner.SpinnerViewModel")], t3);

// node_modules/@arcgis/core/widgets/Spinner.js
var a5 = "esri-spinner";
var p2 = { base: a5, spinnerStart: `${a5}--start`, spinnerFinish: `${a5}--finish` };
var c7 = class extends B {
  constructor(i6, e8) {
    super(i6, e8), this._animationDelay = 500, this._animationPromise = null, this.viewModel = new t3();
  }
  initialize() {
    this.addHandles(l2(() => this.visible, (i6) => this._visibleChange(i6)));
  }
  destroy() {
    this._animationPromise = null;
  }
  get location() {
    return this.viewModel.location;
  }
  set location(i6) {
    this.viewModel.location = i6;
  }
  get view() {
    return this.viewModel.view;
  }
  set view(i6) {
    this.viewModel.view = i6;
  }
  get visible() {
    return this.viewModel.visible;
  }
  set visible(i6) {
    this.viewModel.visible = i6;
  }
  show(i6) {
    const { location: e8, promise: t5 } = i6 ?? {};
    e8 && (this.viewModel.location = e8), this.visible = true;
    const o5 = () => this.hide();
    t5?.catch(() => {
    }).then(o5);
  }
  hide() {
    this.visible = false;
  }
  render() {
    const { visible: i6 } = this, { screenLocation: e8 } = this.viewModel, t5 = !!e8, o5 = i6 && t5, s6 = !i6 && t5, r2 = { [p2.spinnerStart]: o5, [p2.spinnerFinish]: s6 }, n7 = this._getPositionStyles();
    return n("div", { class: this.classes(p2.base, r2), styles: n7 });
  }
  _visibleChange(i6) {
    if (i6) return void (this.viewModel.screenLocationEnabled = true);
    const t5 = T(this._animationDelay);
    this._animationPromise = t5, t5.catch(() => {
    }).then(() => {
      this._animationPromise === t5 && (this.viewModel.screenLocationEnabled = false, this._animationPromise = null);
    });
  }
  _getPositionStyles() {
    const { screenLocation: i6, view: e8 } = this.viewModel;
    if (null == e8 || null == i6) return {};
    const { padding: t5 } = e8;
    return { left: i6.x - t5.left + "px", top: i6.y - t5.top + "px" };
  }
};
__decorate([m()], c7.prototype, "location", null), __decorate([m()], c7.prototype, "view", null), __decorate([m({ type: t3 })], c7.prototype, "viewModel", void 0), __decorate([m()], c7.prototype, "visible", null), c7 = __decorate([a("esri.widgets.Spinner")], c7);

// node_modules/@arcgis/core/widgets/Features/css.js
var e6 = "esri-features";
var n5 = { icon: `${e6}__icon`, actionImage: `${e6}__action-image`, base: e6, container: `${e6}__container`, contentContainer: `${e6}__content-container`, contentFeature: `${e6}__content-feature`, flowItemCollapsed: `${e6}__flow-item--collapsed`, header: `${e6}__header`, footer: `${e6}__footer`, featureMenuObserver: `${e6}__feature-menu-observer`, actionExit: `${e6}__action--exit`, loader: `${e6}__loader`, featuresHeading: `${e6}__heading`, paginationText: `${e6}__pagination-text`, paginationActionBar: `${e6}__pagination-action-bar`, paginationMenuButton: `${e6}__pagination-menu-button`, paginationPrevious: `${e6}__pagination-previous`, paginationNext: `${e6}__pagination-next` };

// node_modules/@arcgis/core/widgets/Popup/actions.js
var i5 = O.ofType({ key: "type", defaultKeyValue: "button", base: p, typeMap: { button: c4, toggle: a3 } });
var n6 = new c4({ icon: "magnifying-glass-plus", id: "zoom-to-feature", title: "{messages.zoom}", className: i3.zoomInMagnifyingGlass });
var r = new c4({ icon: "trash", id: "remove-selected-feature", title: "{messages.remove}", className: i3.trash });
var l4 = new c4({ icon: "magnifying-glass-plus", id: "zoom-to-clustered-features", title: "{messages.zoom}", className: i3.zoomInMagnifyingGlass });
var m4 = new a3({ icon: "table", id: "browse-clustered-features", title: "{messages.browseClusteredFeatures}", className: i3.table, value: false });

// node_modules/@arcgis/core/widgets/Features/FeaturesDrillIn.js
var h2 = n6.clone();
var f4 = class extends B {
  constructor(e8, t5) {
    super(e8, t5), this.flowItems = null, this.messages = null, this.closed = false, this.closable = true, this.selectLastFlowItem = true, this._handleOpenFeature = (e9) => {
      this.emit("open-feature", { feature: e9 });
    }, this._handleZoomToFeature = (e9) => {
      this.emit("zoom-to-feature", { featureWidget: e9 });
    };
  }
  loadDependencies() {
    return Promise.all([e5(), c3({ action: () => import("./calcite-action-ZSODFWAI.js"), "action-bar": () => import("./calcite-action-bar-PRRYQPCO.js"), "action-group": () => import("./calcite-action-group-WSYGPVS4.js"), "flow-item": () => import("./calcite-flow-item-BZCIO4HY.js") })]);
  }
  render() {
    const { flowItems: e8 } = this, t5 = e8?.toArray();
    return n(i2, null, t5?.map((e9, o5) => this._renderFlowItem(e9, this.selectLastFlowItem && o5 === t5.length - 1)));
  }
  _handleCloseClick() {
    this.emit("close");
  }
  _handleExitClick() {
    this.emit("exit");
  }
  _handleDrillInBackClick() {
    const { flowItems: e8 } = this, t5 = e8?.pop();
    t5 && ("activeCategory" in t5.viewModel ? (t5.viewModel.activeCategory = null, e8?.length || (t5.viewModel.showAllEnabled = false)) : "showAllEnabled" in t5.viewModel && (t5.viewModel.showAllEnabled = false), t5 && (t5.viewModel = null, t5.destroy()));
  }
  _getExitMessage(e8) {
    switch (e8.flowType) {
      case "feature":
      case "feature-association":
        return "";
      case "feature-relationship":
        return this.messages.exitRelatedRecords;
      case "feature-utility-network-associations":
      case "feature-utility-network-association-type":
        return this.messages.exitAssociations;
    }
  }
  _renderFlowItem(e8, o5) {
    const { messages: i6, closable: s6, closed: r2 } = this, c9 = "graphic" in e8 && !e8.isTable, n7 = "feature-association" === e8.flowType, p4 = this._getExitMessage(e8), d3 = i6.selectFeature;
    return n("calcite-flow-item", { bind: this, closable: s6, closed: r2, description: c(this._getDrillInFlowItemDescription(e8) ?? ""), heading: c(e8.title ?? ""), key: `flow-item-${e8.viewModel.uid}`, selected: o5, onCalciteFlowItemBack: (e9) => {
      e9.preventDefault(), this._handleDrillInBackClick();
    }, onCalciteFlowItemClose: this._handleCloseClick }, n("calcite-action", { appearance: "transparent", bind: this, class: n5.actionExit, icon: "move-up", key: "exit-action", onclick: this._handleExitClick, slot: "header-actions-start", text: p4, title: p4 }), c9 ? n("calcite-action", { appearance: "transparent", bind: this, icon: "zoom-to-object", key: "open-feature-action", onclick: () => this._handleOpenFeature(e8), slot: "header-actions-end", text: d3, title: d3 }) : null, n7 ? n("calcite-action-bar", { expandDisabled: true, expanded: true, key: "header-action-bar", scale: "s", slot: "action-bar" }, n("calcite-action-group", { overlayPositioning: "fixed", scale: "s" }, n4(h2, { key: `action-${h2.uid}`, title: this._getActionTitle(h2), text: this._getActionTitle(h2), textEnabled: true, onclick: () => this._handleZoomToFeature(e8), bind: this }))) : null, n("div", { class: n5.container }, e8.render()));
  }
  _getActionTitle(e8) {
    const { messages: t5 } = this, o5 = e8.title ?? "";
    return "zoom-to-feature" === e8.id ? s2(o5, { messages: t5 }) : o5;
  }
  _getDrillInFlowItemDescription(e8) {
    switch (e8.flowType) {
      case "feature":
      case "feature-association":
      case "feature-utility-network-associations":
        return e8.viewModel.description ?? "";
      case "feature-relationship":
        return e8.allItemsDescription;
      case "feature-utility-network-association-type":
        return e8.description ?? "";
    }
  }
};
__decorate([m()], f4.prototype, "flowItems", void 0), __decorate([m(), e2("esri/widgets/Features/t9n/Features")], f4.prototype, "messages", void 0), __decorate([m()], f4.prototype, "closed", void 0), __decorate([m()], f4.prototype, "closable", void 0), __decorate([m()], f4.prototype, "selectLastFlowItem", void 0), f4 = __decorate([a("esri.widgets.Features.FeaturesDrillIn")], f4);

// node_modules/@arcgis/core/layers/LayerConstants.js
var o3 = "OBJECTID";

// node_modules/@arcgis/core/widgets/Popup/actionUtils.js
var c8 = "esri.widgets.Popup.PopupViewModel";
var u = () => i.getLogger(c8);
var l5 = (t5) => {
  const { event: r2, view: c9, viewModel: u2 } = t5, { action: l7 } = r2;
  if (!l7) return Promise.reject(new s("trigger-action:missing-arguments", "Event has no action"));
  const { disabled: d3, id: g2 } = l7;
  if (!g2) return Promise.reject(new s("trigger-action:invalid-action", "action.id is missing"));
  if (d3) return Promise.reject(new s("trigger-action:invalid-action", "Action is disabled"));
  if (g2 === n6.id) return f5(u2).catch(m2);
  if (g2 === l4.id) return m5(u2);
  if (g2 === m4.id) return u2.browseClusterEnabled = !u2.browseClusterEnabled, u2.featureMenuOpen = u2.browseClusterEnabled, Promise.resolve();
  if (g2 === r.id) {
    u2.visible = false;
    const { selectedFeature: t6 } = u2;
    if (!t6) return Promise.reject(new s(`trigger-action:${r.id}`, "selectedFeature is required", { selectedFeature: t6 }));
    const { sourceLayer: r3 } = t6;
    return r3 ? r3.remove(t6) : c9?.graphics.remove(t6), Promise.resolve();
  }
  return Promise.resolve();
};
function d2(e8) {
  const { selectedFeature: t5, location: r2, view: o5 } = e8;
  return o5 ? t5 ?? r2 ?? null : null;
}
function g(e8) {
  return !!e8 && e8.isAggregate && "cluster" === e8.sourceLayer?.featureReduction?.type;
}
async function w(e8, t5) {
  if ("3d" !== t5?.type || !e8 || "esri.Graphic" !== e8.declaredClass) return true;
  const r2 = t5.getViewForGraphic(e8);
  if (r2 && "whenGraphicBounds" in r2) {
    let t6 = null;
    try {
      t6 = await r2.whenGraphicBounds(e8, { useViewElevation: true });
    } catch (o5) {
    }
    return !t6 || !t6.boundingBox || t6.boundingBox[0] === t6.boundingBox[3] && t6.boundingBox[1] === t6.boundingBox[4] && t6.boundingBox[2] === t6.boundingBox[5];
  }
  return true;
}
async function f5(t5, o5) {
  const { location: n7, selectedFeature: a7, view: s6, zoomFactor: c9 } = t5;
  await o5?.viewModel?.updateGeometry();
  const l7 = o5?.graphic, g2 = l7?.geometry ? l7 : d2(t5);
  if (!s6 || !g2) {
    const t6 = new s("zoom-to:invalid-target-or-view", "Cannot zoom to location without a target and view.", { target: g2, view: s6 });
    throw u().error(t6), t6;
  }
  const f6 = s6.scale / c9, m6 = l7?.geometry ?? t5.selectedFeature?.geometry ?? n7, v2 = null != m6 && "point" === m6.type && await w(l7 ?? a7, s6);
  n6.active = true, n6.disabled = true;
  try {
    await t5.zoomTo({ target: { target: g2, scale: v2 ? f6 : void 0 } });
  } catch (p4) {
    if (d(p4)) return;
    const t6 = new s("zoom-to:invalid-graphic", "Could not zoom to the location of the graphic.", { graphic: l7 ?? a7 });
    u().error(t6);
  } finally {
    n6.active = false, n6.disabled = false, t5.zoomToLocation = null, v2 && (t5.location = m6);
  }
}
async function m5(t5) {
  const { selectedFeature: r2, view: o5 } = t5;
  if ("2d" !== o5?.type) {
    const t6 = new s("zoomToCluster:invalid-view", "View must be 2d MapView.", { view: o5 });
    throw u().error(t6), t6;
  }
  if (!r2 || !g(r2)) {
    const t6 = new s("zoomToCluster:invalid-selectedFeature", "Selected feature must represent an aggregate/cluster graphic.", { selectedFeature: r2 });
    throw u().error(t6), t6;
  }
  const [i6, a7] = await y2(o5, r2);
  l4.active = true, l4.disabled = true;
  const { extent: s6 } = await i6.queryExtent(a7);
  s6 && await t5.zoomTo({ target: s6 }), l4.active = false, l4.disabled = false;
}
async function v(e8) {
  const { view: t5, selectedFeature: r2 } = e8;
  if (!t5 || !r2) return;
  const [o5, i6] = await y2(t5, r2), { extent: n7 } = await o5.queryExtent(i6);
  e8.selectedClusterBoundaryFeature.geometry = n7, t5.graphics.add(e8.selectedClusterBoundaryFeature);
}
async function p3(e8) {
  const { selectedFeature: t5, view: r2 } = e8;
  if (!r2 || !t5) return;
  const [o5, i6] = await y2(r2, t5);
  m4.active = true, m4.disabled = true;
  const { features: n7 } = await o5.queryFeatures(i6);
  m4.active = false, m4.disabled = false, m4.value = true;
  const s6 = { features: [t5].concat(n7) };
  "feature" === e8?.initialDisplayMode && (s6.featureMenuOpen = true), e8?.open(s6);
}
async function y2(e8, t5) {
  const r2 = await e8.whenLayerView(t5.sourceLayer), o5 = r2.createQuery(), i6 = t5.getObjectId();
  return o5.aggregateIds = null != i6 ? [i6] : [], [r2, o5];
}
function h3(e8) {
  m4.value = false;
  const t5 = e8.features.filter((e9) => g(e9));
  t5.length && (e8.features = t5);
}

// node_modules/@arcgis/core/widgets/Features/FeaturesViewModel.js
var B2 = "location-scale-handle";
var H = () => [n6.clone()];
var U3 = () => [l4.clone(), m4.clone()];
var G = null;
function Z(e8, t5) {
  return "building-scene" === e8 || "map-image" === e8 || "tile" === e8 || "imagery" === e8 || "2d" === t5 && "imagery-tile" === e8;
}
var z2 = class extends i4(c6) {
  constructor(e8) {
    super(e8), this._pendingPromises = new t2(), this._fetchFeaturesController = null, this._highlightPromises = { "highlight-active-feature": null, "highlight-selected-feature": null }, this._selectedClusterFeature = null, this.actions = new i5(), this.activeFeature = null, this.autoCloseEnabled = false, this.browseClusterEnabled = false, this.content = null, this.defaultPopupTemplateEnabled = false, this.featurePage = null, this.featuresPerPage = 20, this.featureMenuOpen = false, this.featureMenuTitle = null, this.featureViewModelAbilities = null, this.featureViewModels = [], this.highlightEnabled = true, this.includeDefaultActions = true, this.initialDisplayMode = "feature", this.selectedClusterBoundaryFeature = new _2({ symbol: new m3({ outline: { width: 1.5, color: "cyan" }, style: "none" }) }), this.title = null, this.updateLocationEnabled = false, this.view = null, this.visible = false, this.zoomFactor = 4, this.zoomToLocation = null, this._debouncedLocationUpdate = L(async (e9) => {
      const { spatialReference: t5 } = this, i6 = this.selectedFeature?.geometry?.type, s6 = this.location ?? e9;
      if (i6 && "mesh" !== i6 && t5 && s6 && this.selectedFeature) if ("point" !== i6) try {
        const e10 = this.selectedFeature;
        let i7 = e10.geometry;
        const r2 = this._getHighlightLayer(e10), o5 = e10.getObjectId();
        if (!r2 || !this.view) return;
        if (o5) {
          const e11 = this.view?.allLayerViews.find((e12) => e12.layer.uid === r2.uid);
          if (!e11 || !("queryFeatures" in e11)) return;
          const s7 = e11.createQuery();
          s7.outSpatialReference = t5, s7.objectIds = [o5], s7.returnGeometry = true;
          const { features: a8 } = await e11.queryFeatures(s7);
          i7 = a8[0]?.geometry;
        }
        if (!i7 || "mesh" === i7.type) return;
        i7 = W(i7, t5), G || (G = await Promise.all([import("./intersectsOperator-AYBKPYQQ.js"), import("./proximityOperator-EYFFZDKD.js")]));
        const [a7, n7] = G;
        if (!a7.execute(i7, s6)) {
          const t6 = n7.getNearestCoordinate(i7, s6).coordinate ?? s6;
          this.selectedFeature === e10 && (this.location = t6);
        }
      } catch (o5) {
        d(o5) || i.getLogger(this).error(o5);
      }
      else this.location = o2(this.selectedFeature.geometry) ?? s6;
    });
  }
  initialize() {
    this.addHandles([this.on("view-change", () => this._autoClose()), l2(() => [this.highlightEnabled, this.selectedFeature, this.visible, this.view], () => this._highlightSelectedFeature()), l2(() => [this.highlightEnabled, this.activeFeature, this.visible, this.view], () => this._highlightActiveFeature()), l2(() => this.view?.animation?.state, (e8) => this._animationStateChange(e8)), l2(() => this.location, (e8) => this._locationChange(e8)), l2(() => this.selectedFeature, (e8) => this._selectedFeatureChange(e8)), l2(() => [this.selectedFeatureIndex, this.featureCount, this.featuresPerPage], () => this._selectedFeatureIndexChange()), l2(() => [this.featurePage, this.selectedFeatureIndex, this.featureCount, this.featuresPerPage, this.featureViewModels], () => this._setGraphicOnFeatureViewModels()), l2(() => this.featureViewModels, () => this._featureViewModelsChange()), this.on("trigger-action", (e8) => l5({ event: e8, viewModel: this, view: this.view })), f(() => !this.waitingForResult, () => this._waitingForResultChange(), U2), l2(() => [this.features, this.map, this.spatialReference, this.timeZone], () => this._updateFeatureVMs()), l2(() => this.view?.scale, () => this._viewScaleChange()), f(() => !this.visible, () => this.browseClusterEnabled = false), l2(() => this.browseClusterEnabled, (e8) => e8 ? this.enableClusterBrowsing() : this.disableClusterBrowsing())]);
  }
  destroy() {
    this._cancelFetchingFeatures(), this._pendingPromises.clear(), this.browseClusterEnabled = false, this.view = null, this.map = null, this.spatialReference = null, this.timeZone = null;
  }
  get active() {
    return !(!this.visible || this.waitingForResult);
  }
  get allActions() {
    const e8 = this._get("allActions") || new i5();
    e8.removeAll();
    const { actions: t5, defaultActions: i6, defaultPopupTemplateEnabled: s6, includeDefaultActions: r2, selectedFeature: o5 } = this, a7 = r2 ? i6.concat(t5) : t5, n7 = o5 && ("function" == typeof o5.getEffectivePopupTemplate && o5.getEffectivePopupTemplate(s6) || o5.popupTemplate), l7 = n7?.actions, u2 = n7?.overwriteActions ? l7 : l7?.concat(a7) ?? a7;
    return u2?.filter(Boolean).forEach((t6) => e8.add(t6)), e8;
  }
  get defaultActions() {
    const e8 = this._get("defaultActions") || new i5();
    return e8.removeAll(), e8.addMany(g(this.selectedFeature) ? U3() : H()), e8;
  }
  get featureCount() {
    return this.features.length;
  }
  set features(e8) {
    const t5 = e8 || [];
    this._set("features", t5);
    const { pendingPromisesCount: i6, promiseCount: s6, selectedFeatureIndex: r2 } = this, o5 = s6 && t5.length;
    "list" !== this.initialDisplayMode ? o5 && i6 && -1 === r2 ? this.selectedFeatureIndex = 0 : o5 && -1 !== r2 || (this.selectedFeatureIndex = t5.length ? 0 : -1) : (!o5 || o5 && i6 === s6) && (this.selectedFeatureIndex = -1);
  }
  set location(e8) {
    let t5 = e8;
    const i6 = this.spatialReference?.isWebMercator, s6 = e8?.spatialReference?.isWGS84;
    s6 && i6 && (t5 = j3(e8)), this._set("location", t5);
  }
  get map() {
    return this.view?.map ?? null;
  }
  set map(e8) {
    this._override("map", e8);
  }
  get pendingPromisesCount() {
    return this._pendingPromises.size;
  }
  get promiseCount() {
    return this.promises.length;
  }
  get promises() {
    return this._get("promises") || [];
  }
  set promises(e8) {
    this._pendingPromises.clear(), this.features = [], Array.isArray(e8) && e8.length ? (this._set("promises", e8), (e8 = e8.slice()).forEach((e9) => this._pendingPromises.add(e9)), e8.reduce((e9, t5) => e9.finally(() => t5.then((e10) => {
      this._pendingPromises.has(t5) && this._updateFeatures(e10);
    }).finally(() => this._pendingPromises.delete(t5)).catch(() => {
    })), Promise.resolve())) : this._set("promises", []);
  }
  get screenLocation() {
    return super.screenLocation;
  }
  get selectedFeature() {
    const { features: e8, selectedFeatureIndex: t5 } = this;
    if (-1 === t5) return null;
    return e8[t5] || null;
  }
  get selectedFeatureIndex() {
    const e8 = this._get("selectedFeatureIndex");
    return "number" == typeof e8 ? e8 : -1;
  }
  set selectedFeatureIndex(e8) {
    const { featureCount: t5 } = this;
    (isNaN(e8) || e8 < 0 || !t5) && (e8 = -1), this.activeFeature = null, this._set("selectedFeatureIndex", e8);
  }
  get selectedFeatureViewModel() {
    return this.featureViewModels[this.selectedFeatureIndex] || null;
  }
  get spatialReference() {
    return this.view?.spatialReference ?? null;
  }
  set spatialReference(e8) {
    this._override("spatialReference", e8);
  }
  get state() {
    const { view: e8, map: t5 } = this;
    return e8 ? e8.ready ? "ready" : "disabled" : t5 ? "ready" : "disabled";
  }
  get timeZone() {
    return this.view?.timeZone ?? e;
  }
  set timeZone(e8) {
    this._overrideIfSome("timeZone", e8);
  }
  get waitingForContents() {
    return this.featureViewModels.some((e8) => e8.waitingForContent);
  }
  get waitingForResult() {
    return !(!(!!this._fetchFeaturesController || this.pendingPromisesCount > 0) || 0 !== this.featureCount);
  }
  centerAtLocation() {
    const { view: e8 } = this, t5 = d2(this);
    return t5 && e8 ? this.callGoTo({ target: { target: t5, scale: e8.scale } }) : Promise.reject(new s("center-at-location:invalid-target-or-view", "Cannot center at a location without a target and view.", { target: t5, view: e8 }));
  }
  zoomTo(e8) {
    return this.callGoTo(e8);
  }
  clear() {
    this.set({ promises: [], features: [], content: null, title: null, location: null, activeFeature: null });
  }
  fetchFeatures(e8, t5) {
    const { view: i6 } = this;
    if (!i6 || !e8) throw new s("fetch-features:invalid-screenpoint-or-view", "Cannot fetch features without a screenPoint and view.", { screenPoint: e8, view: i6 });
    return i6.fetchPopupFeatures(e8, { pointerType: t5?.event?.pointerType, defaultPopupTemplateEnabled: this.defaultPopupTemplateEnabled, signal: t5?.signal });
  }
  open(e8) {
    const t5 = { updateLocationEnabled: false, promises: [], fetchFeatures: false, ...e8, visible: true }, { fetchFeatures: i6 } = t5;
    delete t5.fetchFeatures, i6 && this._setFetchFeaturesPromises(t5.location);
    const s6 = ["actionsMenuOpen", "collapsed"];
    for (const r2 of s6) delete t5[r2];
    this.set(t5);
  }
  triggerAction(e8) {
    const t5 = this.allActions.at(e8);
    t5 && !t5.disabled && this.emit("trigger-action", { action: t5 });
  }
  next() {
    return this.selectedFeatureIndex = this._getRoundRobinIndex(this.selectedFeatureIndex + 1, this.featureCount), this;
  }
  previous() {
    return this.selectedFeatureIndex = this._getRoundRobinIndex(this.selectedFeatureIndex - 1, this.featureCount), this;
  }
  disableClusterBrowsing() {
    h3(this), this._clearBrowsedClusterGraphics();
  }
  async enableClusterBrowsing() {
    const { view: e8, selectedFeature: t5 } = this;
    "2d" === e8?.type ? g(t5) ? (await v(this), await p3(this)) : i.getLogger(this).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.", t5) : i.getLogger(this).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.", t5);
  }
  async handleViewClick(e8) {
    return this._fetchFeaturesAndOpen(e8);
  }
  _getRoundRobinIndex(e8, t5) {
    return (e8 + t5) % t5;
  }
  _animationStateChange(e8) {
    this.zoomToLocation || (n6.disabled = "waiting-for-target" === e8);
  }
  _clearBrowsedClusterGraphics() {
    const e8 = [this.selectedClusterBoundaryFeature, this._selectedClusterFeature].filter(N);
    this.view?.graphics?.removeMany(e8), this._selectedClusterFeature = null, this.selectedClusterBoundaryFeature.geometry = null;
  }
  _viewScaleChange() {
    if (g(this.selectedFeature)) return this.browseClusterEnabled = false, this.visible = false, void this.clear();
    this.browseClusterEnabled && (this.features = this.selectedFeature ? [this.selectedFeature] : []);
  }
  _locationChange(e8) {
    const { selectedFeature: t5, updateLocationEnabled: i6, view: s6 } = this;
    s6 && i6 && e8 && (!t5 || t5.geometry) && this.centerAtLocation();
  }
  _selectedFeatureIndexChange() {
    this.featurePage = this.featureCount > 0 ? Math.floor(this.selectedFeatureIndex / this.featuresPerPage) + 1 : null;
  }
  _featureViewModelsChange() {
    this.featurePage = this.featureCount > 0 ? 1 : null;
  }
  _setGraphicOnFeatureViewModels() {
    const { features: e8, featureCount: t5, featurePage: i6, featuresPerPage: s6, featureViewModels: r2 } = this;
    if (null == i6) return;
    const o5 = ((i6 - 1) * s6 + t5) % t5, a7 = o5 + s6;
    r2.slice(o5, a7).forEach((t6, i7) => {
      t6 && (t6.graphic ??= e8[o5 + i7]);
    });
  }
  async _selectedFeatureChange(e8) {
    const { location: t5, updateLocationEnabled: i6, view: s6 } = this;
    if (!e8 || !s6) return;
    if (this.browseClusterEnabled) {
      if (this._selectedClusterFeature && (s6.graphics.remove(this._selectedClusterFeature), this._selectedClusterFeature = null), g(e8)) return;
      return e8.symbol = await F2(e8), this._selectedClusterFeature = e8, void s6.graphics.add(this._selectedClusterFeature);
    }
    const r2 = e8.sourceLayer?.type;
    if ("map-image" !== r2 && "imagery" !== r2 && "imagery-tile" !== r2 || (e8.symbol = await F2(e8)), !i6 && t5 || !e8.geometry) {
      if (i6 && !e8.geometry) {
        await this.centerAtLocation();
        const e9 = s6.center?.clone();
        e9 && (this.location = e9);
      }
    } else this.location = o2(e8.geometry);
  }
  _waitingForResultChange() {
    !this.featureCount && this.promises && (this.visible = false);
  }
  async _setFetchFeaturesPromises(e8) {
    const { pendingFeatures: t5 } = await this._fetchFeaturesWithController({ mapPoint: e8 });
    this.promises = t5;
  }
  _destroyFeatureVMs() {
    this.featureViewModels.forEach((e8) => e8 && !e8.destroyed && e8.destroy()), this._set("featureViewModels", []);
  }
  _updateFeatureVMs() {
    const { selectedFeature: e8, features: t5, featureViewModels: i6, view: s6, spatialReference: r2, map: o5, timeZone: a7, location: n7 } = this;
    if (g(t5[0]) || (this.browseClusterEnabled = false), this._destroyFeatureVMs(), !t5?.length) return;
    const l7 = i6.slice(), u2 = [];
    t5.forEach((t6, i7) => {
      if (!t6) return;
      let h4 = null;
      if (l7.some((e9, i8) => (e9 && e9.graphic === t6 && (h4 = e9, l7.splice(i8, 1)), !!h4)), h4) u2[i7] = h4;
      else {
        const l8 = new ne({ abilities: this.featureViewModelAbilities, defaultPopupTemplateEnabled: this.defaultPopupTemplateEnabled, spatialReference: r2, graphic: t6 === e8 ? t6 : null, location: n7, map: o5, view: s6, timeZone: a7 });
        u2[i7] = l8;
      }
    }), l7.forEach((e9) => e9 && !e9.destroyed && e9.destroy()), this._set("featureViewModels", u2);
  }
  async _getScreenPoint(e8, t5) {
    const { spatialReference: i6, view: s6 } = this;
    if (!s6) return null;
    await s6?.when();
    const r2 = e8?.spatialReference;
    return r2 && i6 ? (await N2(r2, i6, null, t5), s6.toScreen(e8)) : null;
  }
  _cancelFetchingFeatures() {
    const e8 = this._fetchFeaturesController;
    e8 && e8.abort(), this._fetchFeaturesController = null;
  }
  async _projectScreenPointAndFetchFeatures({ mapPoint: e8, screenPoint: t5, event: i6, signal: s6 }) {
    return this.fetchFeatures(t5 ?? await this._getScreenPoint(e8 ?? this.location, { signal: s6 }), { signal: s6, event: i6 });
  }
  _fetchFeaturesWithController({ mapPoint: e8, screenPoint: t5, event: i6 }) {
    this._cancelFetchingFeatures();
    const s6 = new AbortController(), { signal: r2 } = s6;
    this._fetchFeaturesController = s6;
    const o5 = this._projectScreenPointAndFetchFeatures({ mapPoint: e8, screenPoint: t5, signal: r2, event: i6 });
    return o5.catch(() => {
    }).then(() => {
      this._fetchFeaturesController = null;
    }), o5;
  }
  async _fetchFeaturesAndOpen(e8) {
    const { mapPoint: t5, screenPoint: i6 } = e8;
    this.removeHandles(B2), this.addHandles([l2(() => this.view?.scale, () => this._debouncedLocationUpdate(t5).catch((e9) => {
      d(e9) || i.getLogger(this).error(e9);
    })), f(() => !this.visible, () => {
      this.removeHandles(B2);
    }, { once: true })], B2);
    const { pendingFeatures: s6 } = await this._fetchFeaturesWithController({ mapPoint: t5, screenPoint: i6, event: e8 });
    return { location: t5 ?? void 0, promises: s6 };
  }
  _autoClose() {
    this.autoCloseEnabled && (this.visible = false);
  }
  async _getLayerView(e8, t5) {
    return await e8.when(), e8.whenLayerView(t5);
  }
  _getHighlightLayer(e8) {
    const { layer: t5, sourceLayer: i6 } = e8;
    return i6 && "layer" in i6 && i6.layer ? i6.layer : "map-notes" === i6?.type || "subtype-group" === i6?.type ? i6 : t5 ?? i6;
  }
  _getHighlightLayerView(e8, t5) {
    return "subtype-sublayer" === t5.type && t5.parent && this._mapIncludesLayer(t5.parent) ? this._getLayerView(e8, t5.parent) : t5 && this._mapIncludesLayer(t5) ? this._getLayerView(e8, t5) : null;
  }
  _getHighlightTarget(e8, t5, i6) {
    if (Z(t5.type, i6)) return e8;
    const s6 = e8.getObjectId();
    if (null != s6) return s6;
    const r2 = "imagery" === t5.type ? void 0 : "objectIdField" in t5 ? t5.objectIdField || o3 : null, o5 = e8.attributes;
    return o5 && r2 && o5[r2] || e8;
  }
  _mapIncludesLayer(e8) {
    return !!this.map?.allLayers?.includes(e8);
  }
  async _highlightFeature(e8, t5) {
    this.removeHandles(e8);
    const i6 = this[t5];
    if (!i6) return;
    const { highlightEnabled: s6, view: r2, visible: o5 } = this;
    if (!r2 || !s6 || !o5) return;
    const a7 = this._getHighlightLayer(i6);
    if (!a7) return;
    const n7 = this._getHighlightLayerView(r2, a7);
    if (!n7) return;
    this._highlightPromises[e8] = n7;
    const l7 = await n7;
    if (!(l7 && n2(l7) && this._highlightPromises[e8] === n7 && this[t5] && this.highlightEnabled)) return;
    const u2 = l7.highlight(this._getHighlightTarget(i6, a7, r2.type));
    this.addHandles(u2, e8);
  }
  async _highlightActiveFeature() {
    return this._highlightFeature("highlight-active-feature", "activeFeature");
  }
  async _highlightSelectedFeature() {
    return this._highlightFeature("highlight-selected-feature", "selectedFeature");
  }
  _updateFeatures(e8) {
    const { features: t5 } = this, i6 = e8.filter((e9) => !t5.includes(e9));
    i6?.length && (this.features = t5.concat(i6));
  }
};
__decorate([m()], z2.prototype, "_fetchFeaturesController", void 0), __decorate([m({ type: i5 })], z2.prototype, "actions", void 0), __decorate([m({ readOnly: true })], z2.prototype, "active", null), __decorate([m()], z2.prototype, "activeFeature", void 0), __decorate([m({ readOnly: true })], z2.prototype, "allActions", null), __decorate([m()], z2.prototype, "autoCloseEnabled", void 0), __decorate([m()], z2.prototype, "browseClusterEnabled", void 0), __decorate([m()], z2.prototype, "content", void 0), __decorate([m({ type: i5, readOnly: true })], z2.prototype, "defaultActions", null), __decorate([m({ type: Boolean })], z2.prototype, "defaultPopupTemplateEnabled", void 0), __decorate([m({ readOnly: true })], z2.prototype, "featureCount", null), __decorate([m()], z2.prototype, "featurePage", void 0), __decorate([m({ value: [] })], z2.prototype, "features", null), __decorate([m()], z2.prototype, "featuresPerPage", void 0), __decorate([m()], z2.prototype, "featureMenuOpen", void 0), __decorate([m()], z2.prototype, "featureMenuTitle", void 0), __decorate([m()], z2.prototype, "featureViewModelAbilities", void 0), __decorate([m({ readOnly: true })], z2.prototype, "featureViewModels", void 0), __decorate([m()], z2.prototype, "highlightEnabled", void 0), __decorate([m()], z2.prototype, "includeDefaultActions", void 0), __decorate([m()], z2.prototype, "initialDisplayMode", void 0), __decorate([m({ type: _ })], z2.prototype, "location", null), __decorate([m()], z2.prototype, "map", null), __decorate([m({ readOnly: true })], z2.prototype, "pendingPromisesCount", null), __decorate([m({ readOnly: true })], z2.prototype, "promiseCount", null), __decorate([m()], z2.prototype, "promises", null), __decorate([m({ readOnly: true })], z2.prototype, "selectedClusterBoundaryFeature", void 0), __decorate([m({ value: null, readOnly: true })], z2.prototype, "selectedFeature", null), __decorate([m({ value: -1 })], z2.prototype, "selectedFeatureIndex", null), __decorate([m({ readOnly: true })], z2.prototype, "selectedFeatureViewModel", null), __decorate([m({ type: f2 })], z2.prototype, "spatialReference", null), __decorate([m({ readOnly: true })], z2.prototype, "state", null), __decorate([m()], z2.prototype, "timeZone", null), __decorate([m()], z2.prototype, "title", void 0), __decorate([m()], z2.prototype, "updateLocationEnabled", void 0), __decorate([m()], z2.prototype, "view", void 0), __decorate([m()], z2.prototype, "visible", void 0), __decorate([m({ readOnly: true })], z2.prototype, "waitingForContents", null), __decorate([m({ readOnly: true })], z2.prototype, "waitingForResult", null), __decorate([m()], z2.prototype, "zoomFactor", void 0), __decorate([m()], z2.prototype, "zoomToLocation", void 0), __decorate([m()], z2.prototype, "centerAtLocation", null), z2 = __decorate([a("esri.widgets.Features.FeaturesViewModel")], z2);

// node_modules/@arcgis/core/widgets/Features/FeaturesVisibleElements.js
var l6 = class extends b {
  constructor() {
    super(...arguments), this.actionBar = true, this.closeButton = true, this.collapseButton = false, this.featureMenuHeading = true, this.featureNavigation = true, this.featureListLayerTitle = true, this.flow = true, this.heading = true, this.spinner = true;
  }
};
__decorate([m({ type: Boolean, nonNullable: true })], l6.prototype, "actionBar", void 0), __decorate([m({ type: Boolean, nonNullable: true })], l6.prototype, "closeButton", void 0), __decorate([m({ type: Boolean, nonNullable: true })], l6.prototype, "collapseButton", void 0), __decorate([m({ type: Boolean, nonNullable: true })], l6.prototype, "featureMenuHeading", void 0), __decorate([m({ type: Boolean, nonNullable: true })], l6.prototype, "featureNavigation", void 0), __decorate([m({ type: Boolean, nonNullable: true })], l6.prototype, "featureListLayerTitle", void 0), __decorate([m({ type: Boolean, nonNullable: true })], l6.prototype, "flow", void 0), __decorate([m({ type: Boolean, nonNullable: true })], l6.prototype, "heading", void 0), __decorate([m({ type: Boolean, nonNullable: true })], l6.prototype, "spinner", void 0), l6 = __decorate([a("esri.widgets.Features.FeaturesVisibleElements")], l6);

// node_modules/@arcgis/core/widgets/Features.js
var D = "selected-index";
var B3 = 0;
var S = "features-spinner";
function R(e8) {
  return e8?.declaredClass.startsWith("esri.layers.") ?? false;
}
var H2 = class extends n3(B) {
  constructor(e8, i6) {
    super(e8, i6), this._featureMenuIntersectionObserverCallback = ([e9]) => {
      e9?.isIntersecting && null != this.viewModel.featurePage && this.viewModel.featurePage++;
    }, this._featureMenuIntersectionObserver = new IntersectionObserver(this._featureMenuIntersectionObserverCallback, { root: window.document }), this._featureMenuIntersectionObserverNode = null, this._spinner = null, this._feature = null, this._focusAbortController = null, this._drillInFlowItems = new O(), this._drillInWidget = new f4({ flowItems: this._drillInFlowItems }), this._rootNode = null, this._rootFlowItemNode = null, this._featureMenuViewportNode = null, this._actionBarMenuNode = null, this.collapsed = false, this.featureNavigationTop = false, this.headerActions = new i5(), this.headingLevel = 2, this.messages = null, this.messagesCommon = null, this.responsiveActionsEnabled = false, this.viewModel = new z2(), this.visibleElements = new l6(), this._previousFeature = () => {
      this.viewModel.previous();
    }, this._nextFeature = () => {
      this.viewModel.next();
    }, this._handleFeatureBack = () => {
      "list" === this.initialDisplayMode ? (this.selectedFeatureIndex = -1, this._focusFlowItemNode()) : this._openFeatureMenu();
    }, this._handleFeatureMenuBack = () => {
      "list" === this.initialDisplayMode ? (this.selectedFeatureIndex = -1, this._focusFlowItemNode()) : this.featureMenuOpen && this._closeFeatureMenu();
    }, this._storeRootNode = (e9) => {
      this._rootNode = e9;
    }, this._displaySpinnerThrottled = l3(() => this._displaySpinner(), B3), this._addSelectedFeatureIndexHandle(), this.addHandles([this._displaySpinnerThrottled, l2(() => this.viewModel?.active, () => this._toggleScreenLocationEnabled()), l2(() => this.viewModel?.active, (e9) => this._drillInWidget.closed = !e9), l2(() => this.visibleElements?.closeButton, (e9) => this._drillInWidget.closable = e9), l2(() => this.visibleElements?.spinner, (e9) => this._spinnerEnabledChange(e9)), l2(() => this.viewModel?.view, (e9, t5) => this._viewChange(e9, t5)), l2(() => this.viewModel?.view?.ready, (e9, t5) => this._viewReadyChange(e9 ?? false, t5 ?? false)), l2(() => [this.viewModel?.waitingForResult, this.viewModel?.location], () => {
      this._hideSpinner(), this._displaySpinnerThrottled();
    }), l2(() => this.viewModel?.screenLocation, () => this._closeOpenActionMenu()), l2(() => this.selectedFeatureWidget?.viewModel, () => this._destroyDrillInFlowItemWidgets()), l2(() => this.featureMenuOpen, () => this._drillInWidget.selectLastFlowItem = "list" === this.initialDisplayMode || !this.featureMenuOpen, h), l2(() => {
      const e9 = this.selectedFeatureWidget?.viewModel;
      return [e9?.title, e9?.state];
    }, () => this._setTitleFromFeatureWidget()), l2(() => {
      const e9 = this.selectedFeatureWidget?.viewModel;
      return [e9?.content, e9?.state];
    }, () => this._setContentFromFeatureWidget()), l2(() => this.viewModel?.featureViewModels, () => this._featureMenuViewportScrollTop()), l2(() => this._drillInFlowItems.length, () => this._focusFlowItemNode()), this._drillInWidget.on("close", () => this.close()), this._drillInWidget.on("exit", () => this._destroyDrillInFlowItemWidgets()), this._drillInWidget.on("open-feature", ({ feature: e9 }) => this._openRelatedFeature(e9)), this._drillInWidget.on("zoom-to-feature", ({ featureWidget: e9 }) => f5(this.viewModel, e9))]);
  }
  loadDependencies() {
    return Promise.all([e5(), c3({ action: () => import("./calcite-action-ZSODFWAI.js"), "action-bar": () => import("./calcite-action-bar-PRRYQPCO.js"), "action-group": () => import("./calcite-action-group-WSYGPVS4.js"), button: () => import("./calcite-button-MKDUFM5F.js"), icon: () => import("./calcite-icon-YAZUXSRW.js"), flow: () => import("./calcite-flow-SLV3UYAY.js"), "flow-item": () => import("./calcite-flow-item-BZCIO4HY.js"), list: () => import("./calcite-list-Z3O7DTQI.js"), "list-item": () => import("./calcite-list-item-C7623NT4.js"), "list-item-group": () => import("./calcite-list-item-group-5XWT6KVD.js"), loader: () => import("./calcite-loader-WDQKP4UK.js") })]);
  }
  destroy() {
    this._destroyDrillInFlowItemWidgets(), this._destroySelectedFeatureWidget(), this._destroySpinner(), this._unobserveFeatureMenuObserver(), this._featureMenuIntersectionObserver?.disconnect(), this._drillInWidget?.destroy(), this._focusAbortController?.abort();
  }
  get _hideActionText() {
    if (!this.responsiveActionsEnabled) return false;
    const e8 = this.view?.widthBreakpoint;
    return "xsmall" === e8 || "small" === e8 || "medium" === e8;
  }
  get _featureNavigationVisible() {
    return this.viewModel.active && this.viewModel.featureCount > 1 && !!this.viewModel.selectedFeature && this.visibleElements.featureNavigation;
  }
  get _isCollapsed() {
    return this._collapseEnabled && this.collapsed;
  }
  get _collapseEnabled() {
    return this.visibleElements.collapseButton && ("list" === this.initialDisplayMode || !!this.title && !!this.content);
  }
  get active() {
    return this.viewModel.active;
  }
  get content() {
    return this.viewModel.content;
  }
  set content(e8) {
    this.viewModel.content = e8;
  }
  get icon() {
    return null;
  }
  get featureMenuOpen() {
    return this.viewModel.featureMenuOpen;
  }
  set featureMenuOpen(e8) {
    this.viewModel.featureMenuOpen = e8;
  }
  get featureMenuTitle() {
    return this.viewModel.featureMenuTitle;
  }
  set featureMenuTitle(e8) {
    this.viewModel.featureMenuTitle = e8;
  }
  get features() {
    return this.viewModel.features;
  }
  set features(e8) {
    this.viewModel.features = e8;
  }
  get goToOverride() {
    return this.viewModel.goToOverride;
  }
  set goToOverride(e8) {
    this.viewModel.goToOverride = e8;
  }
  get initialDisplayMode() {
    return this.viewModel.initialDisplayMode;
  }
  set initialDisplayMode(e8) {
    this.viewModel.initialDisplayMode = e8;
  }
  get location() {
    return this.viewModel.location;
  }
  set location(e8) {
    this.viewModel.location = e8;
  }
  get label() {
    return this.messages?.widgetLabel ?? "";
  }
  set label(e8) {
    this._overrideIfSome("label", e8);
  }
  get map() {
    return this.viewModel.map;
  }
  set map(e8) {
    this.viewModel.map = e8;
  }
  get promises() {
    return this.viewModel.promises;
  }
  set promises(e8) {
    this.viewModel.promises = e8;
  }
  get selectedFeature() {
    return this.viewModel.selectedFeature;
  }
  get selectedDrillInFeature() {
    const e8 = Array.from(this._drillInFlowItems).at(-1);
    if (!e8) return null;
    const { flowType: t5 } = e8;
    return "feature-association" === t5 || "feature-relationship" === t5 ? e8.graphic ?? null : null;
  }
  get selectedFeatureIndex() {
    return this.viewModel.selectedFeatureIndex;
  }
  set selectedFeatureIndex(e8) {
    this.viewModel.selectedFeatureIndex = e8;
  }
  get selectedFeatureWidget() {
    const { _feature: e8, headingLevel: t5, _drillInFlowItems: i6, timeZone: o5, spatialReference: s6, map: n7 } = this, { selectedFeatureViewModel: r2 } = this.viewModel, l7 = { title: false };
    return r2 ? (e8 ? (e8.viewModel = r2, e8.visibleElements = l7) : this._feature = new F({ flowItems: i6, headingLevel: t5 + 1, timeZone: o5, spatialReference: s6, map: n7, viewModel: r2, visibleElements: l7 }), this._feature) : null;
  }
  get spatialReference() {
    return this.viewModel.spatialReference;
  }
  set spatialReference(e8) {
    this.viewModel.spatialReference = e8;
  }
  get title() {
    return this.viewModel.title;
  }
  set title(e8) {
    this.viewModel.title = e8;
  }
  get timeZone() {
    return this.viewModel.timeZone;
  }
  set timeZone(e8) {
    this.viewModel.timeZone = e8;
  }
  get updateLocationEnabled() {
    return this.viewModel.updateLocationEnabled;
  }
  set updateLocationEnabled(e8) {
    this.viewModel.updateLocationEnabled = e8;
  }
  get view() {
    return this.viewModel.view;
  }
  set view(e8) {
    this.viewModel.view = e8;
  }
  get visible() {
    return this.viewModel.visible;
  }
  set visible(e8) {
    this.viewModel.visible = e8;
  }
  blur() {
    const { active: e8 } = this.viewModel;
    e8 ? this._rootFlowItemNode?.blur() : i.getLogger(this).warn("Features can only be blurred when currently active.");
  }
  clear() {
    return this.viewModel.clear();
  }
  close() {
    this.viewModel.visible = false;
  }
  fetchFeatures(e8, t5) {
    return this.viewModel.fetchFeatures(e8, t5);
  }
  focus() {
    const { active: e8 } = this.viewModel;
    e8 ? this._focusFlowItemNode() : i.getLogger(this).warn("Features can only be focused when currently active.");
  }
  next() {
    return this.viewModel.next();
  }
  open(e8) {
    this.removeHandles(D);
    const t5 = { collapsed: e8?.collapsed ?? false };
    this.set(t5), this.viewModel.open(e8), this.addHandles(f(() => !this.viewModel.waitingForResult, () => this._addSelectedFeatureIndexHandle(), { once: true }));
  }
  previous() {
    return this.viewModel.previous();
  }
  triggerAction(e8) {
    return this.viewModel.triggerAction(e8);
  }
  render() {
    return n("div", { afterCreate: this._storeRootNode, bind: this, class: this.classes(n5.base, e3.widget, e3.panel), onkeydown: this._onMainKeydown }, this._renderHeader(), this._renderContentContainer());
  }
  _renderFeatureNavigation() {
    return [this._renderPagination(), "list" === this.initialDisplayMode ? this._renderFeaturePaginationText() : this._renderFeatureMenuButton()];
  }
  _renderHeader() {
    return this.featureNavigationTop && this._featureNavigationVisible ? n("div", { class: n5.header, key: "header-actions" }, this._renderFeatureNavigation()) : null;
  }
  _renderFooter() {
    return !this.featureNavigationTop && this._featureNavigationVisible ? n("div", { class: n5.footer, key: "footer-actions", slot: "footer" }, this._renderFeatureNavigation()) : null;
  }
  _renderFeaturePaginationText() {
    const { messages: e8, viewModel: t5 } = this, { featureCount: i6, selectedFeatureIndex: o5 } = t5;
    return n("div", { class: n5.paginationText, key: "feature-pagination-text" }, s2(e8.pageText, { index: c2(o5 + 1), total: c2(i6) }));
  }
  _renderFeatureMenuButton() {
    const { messages: e8, viewModel: t5 } = this, { featureCount: i6, selectedFeatureIndex: o5, pendingPromisesCount: s6 } = t5;
    return n("calcite-action", { appearance: "solid", bind: this, class: n5.paginationMenuButton, icon: "list", key: "feature-menu-button", label: e8.selectFeature, loading: s6 > 0, onclick: this._handlePaginationMenuButton, scale: "s", text: s2(e8.pageText, { index: c2(o5 + 1), total: c2(i6) }), textEnabled: true, title: e8.selectFeature });
  }
  _renderPagination() {
    const { previous: e8, next: t5 } = this.messagesCommon.pagination;
    return n("calcite-action-bar", { class: n5.paginationActionBar, expandDisabled: true, key: "pagination-action-bar", layout: "horizontal", overflowActionsDisabled: true, scale: "s" }, n("calcite-action-group", { scale: "s" }, n("calcite-action", { appearance: "solid", class: n5.paginationPrevious, icon: "chevron-left", iconFlipRtl: true, label: e8, onclick: this._previousFeature, scale: "s", text: e8, title: e8 }), n("calcite-action", { appearance: "solid", icon: "chevron-right", iconFlipRtl: true, label: t5, onclick: this._nextFeature, scale: "s", text: t5, title: t5 })));
  }
  _renderFeatureMenuItem(e8) {
    const { initialDisplayMode: t5 } = this, { selectedFeatureViewModel: i6, featureViewModels: o5 } = this.viewModel, s6 = e8 === i6, n7 = o5.indexOf(e8);
    return n("calcite-list-item", { bind: this, "data-feature-index": n7, key: `feature-menu-item-${e8.uid}`, onblur: this._removeActiveFeature, onfocus: this._setActiveFeature, onmouseleave: this._removeActiveFeature, onmouseover: this._setActiveFeature, selected: s6, onCalciteListItemSelect: this._selectFeature }, n("span", { innerHTML: e8.title || this.messagesCommon.untitled, slot: "content" }), "list" === t5 ? n("calcite-icon", { flipRtl: true, icon: "chevron-right", scale: "s", slot: "content-end" }) : null);
  }
  _groupResultsByLayer() {
    const { featureViewModels: e8 } = this.viewModel, t5 = /* @__PURE__ */ new Map();
    return e8.forEach((e9) => {
      const i6 = e9?.graphic;
      if (!i6) return;
      const { layer: o5, sourceLayer: s6 } = i6, n7 = (R(o5) ? o5 : null) || (R(s6) ? s6 : null), r2 = t5.get(n7) ?? [];
      t5.set(n7, [...r2, e9]);
    }), t5;
  }
  _renderFeatureMenu() {
    const { messages: e8, viewModel: t5 } = this, i6 = this._groupResultsByLayer(), o5 = "list" === this.initialDisplayMode ? "none" : "single";
    return t5.featureViewModels.length ? n("calcite-list", { displayMode: "flat", label: e8?.featuresList, selectionAppearance: "icon", selectionMode: o5 }, Array.from(i6.keys(), (e9) => {
      const t6 = i6.get(e9)?.map((e10) => this._renderFeatureMenuItem(e10)), o6 = e9 ? e9.title ?? this.messagesCommon.untitled : null;
      return this.visibleElements.featureListLayerTitle && null !== o6 ? n("calcite-list-item-group", { heading: o6, key: e9?.uid || "map-graphics" }, t6) : t6;
    })) : null;
  }
  _renderHeaderAction(e8, t5) {
    const i6 = e8.title || "";
    return e8.visible ? n("calcite-action", { active: "toggle" === e8.type && e8.value, appearance: "solid", bind: this, "data-action-id": e8.id, "data-action-uid": e8.uid, disabled: e8.disabled, icon: e8.icon ?? void 0, indicator: e8.indicator, key: `header-action-${t5}`, loading: e8.active, onclick: this._triggerHeaderAction, slot: "header-actions-end", text: i6, title: i6 }) : null;
  }
  _renderHeaderActions() {
    return this.headerActions.map((e8, t5) => this._renderHeaderAction(e8, t5)).toArray();
  }
  _renderContentFeature() {
    const { headingLevel: e8, visibleElements: t5, _isCollapsed: i6, _collapseEnabled: o5, featureNavigationTop: s6, _drillInFlowItems: n7, initialDisplayMode: r2, selectedFeature: l7, featureMenuOpen: a7 } = this, { title: d3, active: c9 } = this.viewModel, u2 = t5.heading && d3 ? d3 : "";
    if ("list" === r2 && !l7) return null;
    const h4 = 0 === n7.length && ("list" === r2 ? !!l7 : !a7);
    return n("calcite-flow-item", { afterCreate: this._storeRootFlowItemNode, bind: this, class: this.classes({ [n5.contentFeature]: true, [n5.flowItemCollapsed]: i6 }), closable: t5.closeButton, closed: !c9, collapsed: i6, collapseDirection: s6 ? "down" : "up", collapsible: o5, headingLevel: e8, key: "root-flow-item", selected: h4, onCalciteFlowItemBack: this._handleFeatureBack, onCalciteFlowItemClose: this.close, onCalciteFlowItemToggle: this._handleCollapseToggle }, u2 ? n(s3, { class: this.classes(n5.featuresHeading, e3.heading), innerHTML: u2, key: "header-content", level: this.headingLevel, slot: "header-content" }) : null, this._renderHeaderActions(), this._renderActionBar(), n("div", { class: this.classes(n5.container, n5.contentContainer) }, this._renderContent()), this._renderFooter());
  }
  _renderFeatureMenuContainer() {
    const { viewModel: e8, visibleElements: t5, featureMenuTitle: i6, messages: o5, messagesCommon: s6, initialDisplayMode: n7, featureMenuOpen: r2, selectedFeature: l7, _collapseEnabled: a7, _isCollapsed: d3, featureNavigationTop: c9, headingLevel: u2 } = this, { active: h4, featureViewModels: p4, pendingPromisesCount: m6 } = e8, { featureMenuHeading: v2 } = t5, g2 = i6 ?? o5.selectFeature;
    if ("feature" === n7 && !r2) return null;
    const w2 = "list" === n7 ? !l7 : r2;
    return n("calcite-flow-item", { afterCreate: this._storeFeatureMenuFlowItemNode, bind: this, class: this.classes({ [n5.flowItemCollapsed]: d3 }), closable: "list" === n7 && t5.closeButton, closed: !h4, collapsed: "list" === n7 && d3, collapseDirection: c9 ? "down" : "up", collapsible: "list" === n7 && a7, description: v2 ? s2(o5.total, { total: p4.length }) : void 0, heading: v2 ? g2 : void 0, headingLevel: u2, key: "feature-menu", loading: e8.waitingForContents, selected: w2, onCalciteFlowItemBack: (e9) => {
      e9.preventDefault(), this._handleFeatureMenuBack();
    }, onCalciteFlowItemClose: this.close, onCalciteFlowItemToggle: this._handleCollapseToggle }, "list" === n7 ? this._renderHeaderActions() : null, m6 > 0 ? n("calcite-loader", { class: n5.loader, inline: true, key: "feature-menu-loader", label: s6.loading, slot: "header-actions-end" }) : null, n("div", { class: n5.container }, this._renderFeatureMenu()), n("div", { afterCreate: this._featureMenuIntersectionObserverCreated, bind: this, class: n5.featureMenuObserver }), "feature" === n7 ? n("calcite-button", { appearance: "transparent", onclick: this._handleFeatureMenuBack, slot: "footer-actions", width: "full" }, s6.back) : null);
  }
  _renderContentContainer() {
    const e8 = "list" === this.initialDisplayMode ? [this._renderFeatureMenuContainer(), this._renderContentFeature(), this._drillInWidget.render()] : [this._renderContentFeature(), this._drillInWidget.render(), this._renderFeatureMenuContainer()];
    return this.visibleElements.flow ? n("calcite-flow", { key: "content-container" }, e8) : e8;
  }
  _getFallbackIcon(e8) {
    const { className: t5, icon: i6 } = e8;
    if (i6) return null;
    const o5 = s4({ action: e8, feature: this.selectedFeature }), s6 = { [n5.icon]: !!t5, [n5.actionImage]: !!o5 };
    return t5 && (s6[t5] = true), o5 || t5 ? n("span", { "aria-hidden": "true", class: this.classes(n5.icon, s6), key: "icon", styles: c5(o5) }) : null;
  }
  _renderActionBar() {
    return !this._isCollapsed && this.visibleElements.actionBar && this.viewModel.allActions?.length ? n("calcite-action-bar", { expandDisabled: true, expanded: !this._hideActionText, key: "header-action-bar", scale: "s", slot: "action-bar" }, n("calcite-action-group", { afterCreate: (e8) => this._actionBarMenuNode = e8, overlayPositioning: "fixed", scale: "s" }, this._renderActions())) : null;
  }
  _renderActions() {
    return this.viewModel.allActions.toArray().map((e8, t5) => {
      const i6 = this._getActionTitle(e8);
      return n4(e8, { key: `action-${t5}`, title: i6, text: i6, textEnabled: !this._hideActionText, onclick: this._triggerAction, bind: this }, this._getFallbackIcon(e8));
    });
  }
  _renderContent() {
    const e8 = this.viewModel?.content;
    return e8 ? "string" == typeof e8 ? n("div", { class: t.contentNode, innerHTML: e8, key: e8 }) : this.renderNodeContent(e8) : null;
  }
  _handleCollapseToggle() {
    this.collapsed = !this.collapsed;
  }
  async _openRelatedFeature(e8) {
    await e8.viewModel.updateGeometry();
    const t5 = e8.graphic, i6 = t5?.geometry;
    if (null == i6 || null == t5) return;
    this._destroyDrillInFlowItemWidgets(), await this.viewModel.zoomTo({ target: i6 });
    const o5 = o2(i6);
    this.open({ features: [t5], location: null != o5 ? o5 : void 0 }), this._focusFlowItemNode();
  }
  _handlePaginationMenuButton() {
    this._updateFeatureMenu();
  }
  _openFeatureMenu() {
    this._updateFeatureMenu(true);
  }
  _closeFeatureMenu() {
    this._updateFeatureMenu(false);
  }
  _updateFeatureMenu(e8 = !this.featureMenuOpen) {
    this.featureMenuOpen = e8, this._focusFlowItemNode();
  }
  async _focusFlowItemNode() {
    this._focusAbortController?.abort(), this._focusAbortController = new AbortController();
    const e8 = this._focusAbortController.signal;
    await y(U(e8));
    const t5 = this._rootNode?.querySelector("calcite-flow-item[selected]");
    j2(t5);
  }
  _storeRootFlowItemNode(e8) {
    this._rootFlowItemNode = e8;
  }
  _storeFeatureMenuFlowItemNode(e8) {
    this._featureMenuViewportNode = e8;
  }
  _setActiveFeature(e8) {
    const { viewModel: t5 } = this, i6 = e8.currentTarget["data-feature-index"];
    t5.activeFeature = t5.features?.[i6] || null;
  }
  _removeActiveFeature() {
    this.viewModel.activeFeature = null;
  }
  _selectFeature(e8) {
    const t5 = e8.currentTarget["data-feature-index"];
    isNaN(t5) || (this.viewModel.selectedFeatureIndex = t5), "feature" === this.initialDisplayMode ? this._handleFeatureMenuBack() : this._focusFlowItemNode();
  }
  _unobserveFeatureMenuObserver() {
    this._featureMenuIntersectionObserverNode && this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode);
  }
  _featureMenuIntersectionObserverCreated(e8) {
    this._unobserveFeatureMenuObserver(), this._featureMenuIntersectionObserver.observe(e8), this._featureMenuIntersectionObserverNode = e8;
  }
  _getActionTitle(e8) {
    const { messages: t5, selectedFeature: i6, messagesCommon: o5 } = this, { id: s6 } = e8, n7 = i6?.attributes, r2 = e8.title ?? "", l7 = "zoom-to-feature" === s6 ? s2(r2, { messages: t5 }) : "remove-selected-feature" === s6 ? s2(r2, { messages: o5 }) : "zoom-to-clustered-features" === s6 || "browse-clustered-features" === s6 ? s2(r2, { messages: t5 }) : e8.title;
    return l7 && n7 ? s2(l7, n7) : l7 ?? "";
  }
  _onMainKeydown(e8) {
    const { key: t5 } = e8;
    "ArrowLeft" === t5 && (e8.stopPropagation(), this._handleFeatureMenuBack(), this.previous()), "ArrowRight" === t5 && (e8.stopPropagation(), this._handleFeatureMenuBack(), this.next());
  }
  _featureMenuViewportScrollTop() {
    this._featureMenuViewportNode?.scrollContentTo({ top: 0 });
  }
  _setContentFromFeatureWidget() {
    const { selectedFeatureWidget: e8 } = this;
    e8 && (this.viewModel.content = e8);
  }
  _setTitleFromFeatureWidget() {
    const { selectedFeatureWidget: e8, messagesCommon: t5 } = this, i6 = e8?.viewModel;
    e8 && (this.viewModel.title = "error" === i6?.state ? t5?.errorMessage : i6?.title || "");
  }
  _addSelectedFeatureIndexHandle() {
    const e8 = l2(() => this.viewModel?.selectedFeatureIndex, (e9, t5) => this._selectedFeatureIndexUpdated(e9, t5));
    this.addHandles(e8, D);
  }
  _selectedFeatureIndexUpdated(e8, t5) {
    const { featureCount: i6 } = this.viewModel;
    i6 && e8 !== t5 && -1 !== e8 && (this._destroyDrillInFlowItemWidgets(), this._rootFlowItemNode?.scrollContentTo({ top: 0 }));
  }
  _triggerHeaderAction(e8) {
    const t5 = e8.currentTarget;
    if (t5.disabled) return;
    const i6 = t5.dataset.actionUid, o5 = this.headerActions.find(({ uid: e9 }) => e9 === i6);
    o5 && !o5.disabled && ("toggle" === o5?.type && (o5.value = !o5.value), this.emit("trigger-header-action", { action: o5 }));
  }
  _triggerAction(e8) {
    const t5 = e8.currentTarget;
    if (t5.disabled) return;
    const i6 = t5.dataset.actionUid, { allActions: o5 } = this.viewModel, s6 = o5.findIndex((e9) => e9.uid === i6), n7 = o5.at(s6);
    n7 && "toggle" === n7.type && (n7.value = !n7.value), this.viewModel.triggerAction(s6);
  }
  _createSpinner(e8) {
    e8 && (this._spinner = new c7({ view: e8 }), e8.ui.add(this._spinner, { key: S, position: "manual", internal: true }));
  }
  _wireUpView(e8) {
    this._destroySpinner(), e8 && this.visibleElements?.spinner && this._createSpinner(e8);
  }
  _hideSpinner() {
    const { _spinner: e8 } = this;
    e8 && (e8.location = null, e8.hide());
  }
  _viewReadyChange(e8, t5) {
    e8 ? this._wireUpView(this.viewModel?.view) : t5 && this.viewModel.clear();
  }
  _viewChange(e8, t5) {
    e8 && t5 && this.viewModel.clear();
  }
  _destroySelectedFeatureWidget() {
    const { _feature: e8 } = this;
    e8 && (e8.viewModel = null, !e8.destroyed && e8.destroy()), this._feature = null;
  }
  _closeOpenActionMenu() {
    const { _actionBarMenuNode: e8 } = this;
    e8 && (e8.menuOpen = false);
  }
  _destroyDrillInFlowItemWidgets() {
    this._drillInFlowItems.drain((e8) => {
      "showAllEnabled" in e8.viewModel && (e8.viewModel.showAllEnabled = false), "activeCategory" in e8.viewModel && (e8.viewModel.activeCategory = null), e8.viewModel = null, e8.destroy();
    });
  }
  _toggleScreenLocationEnabled() {
    const { viewModel: e8 } = this;
    e8 && (e8.screenLocationEnabled = e8.active);
  }
  _displaySpinner() {
    const { _spinner: e8 } = this;
    if (!e8) return;
    const { location: t5, waitingForResult: i6 } = this.viewModel;
    i6 && t5 ? e8.show({ location: t5 }) : e8.hide();
  }
  _destroySpinner() {
    const { _spinner: e8 } = this;
    e8 && (e8.view?.ui?.remove(e8, S), e8.destroy(), this._spinner = null);
  }
  _spinnerEnabledChange(e8) {
    this._destroySpinner(), e8 && this._createSpinner(this.viewModel?.view);
  }
};
__decorate([m()], H2.prototype, "_drillInFlowItems", void 0), __decorate([m()], H2.prototype, "_hideActionText", null), __decorate([m()], H2.prototype, "_featureNavigationVisible", null), __decorate([m()], H2.prototype, "_isCollapsed", null), __decorate([m()], H2.prototype, "_collapseEnabled", null), __decorate([m({ readOnly: true })], H2.prototype, "active", null), __decorate([m()], H2.prototype, "collapsed", void 0), __decorate([m()], H2.prototype, "content", null), __decorate([m()], H2.prototype, "icon", null), __decorate([m()], H2.prototype, "featureMenuOpen", null), __decorate([m()], H2.prototype, "featureMenuTitle", null), __decorate([m()], H2.prototype, "featureNavigationTop", void 0), __decorate([m()], H2.prototype, "features", null), __decorate([m()], H2.prototype, "goToOverride", null), __decorate([m({ type: i5 })], H2.prototype, "headerActions", void 0), __decorate([m()], H2.prototype, "headingLevel", void 0), __decorate([m()], H2.prototype, "initialDisplayMode", null), __decorate([m()], H2.prototype, "location", null), __decorate([m()], H2.prototype, "label", null), __decorate([m()], H2.prototype, "map", null), __decorate([m(), e2("esri/widgets/Features/t9n/Features")], H2.prototype, "messages", void 0), __decorate([m(), e2("esri/t9n/common")], H2.prototype, "messagesCommon", void 0), __decorate([m()], H2.prototype, "promises", null), __decorate([m()], H2.prototype, "responsiveActionsEnabled", void 0), __decorate([m({ readOnly: true })], H2.prototype, "selectedFeature", null), __decorate([m({ readOnly: true })], H2.prototype, "selectedDrillInFeature", null), __decorate([m()], H2.prototype, "selectedFeatureIndex", null), __decorate([m({ readOnly: true })], H2.prototype, "selectedFeatureWidget", null), __decorate([m()], H2.prototype, "spatialReference", null), __decorate([m()], H2.prototype, "title", null), __decorate([m()], H2.prototype, "timeZone", null), __decorate([m()], H2.prototype, "updateLocationEnabled", null), __decorate([m()], H2.prototype, "view", null), __decorate([m({ type: z2 }), e4(["triggerAction", "trigger-action"])], H2.prototype, "viewModel", void 0), __decorate([m({ type: l6, nonNullable: true })], H2.prototype, "visibleElements", void 0), __decorate([m()], H2.prototype, "visible", null), H2 = __decorate([a("esri.widgets.Features")], H2);

// node_modules/@arcgis/core/widgets/Popup/css.js
var t4 = "esri-popup";
var o4 = `${t4}--is-docked`;
var e7 = { base: t4, baseHidden: `${t4}--hidden`, main: `${t4}__main-container`, shadow: `${t4}--shadow`, isDocked: o4, isDockedTopLeft: `${o4}-top-left`, isDockedTopCenter: `${o4}-top-center`, isDockedTopRight: `${o4}-top-right`, isDockedBottomLeft: `${o4}-bottom-left`, isDockedBottomCenter: `${o4}-bottom-center`, isDockedBottomRight: `${o4}-bottom-right`, alignTopCenter: `${t4}--aligned-top-center`, alignBottomCenter: `${t4}--aligned-bottom-center`, alignTopLeft: `${t4}--aligned-top-left`, alignBottomLeft: `${t4}--aligned-bottom-left`, alignTopRight: `${t4}--aligned-top-right`, alignBottomRight: `${t4}--aligned-bottom-right`, pointer: `${t4}__pointer`, pointerDirection: `${t4}__pointer-direction` };

// node_modules/@arcgis/core/widgets/Popup/PopupViewModel.js
var s5 = class extends z2 {
  constructor(r2) {
    super(r2);
  }
};
s5 = __decorate([a("esri.widgets.Popup.PopupViewModel")], s5);

// node_modules/@arcgis/core/widgets/Popup/PopupVisibleElements.js
var a6 = class extends b {
  constructor() {
    super(...arguments), this.actionBar = true, this.closeButton = true, this.collapseButton = true, this.featureMenuHeading = true, this.featureNavigation = true, this.featureListLayerTitle = true, this.heading = true, this.spinner = true;
  }
};
__decorate([m({ type: Boolean, nonNullable: true })], a6.prototype, "actionBar", void 0), __decorate([m({ type: Boolean, nonNullable: true })], a6.prototype, "closeButton", void 0), __decorate([m({ type: Boolean, nonNullable: true })], a6.prototype, "collapseButton", void 0), __decorate([m({ type: Boolean, nonNullable: true })], a6.prototype, "featureMenuHeading", void 0), __decorate([m({ type: Boolean, nonNullable: true })], a6.prototype, "featureNavigation", void 0), __decorate([m({ type: Boolean, nonNullable: true })], a6.prototype, "featureListLayerTitle", void 0), __decorate([m({ type: Boolean, nonNullable: true })], a6.prototype, "heading", void 0), __decorate([m({ type: Boolean, nonNullable: true })], a6.prototype, "spinner", void 0), a6 = __decorate([a("esri.widgets.Popup.PopupVisibleElements")], a6);

// node_modules/@arcgis/core/widgets/Popup.js
var E = 200;
var C = { buttonEnabled: true, position: "auto", breakpoint: { width: 544 } };
var D2 = class extends B {
  constructor(e8, t5) {
    super(e8, t5), this._dockAction = new c4({ id: "popup-dock-action" }), this._featuresWidget = new H2({ responsiveActionsEnabled: true }), this._containerNode = null, this._mainContainerNode = null, this._pointerOffsetInPx = 16, this._focusAbortController = null, this.alignment = "auto", this.dockEnabled = false, this.headingLevel = 2, this.messages = null, this.viewModel = new s5(), this.visibleElements = new a6();
  }
  initialize() {
    this.addHandles([l2(() => [this.viewModel?.view?.widthBreakpoint, this.dockEnabled], () => this._handleDockIcon(), h), l2(() => [this.dockEnabled, this.messages?.undock, this.messages?.dock], () => this._handleDockEnabled(), h), l2(() => this.dockOptions, (e8) => {
      const { _dockAction: t5 } = this, i6 = this._featuresWidget.headerActions;
      i6.remove(t5), e8.buttonEnabled && i6.add(t5);
    }, h), l2(() => this.viewModel?.screenLocation, () => this._positionContainer()), l2(() => [this.viewModel?.active, this.dockEnabled], () => this._toggleScreenLocationEnabled()), l2(() => [this.viewModel?.screenLocation, this.viewModel?.view?.padding, this.viewModel?.view?.size, this.viewModel?.active, this.viewModel?.location, this.alignment], () => this.reposition()), l2(() => this.viewModel?.view?.size, (e8, t5) => this._updateDockEnabledForViewSize(e8, t5)), l2(() => this.viewModel?.view, (e8, t5) => this._viewChange(e8, t5)), l2(() => this.viewModel?.view?.ready, (e8, t5) => this._viewReadyChange(e8 ?? false, t5 ?? false)), l2(() => this.viewModel, () => this._featuresWidget.viewModel = this.viewModel, h), l2(() => this._featureNavigationTop, (e8) => this._featuresWidget.featureNavigationTop = e8, h), l2(() => this.headingLevel, (e8) => this._featuresWidget.headingLevel = e8, h), l2(() => this.visibleElements.actionBar, (e8) => this._featuresWidget.visibleElements.actionBar = !!e8, h), l2(() => this.visibleElements.closeButton, (e8) => this._featuresWidget.visibleElements.closeButton = !!e8, h), l2(() => this.visibleElements.collapseButton, (e8) => this._featuresWidget.visibleElements.collapseButton = !!e8, h), l2(() => this.visibleElements.heading, (e8) => this._featuresWidget.visibleElements.heading = !!e8, h), l2(() => this.visibleElements.spinner, (e8) => this._featuresWidget.visibleElements.spinner = !!e8, h), l2(() => this.visibleElements.featureNavigation, (e8) => this._featuresWidget.visibleElements.featureNavigation = !!e8, h), l2(() => this.visibleElements.featureMenuHeading, (e8) => this._featuresWidget.visibleElements.featureMenuHeading = !!e8, h), l2(() => this.visibleElements.featureListLayerTitle, (e8) => this._featuresWidget.visibleElements.featureListLayerTitle = !!e8, h), a2(() => this._featuresWidget, "trigger-header-action", (e8) => {
      e8.action === this._dockAction && (this.dockEnabled = !this.dockEnabled);
    })]);
  }
  destroy() {
    this._dockAction.destroy(), this._featuresWidget && (this._featuresWidget.viewModel = new z2(), this._featuresWidget.destroy()), this._focusAbortController?.abort();
  }
  get _featureNavigationTop() {
    const { currentAlignment: e8, currentDockPosition: t5 } = this;
    return "bottom-left" === e8 || "bottom-center" === e8 || "bottom-right" === e8 || "top-left" === t5 || "top-center" === t5 || "top-right" === t5;
  }
  get actions() {
    return this.viewModel.actions;
  }
  set actions(e8) {
    this.viewModel.actions = e8;
  }
  get active() {
    return this.viewModel.active;
  }
  get autoCloseEnabled() {
    return this.viewModel.autoCloseEnabled;
  }
  set autoCloseEnabled(e8) {
    this.viewModel.autoCloseEnabled = e8;
  }
  get defaultPopupTemplateEnabled() {
    return this.viewModel.defaultPopupTemplateEnabled;
  }
  set defaultPopupTemplateEnabled(e8) {
    this.viewModel.defaultPopupTemplateEnabled = e8;
  }
  get content() {
    return this.viewModel.content;
  }
  set content(e8) {
    this.viewModel.content = e8;
  }
  get collapsed() {
    return this._featuresWidget.collapsed;
  }
  set collapsed(e8) {
    this._featuresWidget.collapsed = e8;
  }
  get currentAlignment() {
    return this._getCurrentAlignment();
  }
  get currentDockPosition() {
    return this._getCurrentDockPosition();
  }
  get dockOptions() {
    return this._get("dockOptions") || C;
  }
  set dockOptions(e8) {
    const t5 = { ...C }, i6 = this.viewModel?.view?.breakpoints, o5 = {};
    i6 && (o5.width = i6.xsmall, o5.height = i6.xsmall);
    const n7 = { ...t5, ...e8 }, s6 = { ...t5.breakpoint, ...o5 }, { breakpoint: r2 } = n7;
    "object" == typeof r2 ? n7.breakpoint = { ...s6, ...r2 } : r2 && (n7.breakpoint = s6), this._set("dockOptions", n7), this._setCurrentDockPosition(), this.reposition();
  }
  get featureCount() {
    return this.viewModel.featureCount;
  }
  get featureMenuOpen() {
    return this.viewModel.featureMenuOpen;
  }
  set featureMenuOpen(e8) {
    this.viewModel.featureMenuOpen = e8;
  }
  get features() {
    return this.viewModel.features;
  }
  set features(e8) {
    this.viewModel.features = e8;
  }
  get goToOverride() {
    return this.viewModel.goToOverride;
  }
  set goToOverride(e8) {
    this.viewModel.goToOverride = e8;
  }
  get highlightEnabled() {
    return this.viewModel.highlightEnabled;
  }
  set highlightEnabled(e8) {
    this.viewModel.highlightEnabled = e8;
  }
  get icon() {
    return "popup";
  }
  set icon(e8) {
    this._overrideIfSome("icon", e8);
  }
  get initialDisplayMode() {
    return this.viewModel.initialDisplayMode;
  }
  set initialDisplayMode(e8) {
    this.viewModel.initialDisplayMode = e8;
  }
  get location() {
    return this.viewModel.location;
  }
  set location(e8) {
    this.viewModel.location = e8;
  }
  get label() {
    return this.messages?.widgetLabel ?? "";
  }
  set label(e8) {
    this._overrideIfSome("label", e8);
  }
  get promises() {
    return this.viewModel.promises;
  }
  set promises(e8) {
    this.viewModel.promises = e8;
  }
  get selectedFeature() {
    return this.viewModel.selectedFeature;
  }
  get selectedDrillInFeature() {
    return this._featuresWidget.selectedDrillInFeature ?? null;
  }
  get selectedFeatureIndex() {
    return this.viewModel.selectedFeatureIndex;
  }
  set selectedFeatureIndex(e8) {
    this.viewModel.selectedFeatureIndex = e8;
  }
  get selectedFeatureWidget() {
    return this._featuresWidget.selectedFeatureWidget;
  }
  get title() {
    return this.viewModel.title;
  }
  set title(e8) {
    this.viewModel.title = e8;
  }
  get updateLocationEnabled() {
    return this.viewModel.updateLocationEnabled;
  }
  set updateLocationEnabled(e8) {
    this.viewModel.updateLocationEnabled = e8;
  }
  get view() {
    return this.viewModel.view;
  }
  set view(e8) {
    this.viewModel.view = e8;
  }
  get visible() {
    return this.viewModel.visible;
  }
  set visible(e8) {
    this.viewModel.visible = e8;
  }
  blur() {
    const { active: e8 } = this.viewModel;
    e8 || i.getLogger(this).warn("Popup can only be blurred when currently active."), this._featuresWidget.blur();
  }
  clear() {
    return this.viewModel.clear();
  }
  close() {
    this.visible = false;
  }
  fetchFeatures(e8, t5) {
    return this.viewModel.fetchFeatures(e8, t5);
  }
  focus() {
    const { active: e8 } = this.viewModel;
    e8 || i.getLogger(this).warn("Popup can only be focused when currently active."), this._handleFocus();
  }
  next() {
    return this.viewModel.next();
  }
  open(e8) {
    const t5 = !!e8 && !!e8.featureMenuOpen, i6 = { collapsed: !!e8 && !!e8.collapsed, featureMenuOpen: t5 };
    this.set(i6), this.viewModel.open(e8), e8?.shouldFocus && this._handleFocus(true);
  }
  previous() {
    return this.viewModel.previous();
  }
  reposition() {
    this.renderNow(), this._positionContainer(), this._setCurrentAlignment();
  }
  triggerAction(e8) {
    return this.viewModel.triggerAction(e8);
  }
  render() {
    const { dockEnabled: e8, currentAlignment: t5, currentDockPosition: i6 } = this, { active: o5, screenLocation: n7 } = this.viewModel, s6 = o5 && e8, r2 = o5 && !e8, l7 = this.selectedFeature?.layer?.title, a7 = this.selectedFeature?.layer?.id, c9 = { [e7.alignTopCenter]: "top-center" === t5, [e7.alignBottomCenter]: "bottom-center" === t5, [e7.alignTopLeft]: "top-left" === t5, [e7.alignBottomLeft]: "bottom-left" === t5, [e7.alignTopRight]: "top-right" === t5, [e7.alignBottomRight]: "bottom-right" === t5, [e7.isDocked]: s6, [e7.shadow]: r2, [e7.isDockedTopLeft]: "top-left" === i6, [e7.isDockedTopCenter]: "top-center" === i6, [e7.isDockedTopRight]: "top-right" === i6, [e7.isDockedBottomLeft]: "bottom-left" === i6, [e7.isDockedBottomCenter]: "bottom-center" === i6, [e7.isDockedBottomRight]: "bottom-right" === i6 };
    return n("div", { afterCreate: this._positionContainer, afterUpdate: this._positionContainer, "aria-hidden": (!o5).toString(), "aria-label": c(this.title ?? ""), "aria-modal": "false", bind: this, class: this.classes(e7.base, c9, { [e7.baseHidden]: !n7 && !e8 }), "data-layer-id": a7, "data-layer-title": l7, role: "dialog" }, o5 ? [this._renderMainContainer(), this._renderPointer()] : null);
  }
  _renderPointer() {
    return this.dockEnabled ? null : n("div", { class: e7.pointer, key: "popup-pointer", role: "presentation" }, n("div", { class: this.classes(e7.pointerDirection, e7.shadow) }));
  }
  _renderMainContainer() {
    const { dockEnabled: e8 } = this, t5 = { [e7.shadow]: e8 };
    return n("div", { afterCreate: this._setMainContainerNode, afterUpdate: this._setMainContainerNode, bind: this, class: this.classes(e7.main, e3.widget, t5) }, this._featuresWidget.render());
  }
  _getAnimationDurationMS() {
    const { _containerNode: e8 } = this;
    return e8 ? 1e3 * parseFloat(window.getComputedStyle(e8).animationDuration) : E;
  }
  async _handleFocus(e8 = false) {
    this._focusAbortController?.abort(), this._focusAbortController = new AbortController();
    const t5 = this._focusAbortController.signal;
    e8 && await j(() => true === this.viewModel?.active, { signal: t5 }), await y(U(t5)), await y(T(this._getAnimationDurationMS(), t5)), this._featuresWidget.focus();
  }
  _isOutsideView(e8) {
    const { popupHeight: t5, popupWidth: i6, screenLocation: o5, side: n7, view: s6 } = e8;
    if (isNaN(i6) || isNaN(t5) || !s6 || !o5) return false;
    const r2 = s6.padding;
    return "right" === n7 && o5.x + i6 / 2 > s6.width - r2.right || ("left" === n7 && o5.x - i6 / 2 < r2.left || ("top" === n7 && o5.y - t5 < r2.top || "bottom" === n7 && o5.y + t5 > s6.height - r2.bottom));
  }
  _calculateAutoAlignment(e8) {
    if ("auto" !== e8) return e8;
    const { _pointerOffsetInPx: t5, _containerNode: i6, _mainContainerNode: o5, viewModel: n7 } = this, { screenLocation: s6, view: r2 } = n7;
    if (null == s6 || !r2 || !i6) return "top-center";
    function l7(e9) {
      return parseInt(e9.replaceAll(/[^-\d.]/g, ""), 10);
    }
    const a7 = o5 ? window.getComputedStyle(o5, null) : null, d3 = a7 ? l7(a7.getPropertyValue("max-height")) : 0, c9 = a7 ? l7(a7.getPropertyValue("height")) : 0, { height: h4, width: u2 } = i6.getBoundingClientRect(), p4 = u2 + t5, g2 = Math.max(h4, d3, c9) + t5, v2 = this._isOutsideView({ popupHeight: g2, popupWidth: p4, screenLocation: s6, side: "right", view: r2 }), m6 = this._isOutsideView({ popupHeight: g2, popupWidth: p4, screenLocation: s6, side: "left", view: r2 }), f6 = this._isOutsideView({ popupHeight: g2, popupWidth: p4, screenLocation: s6, side: "top", view: r2 }), w2 = this._isOutsideView({ popupHeight: g2, popupWidth: p4, screenLocation: s6, side: "bottom", view: r2 });
    return m6 ? f6 ? "bottom-right" : "top-right" : v2 ? f6 ? "bottom-left" : "top-left" : f6 ? w2 ? "top-center" : "bottom-center" : "top-center";
  }
  _callCurrentAlignment(e8) {
    return "function" == typeof e8 ? e8.call(this) : e8;
  }
  _getCurrentAlignment() {
    const { alignment: e8, dockEnabled: t5, _containerNode: i6 } = this;
    return !t5 && this.viewModel.active && i6 ? this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e8))) : null;
  }
  _setCurrentAlignment() {
    this._set("currentAlignment", this._getCurrentAlignment());
  }
  _setCurrentDockPosition() {
    this._set("currentDockPosition", this._getCurrentDockPosition());
  }
  _calculatePositionResult(e8) {
    const t5 = ["left", "right"];
    return L2(this.container) && t5.reverse(), e8?.replaceAll(/leading/gi, t5[0]).replaceAll(/trailing/gi, t5[1]);
  }
  _callDockPosition(e8) {
    return "function" == typeof e8 ? e8.call(this) : e8;
  }
  _getDockPosition() {
    return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(this.dockOptions?.position)));
  }
  _getCurrentDockPosition() {
    return this.dockEnabled && this.viewModel.active ? this._getDockPosition() : null;
  }
  _calculateAutoDockPosition(e8) {
    if ("auto" !== e8) return e8;
    const t5 = this.viewModel?.view, i6 = L2(this.container) ? "top-left" : "top-right";
    if (!t5) return i6;
    const o5 = t5.padding || { left: 0, right: 0 }, n7 = t5.width - o5.left - o5.right, { breakpoints: s6 } = t5;
    return s6 && n7 <= s6.xsmall ? "bottom-center" : i6;
  }
  _getDockIcon() {
    const e8 = this._getDockPosition();
    if (this.dockEnabled) return "minimize";
    switch (e8) {
      case "top-left":
      case "bottom-left":
        return "dock-left";
      case "top-center":
        return "maximize";
      case "bottom-center":
        return "dock-bottom";
      default:
        return "dock-right";
    }
  }
  _handleDockIcon() {
    this._dockAction.icon = this._getDockIcon();
  }
  _handleDockEnabled() {
    this._dockAction.title = this.dockEnabled ? this.messages?.undock : this.messages?.dock;
  }
  _setMainContainerNode(e8) {
    this._mainContainerNode = e8;
  }
  _positionContainer(e8 = this._containerNode) {
    if (e8 && (this._containerNode = e8), !this._containerNode) return;
    const { screenLocation: t5 } = this.viewModel, { width: i6 } = this._containerNode.getBoundingClientRect(), o5 = this._calculatePositionStyle(t5, i6);
    o5 && Object.assign(this._containerNode.style, o5);
  }
  _calculateFullWidth(e8) {
    const { currentAlignment: t5, _pointerOffsetInPx: i6 } = this;
    return "top-left" === t5 || "bottom-left" === t5 || "top-right" === t5 || "bottom-right" === t5 ? e8 + i6 : e8;
  }
  _calculateAlignmentPosition(e8, t5, i6, o5) {
    const { currentAlignment: n7, _pointerOffsetInPx: s6 } = this;
    if (!i6) return;
    const { padding: r2 } = i6, l7 = o5 / 2, a7 = i6.height - t5, d3 = i6.width - e8;
    return "bottom-center" === n7 ? { top: t5 + s6 - r2.top, left: e8 - l7 - r2.left } : "top-left" === n7 ? { bottom: a7 + s6 - r2.bottom, right: d3 + s6 - r2.right } : "bottom-left" === n7 ? { top: t5 + s6 - r2.top, right: d3 + s6 - r2.right } : "top-right" === n7 ? { bottom: a7 + s6 - r2.bottom, left: e8 + s6 - r2.left } : "bottom-right" === n7 ? { top: t5 + s6 - r2.top, left: e8 + s6 - r2.left } : "top-center" === n7 ? { bottom: a7 + s6 - r2.bottom, left: e8 - l7 - r2.left } : void 0;
  }
  _calculatePositionStyle(e8, t5) {
    const { dockEnabled: i6, view: o5 } = this;
    if (!o5) return;
    if (i6) return { left: "", top: "", right: "", bottom: "" };
    if (null == e8 || !t5) return;
    const n7 = this._calculateFullWidth(t5), s6 = this._calculateAlignmentPosition(e8.x, e8.y, o5, n7);
    return s6 ? { top: void 0 !== s6.top ? `${s6.top}px` : "auto", left: void 0 !== s6.left ? `${s6.left}px` : "auto", bottom: void 0 !== s6.bottom ? `${s6.bottom}px` : "auto", right: void 0 !== s6.right ? `${s6.right}px` : "auto" } : void 0;
  }
  _viewChange(e8, t5) {
    e8 && t5 && (this.close(), this.clear());
  }
  _viewReadyChange(e8, t5) {
    e8 ? this._wireUpView() : t5 && (this.close(), this.clear());
  }
  _wireUpView() {
    this._setDockEnabledForViewSize(this.dockOptions);
  }
  _dockingThresholdCrossed(e8, t5, i6) {
    const [o5, n7] = e8, [s6, r2] = t5, { width: l7 = 0, height: a7 = 0 } = i6 ?? {};
    return o5 <= l7 && s6 > l7 || o5 > l7 && s6 <= l7 || n7 <= a7 && r2 > a7 || n7 > a7 && r2 <= a7;
  }
  _updateDockEnabledForViewSize(e8, t5) {
    if (!e8 || !t5) return;
    const i6 = this.viewModel?.view?.padding || { left: 0, right: 0, top: 0, bottom: 0 }, o5 = i6.left + i6.right, n7 = i6.top + i6.bottom, s6 = [], r2 = [];
    s6[0] = e8[0] - o5, s6[1] = e8[1] - n7, r2[0] = t5[0] - o5, r2[1] = t5[1] - n7;
    const { dockOptions: l7 } = this, a7 = l7.breakpoint;
    this._dockingThresholdCrossed(s6, r2, a7) && this._setDockEnabledForViewSize(l7), this._setCurrentDockPosition();
  }
  _toggleScreenLocationEnabled() {
    const { dockEnabled: e8, viewModel: t5 } = this;
    if (!t5) return;
    const i6 = t5.active && !e8;
    t5.screenLocationEnabled = i6;
  }
  _shouldDockAtCurrentViewSize(e8) {
    const t5 = e8.breakpoint, i6 = this.viewModel?.view?.ui;
    if (!i6) return false;
    const { width: o5, height: n7 } = i6;
    if (isNaN(o5) || isNaN(n7)) return false;
    if (!t5) return false;
    const s6 = t5.hasOwnProperty("width") && o5 <= (t5.width ?? 0), r2 = t5.hasOwnProperty("height") && n7 <= (t5.height ?? 0);
    return s6 || r2;
  }
  _setDockEnabledForViewSize(e8) {
    e8.breakpoint && (this.dockEnabled = this._shouldDockAtCurrentViewSize(e8));
  }
};
__decorate([m()], D2.prototype, "_containerNode", void 0), __decorate([m({ readOnly: true })], D2.prototype, "_featureNavigationTop", null), __decorate([m()], D2.prototype, "actions", null), __decorate([m({ readOnly: true })], D2.prototype, "active", null), __decorate([m()], D2.prototype, "alignment", void 0), __decorate([m()], D2.prototype, "autoCloseEnabled", null), __decorate([m()], D2.prototype, "defaultPopupTemplateEnabled", null), __decorate([m()], D2.prototype, "content", null), __decorate([m()], D2.prototype, "collapsed", null), __decorate([m({ readOnly: true })], D2.prototype, "currentAlignment", null), __decorate([m({ readOnly: true })], D2.prototype, "currentDockPosition", null), __decorate([m()], D2.prototype, "dockOptions", null), __decorate([m()], D2.prototype, "dockEnabled", void 0), __decorate([m({ readOnly: true })], D2.prototype, "featureCount", null), __decorate([m()], D2.prototype, "featureMenuOpen", null), __decorate([m()], D2.prototype, "features", null), __decorate([m()], D2.prototype, "goToOverride", null), __decorate([m()], D2.prototype, "headingLevel", void 0), __decorate([m()], D2.prototype, "highlightEnabled", null), __decorate([m()], D2.prototype, "icon", null), __decorate([m()], D2.prototype, "initialDisplayMode", null), __decorate([m()], D2.prototype, "location", null), __decorate([m()], D2.prototype, "label", null), __decorate([m(), e2("esri/widgets/Popup/t9n/Popup")], D2.prototype, "messages", void 0), __decorate([m()], D2.prototype, "promises", null), __decorate([m({ readOnly: true })], D2.prototype, "selectedFeature", null), __decorate([m({ readOnly: true })], D2.prototype, "selectedDrillInFeature", null), __decorate([m()], D2.prototype, "selectedFeatureIndex", null), __decorate([m({ readOnly: true })], D2.prototype, "selectedFeatureWidget", null), __decorate([m()], D2.prototype, "title", null), __decorate([m()], D2.prototype, "updateLocationEnabled", null), __decorate([m()], D2.prototype, "view", null), __decorate([m({ type: s5 }), e4(["triggerAction", "trigger-action"])], D2.prototype, "viewModel", void 0), __decorate([m()], D2.prototype, "visible", null), __decorate([m({ type: a6, nonNullable: true })], D2.prototype, "visibleElements", void 0), D2 = __decorate([a("esri.widgets.Popup")], D2);
var P = D2;
export {
  P as default
};
//# sourceMappingURL=Popup-C5QZUUYP.js.map
