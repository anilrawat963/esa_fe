{
  "version": 3,
  "sources": ["../../@arcgis/core/layers/IntegratedMesh3DTilesLayer.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{__decorate as e}from\"tslib\";import t from\"../request.js\";import o from\"../core/Error.js\";import r from\"../core/Logger.js\";import{MultiOriginJSONMixin as i}from\"../core/MultiOriginJSONSupport.js\";import{throwIfAbortError as s}from\"../core/promiseUtils.js\";import{on as n,sync as a}from\"../core/reactiveUtils.js\";import{property as l}from\"../core/accessorSupport/decorators/property.js\";import\"../core/has.js\";import\"../core/RandomLCG.js\";import{reader as p}from\"../core/accessorSupport/decorators/reader.js\";import{subclass as m}from\"../core/accessorSupport/decorators/subclass.js\";import{persistable as c}from\"../core/accessorSupport/decorators/persistable.js\";import d from\"../geometry/Extent.js\";import u from\"../geometry/SpatialReference.js\";import h from\"./Layer.js\";import{APIKeyMixin as f}from\"./mixins/APIKeyMixin.js\";import{ArcGISService as y}from\"./mixins/ArcGISService.js\";import{CustomParametersMixin as g}from\"./mixins/CustomParametersMixin.js\";import{OperationalLayer as _}from\"./mixins/OperationalLayer.js\";import{PortalLayer as S}from\"./mixins/PortalLayer.js\";import{ScaleRangeLayer as j}from\"./mixins/ScaleRangeLayer.js\";import{elevationInfo as T,url as v}from\"./support/commonProperties.js\";import w from\"./support/SceneModifications.js\";import{initFullExtent as x}from\"./support/tiles3DUtils.js\";import L from\"../portal/Portal.js\";import{logInvalidElevationInfoWarning as b,elevationModeRequiredMessage as P,featureExpressionUnsupportedMessage as I}from\"../support/elevationInfoUtils.js\";import{f as k}from\"../chunks/persistableUrlUtils.js\";import{isBasemap as R}from\"../support/userTypeGuards/isBasemap.js\";let D=class extends(y(_(S(j(i(g(f(h)))))))){readModifications(e,t,o){this._modificationsSource={url:k(e,o),context:o}}initialize(){this.addHandles(n(()=>this.modifications,\"after-changes\",()=>this.modifications=this.modifications,a))}constructor(e){super(e),this.operationalLayerType=\"IntegratedMesh3DTilesLayer\",this.modifications=null,this._modificationsSource=null,this.spatialReference=new u({wkid:4326,vcsWkid:115700}),this.fullExtent=new d(-180,-90,180,90,this.spatialReference),this.url=null,this.type=\"integrated-mesh-3dtiles\",this.path=null,this.minScale=0,this.maxScale=0,this._rootTilesetJSON=null,this._rootTileset=null,this._key=null,this._session=null,this._rootRequestPromise=null}set elevationInfo(e){null!=e&&\"absolute-height\"!==e.mode||this._set(\"elevationInfo\",e),this._validateElevationInfo(e)}async load(e){return this.addResolvingPromise(this._doLoad(e)),this}get rootTilesetJSON(){return this._rootTilesetJSON}get rootTileset(){return this._rootTileset}get key(){return this._key}get session(){return this._session}_findSessionParameter(e){const t=[e];for(;t?.length>0;){const e=t.pop();if(!e)return;for(const[r,i]of Object.entries(e)){if(\"uri\"===r)try{const e=new URL(\"https://tmp\"+i).searchParams.get(\"session\");if(e)return e}catch(o){}\"object\"==typeof i&&null!==i&&t.push(i)}}return null}async requestRootAndSession(e){const i=(e,t)=>new o(\"3dtiles-init:\"+e,t);return this._rootRequestPromise||(this._rootRequestPromise=new Promise((o,n)=>{this.url||n(i(\"url-missing\",\"Layer url missing\")),this._key=this.customParameters?this.customParameters.key:null;new Promise((e,o)=>{if(this.replacesTerrain&&!this._key){const r=this.portalItem?.portal||this.parent?.portalItem?.portal||L.getDefault();r.signIn().then(()=>{r.g3dTilesEnabled?t(r.restUrl+\"/portals/self/modules/g3dtiles\",{responseType:\"json\",query:{f:\"json\"}}).then(t=>{this._key=t.data.keyString,e()},()=>o(i(\"g3dtiles-key-error\",\"Error fetching Google 3D Tiles key from portal\"))):o(i(\"g3dTilesEnabled-false\",\"Google 3D Tiles are not enabled on Portal \"+r.url))},()=>o(i(\"sign-in-failed\",\"Error signing in to Portal\")))}else e()}).then(()=>{t(this.url,{query:this._key?{key:this._key,token:this.apiKey}:{token:this.apiKey},responseType:\"array-buffer\",signal:e}).then(e=>{try{this._rootTilesetJSON=JSON.parse((new TextDecoder).decode(e.data))}catch(t){return void n(i(\"root-parse-failed\",\"Error parsing root tile, details: \"+t))}this._rootTilesetJSON?(this._session=this._findSessionParameter(this._rootTilesetJSON),this._rootTileset=e.data,this.fullExtent=x(this._rootTilesetJSON),o(),this._rootRequestPromise=null):n(i(\"root-is-null\",\"Root tile is null.\"))},e=>{s(e),n(i(\"root-load-failed\",\"Error loading root tile\")),this._rootRequestPromise=null,r.getLogger(\"IntegratedMesh3DTilesLayer\").error(\"Layer loading failed\",e)})},e=>n(e))})),this._rootRequestPromise}async _doLoad(e){const t=null!=e?e.signal:null;if(this._isUsedAsGroundLayer)throw new o(\"3dtiles-init:not-supported-in-groundlayers\",\"Layer is not supported in basemap.\");try{await this.loadFromPortal({supportedTypes:[\"3DTiles Service\"],validateItem:e=>{if(e.typeKeywords?.includes(\"IntegratedMesh\"))return!0;throw new o(\"portal:invalid-layer-item-type\",\"Invalid layer item, expected '${expectedType}' \",{expectedType:\"3DTiles Service containing IntegratedMesh\"})}},e)}catch(r){s(r)}if(null!=this._modificationsSource){const t=await w.fromUrl(this._modificationsSource.url,this.spatialReference,e);this.setAtOrigin(\"modifications\",t,this._modificationsSource.context.origin),this._modificationsSource=null}await this.requestRootAndSession(t)}beforeSave(){if(null!=this._modificationsSource)return this.load().then(()=>{},()=>{})}get hasAttributionData(){return!1}async fetchAttributionData(){return{}}_validateElevationInfo(e){const t=\"Integrated mesh 3d tiles layers\";b(r.getLogger(this),P(t,\"absolute-height\",e)),b(r.getLogger(this),I(t,e))}get replacesTerrain(){return!1}get _isUsedAsGroundLayer(){return R(this.parent)}get hasGoogleUrl(){return!!this.url?.match(/.+\\.googleapis.com/)}};e([l({type:[\"IntegratedMesh3DTilesLayer\"]})],D.prototype,\"operationalLayerType\",void 0),e([l({type:w,clonable:e=>e.clone()}),c({origins:[\"web-scene\",\"portal-item\"],type:\"resource\",prefix:\"modifications\"})],D.prototype,\"modifications\",void 0),e([p([\"web-scene\",\"portal-item\"],\"modifications\")],D.prototype,\"readModifications\",null),e([l({type:u})],D.prototype,\"spatialReference\",void 0),e([l({type:d})],D.prototype,\"fullExtent\",void 0),e([l(T)],D.prototype,\"elevationInfo\",null),e([l({type:[\"show\",\"hide\"]})],D.prototype,\"listMode\",void 0),e([l(v)],D.prototype,\"url\",void 0),e([l({readOnly:!0})],D.prototype,\"type\",void 0),e([l({type:String,json:{origins:{\"web-scene\":{read:!0,write:!0},\"portal-item\":{read:!0,write:!0}},read:!1}})],D.prototype,\"path\",void 0),e([l({type:Number,json:{name:\"layerDefinition.minScale\",write:!0,origins:{service:{read:!1,write:!1}}}})],D.prototype,\"minScale\",void 0),e([l({type:Number,json:{name:\"layerDefinition.maxScale\",write:!0,origins:{service:{read:!1,write:!1}}}})],D.prototype,\"maxScale\",void 0),e([l()],D.prototype,\"replacesTerrain\",null),e([l()],D.prototype,\"_isUsedAsGroundLayer\",null),e([l()],D.prototype,\"hasGoogleUrl\",null),D=e([m(\"esri.layers.IntegratedMesh3DTilesLayer\")],D);const O=D;export{O as default};\n"],
  "mappings": "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",
  "names": ["l", "t", "s", "o", "b", "a", "f", "e", "i", "n", "j", "m"]
}
