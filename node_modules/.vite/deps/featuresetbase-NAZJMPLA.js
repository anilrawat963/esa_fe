import {
  s as s4
} from "./chunk-WT2BW5KP.js";
import {
  l
} from "./chunk-BH5ZTBHN.js";
import {
  l as l2
} from "./chunk-6UYFHUML.js";
import {
  t as t3
} from "./chunk-OOOA6BWY.js";
import {
  D,
  E,
  F,
  I as I2,
  O,
  R,
  b,
  e as e2,
  h,
  i as i2,
  k,
  k2,
  s as s3,
  v as v2,
  x,
  y as y2
} from "./chunk-IXGT3NHI.js";
import {
  s as s2,
  v
} from "./chunk-5EUFYFR7.js";
import "./chunk-JCVDJALY.js";
import "./chunk-G4TISAAI.js";
import {
  et
} from "./chunk-TF5RNCNY.js";
import "./chunk-WQW6HIRX.js";
import "./chunk-U2MAPSMR.js";
import "./chunk-QPBITBUR.js";
import "./chunk-PJJUVY7C.js";
import "./chunk-7VJQTJLO.js";
import "./chunk-PUWBFCEG.js";
import "./chunk-VVMIB6RA.js";
import "./chunk-A7O5R67Z.js";
import "./chunk-SQ4OSZIG.js";
import "./chunk-MA6OR5A6.js";
import "./chunk-RCHRSC54.js";
import "./chunk-ZEI5DZXH.js";
import "./chunk-RGWH5UES.js";
import "./chunk-4KVWUPLK.js";
import "./chunk-NOLINR6O.js";
import "./chunk-HIGI45S6.js";
import "./chunk-2KBTJPSU.js";
import "./chunk-JVMNF6GR.js";
import "./chunk-SL3GC7WV.js";
import "./chunk-CJZPTLIZ.js";
import "./chunk-2U5X5TIX.js";
import "./chunk-5D65KWSM.js";
import "./chunk-ABHLEPDK.js";
import "./chunk-4FQUAV7M.js";
import "./chunk-EVZ7KLPS.js";
import "./chunk-JSH3APTG.js";
import "./chunk-WQT2KLDB.js";
import "./chunk-UVDECGZC.js";
import "./chunk-VKFTCFFM.js";
import "./chunk-ZETARPSI.js";
import "./chunk-TCDV4P3G.js";
import "./chunk-CZOYDK6P.js";
import "./chunk-RS755KXS.js";
import "./chunk-TMUM75KQ.js";
import "./chunk-OC3OQ2CI.js";
import "./chunk-KY5OS6CK.js";
import "./chunk-3U5UUY3S.js";
import "./chunk-UOYGMZIS.js";
import "./chunk-RXH2WNPA.js";
import "./chunk-TWU3GKHX.js";
import "./chunk-BGIBV6LL.js";
import "./chunk-UQXJMFRI.js";
import "./chunk-DY7N5RAZ.js";
import "./chunk-6TCXGIIN.js";
import "./chunk-NP2TBOXH.js";
import "./chunk-WBYRWTBX.js";
import "./chunk-WFCLXKCE.js";
import "./chunk-WX3525ER.js";
import "./chunk-FHCV4NTV.js";
import "./chunk-HCTBVF3W.js";
import "./chunk-NH6FXYCM.js";
import "./chunk-YE4E5JCT.js";
import "./chunk-SXZO7ULH.js";
import "./chunk-5BAQPFKY.js";
import "./chunk-H34D76ZQ.js";
import "./chunk-QTRET3PG.js";
import "./chunk-FMOL5XMB.js";
import "./chunk-VNSHGTPN.js";
import "./chunk-OEBAFVQK.js";
import "./chunk-76V6RN4F.js";
import "./chunk-Y3FKYMXQ.js";
import "./chunk-S5K4XWUR.js";
import "./chunk-QNDHLVDC.js";
import "./chunk-EK7HOTRR.js";
import "./chunk-GCTH5LET.js";
import "./chunk-TTLSEJNG.js";
import "./chunk-ZVTEFYZX.js";
import "./chunk-LPUPM55U.js";
import "./chunk-EKZRA6TO.js";
import "./chunk-M5SP6ZBM.js";
import {
  L
} from "./chunk-FAA2FDN5.js";
import {
  I
} from "./chunk-J4LH6NQT.js";
import {
  Ae,
  B,
  H as H2,
  Ke,
  L as L2,
  Se,
  X,
  Y,
  Ze,
  _e,
  ge,
  ie,
  ne,
  oe,
  p,
  re,
  te,
  z
} from "./chunk-AH42IBBP.js";
import {
  N,
  o as o5
} from "./chunk-ZGTANDVY.js";
import {
  t as t2
} from "./chunk-5LMO3VQI.js";
import "./chunk-ZHSPVODX.js";
import "./chunk-2HGIYEIL.js";
import "./chunk-XX3OKYJS.js";
import "./chunk-OTCNIJ2H.js";
import "./chunk-JGA5YJWL.js";
import "./chunk-GCI4MA3M.js";
import "./chunk-SJ2OBYX2.js";
import {
  m as m3
} from "./chunk-MDJNYPVI.js";
import "./chunk-Z6VKIQV2.js";
import {
  n as n2,
  o as o3,
  t
} from "./chunk-4PXNA4MD.js";
import "./chunk-ZCI5A4FF.js";
import "./chunk-ET5EDAFM.js";
import "./chunk-2D47RURG.js";
import "./chunk-7HTU7ZUX.js";
import "./chunk-647DAMHU.js";
import "./chunk-O6G3PPOK.js";
import "./chunk-ZKNZTIAS.js";
import "./chunk-OJMISN3F.js";
import "./chunk-EFV6H5NA.js";
import {
  f,
  s,
  u
} from "./chunk-PLNHHGHL.js";
import "./chunk-BBYMM7CM.js";
import {
  m as m4
} from "./chunk-QZQPB5XR.js";
import "./chunk-AQFRVV3U.js";
import "./chunk-OJBEN6CV.js";
import "./chunk-PEL3D3ZN.js";
import "./chunk-Q5KWD3VQ.js";
import "./chunk-BUQC3CLV.js";
import "./chunk-W5S3VUFT.js";
import "./chunk-7YH7T6CS.js";
import "./chunk-3T4IXPP4.js";
import "./chunk-XTZAIV4X.js";
import "./chunk-63LDVRFI.js";
import {
  _
} from "./chunk-C3FRY5U4.js";
import "./chunk-JNJX34GB.js";
import "./chunk-3STJRSDT.js";
import "./chunk-67Q6KVC6.js";
import "./chunk-23NJHA5Q.js";
import "./chunk-4LA6K4VI.js";
import "./chunk-KEZCWFAR.js";
import "./chunk-JZUJ34RR.js";
import "./chunk-PMGS7UDU.js";
import "./chunk-3GHCGAH2.js";
import "./chunk-HWUOAPTX.js";
import "./chunk-QHCKOBU7.js";
import "./chunk-K2OZ6WVC.js";
import "./chunk-MC6NAKKX.js";
import "./chunk-TF6255HN.js";
import "./chunk-GD4FJL3C.js";
import {
  e,
  o as o4,
  r as r2
} from "./chunk-C5OQVQZF.js";
import "./chunk-F7DKSAOI.js";
import "./chunk-4SOQWNPG.js";
import "./chunk-LTULADK2.js";
import "./chunk-35ST7YRB.js";
import "./chunk-EDA5QFHZ.js";
import "./chunk-JW6DU3OK.js";
import "./chunk-CNYNCKEV.js";
import "./chunk-XL5QPCXN.js";
import "./chunk-2LC2762W.js";
import "./chunk-W6HOAVT4.js";
import "./chunk-DTZUXJMD.js";
import "./chunk-YLAGKT2D.js";
import "./chunk-6YRQYUCY.js";
import "./chunk-W75DBJD7.js";
import "./chunk-6KDQMJAI.js";
import "./chunk-UDHS2MGH.js";
import "./chunk-QF7FRVN6.js";
import "./chunk-ENINOZUZ.js";
import "./chunk-P6IKJIMO.js";
import "./chunk-MHV23XAQ.js";
import "./chunk-V2X4OKYI.js";
import "./chunk-LPZUGJNG.js";
import "./chunk-XLOINTMG.js";
import "./chunk-MA3QDRC3.js";
import "./chunk-W6J7XCPU.js";
import "./chunk-ONXWBTTM.js";
import "./chunk-T7F6Q6JJ.js";
import "./chunk-YDTPM7OQ.js";
import "./chunk-75XOUSSS.js";
import "./chunk-TH4EQWJJ.js";
import {
  M
} from "./chunk-7P2ANHQ3.js";
import "./chunk-XCKT47LJ.js";
import "./chunk-3FUHCAX3.js";
import {
  y3 as y
} from "./chunk-PZ5RULLK.js";
import "./chunk-OPJX4KXH.js";
import "./chunk-LTPHDYPK.js";
import "./chunk-3OVERDFX.js";
import "./chunk-FPMLKIDB.js";
import "./chunk-AZXJIEZ6.js";
import "./chunk-Q75WYS7K.js";
import "./chunk-H74Q4SYB.js";
import "./chunk-2OFHDVO5.js";
import "./chunk-TFJXG32O.js";
import "./chunk-DDOCCRD4.js";
import "./chunk-5UPBUJPC.js";
import "./chunk-THQO67BJ.js";
import "./chunk-4YDOPHTZ.js";
import "./chunk-YY5PITIH.js";
import "./chunk-CCQFL76O.js";
import "./chunk-CSMCPN64.js";
import "./chunk-GY6YF4EN.js";
import "./chunk-7H3U4IJR.js";
import "./chunk-SMWUT52Z.js";
import "./chunk-AXZMNHTN.js";
import "./chunk-5T3MJDSR.js";
import "./chunk-NMQNUPE4.js";
import "./chunk-6KIXN4DJ.js";
import "./chunk-7DGJB37R.js";
import "./chunk-234CIOHE.js";
import {
  H2 as H
} from "./chunk-V2H77UEV.js";
import "./chunk-WRA2WBYC.js";
import {
  o as o2
} from "./chunk-XWE6BM2U.js";
import {
  r
} from "./chunk-SOIZOFSB.js";
import {
  n
} from "./chunk-XXLHAM2M.js";
import {
  c,
  m as m2
} from "./chunk-5EI5H4QX.js";
import {
  a2 as a,
  m
} from "./chunk-ZIE53VIV.js";
import {
  __decorate
} from "./chunk-SS5CLIUY.js";
import "./chunk-R54Q5TGA.js";
import "./chunk-6SSZNBOK.js";
import "./chunk-LZ2XTYP2.js";
import "./chunk-45CFSCQX.js";
import "./chunk-A5XN2VFT.js";
import {
  o
} from "./chunk-65HD3WXL.js";
import "./chunk-4DGC7CBY.js";
import {
  C
} from "./chunk-GNMPGHLQ.js";
import {
  i3 as i
} from "./chunk-QY7XKUIV.js";
import "./chunk-AL6YUTZM.js";
import "./chunk-G26ADAPQ.js";

// node_modules/@arcgis/core/networks/support/typeUtils.js
var t4 = new o({ Clean: "clean", Dirty: "dirty" });
var i3 = new o({ Physical: "physical", Virtual: "virtual" });
var o6 = new o({ "Start and end": "start-and-end", Start: "start", Midspan: "midspan", End: "end" });
var e3 = new o({ startingPoint: "starting-point", barrier: "barrier", stoppingPoint: "stopping-point" });
var c2 = new o({ connected: "connected", upstream: "upstream", downstream: "downstream", shortestPath: "shortest-path", subnetwork: "subnetwork", subnetworkController: "subnetwork-controller", loops: "loops", isolation: "isolation", path: "path", circuit: "circuit" });
var r3 = "{00000000-0000-0000-0000-000000000000}";
var a2 = new o({ junctionJunctionConnectivity: "junction-junction-connectivity", connectivity: "connectivity", attachment: "attachment", containment: "containment", junctionEdgeFromConnectivity: "junction-edge-from-connectivity", junctionEdgeMidspanConnectivity: "junction-edge-midspan-connectivity", junctionEdgeToConnectivity: "junction-edge-to-connectivity" });
var d = new o({ normal: "normal", rebuild: "rebuild", forceRebuild: "force-rebuild" });

// node_modules/@arcgis/core/rest/networks/support/TelecomNetworkElement.js
var s5 = class extends s4 {
  constructor(o7) {
    super(o7), this.type = "telecomNetworkElement", this.firstUnit = null, this.numUnits = null;
  }
};
__decorate([m2({ json: { write: false } })], s5.prototype, "type", void 0), __decorate([m2({ json: { write: true } })], s5.prototype, "firstUnit", void 0), __decorate([m2({ json: { write: true } })], s5.prototype, "numUnits", void 0), s5 = __decorate([a("esri.rest.networks.support.TelecomNetworkElement")], s5);

// node_modules/@arcgis/core/rest/networks/support/Association.js
var a3 = class extends n {
  constructor(t5) {
    super(t5), this.globalId = null, this.associationType = null, this.fromNetworkElement = null, this.toNetworkElement = null, this.geometry = null, this.errorMessage = null, this.percentAlong = null, this.errorCode = null, this.isContentVisible = null, this.status = null;
  }
  readFromNetworkElement(t5, o7) {
    return o7.fromFirstUnit || o7.fromNumUnits ? new s5({ globalId: o7.fromGlobalId, networkSourceId: o7.fromNetworkSourceId, terminalId: o7.fromTerminalId, firstUnit: o7.fromFirstUnit, numUnits: o7.fromNumUnits }) : new s4({ globalId: o7.fromGlobalId, networkSourceId: o7.fromNetworkSourceId, terminalId: o7.fromTerminalId });
  }
  writeFromNetworkElement(t5, o7) {
    if (t5 && (o7.fromGlobalId = t5.globalId, o7.fromNetworkSourceId = t5.networkSourceId, o7.fromTerminalId = t5.terminalId, "telecomNetworkElement" === t5.type)) {
      const e4 = t5;
      o7.fromFirstUnit = e4.firstUnit, o7.fromNumUnits = e4.numUnits;
    }
  }
  readToNetworkElement(t5, o7) {
    return o7.toFirstUnit || o7.toNumUnits ? new s5({ globalId: o7.toGlobalId, networkSourceId: o7.toNetworkSourceId, terminalId: o7.toTerminalId, firstUnit: o7.toFirstUnit, numUnits: o7.toNumUnits }) : new s4({ globalId: o7.toGlobalId, networkSourceId: o7.toNetworkSourceId, terminalId: o7.toTerminalId });
  }
  writeToNetworkElement(t5, o7) {
    if (t5 && (o7.toGlobalId = t5.globalId, o7.toNetworkSourceId = t5.networkSourceId, o7.toTerminalId = t5.terminalId, "telecomNetworkElement" === t5.type)) {
      const e4 = t5;
      o7.toFirstUnit = e4.firstUnit, o7.toNumUnits = e4.numUnits;
    }
  }
  equals(t5) {
    if (this.globalId === r3 && t5.globalId === r3) {
      let o7 = function(t6, o8) {
        return t6.networkSourceId === o8.networkSourceId && t6.globalId === o8.globalId && t6.terminalId === o8.terminalId && t6.firstUnit === o8.firstUnit && t6.numUnits === o8.numUnits;
      };
      const e4 = this.fromNetworkElement, r4 = this.toNetworkElement, n4 = t5.fromNetworkElement, i4 = t5.toNetworkElement, l3 = o7(e4, n4), s6 = o7(r4, i4);
      return l3 && s6 && this.associationType === t5.associationType;
    }
    return null != this.globalId && null != t5.globalId && this.globalId === t5.globalId;
  }
};
__decorate([m2({ type: String, json: { write: true } })], a3.prototype, "globalId", void 0), __decorate([m2({ type: a2.apiValues, json: { type: a2.jsonValues, read: a2.read, write: a2.write } })], a3.prototype, "associationType", void 0), __decorate([m2({ type: s4, json: { write: { target: { fromGlobalId: { type: String }, fromNetworkSourceId: { type: Number }, fromTerminalId: { type: Number }, fromFirstUnit: { type: Number }, fromNumUnits: { type: Number } } }, read: { source: ["fromGlobalId", "fromNetworkSourceId", "fromTerminalId", "fromFirstUnit", "fromNumUnits"] } } })], a3.prototype, "fromNetworkElement", void 0), __decorate([o2("fromNetworkElement")], a3.prototype, "readFromNetworkElement", null), __decorate([r("fromNetworkElement")], a3.prototype, "writeFromNetworkElement", null), __decorate([m2({ type: s4, json: { write: { target: { toGlobalId: { type: String }, toNetworkSourceId: { type: Number }, toTerminalId: { type: Number }, toFirstUnit: { type: Number }, toNumUnits: { type: Number } } }, read: { source: ["toGlobalId", "toNetworkSourceId", "toTerminalId", "toFirstUnit", "toNumUnits"] } } })], a3.prototype, "toNetworkElement", void 0), __decorate([o2("toNetworkElement")], a3.prototype, "readToNetworkElement", null), __decorate([r("toNetworkElement")], a3.prototype, "writeToNetworkElement", null), __decorate([m2({ type: y, json: { write: true } })], a3.prototype, "geometry", void 0), __decorate([m2({ type: String, json: { write: true } })], a3.prototype, "errorMessage", void 0), __decorate([m2({ type: Number, json: { write: true } })], a3.prototype, "percentAlong", void 0), __decorate([m2({ type: Number, json: { write: true } })], a3.prototype, "errorCode", void 0), __decorate([m2({ type: Boolean, json: { write: true } })], a3.prototype, "isContentVisible", void 0), __decorate([m2({ type: Number, json: { write: true } })], a3.prototype, "status", void 0), a3 = __decorate([a("esri.rest.networks.support.Association")], a3);

// node_modules/@arcgis/core/rest/networks/support/QueryAssociationsResult.js
var p2 = class extends n {
  constructor(o7) {
    super(o7), this.associations = [];
  }
};
__decorate([m2({ type: [a3], json: { write: true } })], p2.prototype, "associations", void 0), p2 = __decorate([a("esri.rest.networks.support.QueryAssociationsResult")], p2);

// node_modules/@arcgis/core/rest/networks/queryAssociations.js
function a4(e4) {
  const { returnDeletes: t5, elements: o7, gdbVersion: n4, moment: s6 } = e4.toJSON();
  return { returnDeletes: t5, elements: JSON.stringify(o7.map((e5) => ({ globalId: e5.globalId, networkSourceId: e5.networkSourceId, terminalId: e5.terminalId }))), types: JSON.stringify(e4.types.map((e5) => a2.toJSON(e5))).replaceAll('"connectivity"', '"junctionJunctionConnectivity"'), gdbVersion: n4, moment: s6 ?? Date.now() };
}
async function p3(r4, p4, m6) {
  const u2 = f(r4), l3 = { ...a4(p4), f: "json" }, y3 = u({ ...u2.query, ...l3 }), d2 = s(y3, { ...m6, method: "post" }), f2 = `${u2.path}/associations/query`, { data: g } = await H(f2, d2), j = p2.fromJSON(g);
  return p4.types.includes("connectivity") && c(i.getLogger("esri/rest/networks/support/QueryAssociationsParameters"), "types", { replacement: "Please use 'junction-junction-connectivity' instead of 'connectivity'.", see: "https://arcg.is/11Tr8a#types", version: "4.29", warnOnce: true }), j;
}

// node_modules/@arcgis/core/rest/networks/support/QueryAssociationsParameters.js
var m5;
var n3 = m5 = class extends n {
  static from(e4) {
    return m(m5, e4);
  }
  constructor(e4) {
    super(e4), this.returnDeletes = false, this.elements = [], this.types = [], this.gdbVersion = null, this.moment = null;
  }
};
__decorate([m2({ type: Boolean, json: { write: true } })], n3.prototype, "returnDeletes", void 0), __decorate([m2({ type: [s4], json: { write: true } })], n3.prototype, "elements", void 0), __decorate([m2({ type: [a2.apiValues], json: { type: a2.jsonValues, read: a2.read, write: a2.write } })], n3.prototype, "types", void 0), __decorate([m2({ type: String, json: { write: true } })], n3.prototype, "gdbVersion", void 0), __decorate([m2({ type: Date, json: { type: Number, write: { writer: (e4, t5) => {
  t5.moment = e4?.getTime();
} } } })], n3.prototype, "moment", void 0), n3 = m5 = __decorate([a("esri.rest.networks.support.QueryAssociationsParameters")], n3);

// node_modules/@arcgis/core/arcade/functions/featuresetbase.js
function re2(e4) {
  if (1 === e4.length) {
    if (o4(e4[0])) return l("distinct", e4[0], -1);
    if (te(e4[0])) return l("distinct", e4[0].toArray(), -1);
  }
  return l("distinct", e4, -1);
}
function oe2(e4, t5, n4) {
  const i4 = e4.getVariables();
  if (i4.length > 0) {
    const a5 = {};
    for (const e5 of i4) a5[e5] = t5.evaluateIdentifier(n4, { name: e5 });
    e4.parameters = a5;
  }
  return e4;
}
function se(e4, t5, n4 = null) {
  for (const i4 in e4) if (i4.toLowerCase() === t5.toLowerCase()) return e4[i4];
  return n4;
}
function le(e4) {
  if (null === e4) return null;
  const t5 = { type: se(e4, "type", ""), name: se(e4, "name", "") };
  if ("range" === t5.type) t5.range = se(e4, "range", []);
  else {
    t5.codedValues = [];
    for (const n4 of se(e4, "codedValues", [])) t5.codedValues.push({ name: se(n4, "name", ""), code: se(n4, "code", null) });
  }
  return t5;
}
function fe(e4) {
  if (null === e4) return null;
  const t5 = {}, n4 = se(e4, "wkt");
  null !== n4 && (t5.wkt = n4);
  const i4 = se(e4, "wkid");
  return null !== i4 && (t5.wkid = i4), t5;
}
function de(e4) {
  if (null === e4) return null;
  const t5 = { hasZ: se(e4, "hasz", false), hasM: se(e4, "hasm", false) }, n4 = se(e4, "spatialreference");
  null != n4 && (t5.spatialReference = fe(n4));
  const i4 = se(e4, "x", null);
  if (null !== i4) return t5.x = i4, t5.y = se(e4, "y", null), t5.hasZ && (t5.z = se(e4, "z", null)), t5.hasM && (t5.m = se(e4, "m", null)), t5;
  const a5 = se(e4, "rings", null);
  if (null !== a5) return t5.rings = a5, t5;
  const r4 = se(e4, "paths", null);
  if (null !== r4) return t5.paths = r4, t5;
  const o7 = se(e4, "points", null);
  if (null !== o7) return t5.points = o7, t5;
  for (const s6 of ["xmin", "xmax", "ymin", "ymax", "zmin", "zmax", "mmin", "mmax"]) {
    const n5 = se(e4, s6, null);
    null !== n5 && (t5[s6] = n5);
  }
  return t5;
}
function ue(e4, t5) {
  for (const n4 of t5) if (n4 === e4) return true;
  return false;
}
function ce(e4) {
  return !!e4.layerDefinition && (!!e4.featureSet && (false !== ue(e4.layerDefinition.geometryType, ["", null, "esriGeometryNull", "esriGeometryPoint", "esriGeometryPolyline", "esriGeometryPolygon", "esriGeometryMultipoint", "esriGeometryEnvelope"]) && (false !== o4(e4.layerDefinition.fields) && false !== o4(e4.featureSet.features))));
}
function me(e4) {
  return "utc" === e4?.toLowerCase() ? "UTC" : "unknown" === e4?.toLowerCase() ? "Unknown" : e4;
}
async function pe(t5, n4, i4, a5, r4, s6, l3) {
  const f2 = await t5.getFeatureSetInfo();
  if (null === (f2?.layerId ?? null)) return null;
  if (!r4.layerIdLookup.get(f2.layerId)) return null;
  const u2 = t5.serviceUrl().replace(/\/FeatureServer/i, "/UtilityNetworkServer"), c3 = [];
  switch (i4) {
    case "connected":
      c3.push("connectivity"), c3.push("junction-edge-from-connectivity"), c3.push("junction-edge-to-connectivity"), c3.push("junction-edge-midspan-connectivity"), c3.push("junction-junction-connectivity");
      break;
    case "container":
    case "content":
      c3.push("containment");
      break;
    case "structure":
    case "attached":
      c3.push("attachment");
      break;
    case "junctionedge":
      c3.push("junction-edge-from-connectivity"), c3.push("junction-edge-to-connectivity");
      break;
    case "midspan":
      c3.push("junction-edge-midspan-connectivity");
      break;
    default:
      throw new n2(s6, "InvalidParameter", l3);
  }
  let m6 = null, p4 = false;
  if (null !== a5 && "" !== a5 && void 0 !== a5) {
    for (const e4 of r4.terminals) e4.terminalName === a5 && (m6 = e4.terminalId);
    null === m6 && (p4 = true);
  }
  const y3 = [];
  if (!p4) {
    const a6 = new s4({ globalId: n4.field(t5.globalIdField), networkSourceId: r4.layerIdLookup.get(f2.layerId).sourceId, ...m6 ? { terminalId: m6 } : "" }), o7 = await p3(u2, new n3({ types: c3, elements: [a6] }));
    let s7 = 0;
    for (const t6 of o7.associations) {
      let n5 = null, o8 = "", l4 = "";
      if (t6.fromNetworkElement?.globalId === a6.globalId ? (n5 = t6.toNetworkElement, l4 = "to") : t6.toNetworkElement?.globalId === a6.globalId && (n5 = t6.fromNetworkElement, l4 = "from"), !n5) continue;
      switch (i4) {
        case "attached":
          if ("attachment" !== t6.associationType) continue;
          if ("to" !== l4) continue;
          break;
        case "structure":
          if ("attachment" !== t6.associationType) continue;
          if ("from" !== l4) continue;
          break;
        case "container":
          if ("containment" !== t6.associationType) continue;
          if ("from" !== l4) continue;
          break;
        case "content":
          if ("containment" !== t6.associationType) continue;
          if ("to" !== l4) continue;
          break;
        case "connected":
          break;
        case "junctionedge":
          "junction-edge-to-connectivity" === t6.associationType ? o8 = "to" : "junction-edge-from-connectivity" === t6.associationType && (o8 = "from");
          break;
        case "midspan":
          if ("junction-edge-midspan-connectivity" !== t6.associationType) continue;
      }
      const f3 = r4.sourceIdLookup.get(n5.networkSourceId)?.className ?? "";
      y3.push(new _({ geometry: null, attributes: { objectId: s7++, globalId: n5.globalId, percentAlong: t6.percentAlong ?? 0, isContentVisible: t6.isContentVisible ? 0 : 1, className: f3, side: o8 } }));
    }
  }
  const w = new et({ source: y3, geometryType: null, objectIdField: "objectId", globalIdField: "globalId", fields: [new m4({ name: "objectId", alias: "objectId", type: "oid" }), new m4({ name: "globalId", alias: "globalId", type: "global-id" }), new m4({ name: "percentAlong", alias: "percentAlong", type: "double" }), new m4({ name: "side", alias: "side", type: "string" }), new m4({ name: "isContentVisible", alias: "isContentVisible", type: "integer" }), new m4({ name: "className", alias: "className", type: "string" })] });
  return F(w);
}
function ye(e4) {
  if ("async" === e4.mode) {
    e4.functions.timezone = function(n4, a5) {
      return e4.standardFunctionAsync(n4, a5, async (e5, r4, s6) => {
        if (oe(s6, 1, 2, n4, a5), ie(s6[0])) return "Unknown";
        if (re(s6[0])) return "Unknown";
        if (B(s6[0])) {
          if (await s6[0].load(), 1 === s6.length || null === s6[1]) return s6[0].datesInUnknownTimezone ? me("unknown") : me(s6[0].dateFieldsTimeZone);
          if (!(s6[1] instanceof p) || false === s6[1].hasField("type")) throw new n2(n4, "InvalidParameter", a5);
          const e6 = s6[1].field("type");
          if (false === e(e6)) throw new n2(n4, "InvalidParameter", a5);
          switch (ge(e6).toLowerCase()) {
            case "preferredtimezone":
              return me(s6[0].preferredTimeZone);
            case "editfieldsinfo":
              return me(s6[0].editFieldsInfo?.timeZone ?? null);
            case "timeinfo":
              return me(s6[0].timeInfo?.timeZone ?? null);
            case "field":
              if (s6[1].hasField("fieldname") && e(s6[1].field("fieldname"))) return me(s6[0].fieldTimeZone(ge(s6[1].field("fieldname"))));
          }
          throw new n2(n4, "InvalidParameter", a5);
        }
        const l3 = Ze(s6[0], Ke(n4));
        if (null === l3) return null;
        const f2 = l3.timeZone;
        return "system" === f2 ? m3.systemTimeZoneCanonicalName : "utc" === f2.toLowerCase() ? "UTC" : "unknown" === f2.toLowerCase() ? "Unknown" : f2;
      });
    }, e4.functions.sqltimestamp = function(t5, n4) {
      return e4.standardFunctionAsync(t5, n4, async (e5, i4, a5) => {
        oe(a5, 1, 3, t5, n4);
        const r4 = a5[0];
        if (ne(r4)) {
          if (1 === a5.length) return r4.toSQLWithKeyword();
          if (2 === a5.length) return r4.changeTimeZone(ge(a5[1])).toSQLWithKeyword();
          throw new n2(t5, "InvalidParameter", n4);
        }
        if (re(r4)) return r4.toSQLWithKeyword();
        if (B(r4)) {
          if (3 !== a5.length) throw new n2(t5, "InvalidParameter", n4);
          await r4.load();
          const e6 = ge(a5[1]);
          if (re(a5[2])) return a5[2].toSQLWithKeyword();
          if (false === ne(a5[2])) throw new n2(t5, "InvalidParameter", n4);
          const i5 = r4.fieldTimeZone(e6);
          return null == i5 ? a5[2].toSQLWithKeyword() : a5[2].changeTimeZone(i5).toSQLWithKeyword();
        }
        throw new n2(t5, "InvalidParameter", n4);
      });
    }, e4.signatures.push({ name: "sqltimestamp", min: 2, max: 4 }), e4.functions.featuresetbyid = function(t5, n4) {
      return e4.standardFunctionAsync(t5, n4, (e5, i4, a5) => {
        if (oe(a5, 2, 4, t5, n4), X(a5[0])) {
          const e6 = ge(a5[1]);
          let i5 = z(a5[2], null);
          const r4 = Ae(z(a5[3], true));
          if (null === i5 && (i5 = ["*"]), false === o4(i5)) throw new n2(t5, "InvalidParameter", n4);
          return a5[0].featureSetById(e6, r4, i5);
        }
        throw new n2(t5, "InvalidParameter", n4);
      });
    }, e4.signatures.push({ name: "featuresetbyid", min: 2, max: 4 });
    const B2 = new o3(["datasource", "parent", "root"]);
    e4.functions.getfeatureset = function(t5, n4) {
      return e4.standardFunctionAsync(t5, n4, async (e5, i4, a5) => {
        if (oe(a5, 1, 2, t5, n4), H2(a5[0])) {
          const e6 = null == a5[1] ? "datasource" : B2.lookup(ge(a5[1]));
          return v2(a5[0].fullSchema(), e6, t5.lrucache, t5.interceptor, t5.spatialReference);
        }
        throw new n2(t5, "InvalidParameter", n4);
      });
    }, e4.signatures.push({ name: "getfeatureset", min: 1, max: 2 }), e4.functions.featuresetbyportalitem = function(t5, i4) {
      return e4.standardFunctionAsync(t5, i4, (e5, a5, r4) => {
        if (oe(r4, 2, 5, t5, i4), null === r4[0]) throw new n2(t5, "PortalRequired", i4);
        if (r4[0] instanceof t3) {
          const e6 = ge(r4[1]), n4 = ge(r4[2]);
          let a6 = z(r4[3], null);
          const s7 = Ae(z(r4[4], true));
          if (null === a6 && (a6 = ["*"]), false === o4(a6)) throw new n2(t5, "InvalidParameter", i4);
          let l4;
          return l4 = t5.services?.portal ? t5.services.portal : M.getDefault(), l4 = l2(r4[0], l4), R(e6, n4, t5.spatialReference, a6, s7, l4, t5.lrucache, t5.interceptor);
        }
        if (false === e(r4[0])) throw new n2(t5, "PortalRequired", i4);
        const s6 = ge(r4[0]), l3 = ge(r4[1]);
        let d2 = z(r4[2], null);
        const u2 = Ae(z(r4[3], true));
        if (null === d2 && (d2 = ["*"]), false === o4(d2)) throw new n2(t5, "InvalidParameter", i4);
        return R(s6, l3, t5.spatialReference, d2, u2, t5.services?.portal ?? M.getDefault(), t5.lrucache, t5.interceptor);
      });
    }, e4.signatures.push({ name: "featuresetbyportalitem", min: 2, max: 5 }), e4.functions.featuresetbyname = function(t5, n4) {
      return e4.standardFunctionAsync(t5, n4, (e5, i4, a5) => {
        if (oe(a5, 2, 4, t5, n4), X(a5[0])) {
          const e6 = ge(a5[1]);
          let i5 = z(a5[2], null);
          const r4 = Ae(z(a5[3], true));
          if (null === i5 && (i5 = ["*"]), false === o4(i5)) throw new n2(t5, "InvalidParameter", n4);
          return a5[0].featureSetByName(e6, r4, i5);
        }
        throw new n2(t5, "InvalidParameter", n4);
      });
    }, e4.signatures.push({ name: "featuresetbyname", min: 2, max: 4 }), e4.functions.featureset = function(t5, n4) {
      return e4.standardFunction(t5, n4, (e5, a5, r4) => {
        oe(r4, 1, 1, t5, n4);
        const s6 = { layerDefinition: { geometryType: "", objectIdField: "", globalIdField: "", typeIdField: "", hasM: false, hasZ: false, fields: [] }, featureSet: { geometryType: "", features: [] } };
        if (e(r4[0])) {
          const e6 = JSON.parse(r4[0]);
          void 0 !== e6.layerDefinition ? (s6.layerDefinition = e6.layerDefinition, s6.featureSet = e6.featureSet, e6.layerDefinition.spatialReference && (s6.layerDefinition.spatialReference = e6.layerDefinition.spatialReference)) : (s6.featureSet.features = e6.features, s6.featureSet.geometryType = e6.geometryType, s6.layerDefinition.geometryType = s6.featureSet.geometryType, s6.layerDefinition.objectIdField = e6.objectIdFieldName ?? "", s6.layerDefinition.typeIdField = e6.typeIdFieldName, s6.layerDefinition.globalIdField = e6.globalIdFieldName, s6.layerDefinition.fields = e6.fields, e6.spatialReference && (s6.layerDefinition.spatialReference = e6.spatialReference));
        } else {
          if (!(r4[0] instanceof p)) throw new n2(t5, "InvalidParameter", n4);
          {
            const e6 = JSON.parse(r4[0].castToText(true)), i4 = se(e6, "layerdefinition");
            if (null !== i4) {
              s6.layerDefinition.geometryType = se(i4, "geometrytype", ""), s6.featureSet.geometryType = s6.layerDefinition.geometryType, s6.layerDefinition.globalIdField = se(i4, "globalidfield", ""), s6.layerDefinition.objectIdField = se(i4, "objectidfield", ""), s6.layerDefinition.typeIdField = se(i4, "typeidfield", ""), s6.layerDefinition.hasZ = true === se(i4, "hasz", false), s6.layerDefinition.hasM = true === se(i4, "hasm", false);
              const t6 = se(i4, "spatialreference");
              t6 && (s6.layerDefinition.spatialReference = fe(t6));
              const n5 = [];
              for (const e7 of se(i4, "fields", [])) {
                const t7 = { name: se(e7, "name", ""), alias: se(e7, "alias", ""), type: se(e7, "type", ""), nullable: se(e7, "nullable", true), editable: se(e7, "editable", true), length: se(e7, "length", null), domain: le(se(e7, "domain")) };
                n5.push(t7);
              }
              s6.layerDefinition.fields = n5;
              const a6 = se(e6, "featureset");
              if (a6) {
                const e7 = {};
                for (const t7 of n5) e7[t7.name.toLowerCase()] = t7.name;
                for (const t7 of se(a6, "features", [])) {
                  const n6 = {}, i5 = se(t7, "attributes", {});
                  for (const t8 in i5) n6[e7[t8.toLowerCase()]] = i5[t8];
                  s6.featureSet.features.push({ attributes: n6, geometry: de(se(t7, "geometry")) });
                }
              }
            } else {
              s6.layerDefinition.hasZ = true === se(e6, "hasz", false), s6.layerDefinition.hasM = true === se(e6, "hasm", false), s6.layerDefinition.geometryType = se(e6, "geometrytype", ""), s6.featureSet.geometryType = s6.layerDefinition.geometryType, s6.layerDefinition.objectIdField = se(e6, "objectidfieldname", ""), s6.layerDefinition.typeIdField = se(e6, "typeidfieldname", "");
              const i5 = se(e6, "spatialreference");
              i5 && (s6.layerDefinition.spatialReference = fe(i5));
              const a6 = [], r5 = se(e6, "fields", null);
              if (!o4(r5)) throw new n2(t5, "InvalidParameter", n4);
              for (const e7 of r5) {
                const t6 = { name: se(e7, "name", ""), alias: se(e7, "alias", ""), type: se(e7, "type", ""), nullable: se(e7, "nullable", true), editable: se(e7, "editable", true), length: se(e7, "length", null), domain: le(se(e7, "domain")) };
                a6.push(t6);
              }
              s6.layerDefinition.fields = a6;
              const l3 = {};
              for (const e7 of a6) l3[e7.name.toLowerCase()] = e7.name;
              let f2 = se(e6, "features", null);
              if (o4(f2)) for (const e7 of f2) {
                const t6 = {}, n5 = se(e7, "attributes", {});
                for (const e8 in n5) t6[l3[e8.toLowerCase()]] = n5[e8];
                s6.featureSet.features.push({ attributes: t6, geometry: de(se(e7, "geometry", null)) });
              }
              else f2 = null, s6.featureSet.features = f2;
            }
          }
        }
        if (false === ce(s6)) throw new n2(t5, "InvalidParameter", n4);
        return s6.layerDefinition.geometryType || (s6.layerDefinition.geometryType = "esriGeometryNull"), y2.create(s6, t5.spatialReference);
      });
    }, e4.signatures.push({ name: "featureset", min: 1, max: 1 }), e4.functions.filter = function(t5, n4) {
      return e4.standardFunctionAsync(t5, n4, async (i4, a5, r4) => {
        if (oe(r4, 2, 2, t5, n4), o4(r4[0]) || te(r4[0])) {
          const e5 = [];
          let i5, a6 = r4[0];
          if (a6 instanceof t2 && (a6 = a6.toArray()), !L2(r4[1])) throw new n2(t5, "InvalidParameter", n4);
          i5 = r4[1].createFunction(t5);
          for (const t6 of a6) {
            const n5 = i5(t6);
            C(n5) ? true === await n5 && e5.push(t6) : true === n5 && e5.push(t6);
          }
          return e5;
        }
        if (B(r4[0])) {
          const n5 = await r4[0].load(), i5 = L.create(r4[1], { fieldsIndex: n5.getFieldsIndex(), timeZone: n5.dateFieldsTimeZoneDefaultUTC }), a6 = i5.getVariables();
          if (a6.length > 0) {
            const n6 = {};
            for (const i6 of a6) n6[i6] = e4.evaluateIdentifier(t5, { name: i6 });
            i5.parameters = n6;
          }
          return new h({ parentfeatureset: r4[0], whereclause: i5 });
        }
        throw new n2(t5, "InvalidParameter", n4);
      });
    }, e4.signatures.push({ name: "filter", min: 2, max: 2 }), e4.functions.orderby = function(t5, n4) {
      return e4.standardFunctionAsync(t5, n4, async (e5, i4, a5) => {
        if (oe(a5, 2, 2, t5, n4), B(a5[0])) {
          const e6 = new e2(a5[1]);
          return new i2({ parentfeatureset: a5[0], orderbyclause: e6 });
        }
        throw new n2(t5, "InvalidParameter", n4);
      });
    }, e4.signatures.push({ name: "orderby", min: 2, max: 2 }), e4.functions.top = function(t5, n4) {
      return e4.standardFunctionAsync(t5, n4, async (e5, i4, a5) => {
        if (oe(a5, 2, 2, t5, n4), B(a5[0])) return new s3({ parentfeatureset: a5[0], topnum: a5[1] });
        if (o4(a5[0])) return Se(a5[1]) >= a5[0].length ? a5[0].slice() : a5[0].slice(0, Se(a5[1]));
        if (te(a5[0])) return Se(a5[1]) >= a5[0].length() ? a5[0].slice() : a5[0].slice(0, Se(a5[1]));
        throw new n2(t5, "InvalidParameter", n4);
      });
    }, e4.signatures.push({ name: "top", min: 2, max: 2 }), e4.functions.first = function(t5, n4) {
      return e4.standardFunctionAsync(t5, n4, async (e5, i4, a5) => {
        if (oe(a5, 1, 1, t5, n4), B(a5[0])) {
          const n5 = await a5[0].first(e5.abortSignal);
          if (null !== n5) {
            const e6 = I.createFromGraphicLikeObject(n5.geometry, n5.attributes, a5[0], t5.timeZone);
            return e6._underlyingGraphic = n5, e6;
          }
          return n5;
        }
        return o4(a5[0]) ? 0 === a5[0].length ? null : a5[0][0] : te(a5[0]) ? 0 === a5[0].length() ? null : a5[0].get(0) : null;
      });
    }, e4.signatures.push({ name: "first", min: 1, max: 1 }), e4.functions.attachments = function(t5, n4) {
      return e4.standardFunctionAsync(t5, n4, async (e5, a5, r4) => {
        oe(r4, 1, 2, t5, n4);
        const s6 = { minsize: -1, maxsize: -1, types: null, returnMetadata: false };
        if (r4.length > 1) {
          if (r4[1] instanceof p) {
            if (r4[1].hasField("minsize") && (s6.minsize = Se(r4[1].field("minsize"))), r4[1].hasField("metadata") && (s6.returnMetadata = Ae(r4[1].field("metadata"))), r4[1].hasField("maxsize") && (s6.maxsize = Se(r4[1].field("maxsize"))), r4[1].hasField("types")) {
              const e6 = _e(r4[1].field("types"), false);
              e6.length > 0 && (s6.types = e6);
            }
          } else if (null !== r4[1]) throw new n2(t5, "InvalidParameter", n4);
        }
        if (H2(r4[0])) {
          const e6 = r4[0]._layer;
          let n5;
          if (B(e6)) n5 = e6;
          else {
            if (null == e6 || !N(e6)) return [];
            n5 = F(e6, t5.spatialReference, ["*"], true, t5.lrucache, t5.interceptor);
          }
          return await n5.load(), n5.queryAttachments(r4[0].field(n5.objectIdField), s6.minsize, s6.maxsize, s6.types, s6.returnMetadata);
        }
        if (null === r4[0]) return [];
        throw new n2(t5, "InvalidParameter", n4);
      });
    }, e4.signatures.push({ name: "attachments", min: 1, max: 2 }), e4.functions.featuresetbyrelationshipname = function(t5, n4) {
      return e4.standardFunctionAsync(t5, n4, async (e5, i4, a5) => {
        oe(a5, 2, 4, t5, n4);
        const r4 = a5[0], s6 = ge(a5[1]);
        let l3 = z(a5[2], null);
        const f2 = Ae(z(a5[3], true));
        if (null === l3 && (l3 = ["*"]), false === o4(l3)) throw new n2(t5, "InvalidParameter", n4);
        if (null === a5[0]) return null;
        if (!H2(a5[0])) throw new n2(t5, "InvalidParameter", n4);
        const m6 = r4._layer;
        let p4;
        if (B(m6)) p4 = m6;
        else {
          if (null == m6 || !N(m6)) return null;
          p4 = F(m6, t5.spatialReference, ["*"], true, t5.lrucache, t5.interceptor);
        }
        p4 = await p4.load();
        const w = p4.relationshipMetaData().filter((e6) => e6.name === s6);
        if (0 === w.length) return null;
        if (void 0 !== w[0].relationshipTableId && null !== w[0].relationshipTableId && w[0].relationshipTableId > -1) return E(p4, w[0], r4.field(p4.objectIdField), p4.spatialReference, l3, f2, t5.lrucache, t5.interceptor);
        let I3 = p4.serviceUrl();
        if (!I3) return null;
        I3 = I3.endsWith("/") ? I3 + w[0].relatedTableId.toString() : I3 + "/" + w[0].relatedTableId.toString();
        const F2 = await k2(I3, p4.spatialReference, l3, f2, t5.lrucache, t5.interceptor);
        await F2.load();
        let b2 = F2.relationshipMetaData();
        if (b2 = b2.filter((e6) => e6.id === w[0].id), false === r4.hasField(w[0].keyField) || null === r4.field(w[0].keyField)) {
          const e6 = await p4.getFeatureByObjectId(r4.field(p4.objectIdField), [w[0].keyField]);
          if (e6) {
            const t6 = L.create(b2[0].keyField + "= @id", { fieldsIndex: F2.getFieldsIndex(), timeZone: F2.dateFieldsTimeZoneDefaultUTC });
            return t6.parameters = { id: e6.attributes[w[0].keyField] }, F2.filter(t6);
          }
          return new s2({ parentfeatureset: F2 });
        }
        const T = L.create(b2[0].keyField + "= @id", { fieldsIndex: F2.getFieldsIndex(), timeZone: F2.dateFieldsTimeZoneDefaultUTC });
        return T.parameters = { id: r4.field(w[0].keyField) }, F2.filter(T);
      });
    }, e4.signatures.push({ name: "featuresetbyrelationshipname", min: 2, max: 4 }), e4.functions.featuresetbyassociation = function(t5, n4) {
      return e4.standardFunctionAsync(t5, n4, async (e5, i4, a5) => {
        oe(a5, 2, 3, t5, n4);
        const s6 = a5[0], l3 = t(ge(z(a5[1], ""))), f2 = e(a5[2]) ? ge(a5[2]) : null;
        if (null === a5[0]) return null;
        if (!H2(a5[0])) throw new n2(t5, "InvalidParameter", n4);
        let u2 = s6._layer;
        if (u2 instanceof et && (u2 = F(u2, t5.spatialReference, ["*"], true, t5.lrucache, t5.interceptor)), null === u2) return null;
        if (false === B(u2)) return null;
        await u2.load();
        const c3 = u2.serviceUrl(), p4 = await O(c3, t5.spatialReference, true);
        if (p4.unVersion >= 8) return await pe(u2, s6, l3, f2, p4, t5, n4);
        const w = p4.associations;
        let I3 = null, F2 = null, b2 = false;
        if (null !== f2 && "" !== f2 && void 0 !== f2) {
          for (const e6 of p4.terminals) e6.terminalName === f2 && (F2 = e6.terminalId);
          null === F2 && (b2 = true);
        }
        const T = w.getFieldsIndex(), D2 = T.get("TOGLOBALID").name, E2 = T.get("FROMGLOBALID").name, A = T.get("TOTERMINALID").name, v3 = T.get("FROMTERMINALID").name, S = T.get("FROMNETWORKSOURCEID").name, j = T.get("TONETWORKSOURCEID").name, C2 = T.get("ASSOCIATIONTYPE").name, M2 = T.get("ISCONTENTVISIBLE").name, R2 = T.get("OBJECTID").name;
        for (const t6 of u2.fields) if ("global-id" === t6.type) {
          I3 = s6.field(t6.name);
          break;
        }
        let O2 = null, z2 = new k(new m4({ name: "percentalong", alias: "percentalong", type: "double" }), L.create("0", { fieldsIndex: w.getFieldsIndex(), timeZone: w.dateFieldsTimeZoneDefaultUTC })), W = new k(new m4({ name: "side", alias: "side", type: "string" }), L.create("''", { fieldsIndex: w.getFieldsIndex(), timeZone: w.dateFieldsTimeZoneDefaultUTC }));
        const H3 = "globalid", G = "globalId", _2 = {};
        for (const t6 in p4.lkp) _2[t6] = p4.lkp[t6].sourceId;
        const B3 = new I2(new m4({ name: "classname", alias: "classname", type: "string" }), null, _2);
        let K = "";
        switch (l3) {
          case "midspan": {
            K = `((${D2}='${I3}') OR ( ${E2}='${I3}')) AND (${C2} IN (5))`, B3.codefield = L.create(`CASE WHEN (${D2}='${I3}') THEN ${S} ELSE ${j} END`, { fieldsIndex: w.getFieldsIndex(), timeZone: w.dateFieldsTimeZoneDefaultUTC });
            const e6 = o5(b.findField(w.fields, E2));
            e6.name = H3, e6.alias = H3, O2 = new k(e6, L.create(`CASE WHEN (${E2}='${I3}') THEN ${D2} ELSE ${E2} END`, { fieldsIndex: w.getFieldsIndex(), timeZone: w.dateFieldsTimeZoneDefaultUTC })), z2 = p4.unVersion >= 4 ? new x(b.findField(w.fields, T.get("PERCENTALONG").name)) : new k(new m4({ name: "percentalong", alias: "percentalong", type: "double" }), L.create("0", { fieldsIndex: w.getFieldsIndex(), timeZone: w.dateFieldsTimeZoneDefaultUTC }));
            break;
          }
          case "junctionedge": {
            K = `((${D2}='${I3}') OR ( ${E2}='${I3}')) AND (${C2} IN (4,6))`, B3.codefield = L.create(`CASE WHEN (${D2}='${I3}') THEN ${S} ELSE ${j} END`, { fieldsIndex: w.getFieldsIndex(), timeZone: w.dateFieldsTimeZoneDefaultUTC });
            const e6 = o5(b.findField(w.fields, E2));
            e6.name = H3, e6.alias = H3, O2 = new k(e6, L.create(`CASE WHEN (${E2}='${I3}') THEN ${D2} ELSE ${E2} END`, { fieldsIndex: w.getFieldsIndex(), timeZone: w.dateFieldsTimeZoneDefaultUTC })), W = new k(new m4({ name: "side", alias: "side", type: "string" }), L.create(`CASE WHEN (${C2}=4) THEN 'from' ELSE 'to' END`, { fieldsIndex: w.getFieldsIndex(), timeZone: w.dateFieldsTimeZoneDefaultUTC }));
            break;
          }
          case "connected": {
            let e6 = `${D2}='@T'`, t6 = `${E2}='@T'`;
            null !== F2 && (e6 += ` AND ${A}=@A`, t6 += ` AND ${v3}=@A`), K = "((" + e6 + ") OR (" + t6 + "))", K = Y(K, "@T", I3 ?? ""), e6 = Y(e6, "@T", I3 ?? ""), null !== F2 && (e6 = Y(e6, "@A", F2.toString()), K = Y(K, "@A", F2.toString())), B3.codefield = L.create("CASE WHEN " + e6 + ` THEN ${S} ELSE ${j} END`, { fieldsIndex: w.getFieldsIndex(), timeZone: w.dateFieldsTimeZoneDefaultUTC });
            const n5 = o5(b.findField(w.fields, E2));
            n5.name = H3, n5.alias = H3, O2 = new k(n5, L.create("CASE WHEN " + e6 + ` THEN ${E2} ELSE ${D2} END`, { fieldsIndex: w.getFieldsIndex(), timeZone: w.dateFieldsTimeZoneDefaultUTC }));
            break;
          }
          case "container":
            K = `${D2}='${I3}' AND ${C2} = 2`, null !== F2 && (K += ` AND ${A} = ` + F2.toString()), B3.codefield = S, K = "( " + K + " )", O2 = new D(b.findField(w.fields, E2), H3, H3);
            break;
          case "content":
            K = `(${E2}='${I3}' AND ${C2} = 2)`, null !== F2 && (K += ` AND ${v3} = ` + F2.toString()), B3.codefield = j, K = "( " + K + " )", O2 = new D(b.findField(w.fields, D2), H3, H3);
            break;
          case "structure":
            K = `(${D2}='${I3}' AND ${C2} = 3)`, null !== F2 && (K += ` AND ${A} = ` + F2.toString()), B3.codefield = S, K = "( " + K + " )", O2 = new D(b.findField(w.fields, E2), H3, G);
            break;
          case "attached":
            K = `(${E2}='${I3}' AND ${C2} = 3)`, null !== F2 && (K += ` AND ${v3} = ` + F2.toString()), B3.codefield = j, K = "( " + K + " )", O2 = new D(b.findField(w.fields, D2), H3, G);
            break;
          default:
            throw new n2(t5, "InvalidParameter", n4);
        }
        b2 && (K = "1 <> 1");
        return new b({ parentfeatureset: w, adaptedFields: [new x(b.findField(w.fields, R2)), new x(b.findField(w.fields, M2)), O2, W, B3, z2], extraFilter: K ? L.create(K, { fieldsIndex: w.getFieldsIndex(), timeZone: w.dateFieldsTimeZoneDefaultUTC }) : null });
      });
    }, e4.signatures.push({ name: "featuresetbyassociation", min: 2, max: 6 }), e4.functions.groupby = function(t5, n4) {
      return e4.standardFunctionAsync(t5, n4, async (a5, r4, s6) => {
        if (oe(s6, 3, 3, t5, n4), !B(s6[0])) throw new n2(t5, "InvalidParameter", n4);
        const l3 = await s6[0].load(), f2 = [], d2 = [];
        let u2 = false, c3 = [];
        if (e(s6[1])) c3.push(s6[1]);
        else if (s6[1] instanceof p) c3.push(s6[1]);
        else if (o4(s6[1])) c3 = s6[1];
        else {
          if (!te(s6[1])) throw new n2(t5, "InvalidParameter", n4);
          c3 = s6[1].toArray();
        }
        for (const e5 of c3) if (e(e5)) {
          const t6 = L.create(ge(e5), { fieldsIndex: l3.getFieldsIndex(), timeZone: l3.dateFieldsTimeZoneDefaultUTC }), n5 = true === v(t6) ? ge(e5) : "%%%%FIELDNAME";
          f2.push({ name: n5, expression: t6 }), "%%%%FIELDNAME" === n5 && (u2 = true);
        } else {
          if (!(e5 instanceof p)) throw new n2(t5, "InvalidParameter", n4);
          {
            const i4 = e5.hasField("name") ? e5.field("name") : "%%%%FIELDNAME", a6 = e5.hasField("expression") ? e5.field("expression") : "";
            if ("%%%%FIELDNAME" === i4 && (u2 = true), !i4) throw new n2(t5, "InvalidParameter", n4);
            f2.push({ name: i4, expression: L.create(a6 || i4, { fieldsIndex: l3.getFieldsIndex(), timeZone: l3.dateFieldsTimeZoneDefaultUTC }) });
          }
        }
        if (c3 = [], e(s6[2])) c3.push(s6[2]);
        else if (o4(s6[2])) c3 = s6[2];
        else if (te(s6[2])) c3 = s6[2].toArray();
        else {
          if (!(s6[2] instanceof p)) throw new n2(t5, "InvalidParameter", n4);
          c3.push(s6[2]);
        }
        for (const e5 of c3) {
          if (!(e5 instanceof p)) throw new n2(t5, "InvalidParameter", n4);
          {
            const i4 = e5.hasField("name") ? e5.field("name") : "", a6 = e5.hasField("statistic") ? e5.field("statistic") : "", r5 = e5.hasField("expression") ? e5.field("expression") : "";
            if (!(i4 && a6 && e(a6) && r5)) throw new n2(t5, "InvalidParameter", n4);
            d2.push({ name: i4, statistic: a6, expression: L.create(r5, { fieldsIndex: l3.getFieldsIndex(), timeZone: l3.dateFieldsTimeZoneDefaultUTC }) });
          }
        }
        if (u2) {
          const e5 = {};
          for (const n5 of l3.fields) e5[n5.name.toLowerCase()] = 1;
          for (const n5 of f2) "%%%%FIELDNAME" !== n5.name && (e5[n5.name.toLowerCase()] = 1);
          for (const n5 of d2) "%%%%FIELDNAME" !== n5.name && (e5[n5.name.toLowerCase()] = 1);
          let t6 = 0;
          for (const n5 of f2) if ("%%%%FIELDNAME" === n5.name) {
            for (; 1 === e5["field_" + t6.toString()]; ) t6++;
            e5["field_" + t6.toString()] = 1, n5.name = "FIELD_" + t6.toString();
          }
        }
        for (const n5 of f2) oe2(n5.expression, e4, t5);
        for (const n5 of d2) oe2(n5.expression, e4, t5);
        return s6[0].groupby(f2, d2);
      });
    }, e4.signatures.push({ name: "groupby", min: 3, max: 3 }), e4.functions.distinct = function(t5, n4) {
      return e4.standardFunctionAsync(t5, n4, async (a5, r4, s6) => {
        if (B(s6[0])) {
          oe(s6, 2, 2, t5, n4);
          const a6 = await s6[0].load(), r5 = [];
          let l3 = [];
          if (e(s6[1])) l3.push(s6[1]);
          else if (s6[1] instanceof p) l3.push(s6[1]);
          else if (o4(s6[1])) l3 = s6[1];
          else {
            if (!te(s6[1])) throw new n2(t5, "InvalidParameter", n4);
            l3 = s6[1].toArray();
          }
          let f2 = false;
          for (const e5 of l3) if (e(e5)) {
            const t6 = L.create(ge(e5), { fieldsIndex: a6.getFieldsIndex(), timeZone: a6.dateFieldsTimeZoneDefaultUTC }), n5 = true === v(t6) ? ge(e5) : "%%%%FIELDNAME";
            r5.push({ name: n5, expression: t6 }), "%%%%FIELDNAME" === n5 && (f2 = true);
          } else {
            if (!(e5 instanceof p)) throw new n2(t5, "InvalidParameter", n4);
            {
              const i4 = e5.hasField("name") ? e5.field("name") : "%%%%FIELDNAME", s7 = e5.hasField("expression") ? e5.field("expression") : "";
              if ("%%%%FIELDNAME" === i4 && (f2 = true), !i4) throw new n2(t5, "InvalidParameter", n4);
              r5.push({ name: i4, expression: L.create(s7 || i4, { fieldsIndex: a6.getFieldsIndex(), timeZone: a6.dateFieldsTimeZoneDefaultUTC }) });
            }
          }
          if (f2) {
            const e5 = {};
            for (const n5 of a6.fields) e5[n5.name.toLowerCase()] = 1;
            for (const n5 of r5) "%%%%FIELDNAME" !== n5.name && (e5[n5.name.toLowerCase()] = 1);
            let t6 = 0;
            for (const n5 of r5) if ("%%%%FIELDNAME" === n5.name) {
              for (; 1 === e5["field_" + t6.toString()]; ) t6++;
              e5["field_" + t6.toString()] = 1, n5.name = "FIELD_" + t6.toString();
            }
          }
          for (const n5 of r5) oe2(n5.expression, e4, t5);
          return s6[0].groupby(r5, []);
        }
        return re2(s6);
      });
    }, e4.functions.getfeaturesetinfo = function(t5, n4) {
      return e4.standardFunctionAsync(t5, n4, async (e5, a5, r4) => {
        if (oe(r4, 1, 1, t5, n4), !B(r4[0])) return null;
        const o7 = await r4[0].getFeatureSetInfo();
        return o7 ? p.convertObjectToArcadeDictionary({ layerId: o7.layerId, layerName: o7.layerName, itemId: o7.itemId, serviceLayerUrl: o7.serviceLayerUrl, webMapLayerId: o7.webMapLayerId ?? null, webMapLayerTitle: o7.webMapLayerTitle ?? null, className: null, objectClassId: null }, Ke(t5), false, false) : null;
      });
    }, e4.signatures.push({ name: "getfeaturesetinfo", min: 1, max: 1 }), e4.functions.filterbysubtypecode = function(t5, n4) {
      return e4.standardFunctionAsync(t5, n4, async (e5, i4, a5) => {
        if (oe(a5, 2, 2, t5, n4), B(a5[0])) {
          const e6 = await a5[0].load(), i5 = a5[1];
          if (!r2(i5)) throw new n2(t5, "InvalidParameter", n4);
          if (e6.subtypeField) {
            const t6 = L.create(`${e6.subtypeField}= ${a5[1]}`, { fieldsIndex: e6.getFieldsIndex(), timeZone: e6.dateFieldsTimeZoneDefaultUTC });
            return new h({ parentfeatureset: a5[0], whereclause: t6 });
          }
          if (null === e6.typeIdField || "" === e6.typeIdField) throw new n2(t5, "FeatureSetDoesNotHaveSubtypes", n4);
          const r4 = L.create(`${e6.typeIdField}= ${a5[1]}`, { fieldsIndex: e6.getFieldsIndex(), timeZone: e6.dateFieldsTimeZoneDefaultUTC });
          return new h({ parentfeatureset: a5[0], whereclause: r4 });
        }
        throw new n2(t5, "InvalidParameter", n4);
      });
    }, e4.signatures.push({ name: "filterbysubtypecode", min: 2, max: 2 });
  }
}
export {
  ye as registerFunctions
};
//# sourceMappingURL=featuresetbase-NAZJMPLA.js.map
