import {
  c
} from "./chunk-WBYRWTBX.js";
import {
  b
} from "./chunk-647DAMHU.js";
import {
  l
} from "./chunk-TF6255HN.js";
import {
  m
} from "./chunk-MHV23XAQ.js";
import {
  f
} from "./chunk-5T3MJDSR.js";
import {
  has
} from "./chunk-AL6YUTZM.js";

// node_modules/@arcgis/core/layers/graphics/data/FeatureIdInfo.js
function* e(e2) {
  switch (e2.type) {
    case "object-id":
    case "unique-id-simple":
      return void (yield e2.fieldName);
    case "unique-id-composite":
      return void (yield* e2.fieldNames);
  }
}

// node_modules/@arcgis/core/views/2d/layers/features/sources/FeatureSourceQueryInfo.js
var s = 4;
function o(e2) {
  switch (e2.type) {
    case "object-id":
    case "unique-id-simple":
      return `${e2.fieldName} ASC`;
    case "unique-id-composite":
      return `${e2.fieldNames.join(",")} ASC`;
  }
}
function n(e2, r, a) {
  const s2 = o(a.featureIdInfo);
  return { returnCentroid: "esriGeometryPolygon" === a.serviceGeometryType && !e2.queryMetadata.supportsCentroidOnDegeneratedQuantizedGeometry && !e2.queryMetadata.supportsDegeneratedQuantizedGeometry, returnGeometry: true, timeReferenceUnknownClient: a.timeReferenceUnknownClient ?? void 0, outSpatialReference: f.fromJSON(e2.outSpatialReference), orderByFields: "memory" === e2.type ? [] : [s2], where: r.definitionExpression ?? "1=1", outFields: r.availableFields, multipatchOption: "esriGeometryMultiPatch" === a.serviceGeometryType ? "xyFootprint" : null, gdbVersion: r.gdbVersion, historicMoment: r.historicMoment ? new Date(r.historicMoment) : null, timeExtent: r.timeExtent ? m.fromJSON(r.timeExtent) : null };
}
var u = class _u {
  static create(e2, t, r) {
    const a = t.queryScaleRanges, i = t.displayFilterInfo;
    return new _u(n(e2, t, r), i, a, r.subtypeField, t.customParameters, r.geometryType, e2.queryMetadata);
  }
  constructor(e2, t, r, a, i, s2, o2) {
    this._queryParams = e2, this._displayFilter = t, this._queryScaleRanges = r, this._subtypeField = a, this._customParameters = i, this._geometryType = s2, this._queryMetadata = o2;
  }
  get pageSize() {
    if (null == this._queryMetadata) throw new Error("InternalError: Service does not support paged queries");
    const e2 = this._queryMetadata.supportsMaxRecordCountFactor ? s : null, t = (this._queryMetadata.maxRecordCount ?? 8e3) * (e2 ?? 1);
    return Math.min(8e3, t);
  }
  get objectIdsQueryPageSize() {
    return this._queryMetadata?.maxRecordCount ?? 2e3;
  }
  updateHistoricMoment(e2) {
    this._queryParams.historicMoment = e2;
  }
  updateFields(e2) {
    this._queryParams.outFields = e2;
  }
  createPatchFieldsQuery(e2, t, r) {
    if (!t.getSize()) return null;
    const a = e2.clone();
    if ("*" === this._queryParams.outFields[0]) {
      if ("*" === (a.outFields ?? [])[0]) return null;
      a.outFields = this._queryParams.outFields;
    } else {
      const e3 = new Set(this._queryParams.outFields), r2 = [];
      for (const a2 of e3) t.hasField(a2) || r2.push(a2);
      if (0 === r2.length) return null;
      a.outFields = r2;
    }
    a.returnGeometry = false, a.returnCentroid = false, a.quantizationParameters = null, a.cacheHint = true;
    const i = { inner: a, customParameters: this._customParameters };
    if (has("esri-tiles-debug") && null != r) {
      const e3 = r.chunkId.toString().replaceAll("/", ".");
      i.customParameters = i.customParameters ? { ...i.customParameters, chunkId: e3 } : { chunkId: e3 };
    }
    return i;
  }
  createQuery(e2 = {}) {
    if (!this._queryParams) throw new Error("InternalError: queryInfo should be defined");
    return { inner: new b({ ...this._queryParams, ...e2 }), customParameters: this._customParameters };
  }
  createTileQuery(t, a) {
    if (null == this._queryMetadata) throw new Error("InternalError: Service does not support tile queries");
    const i = this.createQuery(a), o2 = i.inner;
    if (this._queryScaleRanges?.length) {
      const r = this._queryScaleRanges.filter((e2) => (!e2.minScale || e2.minScale >= t.maxScale) && (!e2.maxScale || e2.maxScale <= t.minScale)).map((e2) => e2.subtypeCode);
      if (r.length) {
        const t2 = `${this._subtypeField} IN (${r})`;
        o2.where = l(o2.where, t2);
      }
    }
    if (this._displayFilter && (o2.where = l(o2.where, c(this._displayFilter, t.minScale, t.maxScale))), o2.quantizationParameters = a.quantizationParameters ?? t.getQuantizationParameters(), o2.resultType = "tile", o2.geometry = t.extent, this._queryMetadata.supportsQuantization ? "esriGeometryPolyline" === this._geometryType && (o2.maxAllowableOffset = t.resolution * has("feature-polyline-generalization-factor")) : "esriGeometryPolyline" !== this._geometryType && "esriGeometryPolygon" !== this._geometryType || (o2.maxAllowableOffset = t.resolution, "esriGeometryPolyline" === this._geometryType && (o2.maxAllowableOffset *= has("feature-polyline-generalization-factor"))), o2.defaultSpatialReferenceEnabled = this._queryMetadata.supportsDefaultSpatialReference, o2.compactGeometryEnabled = this._queryMetadata.supportsCompactGeometry, this._queryMetadata.supportsMaxRecordCountFactor && (o2.maxRecordCountFactor = s), has("esri-tiles-debug")) {
      const e2 = t.id.replaceAll("/", ".");
      i.customParameters = i.customParameters ? { ...i.customParameters, tileId: e2 } : { tileId: e2 };
    }
    return i;
  }
  createPagedTileQuery(e2, t) {
    const r = this.pageSize;
    return this.createTileQuery(e2, { start: r * t, num: r, returnExceededLimitFeatures: true });
  }
  createPagedQuery(e2, t) {
    const r = this.pageSize;
    return this.createQuery({ start: r * e2, num: r, returnExceededLimitFeatures: true, maxRecordCountFactor: s, quantizationParameters: t, cacheHint: true });
  }
  createObjectIdsQuery(e2) {
    return this.createQuery({ objectIds: e2, outFields: ["*"] });
  }
};

export {
  u,
  e
};
//# sourceMappingURL=chunk-X5BCRMNY.js.map
