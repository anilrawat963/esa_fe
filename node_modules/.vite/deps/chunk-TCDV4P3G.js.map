{
  "version": 3,
  "sources": ["../../@arcgis/core/layers/mixins/refresh.js", "../../@arcgis/core/layers/mixins/RefreshableLayer.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Collection.js\";import{sync as r}from\"../../core/reactiveUtils.js\";import{autorun as t}from\"../../core/accessorSupport/trackingUtils.js\";const n=new e,o=new WeakMap;function f(e){i(e)&&n.push(new WeakRef(e))}function s(e){const r=n.find(r=>r.deref()===e);r&&n.remove(r)}function i(e){return null!=e&&\"object\"==typeof e&&\"refreshInterval\"in e&&\"refresh\"in e}function c(e,r){return Number.isFinite(e)&&Number.isFinite(r)?r<=0?e:c(r,e%r):0}let l=0,a=0;function u(){const e=Date.now();let r=!1;for(const t of n){const n=t.deref();if(n){if(n.refreshInterval){e-(o.get(n)??0)+5>=6e4*n.refreshInterval&&(o.set(n,e),n.refresh(e))}}else r=!0}if(r)for(let t=n.length-1;t>=0;t--){n.at(t).deref()||n.removeAt(t)}}t(()=>{const e=Date.now();let r=0;for(const t of n){const n=t.deref();n&&(r=c(Math.round(6e4*n.refreshInterval),r),n.refreshInterval?o.get(n)||o.set(n,e):o.delete(n))}if(r!==a){if(a=r,clearInterval(l),0===a)return void(l=0);l=setInterval(u,a)}},r);const h={get hasRefreshTimer(){return l>0},get tickInterval(){return a},forceRefresh(){u()},hasLayer:e=>i(e)&&n.some(r=>r.deref()===e),clear(){for(const e of n){const r=e.deref();r&&o.delete(r)}n.removeAll()}};export{f as registerLayer,h as test,s as unregisterLayer};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{__decorate as e}from\"tslib\";import\"../../core/has.js\";import r from\"../../core/Logger.js\";import{debounce as t,ignoreAbortErrors as s}from\"../../core/promiseUtils.js\";import{property as o}from\"../../core/accessorSupport/decorators/property.js\";import{cast as a}from\"../../core/accessorSupport/decorators/cast.js\";import\"../../core/RandomLCG.js\";import{subclass as i}from\"../../core/accessorSupport/decorators/subclass.js\";import{excludeTables as n}from\"../../core/accessorSupport/layerContainerType.js\";import{registerLayer as h,unregisterLayer as p}from\"./refresh.js\";function m(e){return null!=e&&\"object\"==typeof e&&\"refreshTimestamp\"in e&&\"refresh\"in e}const c=.1,f=m=>{const f=m;let l=class extends f{constructor(...e){super(...e),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=t(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||h(this)},()=>{})}destroy(){p(this)}castRefreshInterval(e){return e>=c?e:e<=0?0:c}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(e=Date.now()){s(this._debounceHasDataChanged()).then(r=>{r&&this._set(\"refreshTimestamp\",e),this.emit(\"refresh\",{dataChanged:r})},e=>{r.getLogger(this).error(e),this.emit(\"refresh\",{dataChanged:!1,error:e})})}async hasDataChanged(){return!0}get test(){}};return e([o({type:Number,json:{write:!0,origins:{\"web-scene\":{write:{enabled:!0,layerContainerTypes:n}}}}})],l.prototype,\"refreshInterval\",void 0),e([a(\"refreshInterval\")],l.prototype,\"castRefreshInterval\",null),e([o({readOnly:!0})],l.prototype,\"refreshTimestamp\",void 0),e([o({readOnly:!0})],l.prototype,\"refreshParameters\",null),l=e([i(\"esri.layers.mixins.RefreshableLayer\")],l),l};export{f as RefreshableLayer,m as isRefreshableLayer};\n"],
  "mappings": "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",
  "names": ["i", "s", "r", "a", "n", "c", "f", "m", "l", "s", "e", "a"]
}
