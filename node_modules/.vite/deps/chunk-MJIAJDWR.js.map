{
  "version": 3,
  "sources": ["../../@arcgis/core/geometry/support/curves/densifyCurvedGeometry.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{interpolateCubicBezier as t}from\"./bezierCurveUtils.js\";import{deriveCircleFromCircularArc as s}from\"./circularArcUtils.js\";import{isCurvedGeometry as i,getCurves as n,getEndpoint as e,isCoordinate as r,isBezierCurve as a,isCircularArc as h,isEllipticArc4 as c,isEllipticArc7 as o,cloneCurve as u}from\"./curveUtils.js\";import{deriveCircleFromEllipticArc4 as p}from\"./ellipticArc4Utils.js\";import{deriveEllipse as l,interpolateEllipse as d}from\"./ellipticArc7Utils.js\";import{interpolateSegment as m,pointToSegmentDistance2 as S,distance2 as E}from\"./mathUtils.js\";const v={maxSegmentLength:1/0,maxDeviation:1/0,maxSegmentsPerCurve:12e3,minSegmentsPerCurve:1},f=1e-6,g=[0,0];function M(t){return{maxSegmentLength:t.maxSegmentLength??v.maxSegmentLength,maxDeviation:t.maxDeviation??v.maxDeviation,maxSegmentsPerCurve:t.maxSegmentsPerCurve??v.maxSegmentsPerCurve,minSegmentsPerCurve:Math.max(t.minSegmentsPerCurve??v.minSegmentsPerCurve,1)}}class P{constructor(t,s){this.curveStart=t,this.curveEnd=s,this.tStart=0,this.tEnd=0,this.tEndStack=[],this.arcEndStack=[]}get stackSize(){return this.tEndStack.length}initialize(t,s){this.tStart=0,this.arcStart=t,this.tEndStack.push(1),this.arcEndStack.push(s)}splitAt(t){this.tEndStack.push(this.tEnd),this.arcEndStack.push(this.arcEnd),this.tEndStack.push(t),this.arcEndStack.push(this.interpolate(t))}splitInHalf(){return this.splitAt((this.tStart+this.tEnd)/2)}pop(){this.tEnd=this.tEndStack.pop(),this.arcEnd=this.arcEndStack.pop()}next(){this.tStart=this.tEnd,this.arcStart=this.arcEnd}densify(t,{maxDeviation:s,maxSegmentLength:i,maxSegmentsPerCurve:n,minSegmentsPerCurve:e}){const r=i*i,a=s*s,h=1/n,c=this.interpolate(0),o=this.interpolate(1);E(this.curveStart,c)>f&&t.push(c),this.initialize(c,o);const u=1/e;for(let p=e-1;p>0;p--){const t=p*u;this.pop(),this.splitAt(t)}for(;this.stackSize>0;)this.pop(),this.tStart===this.tEnd||this.tEnd-this.tStart<h||(0===r||!isFinite(r)||E(this.arcStart,this.arcEnd)<r)&&(0===a||!isFinite(a)||this.getDeviation2()<a)?(t.push(this.arcEnd),this.next()):this.splitInHalf();return E(this.curveEnd,o)>f&&t.push([...this.curveEnd]),t}}class x extends P{constructor(t,s){const[i,n,e]=s.b;super(t,i),this._controlPointsStack=[],this._curveControlPoints=[n,e],this._arcControlPoints=[n,e],this._controlPointsStack.push(this._arcControlPoints)}splitAt(t){const{arcStart:s,arcEnd:i,tStart:n,tEnd:e}=this,[r,a]=this._arcControlPoints,h=(t-n)/(e-n),c=m([],s,r,h),o=m(g,r,a,h),u=m([],a,i,h),p=m([],c,o,h),l=m([],o,u,h),d=m([],p,l,h);this.tEndStack.push(this.tEnd),this.arcEndStack.push(this.arcEnd),this._controlPointsStack.push([l,u]),this.tEndStack.push(t),this.arcEndStack.push(d),this._arcControlPoints[0]=c,this._arcControlPoints[1]=p,this._controlPointsStack.push(this._arcControlPoints)}pop(){super.pop(),this._arcControlPoints=this._controlPointsStack.pop()}interpolate(s){const{curveStart:i,curveEnd:n}=this,[e,r]=this._curveControlPoints;return t(i,e,r,n,s)}getDeviation2(){const{arcStart:t,arcEnd:s}=this,[i,n]=this._arcControlPoints;return Math.max(S(i,t,s),S(n,t,s))}}class k extends P{constructor(t,s){const[i]=s.a;super(t,i),this._derivedEllipse=l(t,s)}pop(){super.pop(),this._tMid=(this.tStart+this.tEnd)/2,this._arcMid=this.interpolate(this._tMid)}splitInHalf(){this.tEndStack.push(this.tEnd),this.arcEndStack.push(this.arcEnd),this.tEndStack.push(this._tMid),this.arcEndStack.push(this._arcMid)}interpolate(t){return d(this._derivedEllipse,t)}getDeviation2(){return S(this._arcMid,this.arcStart,this.arcEnd)}}function C(t,s,i,{cx:n,cy:e,radius:r,thetaStart:a,thetaEnd:h,isInvalid:c},{maxDeviation:o,maxSegmentLength:u,maxSegmentsPerCurve:p,minSegmentsPerCurve:l}){if(c)return t.push([...i]),t;const d=2*r,m=[n+r*Math.cos(a),e+r*Math.sin(a)],S=[n+r*Math.cos(h),e+r*Math.sin(h)];E(s,m)>f&&t.push(m);const v=Math.abs(h-a),g=u<d?2*Math.asin(u/d):v,M=o<=r?2*Math.acos(1-o/r):v,P=Math.min(g,M),x=Math.min(p,Math.max(l,Math.ceil(Math.abs(v/P)))),k=1/x;for(let E=1;E<x;E++){const s=E*k,i=a*(1-s)+h*s;t.push([n+r*Math.cos(i),e+r*Math.sin(i)])}return t.push(S),E(i,S)>f&&t.push([...i]),t}function _(t,s,i,n){return new x(s,i).densify(t,n)}function Z(t,i,n,e){const r=s(i,n),[a]=n.c;return C(t,i,a,r,e)}function A(t,s,i,n){const e=p(s,i),[r]=i.a;return C(t,s,r,e,n)}function D(t,s,i,n){const[e,r,a,h,c,o,u]=i.a;return 0===o||0===u?(t.push([...e]),t):new k(s,i).densify(t,n)}function R(t,s,i,n){return r(i)?(t.push([...i]),t):a(i)?_(t,s,i,n):h(i)?Z(t,s,i,n):c(i)?A(t,s,i,n):D(t,s,i,n)}function y(t,s){if(!i(t))return t;const r=M(s),a=n(t),h=[];for(const i of a){const t=[];for(let s=0;s<i.length-1;s++){const n=s+1,a=[...e(i[s])];0===s&&t.push(a);R(t,a,i[n],r)}h.push(t)}return\"curvePaths\"in t?{...void 0!==t.hasZ?{hasZ:t.hasZ}:{},...void 0!==t.hasM?{hasM:t.hasM}:{},paths:h,spatialReference:t.spatialReference}:{...void 0!==t.hasZ?{hasZ:t.hasZ}:{},...void 0!==t.hasM?{hasM:t.hasM}:{},rings:h,spatialReference:t.spatialReference}}function j(t,s,p){if(!i(t))return t;const l=new Set(s),d=M(p),m=n(t),S=[];let E=!1;for(const i of m){const t=[];for(let s=0;s<i.length-1;s++){const n=s+1,p=[...e(i[s])];0===s&&t.push(p);const m=i[n];r(m)?t.push([...m]):a(m)&&!l.has(\"esriGeometryBezier3Curve\")?_(t,p,m,d):h(m)&&!l.has(\"esriGeometryCircularArc\")?Z(t,p,m,d):c(m)&&!l.has(\"esriGeometryEllipticArc\")?A(t,p,m,d):o(m)&&!l.has(\"esriGeometryEllipticArc\")?D(t,p,m,d):(t.push(u(m)),E=!0)}S.push(t)}return\"curvePaths\"in t?{...void 0!==t.hasZ?{hasZ:t.hasZ}:{},...void 0!==t.hasM?{hasM:t.hasM}:{},spatialReference:t.spatialReference,...E?{curvePaths:S}:{paths:S}}:{hasZ:t.hasZ,hasM:t.hasM,spatialReference:t.spatialReference,...E?{curveRings:S}:{rings:S}}}export{y as densifyCurvedGeometry,j as selectiveDensifyCurvedGeometry};\n"],
  "mappings": "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",
  "names": ["f", "t", "i", "n", "r", "a", "h", "c", "o", "u", "p", "l", "d", "v", "g", "M", "P", "x", "k", "s"]
}
