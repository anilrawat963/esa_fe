import {
  y as y2
} from "./chunk-KZCOWPYM.js";
import {
  l as l2
} from "./chunk-RO646JIV.js";
import {
  n as n2
} from "./chunk-CNYNCKEV.js";
import {
  a as a4,
  s as s3
} from "./chunk-L4A2QJG4.js";
import {
  k
} from "./chunk-W75DBJD7.js";
import {
  m as m2
} from "./chunk-ENINOZUZ.js";
import {
  n
} from "./chunk-MA3QDRC3.js";
import {
  O
} from "./chunk-YDTPM7OQ.js";
import {
  M
} from "./chunk-7P2ANHQ3.js";
import {
  u as u2
} from "./chunk-XCKT47LJ.js";
import {
  l
} from "./chunk-YY5PITIH.js";
import {
  f
} from "./chunk-5T3MJDSR.js";
import {
  H2 as H,
  I,
  ht
} from "./chunk-V2H77UEV.js";
import {
  r
} from "./chunk-SOIZOFSB.js";
import {
  a as a3
} from "./chunk-XXLHAM2M.js";
import {
  b,
  m
} from "./chunk-5EI5H4QX.js";
import {
  a2
} from "./chunk-ZIE53VIV.js";
import {
  __decorate
} from "./chunk-SS5CLIUY.js";
import {
  s as s2,
  u2 as u
} from "./chunk-GNMPGHLQ.js";
import {
  a,
  i3 as i,
  s,
  y
} from "./chunk-QY7XKUIV.js";

// node_modules/@arcgis/core/support/BasemapStyle.js
var l3 = class extends b {
  constructor(o) {
    super(o), this.apiKey = null, this.id = null, this.language = null, this.places = null, this.serviceUrl = "https://basemapstyles-api.arcgis.com/arcgis/rest/services/styles/v2", this.worldview = null;
  }
  get languageParameter() {
    const o = this.language;
    let r2 = "local" === o || "global" === o ? o : m2(o ?? l()) ?? "global";
    return r2 = "no" === r2 ? "nb" : r2, r2;
  }
};
__decorate([m()], l3.prototype, "apiKey", void 0), __decorate([m()], l3.prototype, "id", void 0), __decorate([m()], l3.prototype, "language", void 0), __decorate([m()], l3.prototype, "places", void 0), __decorate([m()], l3.prototype, "serviceUrl", void 0), __decorate([m()], l3.prototype, "worldview", void 0), l3 = __decorate([a2("esri.support.BasemapStyle")], l3);
var p = l3;

// node_modules/@arcgis/core/Basemap.js
var U;
var $;
var _a;
var x = (_a = class extends a3(u2) {
  constructor(e) {
    super(e), this[U] = true, this.id = null, this.portalItem = null, this.spatialReference = null, this.style = null, this.thumbnailUrl = null, this.title = "Basemap", this.type = "Basemap", this.id = Date.now().toString(16) + "-basemap-" + $.idCounter++, this.baseLayers = new O(), this.referenceLayers = new O(), this.groundLayers = new O();
    const r2 = (e2) => {
      const { parent: r3 } = e2;
      r3 && r3 !== this && "remove" in r3 && r3.remove?.(e2), e2.parent = this, "elevation" !== e2.type && "integrated-mesh-3dtiles" !== e2.type || i.getLogger(this).error(`Layer '${e2.title}, id:${e2.id}' of type '${e2.type}' is not supported as a basemap layer and will therefore be ignored.`);
    }, t = (e2) => {
      const { parent: r3 } = e2;
      r3 && r3 !== this && "remove" in r3 && r3.remove?.(e2), e2.parent = this;
    }, a5 = (e2) => {
      const r3 = e2.item;
      return r3.parent === this ? (i.getLogger(this).error(`Layer '${r3.title}, id:${r3.id}' of type '${r3.type}' already a ground layer, second add will be ignored.`), void e2.preventDefault()) : "integrated-mesh-3dtiles" !== r3.type && "integrated-mesh" !== r3.type ? (i.getLogger(this).error(`Layer '${r3.title}, id:${r3.id}' of type '${r3.type}' is not supported as a ground layer and will therefore be ignored.`), void e2.preventDefault()) : void 0;
    }, o = (e2) => {
      e2.parent = null;
    }, i2 = (e2) => {
      e2.parent === this && (e2.parent = null);
    };
    this.addHandles([this.baseLayers.on("after-add", (e2) => r2(e2.item)), this.baseLayers.on("after-remove", (e2) => o(e2.item)), this.referenceLayers.on("after-add", (e2) => r2(e2.item)), this.referenceLayers.on("after-remove", (e2) => o(e2.item)), this.groundLayers.on("before-add", a5), this.groundLayers.on("after-add", (e2) => t(e2.item)), this.groundLayers.on("after-remove", (e2) => i2(e2.item))]);
  }
  initialize() {
    this.when().catch((e) => {
      i.getLogger(this).error("#load()", `Failed to load basemap (title: '${this.title}', id: '${this.id}')`, e);
    }), this.resourceInfo && this.read(this.resourceInfo.data, this.resourceInfo.context);
  }
  destroy() {
    const e = this.baseLayers.toArray();
    for (const s4 of e) s4.destroyed || s4.destroy();
    const r2 = this.groundLayers.toArray();
    for (const s4 of r2) s4.destroyed || s4.destroy();
    const t = this.referenceLayers.toArray();
    for (const s4 of t) s4.destroyed || s4.destroy();
    this.baseLayers.destroy(), this.groundLayers.destroy(), this.referenceLayers.destroy(), this.portalItem = u(this.portalItem);
  }
  removeChildLayer(e) {
    for (const r2 of [this.baseLayers, this.referenceLayers, this.groundLayers]) r2.remove(e);
  }
  normalizeCtorArgs(e) {
    return e && "resourceInfo" in e && (this._set("resourceInfo", e.resourceInfo), delete (e = { ...e }).resourceInfo), e;
  }
  set baseLayers(e) {
    this._set("baseLayers", n(e, this._get("baseLayers")));
  }
  _writeBaseLayers(e, r2, t) {
    const s4 = [];
    e ? (t = { ...t, layerContainerType: "basemap-base-layers" }, this.baseLayers.forEach((e2) => {
      const r3 = y2(e2, t.webmap ? t.webmap.getLayerJSONFromResourceInfo(e2) : null, t);
      null != r3 && s4.push(r3);
    }), this.referenceLayers.forEach((e2) => {
      const r3 = y2(e2, t.webmap ? t.webmap.getLayerJSONFromResourceInfo(e2) : null, t);
      null != r3 && ("scene" !== e2.type && (r3.isReference = true), s4.push(r3));
    }), r2.baseMapLayers = s4) : r2.baseMapLayers = s4;
  }
  set groundLayers(e) {
    this._set("groundLayers", n(e, this._get("groundLayers")));
  }
  _writeGroundLayers(e, r2, t) {
    const s4 = [];
    e && (t = { ...t, layerContainerType: "basemap-ground-layers" }, this.groundLayers.forEach((e2) => {
      const r3 = y2(e2, t.webmap ? t.webmap.getLayerJSONFromResourceInfo(e2) : null, t);
      null != r3 && s4.push(r3);
    }), s4.length > 0 && (r2.groundLayers = s4));
  }
  get loaded() {
    return super.loaded;
  }
  set referenceLayers(e) {
    this._set("referenceLayers", n(e, this._get("referenceLayers")));
  }
  writeTitle(e, r2) {
    r2.title = e || "Basemap";
  }
  load(e) {
    return this.addResolvingPromise(this._loadFromSource(e)), Promise.resolve(this);
  }
  loadAll() {
    return l2(this, (e) => {
      e(this.baseLayers, this.groundLayers, this.referenceLayers);
    });
  }
  clone() {
    const e = { id: this.id, title: this.title, portalItem: this.portalItem, baseLayers: this.baseLayers.map((e2) => y(e2) ? e2.clone() : e2), groundLayers: this.groundLayers.map((e2) => y(e2) ? e2.clone() : e2), referenceLayers: this.referenceLayers.map((e2) => y(e2) ? e2.clone() : e2) };
    return this.loaded && (e.loadStatus = "loaded"), new $({ resourceInfo: this.resourceInfo }).set(e);
  }
  read(e, r2) {
    this.resourceInfo || this._set("resourceInfo", { data: e, context: r2 }), super.read(e, r2);
  }
  write(e, r2) {
    return e = e || {}, r2?.origin || (r2 = { origin: "web-map", ...r2 }), super.write(e, r2), !this.loaded && this.resourceInfo?.data.baseMapLayers && (e.baseMapLayers = this.resourceInfo.data.baseMapLayers.map((e2) => {
      const r3 = a(e2);
      return r3.url && ht(r3.url) && (r3.url = `https:${r3.url}`), r3.templateUrl && ht(r3.templateUrl) && (r3.templateUrl = `https:${r3.templateUrl}`), r3;
    })), e;
  }
  async _loadFromSource(e) {
    const { resourceInfo: r2, portalItem: t, style: s4 } = this;
    s2(e);
    const a5 = [];
    if (r2) {
      const t2 = r2.context ? r2.context.url : null;
      if (a5.push(this._loadLayersFromJSON(r2.data, t2, e)), r2.data.id && !r2.data.title) {
        const e2 = r2.data.id;
        a5.push(s3(e2).then((e3) => {
          e3 && this.read({ title: e3 }, r2.context);
        }));
      }
    } else t ? a5.push(this._loadFromItem(t, e)) : s4 && a5.push(this._loadFromStylesService(s4, e));
    await Promise.all(a5);
  }
  async _loadLayersFromJSON(e, r2, t) {
    const s4 = this.resourceInfo?.context, a5 = this.portalItem?.portal || s4?.portal || null, o = O2[s4?.origin || ""] ?? "web-map", { populateOperationalLayers: i2 } = await import("./layersCreator-5GUIYQS3.js"), n3 = [];
    if (s2(t), e.baseMapLayers && Array.isArray(e.baseMapLayers)) {
      const t2 = { context: { ...s4, origin: o, url: r2, portal: a5, layerContainerType: "basemap-base-layers" }, defaultLayerType: "DefaultTileLayer" }, l4 = (e2) => "web-scene" === o && "ArcGISSceneServiceLayer" === e2.layerType || e2.isReference, p2 = i2(this.baseLayers, e.baseMapLayers.filter((e2) => !l4(e2)), t2);
      n3.push(p2);
      const c = i2(this.referenceLayers, e.baseMapLayers.filter(l4), t2);
      n3.push(c);
    }
    if (e.groundLayers && Array.isArray(e.groundLayers)) {
      const t2 = { context: { ...s4, origin: o, url: r2, portal: a5, layerContainerType: "basemap-ground-layers" }, defaultLayerType: "IntegratedMesh3DTilesLayer" }, l4 = i2(this.groundLayers, e.groundLayers, t2);
      n3.push(l4);
    }
    await Promise.allSettled(n3);
  }
  async _loadFromItem(e, r2) {
    const t = await e.load(r2), s4 = await t.fetchData("json", r2), a5 = I(e.itemUrl ?? "");
    return this._set("resourceInfo", { data: s4.baseMap ?? {}, context: { origin: M2[e.type || ""] ?? "web-map", portal: e.portal || M.getDefault(), url: a5 } }), this.read(this.resourceInfo.data, this.resourceInfo.context), this.read({ spatialReference: s4.spatialReference }, this.resourceInfo.context), this.read({ title: e.title, thumbnailUrl: e.thumbnailUrl }, { origin: "portal-item", portal: e.portal || M.getDefault(), url: a5 }), this._loadLayersFromJSON(this.resourceInfo.data, a5, r2);
  }
  async _loadFromStylesService(e, s4) {
    const a5 = e.serviceUrl.endsWith("/webmaps") ? e.serviceUrl.slice(0, -8) : e.serviceUrl, o = `${a5}/styles/${e.id}/self`, i2 = `${a5}/webmaps/${e.id}`, n3 = e.apiKey ?? s.apiKeys.basemapStyles, [l4, p2] = await Promise.all([(await H(o, { query: { token: n3 }, signal: s4?.signal })).data, (await H(i2, { query: { language: e.languageParameter, places: e.places, worldview: e.worldview, token: n3 }, signal: s4?.signal })).data]);
    this.thumbnailUrl ??= l4.thumbnailUrl;
    const c = I(i2);
    if (this._set("resourceInfo", { data: p2.baseMap ?? {}, context: { origin: "web-map", url: c } }), this.read(this.resourceInfo.data, this.resourceInfo.context), this.read({ spatialReference: p2.spatialReference }, this.resourceInfo.context), await this._loadLayersFromJSON(this.resourceInfo.data, c, s4), n3) for (const r2 of [...this.baseLayers, ...this.groundLayers, ...this.referenceLayers]) "apiKey" in r2 && (r2.apiKey = n3);
  }
  static fromId(e) {
    const r2 = a4[e];
    return r2 ? r2.itemId ? new $({ portalItem: { id: r2.itemId, portal: { url: "https://www.arcgis.com" } } }) : $.fromJSON(r2, r2.is3d ? { origin: "web-scene", portal: new M({ url: "https://www.arcgis.com" }) } : { origin: "web-map" }) : null;
  }
}, U = n2, $ = _a, _a.idCounter = 0, _a);
__decorate([m({ json: { read: false, write: { ignoreOrigin: true, target: "baseMapLayers", writer(e, r2, t, s4) {
  this._writeBaseLayers(e, r2, s4);
} }, origins: { "web-scene": { write: { ignoreOrigin: true, target: { baseMapLayers: { type: O } }, writer(e, r2, t, s4) {
  this._writeBaseLayers(e, r2, s4);
} } } } } })], x.prototype, "baseLayers", null), __decorate([m({ json: { read: false, write: { ignoreOrigin: true, target: "groundLayers", writer(e, r2, t, s4) {
  this._writeGroundLayers(e, r2, s4);
} }, origins: { "web-scene": { write: { ignoreOrigin: true, target: { groundLayers: { type: O } }, writer(e, r2, t, s4) {
  this._writeGroundLayers(e, r2, s4);
} } } } } })], x.prototype, "groundLayers", null), __decorate([m({ type: String, json: { origins: { "web-scene": { write: true } } } })], x.prototype, "id", void 0), __decorate([m({ type: k })], x.prototype, "portalItem", void 0), __decorate([m()], x.prototype, "referenceLayers", null), __decorate([m({ readOnly: true })], x.prototype, "resourceInfo", void 0), __decorate([m({ type: f })], x.prototype, "spatialReference", void 0), __decorate([m({ type: p })], x.prototype, "style", void 0), __decorate([m()], x.prototype, "thumbnailUrl", void 0), __decorate([m({ type: String, json: { origins: { "web-scene": { write: { isRequired: true } } } } })], x.prototype, "title", void 0), __decorate([r("title")], x.prototype, "writeTitle", null), x = $ = __decorate([a2("esri.Basemap")], x);
var M2 = { "Web Scene": "web-scene", "Web Map": "web-map", "Link Chart": "link-chart" };
var O2 = { "web-scene": "web-scene", "web-map": "web-map", "link-chart": "link-chart" };
var F = x;

export {
  F
};
//# sourceMappingURL=chunk-LRXVZGY2.js.map
