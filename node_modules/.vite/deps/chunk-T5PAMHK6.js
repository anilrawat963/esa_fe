import {
  n as n3
} from "./chunk-ALLCMCHO.js";
import {
  t
} from "./chunk-VIDAPS4J.js";
import {
  g,
  t as t2
} from "./chunk-EKM7KERW.js";
import {
  a2 as a3,
  u
} from "./chunk-WKTI47FV.js";
import {
  s as s3
} from "./chunk-4WTOIJXV.js";
import {
  f
} from "./chunk-GD4FJL3C.js";
import {
  n
} from "./chunk-MA3QDRC3.js";
import {
  O
} from "./chunk-YDTPM7OQ.js";
import {
  P
} from "./chunk-PZ5RULLK.js";
import {
  z
} from "./chunk-H74Q4SYB.js";
import {
  a as a2,
  l,
  w
} from "./chunk-2OFHDVO5.js";
import {
  c
} from "./chunk-AXZMNHTN.js";
import {
  n as n2
} from "./chunk-XXLHAM2M.js";
import {
  b,
  m,
  s2
} from "./chunk-5EI5H4QX.js";
import {
  a2 as a
} from "./chunk-ZIE53VIV.js";
import {
  __decorate
} from "./chunk-SS5CLIUY.js";
import {
  e
} from "./chunk-4DGC7CBY.js";
import {
  i3 as i,
  s2 as s
} from "./chunk-QY7XKUIV.js";

// node_modules/@arcgis/core/linkChart/utils.js
function e2(e4) {
  return null != e4 && "object" == typeof e4 && "2d" === e4.type && "linkchart" === e4.view2dType;
}

// node_modules/@arcgis/core/views/2d/layers/support/HighlightCounter.js
var i2 = class extends b {
  constructor() {
    super(...arguments), this._idToCounters = new s3();
  }
  get size() {
    return this._idToCounters.size;
  }
  get objectIds() {
    return this._idToCounters.keys();
  }
  get highlightNamesByObjectId() {
    return n4(this._idToCounters);
  }
  add(e4, t4) {
    let r = false;
    for (const s5 of e4) {
      const e5 = e(this._idToCounters, s5, () => (r = true, /* @__PURE__ */ new Map())), i4 = e5.get(t4) ?? 0;
      i4 || (r = true), e5.set(t4, i4 + 1);
    }
    return r;
  }
  delete(e4, t4) {
    let o = false;
    for (const r of e4) {
      const e5 = this._idToCounters.get(r);
      if (!e5) continue;
      let s5 = e5.get(t4);
      null != s5 && (s5--, s5 > 0 ? e5.set(t4, s5) : (e5.delete(t4), o = true), 0 === e5.size && (this._idToCounters.delete(r), o = true));
    }
    return o;
  }
};
function* n4(e4) {
  for (const [t4, o] of e4) yield [t4, o.keys()];
}
i2 = __decorate([a("esri.views.2d.layers.support.HighlightCounter")], i2);

// node_modules/@arcgis/core/views/layers/support/ClipArea.js
var t3 = class extends n2 {
  get version() {
    return this.commitVersionProperties(), (this._get("version") || 0) + 1;
  }
};
__decorate([m({ readOnly: true })], t3.prototype, "version", null), t3 = __decorate([a("esri.views.layers.support.ClipArea")], t3);

// node_modules/@arcgis/core/views/layers/support/ClipRect.js
var i3;
var s4 = i3 = class extends t3 {
  constructor(t4) {
    super(t4), this.type = "rect", this.left = null, this.right = null, this.top = null, this.bottom = null;
  }
  clone() {
    return new i3({ left: this.left, right: this.right, top: this.top, bottom: this.bottom });
  }
  commitVersionProperties() {
    this.commitProperty("left"), this.commitProperty("right"), this.commitProperty("top"), this.commitProperty("bottom");
  }
};
__decorate([m({ type: [Number, String], json: { write: true } })], s4.prototype, "left", void 0), __decorate([m({ type: [Number, String], json: { write: true } })], s4.prototype, "right", void 0), __decorate([m({ type: [Number, String], json: { write: true } })], s4.prototype, "top", void 0), __decorate([m({ type: [Number, String], json: { write: true } })], s4.prototype, "bottom", void 0), s4 = i3 = __decorate([a("esri.views.layers.support.ClipRect")], s4);

// node_modules/@arcgis/core/views/layers/support/Geometry.js
var y;
var c2 = { base: c, key: "type", typeMap: { extent: z, polygon: P } };
var n5 = y = class extends t3 {
  constructor(o) {
    super(o), this.type = "geometry", this.geometry = null;
  }
  clone() {
    return new y({ geometry: this.geometry?.clone() ?? null });
  }
  commitVersionProperties() {
    this.commitProperty("geometry");
  }
};
__decorate([m({ types: c2, json: { read: f, write: true } })], n5.prototype, "geometry", void 0), n5 = y = __decorate([a("esri.views.layers.support.Geometry")], n5);

// node_modules/@arcgis/core/views/layers/support/Path.js
var e3 = class extends t3 {
  constructor(r) {
    super(r), this.type = "path", this.path = [];
  }
  commitVersionProperties() {
    this.commitProperty("path");
  }
};
__decorate([m({ type: [[[Number]]], json: { write: true } })], e3.prototype, "path", void 0), e3 = __decorate([a("esri.views.layers.support.Path")], e3);

// node_modules/@arcgis/core/views/2d/layers/LayerView2D.js
var S = O.ofType({ key: "type", base: null, typeMap: { rect: s4, path: e3, geometry: n5 } });
var H = new (O.ofType(u))();
var b2 = (y2) => {
  const v = y2;
  let w2 = class extends v {
    constructor() {
      super(...arguments), this._highlightCounter = new i2(), this.attached = false, this.clips = new S(), this.highlights = null, this.lastUpdateId = -1, this.moving = false, this.updateRequested = false, this._visibleAtCurrentScale = true;
    }
    initialize() {
      const t4 = this.view?.spatialReferenceLocked ?? true, e4 = this.view?.spatialReference;
      e4 && t4 && !this.spatialReferenceSupported ? this.addResolvingPromise(Promise.reject(new s("layerview:spatial-reference-incompatible", "The spatial reference of this layer does not meet the requirements of the view", { layer: this.layer }))) : (this.container || (this.container = new n3()), this.container.fadeTransitionEnabled = true, this.container.visible = false, this.container.endTransitions(), this.addHandles([l(() => this.suspended, (t5) => {
        this.container && (this.container.visible = !t5);
      }, w), l(() => this.updateSuspended, (t5) => {
        this.view && !t5 && this.updateRequested && this.view.requestUpdate();
      }, w), l(() => this.layer?.opacity ?? 1, (t5) => {
        this.container && (this.container.opacity = t5);
      }, w), l(() => this.layer && "blendMode" in this.layer ? this.layer.blendMode : "normal", (t5) => {
        this.container && (this.container.blendMode = t5);
      }, w), l(() => this.layer && "effect" in this.layer ? this.layer.effect : null, (t5) => {
        this.container && (this.container.effect = t5);
      }, w), l(() => this._mergedHighlights.items.map((t5) => ({ name: t5.name, options: { fillColor: t5.color, haloColor: t5.haloColor, fillOpacity: t5.fillOpacity, haloOpacity: t5.haloOpacity, haloWidth: t5.haloWidth, haloBlur: t5.haloBlur } })), () => {
        this.container.highlightGradient = a3(this.container.highlightGradient, this._mergedHighlights.items);
      }, w), l(() => this._mergedHighlights.items.map((t5) => t5.name), () => {
        this._processHighlight();
      }), a2(() => this.clips, "change", () => {
        this.container && (this.container.clips = this.clips);
      }, w), l(() => ({ scale: this.view?.scale, scaleRange: this.layer && "effectiveScaleRange" in this.layer ? this.layer.effectiveScaleRange : null }), ({ scale: t5, scaleRange: e5 }) => {
        const i4 = t(e5, t5);
        i4 !== this._visibleAtCurrentScale && (this._visibleAtCurrentScale = i4);
      }, w)], "constructor"), this.view?.whenLayerView ? this.view.whenLayerView(this.layer).then((t5) => {
        t5 === this && this.processAttach();
      }, () => {
      }) : this.when().then(() => {
        this.processAttach();
      }, () => {
      }));
    }
    destroy() {
      this.processDetach(), this.updateRequested = false;
    }
    get highlightOptions() {
      return this._logHighlightOptionsDeprecation(), t2(this);
    }
    set highlightOptions(t4) {
      this._logHighlightOptionsDeprecation(), g(this, t4);
    }
    _logHighlightOptionsDeprecation() {
      s2(i.getLogger(this), "`LayerView.highlightOptions` is deprecated in favor of View.highlights", { replacement: "View.highlights", version: "4.34", see: "https://arcg.is/inbTa1#highlights", warnOnce: true });
    }
    get hasHighlight() {
      return this._highlightCounter.size > 0;
    }
    get _mergedHighlights() {
      if (!this.view) return H;
      if (!this.highlights) return this.view.highlights;
      const t4 = this.view.highlights.clone();
      for (const e4 of this.highlights) {
        const i4 = t4.find((t5) => t5.name === e4.name);
        i4 && i4.assignFrom(e4);
      }
      return t4;
    }
    get highlightIds() {
      return Array.from(this._highlightCounter.objectIds);
    }
    get scheduler() {
      return this.view.scheduler;
    }
    get spatialReferenceSupported() {
      const t4 = this.view?.spatialReference;
      return null == t4 || this.supportsSpatialReference(t4);
    }
    get updating() {
      return this.spatialReferenceSupported && (!this.attached || !this.suspended && (this.updateRequested || this.isUpdating()) || !!this._updatingHandles?.updating || this.container.transitioning);
    }
    get visibleAtCurrentScale() {
      return this._visibleAtCurrentScale;
    }
    processAttach() {
      this.isResolved() && !this.attached && !this.destroyed && this.spatialReferenceSupported && (this.attach(), this.attached = true, this.requestUpdate());
    }
    processDetach() {
      this.attached && (this.attached = false, this.removeHandles("attach"), this.detach(), this.updateRequested = false);
    }
    requestUpdate() {
      this.destroyed || this.updateRequested || (this.updateRequested = true, this.updateSuspended || this.view.requestUpdate());
    }
    processUpdate(t4) {
      !this.isFulfilled() || this.isResolved() ? (this._set("updateParameters", t4), this.updateRequested && !this.updateSuspended && (this.updateRequested = false, this.update(t4))) : this.updateRequested = false;
    }
    hitTest(t4, e4) {
      return Promise.resolve(null);
    }
    supportsSpatialReference(t4) {
      return true;
    }
    canResume() {
      if (!this.spatialReferenceSupported) return false;
      switch (this.layer?.type) {
        case "link-chart":
        case "knowledge-graph-sublayer":
        case "graphics":
          break;
        default:
          if (e2(this.view) && !this.view.inGeographicLayout) return false;
      }
      return !!super.canResume() && this.visibleAtCurrentScale;
    }
    getSuspendInfo() {
      const t4 = super.getSuspendInfo(), e4 = !this.spatialReferenceSupported;
      return e4 && (t4.spatialReferenceNotSupported = e4), t4;
    }
    addAttachHandles(t4) {
      this.addHandles(t4, "attach");
    }
    _addHighlights(t4, e4) {
      this._highlightCounter.add(t4, e4) && this._processHighlight();
    }
    _removeHighlights(t4, e4) {
      this._highlightCounter.delete(t4, e4) && this._processHighlight();
    }
    _processHighlight() {
    }
    _getHighlights() {
      const t4 = [];
      for (const [e4, i4] of this._highlightCounter.highlightNamesByObjectId) {
        const s5 = this._getHighlightBits(i4);
        t4.push({ objectId: e4, highlightFlags: s5 });
      }
      return t4;
    }
    _getHighlightBits(t4) {
      const e4 = new Set(t4);
      let i4 = 1, s5 = 0;
      if (!this.view) return 0;
      const r = this._mergedHighlights;
      for (const { name: h } of r) e4.delete(h) && (s5 = i4), i4 <<= 1;
      return s5;
    }
  };
  return __decorate([m()], w2.prototype, "attached", void 0), __decorate([m({ type: S, set(t4) {
    const e4 = n(t4, this._get("clips"), S);
    this._set("clips", e4);
  } })], w2.prototype, "clips", void 0), __decorate([m()], w2.prototype, "container", void 0), __decorate([m({ type: u })], w2.prototype, "highlightOptions", null), __decorate([m({ type: O.ofType(u) })], w2.prototype, "highlights", void 0), __decorate([m()], w2.prototype, "_mergedHighlights", null), __decorate([m()], w2.prototype, "moving", void 0), __decorate([m({ readOnly: true })], w2.prototype, "spatialReferenceSupported", null), __decorate([m({ readOnly: true })], w2.prototype, "updateParameters", void 0), __decorate([m()], w2.prototype, "updateRequested", void 0), __decorate([m()], w2.prototype, "updating", null), __decorate([m()], w2.prototype, "view", void 0), __decorate([m()], w2.prototype, "_visibleAtCurrentScale", void 0), __decorate([m({ readOnly: true })], w2.prototype, "visibleAtCurrentScale", null), w2 = __decorate([a("esri.views.2d.layers.LayerView2D")], w2), w2;
};

export {
  n5 as n,
  b2 as b
};
//# sourceMappingURL=chunk-T5PAMHK6.js.map
