{
  "version": 3,
  "sources": ["../../@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl.js", "../../@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/util/NoPerspective.glsl.js", "../../@arcgis/core/views/3d/support/engineContent/marker.js", "../../@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/MarkerSizing.glsl.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{invert as e,translate as i}from\"../../../../../../core/libs/gl-matrix-2/math/mat4.js\";import{create as a}from\"../../../../../../core/libs/gl-matrix-2/factories/mat4f64.js\";import{VisualVariables as t}from\"../shading/VisualVariables.glsl.js\";import{ScreenSizePerspective as r,addScreenSizePerspective as o}from\"../util/ScreenSizePerspective.glsl.js\";import{addCameraPosition as c}from\"../util/View.glsl.js\";import{Float3PassUniform as l}from\"../../shaderModules/Float3PassUniform.js\";import{FloatPassUniform as s}from\"../../shaderModules/FloatPassUniform.js\";import{FloatsPassUniform as v}from\"../../shaderModules/FloatsPassUniform.js\";import{glsl as n,If as p}from\"../../shaderModules/glsl.js\";import{Matrix4DrawUniform as d}from\"../../shaderModules/Matrix4DrawUniform.js\";const u=8;function f(a,f){const{vertex:S,attributes:m}=a;S.uniforms.add(new s(\"intrinsicWidth\",e=>e.width));const{hasScreenSizePerspective:y,spherical:O}=f;y?(a.include(r,f),o(S),c(S,f),S.uniforms.add(new d(\"inverseViewMatrix\",(a,t)=>e(z,i(z,t.camera.viewMatrix,a.origin)))),S.code.add(n`\n      float applyLineSizeScreenSizePerspective(float size, vec3 pos) {\n        vec3 worldPos = (inverseViewMatrix * vec4(pos, 1)).xyz;\n        vec3 groundUp = ${O?n`normalize(worldPos + localOrigin)`:n`vec3(0.0, 0.0, 1.0)`};\n        float absCosAngle = abs(dot(groundUp, normalize(worldPos - cameraPosition)));\n\n        return screenSizePerspectiveScaleFloat(size, absCosAngle, length(pos), screenSizePerspective);\n      }\n    `)):S.code.add(n`float applyLineSizeScreenSizePerspective(float size, vec3 pos) {\nreturn size;\n}`),f.hasVVSize?(m.add(\"sizeFeatureAttribute\",\"float\"),S.uniforms.add(new l(\"vvSizeMinSize\",e=>e.vvSize.minSize),new l(\"vvSizeMaxSize\",e=>e.vvSize.maxSize),new l(\"vvSizeOffset\",e=>e.vvSize.offset),new l(\"vvSizeFactor\",e=>e.vvSize.factor),new l(\"vvSizeFallback\",e=>e.vvSize.fallback)),S.code.add(n`\n    float getSize(${p(y,\"vec3 pos\")}) {\n      float size = isnan(sizeFeatureAttribute)\n        ? vvSizeFallback.x\n        : intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;\n\n      return ${p(y,\"applyLineSizeScreenSizePerspective(size, pos)\",\"size\")};\n    }\n    `)):(m.add(\"size\",\"float\"),S.code.add(n`\n    float getSize(${p(y,\"vec3 pos\")}) {\n      float fullSize = intrinsicWidth * size;\n      return ${p(y,\"applyLineSizeScreenSizePerspective(fullSize, pos)\",\"fullSize\")};\n    }\n    `)),f.hasVVOpacity?(m.add(\"opacityFeatureAttribute\",\"float\"),S.constants.add(\"vvOpacityNumber\",\"int\",8),S.uniforms.add(new v(\"vvOpacityValues\",e=>e.vvOpacity.values,u),new v(\"vvOpacityOpacities\",e=>e.vvOpacity.opacityValues,u),new s(\"vvOpacityFallback\",e=>e.vvOpacity.fallback,{supportsNaN:!0})),S.code.add(n`\n    float interpolateOpacity(float value) {\n      if (value <= vvOpacityValues[0]) {\n        return vvOpacityOpacities[0];\n      }\n\n      for (int i = 1; i < vvOpacityNumber; ++i) {\n        if (vvOpacityValues[i] >= value) {\n          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\n          return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);\n        }\n      }\n\n      return vvOpacityOpacities[vvOpacityNumber - 1];\n    }\n\n    vec4 applyOpacity(vec4 color) {\n      if (isnan(opacityFeatureAttribute)) {\n        // If there is a color vv then it will already have taken care of applying the fallback\n        return ${p(f.hasVVColor,\"color\",\"vec4(color.rgb, vvOpacityFallback)\")};\n      }\n\n      return vec4(color.rgb, interpolateOpacity(opacityFeatureAttribute));\n    }\n    `)):S.code.add(n`vec4 applyOpacity(vec4 color) {\nreturn color;\n}`),f.hasVVColor?(a.include(t,f),m.add(\"colorFeatureAttribute\",\"float\"),S.code.add(n`vec4 getColor() {\nvec4 color = interpolateVVColor(colorFeatureAttribute);\nif (isnan(color.r)) {\nreturn vec4(0);\n}\nreturn applyOpacity(color);\n}`)):(m.add(\"color\",\"vec4\"),S.code.add(n`vec4 getColor() {\nreturn applyOpacity(color);\n}`))}const z=a();export{f as RibbonVertexPosition};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nfunction e(e){e.vertex.code.add(\"#define noPerspectiveWrite(x, w) (x * w)\")}function d(e){e.fragment.code.add(\"#define noPerspectiveRead(x) (x * gl_FragCoord.w)\")}export{d as NoPerspectiveRead,e as NoPerspectiveWrite};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{createPrimitive as r}from\"./sdfPrimitives.js\";import{SizedPixelFormat as e,PixelType as t}from\"../../../webgl/enums.js\";import{Texture as o}from\"../../../webgl/Texture.js\";import{TextureDescriptor as m}from\"../../../webgl/TextureDescriptor.js\";const i=64,s=i/2,n=s/5,p=i/n,a=.25;function f(p,a){const f=r(p,i,s,n),u=new m(i);return u.internalFormat=e.R16F,u.dataType=t.FLOAT,u.pixelFormat=6403,u.wrapMode=33071,new o(a,u,f)}export{f as createMarkerTexture,p as markerSizePerLineWidth,s as markerSymbolSize,i as markerTextureSize,n as markerThickness,a as markerTipThicknessFactor};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{markerSizePerLineWidth as e}from\"../../../../support/engineContent/marker.js\";import{addPixelRatio as r}from\"../util/View.glsl.js\";import{FloatBindUniform as t}from\"../../shaderModules/FloatBindUniform.js\";import{If as o,glsl as a}from\"../../shaderModules/glsl.js\";function i(i,n){const d=i.vertex,l=n.hasScreenSizePerspective;r(d),null==d.uniforms.get(\"markerScale\")&&d.constants.add(\"markerScale\",\"float\",1),d.constants.add(\"markerSizePerLineWidth\",\"float\",e).code.add(a`\n  float getLineWidth(${o(l,\"vec3 pos\")}) {\n     return max(getSize(${o(l,\"pos\")}), 1.0) * pixelRatio;\n  }\n\n  float getScreenMarkerSize(float lineWidth) {\n    return markerScale * markerSizePerLineWidth * lineWidth;\n  }\n  `),2===n.space&&(d.constants.add(\"maxSegmentLengthFraction\",\"float\",.45),d.uniforms.add(new t(\"perRenderPixelRatio\",e=>e.camera.perRenderPixelRatio)),d.code.add(a`\n  bool areWorldMarkersHidden(vec3 pos, vec3 other) {\n    vec3 midPoint = mix(pos, other, 0.5);\n    float distanceToCamera = length(midPoint);\n    float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;\n    float worldMarkerSize = getScreenMarkerSize(getLineWidth(${o(l,\"pos\")})) * screenToWorldRatio;\n    float segmentLen = length(pos - other);\n    return worldMarkerSize > maxSegmentLengthFraction * segmentLen;\n  }\n\n  float getWorldMarkerSize(vec3 pos) {\n    float distanceToCamera = length(pos);\n    float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;\n    return getScreenMarkerSize(getLineWidth(${o(l,\"pos\")})) * screenToWorldRatio;\n  }\n  `))}export{i as MarkerSizing};\n"],
  "mappings": "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",
  "names": ["u", "a", "f", "r", "e", "t", "e", "d", "i", "s", "n", "i", "n", "d", "e"]
}
