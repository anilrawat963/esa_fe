{
  "version": 3,
  "sources": ["../../@arcgis/core/versionManagement/support/versionManagementUtils.js", "../../@arcgis/core/layers/mixins/EditBusLayer.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport e from\"../../request.js\";import{generateLowercaseBracedUUID as r}from\"../../core/uuid.js\";const t=r(),n=new Map,s=new Map,a=new Map;async function o(r,t,s){if(!r||!s)return!1;if(!t)return!0;const a=new URL(r).host;let o=n.get(a);if(!o){const t=r.replace(/\\/FeatureServer/i,\"/VersionManagementServer\").replace(/\\/\\d*$/,\"\");o=(await e(t,{responseType:\"json\",query:{f:\"json\"}})).data.defaultVersionName}return o===t}async function i(e,r,n=!1){if(!e||!r)return!0;const a=e.replace(/\\/FeatureServer/i,\"/VersionManagementServer\").replace(/\\/\\d*$/,\"\"),o=s.get(a)?.entries();if(o)for(const[s,i]of o)if(i.name===r){const e=!i.stack?.hasForwardEdits();if(!e&&n){const[{deleteForwardEdits:e},{default:r}]=await Promise.all([import(\"../../rest/versionManagement/gdbVersion/deleteForwardEdits.js\"),import(\"../../rest/versionManagement/gdbVersion/support/DeleteForwardEditsParameters.js\")]),n=await e(a,s,new r({sessionId:t,moment:i.moment}));return n.success&&i.stack?.clearForwardEdits(),n.success}return e}return!0}function c(e,r){if(!e)return!1;const t=e.replace(/\\/FeatureServer/i,\"/VersionManagementServer\").replace(/\\/\\d*$/,\"\"),n=s.get(t)?.entries();if(n)for(const[s,a]of n)if(a.name===r){return\"edit\"===a.lockType}return!1}export{t as currentSessionId,n as defaultVersionNameLookup,o as isHistoricVersion,i as isSafeToEditVersion,c as isVersionInEditSession,s as versionCollection,a as versionCollectionCount};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{__decorate as t}from\"tslib\";import{EventEmitter as e}from\"../../core/Evented.js\";import{clone as i}from\"../../core/lang.js\";import{createResolver as s}from\"../../core/promiseUtils.js\";import{property as r}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/Logger.js\";import{subclass as d}from\"../../core/accessorSupport/decorators/subclass.js\";import{isVersionInEditSession as o,defaultVersionNameLookup as n}from\"../../versionManagement/support/versionManagementUtils.js\";const a=new e;function l(t){return a.on(\"apply-edits\",new WeakRef(t))}function h(t){return a.on(\"update-moment\",new WeakRef(t))}function c(t,e,i=null,r=!1){const d=s();return r=null==e||r,a.emit(\"apply-edits\",{serviceUrl:t,layerId:e,gdbVersion:i,mayReceiveServiceEdits:r,result:d.promise}),d}function u(t,e,i=null,s){a.emit(\"update-moment\",{serviceUrl:t,layerId:e,gdbVersion:i,moment:s})}const m=Symbol();function p(t){return null!=t&&\"object\"==typeof t&&m in t}function b(t){return null!=t&&\"object\"==typeof t&&\"gdbVersion\"in t}function g(t,e,i){const s=new URL(t).host,r=n.get(s),d=t=>!t||t===r;return d(e)&&d(i)||e===i}const F=e=>{var s;const n=e;let a=class extends n{static{s=m}constructor(...t){super(...t),this[s]=!0,this._applyEditsHandler=t=>{const{serviceUrl:e,layerId:s,gdbVersion:r,mayReceiveServiceEdits:d,result:o}=t,n=e===this.url,a=null!=s&&null!=this.layerId&&s===this.layerId,l=b(this),h=b(this)&&g(e,r,this.gdbVersion);if(!n||l&&!h||!a&&!d)return;const c=o.then(t=>{if(this.lastEditsEventDate=new Date,a&&(t.addedFeatures.length||t.updatedFeatures.length||t.deletedFeatures.length||t.addedAttachments.length||t.updatedAttachments.length||t.deletedAttachments.length))return this.emit(\"edits\",i(t)),t;const s=t.editedFeatures?.find(({layerId:t})=>t===this.layerId);if(s){const{adds:e,updates:r,deletes:d}=s.editedFeatures,o={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:e?e.map(({attributes:t})=>({objectId:this.objectIdField&&t[this.objectIdField],globalId:this.globalIdField&&t[this.globalIdField]})):[],deletedFeatures:d?d.map(({attributes:t})=>({objectId:this.objectIdField&&t[this.objectIdField],globalId:this.globalIdField&&t[this.globalIdField]})):[],updatedFeatures:r?r.map(({current:{attributes:t}})=>({objectId:this.objectIdField&&t[this.objectIdField],globalId:this.globalIdField&&t[this.globalIdField]})):[],editedFeatures:i(t.editedFeatures),exceededTransferLimit:!1,historicMoment:i(t.historicMoment)};return this.emit(\"edits\",o),o}const d={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:i(t.editedFeatures),exceededTransferLimit:!1,historicMoment:i(t.historicMoment)};return\"historicMoment\"in this&&this._shouldUpdateHistoricMoment(e,r,d.historicMoment)&&this.emit(\"edits\",d),d}).then(t=>(\"historicMoment\"in this&&this._shouldUpdateHistoricMoment(e,r,t.historicMoment)&&(this.historicMoment=t.historicMoment),t));this.emit(\"apply-edits\",{result:c})},this._updateMomentHandler=t=>{const{serviceUrl:e,gdbVersion:i,moment:s}=t,r=e===this.url,d=b(this),o=b(this)&&g(e,i,this.gdbVersion),n=b(this)&&!g(e,this.gdbVersion,null);r&&d&&o&&n&&\"historicMoment\"in this&&this.historicMoment!==s&&(this.historicMoment=s)},this.when().then(()=>{this.addHandles(l(this._applyEditsHandler)),\"historicMoment\"in this&&this.addHandles(h(this._updateMomentHandler))},()=>{})}_shouldUpdateHistoricMoment(t,e,i){return\"historicMoment\"in this&&this.historicMoment!==i&&o(t,e)}};return t([r()],a.prototype,\"lastEditsEventDate\",void 0),a=t([d(\"esri.layers.mixins.EditBusLayer\")],a),a};export{F as EditBusLayer,c as emitApplyEditsEvent,u as emitUpdateMomentEvent,p as isEditBusLayer,b as isLayerWithGDBVersion,l as onApplyEditsEvent,h as onUpdateMomentEvent,g as versionMatches};\n"],
  "mappings": "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",
  "names": ["o", "t", "s", "a", "i", "n", "e", "r", "a", "t", "c", "i", "m", "t", "i", "s", "n", "a", "e", "o", "l", "h", "c", "r", "d"]
}
