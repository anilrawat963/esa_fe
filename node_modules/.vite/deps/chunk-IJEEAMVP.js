import {
  i2 as i3,
  t as t2
} from "./chunk-43423NKQ.js";
import {
  e as e2
} from "./chunk-ALLCMCHO.js";
import {
  h as h3
} from "./chunk-7LPDSYJP.js";
import {
  r as r2
} from "./chunk-QTS3W27E.js";
import {
  o as o2
} from "./chunk-3RABUJDL.js";
import {
  U2 as U,
  _ as _4
} from "./chunk-NQDCX3PB.js";
import {
  x
} from "./chunk-QW7RJMQR.js";
import {
  $
} from "./chunk-JPZOLUPV.js";
import {
  n
} from "./chunk-ALR6N4CF.js";
import {
  t
} from "./chunk-4X4BOGIG.js";
import {
  e
} from "./chunk-WKTI47FV.js";
import {
  A,
  h as h2
} from "./chunk-U55FA2EK.js";
import {
  r
} from "./chunk-UYMV6HXW.js";
import {
  R,
  _ as _2
} from "./chunk-QNVJVDYZ.js";
import {
  _ as _3
} from "./chunk-C3FRY5U4.js";
import {
  M,
  b as b2,
  f,
  h,
  i as i2,
  l as l2,
  o
} from "./chunk-LTPHDYPK.js";
import {
  z
} from "./chunk-H74Q4SYB.js";
import {
  l
} from "./chunk-2OFHDVO5.js";
import {
  u
} from "./chunk-CSMCPN64.js";
import {
  s as s2
} from "./chunk-SMWUT52Z.js";
import {
  _
} from "./chunk-AXZMNHTN.js";
import {
  b,
  m
} from "./chunk-5EI5H4QX.js";
import {
  a2 as a
} from "./chunk-ZIE53VIV.js";
import {
  __decorate
} from "./chunk-SS5CLIUY.js";
import {
  d,
  s
} from "./chunk-GNMPGHLQ.js";
import {
  i3 as i
} from "./chunk-QY7XKUIV.js";

// node_modules/@arcgis/core/views/2d/engine/flow/utils.js
function i4(t4) {
  const n3 = o3(r3(t4)), i6 = n3, s7 = true, a5 = Math.max(n3 / 2, 5), l6 = Math.round(u(t4.maxPathLength) / a5) + 1, u4 = 10, { density: c4 } = t4;
  return { smoothing: u(t4.smoothing), interpolate: true, velocityScale: "flow-from" === t4.flowRepresentation ? 1 : -1, verticesPerLine: l6, minSpeedThreshold: 1e-3, segmentLength: a5, maxTurnAngle: 1, collisions: s7, lineCollisionWidth: i6, lineSpacing: u4, density: c4, onlyForwardTracing: true, wrapAround: false };
}
function o3(e4) {
  return "constant" === e4.kind ? e4.value[0] : e4.values[e4.values.length - 1];
}
function s3(e4) {
  const t4 = e4.toRgba();
  return [t4[0] / 255, t4[1] / 255, t4[2] / 255, t4[3]];
}
function a3(e4) {
  return { kind: "constant", value: [0.1, 0.1, 0.1, 1] };
}
function r3(t4) {
  if (!t4.hasVisualVariables("size")) return { kind: "constant", value: [u(t4.trailWidth)] };
  const n3 = t4.getVisualVariablesForType("size")[0], i6 = [], o6 = [];
  let s7;
  if (n3.stops) {
    for (const t5 of n3.stops) i6.push(t5.value), o6.push(u(t5.size));
    s7 = n3.stops.length;
  } else i6.push(n3.minDataValue, n3.maxDataValue), o6.push(u(n3.minSize), u(n3.maxSize)), s7 = 2;
  return { kind: "ramp", stops: i6, values: o6, count: s7 };
}
function l3(e4) {
  if (!e4.hasVisualVariables("color")) return { kind: "constant", value: s3(e4.color) };
  const t4 = e4.getVisualVariablesForType("color")[0], n3 = [], i6 = [];
  for (const o6 of t4.stops) n3.push(o6.value), Array.prototype.push.apply(i6, s3(o6.color));
  return { kind: "ramp", stops: n3, values: i6, count: t4.stops.length };
}
function u2(e4) {
  if (!e4.hasVisualVariables("opacity")) return { kind: "constant", value: [1] };
  const t4 = e4.getVisualVariablesForType("opacity")[0], n3 = [], i6 = [];
  for (const o6 of t4.stops) n3.push(o6.value), i6.push(o6.opacity);
  return { kind: "ramp", stops: n3, values: i6, count: t4.stops.length };
}
function c(e4, t4, n3, i6) {
  switch (t4) {
    case "int":
      e4.setUniform1iv(n3, i6);
      break;
    case "float":
      e4.setUniform1fv(n3, i6);
      break;
    case "vec2":
      e4.setUniform2fv(n3, i6);
      break;
    case "vec3":
      e4.setUniform3fv(n3, i6);
      break;
    case "vec4":
      e4.setUniform4fv(n3, i6);
  }
}
function m2(e4, t4, n3, i6) {
  "constant" === i6.kind ? c(e4, n3, `u_${t4}`, i6.value) : (c(e4, "float", `u_${t4}_stops`, i6.stops), c(e4, n3, `u_${t4}_values`, i6.values), e4.setUniform1i(`u_${t4}_count`, i6.count));
}
function p(e4, t4) {
  let n3 = true;
  return n3 = n3 && e4.collisions === t4.collisions, n3 = n3 && e4.density === t4.density, n3 = n3 && e4.interpolate === t4.interpolate, n3 = n3 && e4.lineCollisionWidth === t4.lineCollisionWidth, n3 = n3 && e4.lineSpacing === t4.lineSpacing, n3 = n3 && e4.maxTurnAngle === t4.maxTurnAngle, n3 = n3 && e4.minSpeedThreshold === t4.minSpeedThreshold, n3 = n3 && e4.segmentLength === t4.segmentLength, n3 = n3 && e4.smoothing === t4.smoothing, n3 = n3 && e4.velocityScale === t4.velocityScale, n3 = n3 && e4.verticesPerLine === t4.verticesPerLine, n3;
}
function f3(e4, t4) {
  return e4 === t4 || null != e4 && null != t4 && e4.equals(t4);
}
function h4(e4, t4) {
  if (!p(e4.simulationSettings, t4.simulationSettings)) return false;
  if (!f3(e4.timeExtent, t4.timeExtent)) return false;
  let n3 = true;
  return n3 = n3 && e4.loadImagery === t4.loadImagery, n3 = n3 && e4.createFlowMesh === t4.createFlowMesh, n3 = n3 && e4.color.kind === t4.color.kind, n3 = n3 && e4.opacity.kind === t4.opacity.kind, n3 = n3 && e4.size.kind === t4.size.kind, n3;
}

// node_modules/@arcgis/core/views/2d/engine/flow/styles/Imagery.js
var c2 = class _c {
  constructor(t4) {
    this._params = t4, this.animated = false;
  }
  isCompatible(t4) {
    if (!(t4 instanceof _c)) return false;
    if (!f3(this._params.timeExtent, t4._params.timeExtent)) return false;
    let a5 = true;
    return a5 = a5 && this._params.loadImagery === t4._params.loadImagery, a5 = a5 && this._params.color.kind === t4._params.color.kind, a5 = a5 && this._params.opacity.kind === t4._params.opacity.kind, a5;
  }
  async load(r5, a5) {
    const { extent: e4, size: s7 } = r5;
    s(a5);
    const o6 = await this._params.loadImagery(e4, s7[0], s7[1], this._params.timeExtent, a5);
    return new _5(o6, { color: this._params.color, opacity: this._params.opacity });
  }
  render(t4, r5, s7) {
    const { context: o6 } = t4, { program: i6 } = s7;
    o6.setFaceCullingEnabled(false), o6.setBlendingEnabled(true), o6.setBlendFunction(1, 771), o6.useProgram(i6), i6.setUniformMatrix3fv("u_dvsMat3", r5.dvsMat3), o6.bindTexture(s7.texture, 0), i6.setUniform1i("u_texture", 0), i6.setUniform1f("u_Min", s7.min), i6.setUniform1f("u_Max", s7.max), m2(i6, "color", "vec4", this._params.color), m2(i6, "opacity", "float", this._params.opacity), o6.bindVAO(s7.vertexArray), o6.drawArrays(_2.TRIANGLE_STRIP, 0, 4);
  }
};
var h5 = [new t("a_position", 2, R.UNSIGNED_SHORT, 0, 8), new t("a_texcoord", 2, R.UNSIGNED_SHORT, 4, 8)];
var f4 = { vsPath: "raster/flow/imagery", fsPath: "raster/flow/imagery", locations: n(h5) };
var _5 = class {
  constructor(t4, r5) {
    this._flowData = t4, this._values = r5;
  }
  attach(t4) {
    const { context: r5 } = t4, { width: a5, height: e4 } = this._flowData, s7 = new r2(r5, h5, new Uint16Array([0, 0, 0, 1, a5, 0, 1, 1, 0, e4, 0, 0, a5, e4, 1, 0])), m5 = new h3(r5, s7), p3 = [];
    "ramp" === this._values.color.kind && p3.push("vvColor"), "ramp" === this._values.opacity.kind && p3.push("vvOpacity");
    const c4 = t4.getProgram(f4, p3);
    let _7 = 1e6, d5 = -1e6;
    for (let o6 = 0; o6 < e4; o6++) for (let t5 = 0; t5 < a5; t5++) if (0 !== this._flowData.mask[o6 * a5 + t5]) {
      const r6 = this._flowData.data[2 * (o6 * a5 + t5)], e5 = this._flowData.data[2 * (o6 * a5 + t5) + 1], s8 = Math.sqrt(r6 * r6 + e5 * e5);
      _7 = Math.min(_7, s8), d5 = Math.max(d5, s8);
    }
    const u4 = new Uint8Array(4 * a5 * e4);
    for (let o6 = 0; o6 < e4; o6++) for (let t5 = 0; t5 < a5; t5++) if (0 !== this._flowData.mask[o6 * a5 + t5]) {
      const r6 = this._flowData.data[2 * (o6 * a5 + t5)], e5 = this._flowData.data[2 * (o6 * a5 + t5) + 1], s8 = (Math.sqrt(r6 * r6 + e5 * e5) - _7) / (d5 - _7);
      u4[4 * (o6 * a5 + t5)] = 255 * s8, u4[4 * (o6 * a5 + t5) + 1] = 0, u4[4 * (o6 * a5 + t5) + 2] = 0, u4[4 * (o6 * a5 + t5) + 3] = 255;
    } else u4[4 * (o6 * a5 + t5)] = 0, u4[4 * (o6 * a5 + t5) + 1] = 0, u4[4 * (o6 * a5 + t5) + 2] = 0, u4[4 * (o6 * a5 + t5) + 3] = 0;
    const w = new h2(a5, e4);
    w.internalFormat = 6408, w.wrapMode = 33071, w.flipped = true;
    const x2 = new A(r5, w, u4);
    this.vertexArray = m5, this.program = c4, this.texture = x2, this.min = _7, this.max = d5, this._flowData = null;
  }
  detach() {
    this.vertexArray.dispose(), this.texture.dispose();
  }
  get ready() {
    return this.program.compiled;
  }
};

// node_modules/@arcgis/core/views/2d/engine/flow/styles/Particles.js
var l4 = class _l {
  constructor(t4) {
    this._params = t4;
  }
  get animated() {
    return this._params.flowSpeed > 0;
  }
  isCompatible(t4) {
    return t4 instanceof _l && h4(this._params, t4._params);
  }
  async load(e4, a5) {
    const { extent: r5, size: s7 } = e4;
    s(a5);
    const i6 = await this._params.loadImagery(r5, s7[0], s7[1], this._params.timeExtent, a5), { vertexData: o6, indexData: n3 } = await this._params.createFlowMesh("Particles", this._params.simulationSettings, i6, a5);
    return new c3(o6, n3, { color: this._params.color, opacity: this._params.opacity, size: this._params.size });
  }
  render(t4, e4, r5) {
    const { context: o6 } = t4, { program: n3 } = r5;
    o6.setFaceCullingEnabled(false), o6.setBlendingEnabled(true), o6.setBlendFunction(1, 771), o6.useProgram(n3), n3.setUniform1f("u_time", e4.time), n3.setUniform1f("u_trailLength", this._params.trailLength), n3.setUniform1f("u_flowSpeed", this._params.flowSpeed), n3.setUniform1f("u_featheringSize", this._params.featheringSize), n3.setUniform1f("u_featheringOffset", this._params.featheringOffset), n3.setUniform1f("u_introFade", this._params.introFade ? 1 : 0), n3.setUniform1f("u_fadeToZero", this._params.fadeToZero ? 1 : 0), n3.setUniform1f("u_decayRate", this._params.decayRate), n3.setUniformMatrix3fv("u_dvsMat3", e4.dvsMat3), n3.setUniformMatrix3fv("u_displayViewMat3", e4.displayViewMat3), m2(n3, "color", "vec4", this._params.color), m2(n3, "opacity", "float", this._params.opacity), m2(n3, "size", "float", this._params.size), o6.bindVAO(r5.vertexArray), o6.drawElements(_2.TRIANGLES, r5.indexCount, R.UNSIGNED_INT, 0);
  }
};
var f5 = [new t("a_xyts0", 4, R.FLOAT, 0, 64), new t("a_xyts1", 4, R.FLOAT, 16, 64), new t("a_typeIdDurationSeed", 4, R.FLOAT, 32, 64), new t("a_extrudeInfo", 4, R.FLOAT, 48, 64)];
var h6 = { vsPath: "raster/flow/particles", fsPath: "raster/flow/particles", locations: n(f5) };
var c3 = class {
  constructor(t4, e4, a5) {
    this._vertexData = t4, this._indexData = e4, this._values = a5;
  }
  attach(t4) {
    const { context: e4 } = t4, a5 = new r2(e4, f5, this._vertexData), s7 = o2.createIndex(e4, 35044, this._indexData), i6 = new h3(e4, a5, s7), n3 = [];
    "ramp" === this._values.color.kind && n3.push("vvColor"), "ramp" === this._values.opacity.kind && n3.push("vvOpacity"), "ramp" === this._values.size.kind && n3.push("vvSize");
    const p3 = t4.getProgram(h6, n3);
    this.vertexArray = i6, this.program = p3, this.indexCount = this._indexData.length, this._vertexData = null, this._indexData = null;
  }
  detach() {
    this.vertexArray.dispose();
  }
  get ready() {
    return this.program.compiled;
  }
};

// node_modules/@arcgis/core/views/2d/engine/flow/styles/Stack.js
var t3 = class _t {
  constructor(t4) {
    this._styles = t4;
  }
  get animated() {
    return this._styles.reduce((t4, s7) => t4 || s7.animated, false);
  }
  isCompatible(s7) {
    if (!(s7 instanceof _t)) return false;
    if (this._styles.length !== s7._styles.length) return false;
    const e4 = this._styles.length;
    for (let t4 = 0; t4 < e4; t4++) if (!this._styles[t4].isCompatible(s7._styles[t4])) return false;
    return true;
  }
  async load(t4, e4) {
    const r5 = await Promise.all(this._styles.map((s7) => s7.load(t4, e4)));
    return new s4(r5);
  }
  render(t4, s7, e4) {
    for (let r5 = 0; r5 < this._styles.length; r5++) this._styles[r5].render(t4, s7, e4.resources[r5]);
  }
};
var s4 = class {
  constructor(t4) {
    this.resources = t4;
  }
  attach(t4) {
    for (const s7 of this.resources) s7.attach(t4);
  }
  detach() {
    for (const t4 of this.resources) t4.detach();
  }
  get ready() {
    return this.resources.reduce((t4, s7) => t4 && s7.ready, true);
  }
};

// node_modules/@arcgis/core/views/2d/engine/flow/styles/Streamlines.js
var l5 = class _l {
  constructor(t4) {
    this._params = t4;
  }
  get animated() {
    return this._params.flowSpeed > 0;
  }
  isCompatible(t4) {
    return t4 instanceof _l && h4(this._params, t4._params);
  }
  async load(e4, a5) {
    const { extent: s7, size: r5 } = e4;
    s(a5);
    const i6 = await this._params.loadImagery(s7, r5[0], r5[1], this._params.timeExtent, a5), { vertexData: o6, indexData: n3 } = await this._params.createFlowMesh("Streamlines", this._params.simulationSettings, i6, a5);
    return new _6(o6, n3, { color: this._params.color, opacity: this._params.opacity, size: this._params.size });
  }
  render(t4, e4, s7) {
    const { context: o6 } = t4, { program: n3 } = s7;
    o6.setFaceCullingEnabled(false), o6.setBlendingEnabled(true), o6.setBlendFunction(1, 771), o6.useProgram(n3), n3.setUniform1f("u_time", e4.time), n3.setUniform1f("u_trailLength", this._params.trailLength), n3.setUniform1f("u_flowSpeed", this._params.flowSpeed), n3.setUniform1f("u_featheringSize", this._params.featheringSize), n3.setUniform1f("u_featheringOffset", this._params.featheringOffset), n3.setUniform1f("u_introFade", this._params.introFade ? 1 : 0), n3.setUniform1f("u_fadeToZero", this._params.fadeToZero ? 1 : 0), n3.setUniform1f("u_decayRate", this._params.decayRate), n3.setUniformMatrix3fv("u_dvsMat3", e4.dvsMat3), n3.setUniformMatrix3fv("u_displayViewMat3", e4.displayViewMat3), m2(n3, "color", "vec4", this._params.color), m2(n3, "opacity", "float", this._params.opacity), m2(n3, "size", "float", this._params.size), o6.bindVAO(s7.vertexArray), o6.drawElements(_2.TRIANGLES, s7.indexCount, R.UNSIGNED_INT, 0);
  }
};
var f6 = [new t("a_positionAndSide", 3, R.FLOAT, 0, 36), new t("a_timeInfo", 3, R.FLOAT, 12, 36), new t("a_extrude", 2, R.FLOAT, 24, 36), new t("a_speed", 1, R.FLOAT, 32, 36)];
var h7 = { vsPath: "raster/flow/streamlines", fsPath: "raster/flow/streamlines", locations: n(f6) };
var _6 = class {
  constructor(t4, e4, a5) {
    this._vertexData = t4, this._indexData = e4, this._values = a5;
  }
  attach(t4) {
    const { context: e4 } = t4, a5 = new r2(e4, f6, this._vertexData), r5 = o2.createIndex(e4, 35044, this._indexData), i6 = new h3(e4, a5, r5), n3 = [];
    "ramp" === this._values.color.kind && n3.push("vvColor"), "ramp" === this._values.opacity.kind && n3.push("vvOpacity"), "ramp" === this._values.size.kind && n3.push("vvSize");
    const p3 = t4.getProgram(h7, n3);
    this.vertexArray = i6, this.program = p3, this.indexCount = this._indexData.length, this._vertexData = null, this._indexData = null;
  }
  detach() {
    this.vertexArray.dispose();
  }
  get ready() {
    return this.program.compiled;
  }
};

// node_modules/@arcgis/core/views/2d/engine/flow/createFlowStyle.js
var m3 = 4;
var u3 = 1;
var f7 = 0.5;
var p2 = true;
var d2 = true;
var y = 2.3;
function g(g2, w) {
  const { flowSpeed: h9, trailLength: v2 } = g2, S = i4(g2);
  let j = null;
  const k = { opacity: u2(g2), size: r3(g2) };
  let x2 = l3(g2);
  if ("none" === g2.background) k.color = x2;
  else {
    "constant" === x2.kind && (x2 = { kind: "ramp", stops: [0, 1], values: [0, 0, 0, 1, x2.value[0], x2.value[1], x2.value[2], x2.value[3]], count: 2 });
    const e4 = { loadImagery: w.loadImagery, timeExtent: w.timeExtent, color: x2, opacity: { kind: "constant", value: [1] } };
    j = new c2(e4), k.color = a3();
  }
  const I = { loadImagery: w.loadImagery, createFlowMesh: w.createFlowMesh, simulationSettings: S, timeExtent: w.timeExtent, trailLength: v2, flowSpeed: h9, featheringSize: u3, featheringOffset: f7, introFade: p2, fadeToZero: d2, decayRate: y, color: k.color, opacity: k.opacity, size: k.size }, z2 = "butt" === g2.trailCap || o3(r3(g2)) <= m3 ? new l5(I) : new l4(I);
  return null != j ? new t3([j, z2]) : z2;
}

// node_modules/@arcgis/core/views/2d/engine/flow/BrushFlow.js
var a4 = class extends t2 {
  constructor() {
    super(...arguments), this._visualState = { time: 0, dvsMat3: e(), displayViewMat3: e() };
  }
  dispose() {
  }
  prepareState(t4) {
    const { context: e4 } = t4;
    e4.setColorMask(true, true, true, true), e4.setStencilFunction(514, 0, 255);
  }
  draw(t4, e4) {
    const { requestRender: a5, allowDelayedRender: s7 } = t4, { displayData: r5 } = e4;
    if (null == r5) return;
    if ("loaded" === r5.state.name && r5.attach({ context: t4.context, getProgram: (e5, a6) => t4.painter.materialManager.getProgram(e5, a6) }), "attached" !== r5.state.name) return;
    const i6 = r5.state.resources;
    !s7 || i6.ready || null == a5 ? (this._visualState.time = t4.animationsEnabled ? t4.time / 1e3 : 0, this._visualState.dvsMat3 = e4.transforms.displayViewScreenMat3, this._visualState.displayViewMat3 = t4.state.displayViewMat3, r5.flowStyle.render({ context: t4.context, getProgram: (e5, a6) => t4.painter.materialManager.getProgram(e5, a6) }, this._visualState, i6), r5.flowStyle.animated && null != a5 && t4.animationsEnabled && a5()) : a5();
  }
};

// node_modules/@arcgis/core/views/2d/engine/flow/FlowContainer.js
var s5 = class extends i3 {
  constructor() {
    super(...arguments), this.flowStyle = null;
  }
  doRender(e4) {
    super.doRender(e4);
  }
  prepareRenderPasses(r5) {
    const s7 = r5.registerRenderPass({ name: "flow", brushes: [a4], target: () => this.children, drawPhase: 1 });
    return [...super.prepareRenderPasses(r5), s7];
  }
};

// node_modules/@arcgis/core/views/2d/engine/flow/FlowDisplayData.js
var e3 = class {
  constructor(t4, e4, s7, a5, i6) {
    this.state = { name: "created" }, this.flowStyle = t4, this.extent = e4, this.size = s7, this.pixelRatio = a5, this.startTime = i6;
  }
  async load() {
    const t4 = new AbortController();
    this.state = { name: "loading", abortController: t4 };
    const e4 = { extent: this.extent, size: this.size, pixelRatio: this.pixelRatio, time: this.startTime }, s7 = await this.flowStyle.load(e4, t4.signal);
    this.state = { name: "loaded", resources: s7 };
  }
  attach(e4) {
    if ("loaded" !== this.state.name) return void i.getLogger("esri.views.2d.engine.flow.FlowDisplayData").error("Only loaded resources can be attached.");
    const s7 = this.state.resources;
    s7.attach(e4), this.state = { name: "attached", resources: s7 };
  }
  detach() {
    if ("loading" === this.state.name) return this.state.abortController.abort(), void (this.state = { name: "detached" });
    "attached" === this.state.name && (this.state.resources.detach(), this.state = { name: "detached" });
  }
  update(t4) {
    if (!this.flowStyle.isCompatible(t4.flowStyle)) return false;
    return !(!this.extent.equals(t4.extent) || this.size[0] !== t4.size[0] || this.size[1] !== t4.size[1] || this.pixelRatio !== t4.pixelRatio) && (this.flowStyle = t4.flowStyle, true);
  }
};

// node_modules/@arcgis/core/views/2d/engine/flow/FlowDisplayObject.js
var o4 = class extends e2 {
  constructor() {
    super(...arguments), this._displayData = null;
  }
  get displayData() {
    return this._displayData;
  }
  set displayData(t4) {
    this._displayData = t4, this.requestRender();
  }
  clear() {
    null != this._displayData && (this._displayData.detach(), this._displayData = null, this.requestRender());
  }
  setTransform(r5) {
    const { displayData: l6 } = this;
    if (null == l6) return;
    const o6 = l6.extent.xmin, n3 = l6.extent.ymax, p3 = [0, 0];
    r5.toScreen(p3, [o6, n3]);
    const m5 = (l6.extent.xmax - l6.extent.xmin) / l6.size[0] / r5.resolution, c4 = s2(r5.rotation), { displayViewScreenMat3: x2 } = this.transforms;
    l2(x2, [-1, 1, 0]), f(x2, x2, [2 / (r5.size[0] * r5.pixelRatio), -2 / (r5.size[1] * r5.pixelRatio), 1]), M(x2, x2, [p3[0], p3[1], 0]), h(x2, x2, c4), f(x2, x2, [m5 * r5.pixelRatio, m5 * r5.pixelRatio, 1]);
  }
  _createTransforms() {
    return { displayViewScreenMat3: e() };
  }
};

// node_modules/@arcgis/core/views/2d/engine/flow/FlowStrategy.js
var m4 = 1.15;
var d3 = class extends b {
  constructor(t4) {
    super(t4), this._flowDisplayObject = new o4(), this._loading = null;
  }
  initialize() {
    this.flowContainer.addChild(this._flowDisplayObject);
  }
  destroy() {
    this._clear(), this.flowContainer.removeAllChildren();
  }
  get updating() {
    return null != this._loading;
  }
  update(t4) {
    const { flowStyle: o6 } = this.flowContainer;
    if (null == o6) return void this._clear();
    const { extent: e4, rotation: r5, resolution: l6, pixelRatio: s7 } = t4.state, n3 = h8(e4, r5);
    n3.expand(m4);
    const c4 = [Math.round((n3.xmax - n3.xmin) / l6), Math.round((n3.ymax - n3.ymin) / l6)], d5 = performance.now() / 1e3, f8 = new e3(o6, n3, c4, s7, d5);
    if (null != this._loading) {
      if (this._loading.update(f8)) return;
      this._loading.detach(), this._loading = null;
    }
    null != this._flowDisplayObject.displayData && this._flowDisplayObject.displayData.update(f8) || (f8.load().then(() => {
      this._flowDisplayObject.clear(), this._flowDisplayObject.displayData = this._loading, this._loading = null;
    }, (t5) => {
      d(t5) || (i.getLogger(this).error("A resource failed to load.", t5), this._loading = null);
    }), this._loading = f8);
  }
  _clear() {
    this._flowDisplayObject.clear(), null != this._loading && (this._loading.detach(), this._loading = null);
  }
};
function h8(t4, o6) {
  const i6 = new _({ x: (t4.xmax + t4.xmin) / 2, y: (t4.ymax + t4.ymin) / 2, spatialReference: t4.spatialReference }), a5 = t4.xmax - t4.xmin, r5 = t4.ymax - t4.ymin, l6 = Math.abs(Math.cos(s2(o6))), p3 = Math.abs(Math.sin(s2(o6))), c4 = l6 * a5 + p3 * r5, m5 = p3 * a5 + l6 * r5, d5 = new z({ xmin: i6.x - c4 / 2, ymin: i6.y - m5 / 2, xmax: i6.x + c4 / 2, ymax: i6.y + m5 / 2, spatialReference: t4.spatialReference });
  return d5.centerAt(i6), d5;
}
__decorate([m()], d3.prototype, "_loading", void 0), __decorate([m()], d3.prototype, "flowContainer", void 0), __decorate([m()], d3.prototype, "updating", null), d3 = __decorate([a("esri.views.2d.engine.flow.FlowStrategy")], d3);

// node_modules/@arcgis/core/views/2d/engine/flow/FlowView2D.js
var d4 = class extends b {
  constructor() {
    super(...arguments), this._loadImagery = (t4, e4, i6, o6, r5) => x(this.layer, t4, e4, i6, o6, r5), this._createFlowMesh = (t4, e4, i6, o6) => this.layer.createFlowMesh({ meshType: t4, flowData: i6, simulationSettings: e4 }, { signal: o6 }), this.attached = false, this.type = "flow", this.timeExtent = null, this.redrawOrRefetch = async () => {
      this._updateVisualization();
    };
  }
  get updating() {
    return !this.attached || this._strategy.updating;
  }
  attach() {
    const { layer: t4 } = this, e4 = () => {
      this._loadImagery = (e5, i6, o6, r5, s7) => x(t4, e5, i6, o6, r5, s7), this._updateVisualization();
    };
    "multidimensionalDefinition" in t4 ? this.addHandles(l(() => t4.multidimensionalDefinition, e4)) : this.addHandles([l(() => t4.mosaicRule, e4), l(() => t4.rasterFunction, e4), l(() => t4.definitionExpression, e4)]), this.container = new s5(), this._strategy = new d3({ flowContainer: this.container }), this._updateVisualization();
  }
  detach() {
    this._strategy.destroy(), this.container?.removeAllChildren(), this.container = null, this.removeHandles();
  }
  update(t4) {
    t4.stationary ? this._strategy.update(t4) : this.layerView.requestUpdate();
  }
  hitTest(t4) {
    return new _3({ attributes: {}, geometry: t4.clone(), layer: this.layer });
  }
  moveEnd() {
  }
  async doRefresh() {
  }
  _updateVisualization() {
    const t4 = this.layer.renderer;
    if (null == t4 || "flow" !== t4.type) return;
    const e4 = g(t4, { loadImagery: this._loadImagery, createFlowMesh: this._createFlowMesh, timeExtent: this.timeExtent });
    this.container.flowStyle = e4, this.layerView.requestUpdate();
  }
};
__decorate([m()], d4.prototype, "_strategy", void 0), __decorate([m()], d4.prototype, "attached", void 0), __decorate([m()], d4.prototype, "container", void 0), __decorate([m()], d4.prototype, "layer", void 0), __decorate([m()], d4.prototype, "layerView", void 0), __decorate([m()], d4.prototype, "type", void 0), __decorate([m()], d4.prototype, "updating", null), __decorate([m()], d4.prototype, "timeExtent", void 0), d4 = __decorate([a("esri.views.2d.engine.flow.FlowView2D")], d4);

// node_modules/@arcgis/core/views/2d/engine/imagery/BrushVectorField.js
var r4 = new Float32Array([0.27058823529411763, 0.4588235294117647, 0.7098039215686275, 1, 0.396078431372549, 0.5372549019607843, 0.7215686274509804, 1, 0.5176470588235295, 0.6196078431372549, 0.7294117647058823, 1, 0.6352941176470588, 0.7058823529411765, 0.7411764705882353, 1, 0.7529411764705882, 0.8, 0.7450980392156863, 1, 0.8705882352941177, 0.8901960784313725, 0.7490196078431373, 1, 1, 1, 0.7490196078431373, 1, 1, 0.8627450980392157, 0.6313725490196078, 1, 0.9803921568627451, 0.7254901960784313, 0.5176470588235295, 1, 0.9607843137254902, 0.596078431372549, 0.4117647058823529, 1, 0.9294117647058824, 0.4588235294117647, 0.3176470588235294, 1, 0.9098039215686274, 0.08235294117647059, 0.08235294117647059, 1]);
var o5 = new Float32Array([0, 92 / 255, 230 / 255, 1]);
var s6 = { beaufort_ft: r4, beaufort_m: r4, beaufort_km: r4, beaufort_mi: r4, beaufort_kn: new Float32Array([0.1568627450980392, 0.5725490196078431, 0.7803921568627451, 1, 0.34901960784313724, 0.6352941176470588, 0.7294117647058823, 1, 0.5058823529411764, 0.7019607843137254, 0.6705882352941176, 1, 0.6274509803921569, 0.7607843137254902, 0.6078431372549019, 1, 0.7490196078431373, 0.8313725490196079, 0.5411764705882353, 1, 0.8549019607843137, 0.9019607843137255, 0.4666666666666667, 1, 0.9803921568627451, 0.9803921568627451, 0.39215686274509803, 1, 0.9882352941176471, 0.8352941176470589, 0.3254901960784314, 1, 0.9882352941176471, 0.7019607843137254, 0.4, 1, 0.9803921568627451, 0.5529411764705883, 0.20392156862745098, 1, 0.9686274509803922, 0.43137254901960786, 0.16470588235294117, 1, 0.9411764705882353, 0.2784313725490196, 0.11372549019607843, 1]), classified_arrow: new Float32Array([0.2196078431372549, 0.6588235294117647, 0, 1, 0.5450980392156862, 1.2117647058823529, 0, 1, 1, 1, 0, 1, 1, 0.5019607843137255, 0, 1, 1, 0, 0, 1]), ocean_current_m: new Float32Array([0.3058823529411765, 0.10196078431372549, 0.6, 1, 0.7019607843137254, 0.10588235294117647, 0.10196078431372549, 1, 0.792156862745098, 0.5019607843137255, 0.10196078431372549, 1, 0.6941176470588235, 0.6941176470588235, 0.6941176470588235, 1]), ocean_current_kn: new Float32Array([0, 0, 0, 1, 0, 0.1450980392156863, 0.39215686274509803, 1, 0.3058823529411765, 0.10196078431372549, 0.6, 1, 0.592156862745098, 0, 0.39215686274509803, 1, 0.7019607843137254, 0.10588235294117647, 0.10196078431372549, 1, 0.6941176470588235, 0.3058823529411765, 0.10196078431372549, 1, 0.792156862745098, 0.5019607843137255, 0.10196078431372549, 1, 0.6941176470588235, 0.7019607843137254, 0.20392156862745098, 1, 0.6941176470588235, 0.6941176470588235, 0.6941176470588235, 1]), simple_scalar: o5, single_arrow: o5, wind_speed: new Float32Array([0, 0, 0, 1]) };
var n2 = [0, 20];
var i5 = class extends t2 {
  constructor() {
    super(...arguments), this._desc = { magdir: { vsPath: "raster/magdir", fsPath: "raster/magdir", locations: /* @__PURE__ */ new Map([["a_pos", 0], ["a_offset", 1], ["a_vv", 2]]) }, scalar: { vsPath: "raster/scalar", fsPath: "raster/scalar", locations: /* @__PURE__ */ new Map([["a_pos", 0], ["a_offset", 1], ["a_vv", 2]]) } };
  }
  dispose() {
  }
  prepareState({ context: e4 }) {
    e4.setBlendingEnabled(true), e4.setBlendFunctionSeparate(1, 771, 1, 771), e4.setColorMask(true, true, true, true), e4.setStencilWriteMask(0), e4.setStencilTestEnabled(true), e4.setStencilOp(7680, 7680, 7681);
  }
  draw(e4, a5) {
    if (null == a5.source || 0 === a5.source.validPixelCount) return;
    const { context: t4, timeline: r5 } = e4;
    if (r5.begin(this.name), t4.setStencilFunction(514, a5.stencilRef, 255), a5.updateVectorFieldVAO(e4), "scalar" === e4.renderPass) {
      const t5 = a5.vaoData.scalar;
      t5 && this._drawScalars(e4, a5, t5.vao, t5.elementCount);
    } else {
      const t5 = a5.vaoData.magdir;
      t5 && this._drawTriangles(e4, a5, t5.vao, t5.elementCount);
    }
    r5.end(this.name);
  }
  _drawTriangles(e4, r5, o6, i6) {
    const { context: l6, painter: c4, requestRender: d5, allowDelayedRender: m5 } = e4, { symbolizerParameters: f8 } = r5, u4 = f8.dataRange ? ["dataRange"] : [];
    "geographic" === f8.rotationType && u4.push("rotationGeographic");
    const _7 = c4.materialManager.getProgram(this._desc.magdir, u4);
    if (m5 && null != d5 && !_7.compiled) return void d5();
    l6.useProgram(_7);
    const { coordScale: g2, opacity: p3, transforms: y2 } = r5;
    _7.setUniform2fv("u_coordScale", g2), _7.setUniform1f("u_opacity", p3), _7.setUniformMatrix3fv("u_dvsMat3", y2.displayViewScreenMat3);
    const { style: h9, dataRange: v2, rotation: w, symbolPercentRange: S } = f8;
    _7.setUniform4fv("u_colors", s6[h9]), _7.setUniform2fv("u_dataRange", v2 || n2), _7.setUniform1f("u_rotation", w), _7.setUniform2fv("u_symbolPercentRange", S);
    const b3 = this._getSymbolSize(e4, r5);
    _7.setUniform2fv("u_symbolSize", b3), l6.bindVAO(o6), l6.drawElements(_2.TRIANGLES, i6, R.UNSIGNED_INT, 0);
  }
  _drawScalars(e4, r5, o6, s7) {
    const { context: i6, painter: l6, requestRender: c4, allowDelayedRender: d5 } = e4, { symbolizerParameters: m5 } = r5, f8 = [];
    "wind_speed" === m5.style ? f8.push("innerCircle") : m5.dataRange && f8.push("dataRange"), "geographic" === m5.rotationType && f8.push("rotationGeographic");
    const u4 = l6.materialManager.getProgram(this._desc.scalar, f8);
    if (d5 && null != c4 && !u4.compiled) return void c4();
    i6.useProgram(u4);
    const { coordScale: _7, opacity: g2, transforms: p3 } = r5;
    u4.setUniform2fv("u_coordScale", _7), u4.setUniform1f("u_opacity", g2), u4.setUniformMatrix3fv("u_dvsMat3", p3.displayViewScreenMat3);
    const { dataRange: y2, symbolPercentRange: h9 } = m5;
    u4.setUniform2fv("u_dataRange", y2 || n2), u4.setUniform2fv("u_symbolPercentRange", h9);
    const v2 = this._getSymbolSize(e4, r5);
    u4.setUniform2fv("u_symbolSize", v2), i6.bindVAO(o6), i6.drawElements(_2.TRIANGLES, s7, R.UNSIGNED_INT, 0);
  }
  _getSymbolSize(e4, a5) {
    const t4 = a5.key ? 2 ** (e4.displayLevel - a5.key.level) : a5.resolution / e4.state.resolution, { symbolTileSize: r5 } = a5.symbolizerParameters;
    return [r5 / (Math.round((a5.width - a5.offset[0]) / r5) * r5) / t4, r5 / (Math.round((a5.height - a5.offset[1]) / r5) * r5) / t4];
  }
};

// node_modules/@arcgis/core/views/2d/engine/imagery/RasterVFDisplayObject.js
var v = class extends e2 {
  constructor(t4 = null) {
    super(), this._source = null, this._symbolizerParameters = null, this._vaoInvalidated = true, this.coordScale = [1, 1], this.height = null, this.key = null, this.offset = null, this.stencilRef = 0, this.resolution = null, this.pixelRatio = 1, this.x = 0, this.y = 0, this.rotation = 0, this.rawPixelData = null, this.vaoData = null, this.width = null, this.source = t4;
  }
  destroy() {
    super.destroy(), null != this.vaoData && (this.vaoData.magdir?.vao.dispose(), this.vaoData.scalar?.vao.dispose(), this.vaoData = null);
  }
  get symbolizerParameters() {
    return this._symbolizerParameters;
  }
  set symbolizerParameters(t4) {
    JSON.stringify(this._symbolizerParameters) !== JSON.stringify(t4) && (this._symbolizerParameters = t4, this.invalidateVAO());
  }
  get source() {
    return this._source;
  }
  set source(t4) {
    this._source = t4, this.invalidateVAO();
  }
  invalidateVAO() {
    this._vaoInvalidated || null == this.vaoData || (this.vaoData.magdir?.vao.dispose(), this.vaoData.scalar?.vao.dispose(), this.vaoData = null, this._vaoInvalidated = true, this.requestRender());
  }
  updateVectorFieldVAO(t4) {
    if (this._vaoInvalidated) {
      if (this._vaoInvalidated = false, null != this.source && null == this.vaoData) {
        const { style: e4 } = this.symbolizerParameters;
        switch (e4) {
          case "beaufort_ft":
          case "beaufort_km":
          case "beaufort_kn":
          case "beaufort_m":
          case "beaufort_mi":
          case "classified_arrow":
          case "ocean_current_kn":
          case "ocean_current_m":
          case "single_arrow":
            {
              const e5 = U(this.source, this.symbolizerParameters), a5 = this._createVectorFieldVAO(t4.context, e5);
              this.vaoData = { magdir: a5 };
            }
            break;
          case "simple_scalar":
            {
              const e5 = _4(this.source, this.symbolizerParameters), a5 = this._createVectorFieldVAO(t4.context, e5);
              this.vaoData = { scalar: a5 };
            }
            break;
          case "wind_speed": {
            const e5 = U(this.source, this.symbolizerParameters), a5 = this._createVectorFieldVAO(t4.context, e5), s7 = _4(this.source, this.symbolizerParameters), i6 = this._createVectorFieldVAO(t4.context, s7);
            this.vaoData = { magdir: a5, scalar: i6 };
          }
        }
      }
      this.ready(), this.requestRender();
    }
  }
  _createTransforms() {
    return { displayViewScreenMat3: e() };
  }
  setTransform(r5) {
    const l6 = o(this.transforms.displayViewScreenMat3), [n3, c4] = r5.toScreenNoRotation([0, 0], [this.x, this.y]), h9 = this.resolution / this.pixelRatio / r5.resolution, m5 = h9 * this.width, u4 = h9 * this.height, d5 = Math.PI * this.rotation / 180;
    M(l6, l6, r(n3, c4)), M(l6, l6, r(m5 / 2, u4 / 2)), h(l6, l6, -d5), M(l6, l6, r(-m5 / 2, -u4 / 2)), b2(l6, l6, r(m5, u4)), i2(this.transforms.displayViewScreenMat3, r5.displayViewMat3, l6);
  }
  onAttach() {
    this.invalidateVAO();
  }
  onDetach() {
    this.invalidateVAO();
  }
  _createVectorFieldVAO(t4, e4) {
    const { vertexData: a5, indexData: s7 } = e4, i6 = o2.createIndex(t4, 35044, new Uint32Array(s7)), r5 = $("vector-field", [{ location: 0, name: "a_pos", count: 2, type: R.FLOAT, normalized: false }, { location: 1, name: "a_offset", count: 2, type: R.FLOAT, normalized: false }, { location: 2, name: "a_vv", count: 2, type: R.FLOAT, normalized: false }]), o6 = new r2(t4, r5.bufferLayout, new Float32Array(a5));
    return { vao: new h3(t4, o6, i6), elementCount: s7.length };
  }
};

export {
  d4 as d,
  i5 as i,
  v
};
//# sourceMappingURL=chunk-IJEEAMVP.js.map
