import {
  U,
  a as a2,
  f,
  l
} from "./chunk-2OFHDVO5.js";
import {
  b,
  m
} from "./chunk-5EI5H4QX.js";
import {
  a2 as a
} from "./chunk-ZIE53VIV.js";
import {
  __decorate
} from "./chunk-SS5CLIUY.js";
import {
  A
} from "./chunk-R54Q5TGA.js";
import {
  e
} from "./chunk-GNMPGHLQ.js";

// node_modules/@arcgis/core/core/support/UpdatingHandles.js
var h = class extends b {
  constructor() {
    super(...arguments), this.updating = false, this._handleId = 0, this._scheduleHandleId = 0, this._pendingPromises = /* @__PURE__ */ new Set();
  }
  destroy() {
    this.removeAll();
  }
  add(e2, s, t = {}) {
    return this._installWatch(e2, s, t, l);
  }
  addWhen(e2, s, t = {}) {
    return this._installWatch(e2, s, t, f);
  }
  addOnCollectionChange(e2, s, { initial: i = false, final: n = false } = {}) {
    const r = ++this._handleId;
    return this.addHandles([a2(e2, "after-changes", this._createSyncUpdatingCallback(), U), a2(e2, "change", s, { onListenerAdd: i ? (e3) => s({ added: e3.toArray(), removed: [] }) : void 0, onListenerRemove: n ? (e3) => s({ added: [], removed: e3.toArray() }) : void 0 })], r), e(() => this.removeHandles(r));
  }
  addPromise(e2) {
    if (null == e2) return e2;
    const s = ++this._handleId;
    this.addHandles(e(() => {
      this._pendingPromises.delete(e2) && (0 !== this._pendingPromises.size || this.hasHandles(c) || this._set("updating", false));
    }), s), this._pendingPromises.add(e2), this._set("updating", true);
    const i = () => this.removeHandles(s);
    return e2.then(i, i), e2;
  }
  removeAll() {
    this._pendingPromises.clear(), this.removeAllHandles(), this._set("updating", false);
  }
  _installWatch(e2, s, i = {}, n) {
    const d = ++this._handleId;
    i.sync || this._installSyncUpdatingWatch(e2, d);
    const a3 = n(e2, s, i);
    return this.addHandles(a3, d), e(() => this.removeHandles(d));
  }
  _installSyncUpdatingWatch(e2, s) {
    const t = this._createSyncUpdatingCallback(), n = l(e2, t, { sync: true, equals: () => false });
    return this.addHandles(n, s), n;
  }
  _createSyncUpdatingCallback() {
    return () => {
      this.removeHandles(c), ++this._scheduleHandleId;
      const e2 = this._scheduleHandleId;
      this._get("updating") || this._set("updating", true), this.addHandles(A(() => {
        e2 === this._scheduleHandleId && (this._set("updating", this._pendingPromises.size > 0), this.removeHandles(c));
      }), c);
    };
  }
};
__decorate([m({ readOnly: true })], h.prototype, "updating", void 0), h = __decorate([a("esri.core.support.UpdatingHandles")], h);
var c = -42;

export {
  h
};
//# sourceMappingURL=chunk-BPTFV5VM.js.map
