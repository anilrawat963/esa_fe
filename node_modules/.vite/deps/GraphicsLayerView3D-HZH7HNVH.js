import {
  F as F2,
  O as O2,
  P as P3,
  d as d9,
  d3 as d10,
  e as e11,
  f2 as f9,
  l as l9,
  m as m4,
  m2 as m5,
  n as n9,
  p as p4,
  r as r7,
  r2 as r8,
  r3 as r9,
  t3 as t8,
  u as u10
} from "./chunk-OOMAOGYV.js";
import {
  a2 as a9,
  c as c6,
  d as d6,
  d2 as d7,
  d3 as d8,
  f as f7,
  f2 as f8,
  n as n8,
  o as o9,
  x
} from "./chunk-Q4G6BRR7.js";
import {
  u as u11
} from "./chunk-PU7CAQGZ.js";
import "./chunk-ZP5CSWYG.js";
import "./chunk-BLCKE43G.js";
import {
  r as r6
} from "./chunk-ZS4Q4DJE.js";
import {
  d as d5
} from "./chunk-PZZ55S55.js";
import "./chunk-D6KKUGCT.js";
import {
  u as u9
} from "./chunk-RRK2YVM5.js";
import {
  a as a7,
  r as r5,
  t as t7
} from "./chunk-VIDAPS4J.js";
import {
  l as l8
} from "./chunk-GD72EK2J.js";
import "./chunk-LBWWJ76V.js";
import {
  U as U3,
  ie,
  w as w3
} from "./chunk-KDOWKZ3H.js";
import "./chunk-NH6F2I5R.js";
import {
  c as c4
} from "./chunk-6WSJV2UJ.js";
import "./chunk-EC56NYYL.js";
import "./chunk-3RNQTFH6.js";
import {
  S,
  a2 as a6,
  e2 as e8,
  h3 as h5,
  i2 as i5,
  m as m2,
  s as s8,
  z as z4
} from "./chunk-VIIQX37N.js";
import "./chunk-BRGWF4BT.js";
import "./chunk-UR6CZJPX.js";
import "./chunk-JS3I6GIR.js";
import "./chunk-QTS3W27E.js";
import "./chunk-3RABUJDL.js";
import "./chunk-IFKJBQCK.js";
import "./chunk-V5R3CDPU.js";
import "./chunk-6GZZL5MR.js";
import "./chunk-HZVRMY4D.js";
import "./chunk-YTJAN3CY.js";
import "./chunk-T6CRNJ3D.js";
import "./chunk-Z4KE5G4E.js";
import {
  n as n7
} from "./chunk-KEMYAF6M.js";
import {
  m as m3,
  t as t6,
  u as u8
} from "./chunk-CYVJEU2B.js";
import "./chunk-7YJLACUB.js";
import "./chunk-HETHJJO6.js";
import "./chunk-KOVWXXQR.js";
import "./chunk-ECKVUXN3.js";
import "./chunk-CHC4AAHW.js";
import "./chunk-S2SKSSUG.js";
import {
  T as T3,
  c as c5,
  d as d4,
  e as e9
} from "./chunk-FDSAQJ3R.js";
import "./chunk-KDGDF37U.js";
import {
  o as o7,
  t2 as t5
} from "./chunk-I4DSU5MJ.js";
import "./chunk-66AADZ63.js";
import "./chunk-6HNBANDZ.js";
import "./chunk-MCWHCMX6.js";
import "./chunk-SESXYKK5.js";
import "./chunk-HAR63DI2.js";
import "./chunk-A3JORY5L.js";
import "./chunk-JNASI2YX.js";
import "./chunk-P355ISZZ.js";
import "./chunk-FCDWKXLA.js";
import "./chunk-AUP2E2QB.js";
import "./chunk-NDWECAKM.js";
import "./chunk-KTMKDXZP.js";
import "./chunk-F43BIMML.js";
import "./chunk-CT7HOWYG.js";
import "./chunk-CW4AXF3Q.js";
import {
  o2 as o8
} from "./chunk-BZBDEPRV.js";
import "./chunk-MXP2VO3L.js";
import "./chunk-OWSUTT7E.js";
import "./chunk-WNQORCSA.js";
import "./chunk-CIIRREHX.js";
import "./chunk-COMSADUT.js";
import "./chunk-66Y6I5GR.js";
import "./chunk-U5J3MCMX.js";
import "./chunk-D7KJNSAT.js";
import "./chunk-BZV32YR7.js";
import "./chunk-IT62DCG6.js";
import "./chunk-SZ5DGQ75.js";
import "./chunk-3PAAA3FK.js";
import "./chunk-EGPAQBOO.js";
import "./chunk-W6L6ZQPE.js";
import "./chunk-6GHQTYW5.js";
import "./chunk-WJ3E33GQ.js";
import "./chunk-YOYO2XMY.js";
import "./chunk-SZTZNZQW.js";
import "./chunk-AJG2ZYEA.js";
import "./chunk-CFXCM2NO.js";
import {
  n as n6
} from "./chunk-B3BLJNSM.js";
import {
  t as t4
} from "./chunk-ALKEERWI.js";
import "./chunk-F75XORHS.js";
import {
  t as t3
} from "./chunk-ME5HHRVQ.js";
import "./chunk-ZP6KSK4N.js";
import "./chunk-6KSMNSLR.js";
import {
  b as b5,
  v as v2
} from "./chunk-JBTWCDRR.js";
import {
  k as k3
} from "./chunk-U6CJFTOF.js";
import {
  $ as $3
} from "./chunk-RXH2WNPA.js";
import "./chunk-TWU3GKHX.js";
import "./chunk-BGIBV6LL.js";
import "./chunk-UQXJMFRI.js";
import "./chunk-DY7N5RAZ.js";
import {
  d as d2,
  y as y2
} from "./chunk-FHCV4NTV.js";
import {
  H as H2,
  I,
  X,
  j2,
  k as k2,
  y as y3
} from "./chunk-2JMKFI2D.js";
import "./chunk-QYAMBIRP.js";
import "./chunk-GVMCGYZ6.js";
import "./chunk-JHV6OBEB.js";
import "./chunk-QTRET3PG.js";
import {
  d as d3,
  g as g4,
  u as u7
} from "./chunk-FMOL5XMB.js";
import "./chunk-VNSHGTPN.js";
import "./chunk-OEBAFVQK.js";
import {
  R,
  b as b3,
  v,
  z as z3
} from "./chunk-XHNYLMJC.js";
import "./chunk-NHFKDWOM.js";
import {
  Q as Q2
} from "./chunk-2AOVWXAQ.js";
import "./chunk-ALR6N4CF.js";
import "./chunk-4X4BOGIG.js";
import "./chunk-7QPS6ATI.js";
import "./chunk-YYXR3KOD.js";
import {
  c as c3
} from "./chunk-WHHIH5YU.js";
import {
  f as f5
} from "./chunk-MEDXVTKR.js";
import "./chunk-5LMH6D7V.js";
import "./chunk-BZLHV37L.js";
import "./chunk-V6V3WWJF.js";
import "./chunk-NDFIZYZY.js";
import "./chunk-TLTSPUO7.js";
import "./chunk-EK7HOTRR.js";
import {
  e as e7
} from "./chunk-B5SL7XHP.js";
import {
  s as s6
} from "./chunk-Q7VRQYAO.js";
import "./chunk-VGXUPJSS.js";
import {
  a as a5,
  n as n3,
  r as r3
} from "./chunk-ZVTEFYZX.js";
import "./chunk-LPUPM55U.js";
import {
  t
} from "./chunk-M5SP6ZBM.js";
import {
  ut
} from "./chunk-XX3OKYJS.js";
import "./chunk-OTCNIJ2H.js";
import {
  s as s5
} from "./chunk-JGA5YJWL.js";
import {
  e as e6
} from "./chunk-GCI4MA3M.js";
import {
  e as e5
} from "./chunk-SJ2OBYX2.js";
import {
  a as a8,
  g as g5,
  p as p3
} from "./chunk-AUJIAAW5.js";
import {
  s as s9
} from "./chunk-AIJLLSRB.js";
import "./chunk-T3SYSTKO.js";
import "./chunk-U55FA2EK.js";
import "./chunk-GBN36VHC.js";
import "./chunk-ET5EDAFM.js";
import {
  r as r4
} from "./chunk-UYMV6HXW.js";
import "./chunk-QNVJVDYZ.js";
import {
  n as n4
} from "./chunk-WDTGOP77.js";
import {
  A as A2,
  E as E2,
  K as K2,
  P as P2,
  c as c2,
  g as g2,
  o as o4,
  p as p2,
  s as s7,
  u as u5
} from "./chunk-VYMBX5H5.js";
import {
  h as h4
} from "./chunk-BPTFV5VM.js";
import {
  F,
  G,
  f as f4,
  l as l6,
  o as o3
} from "./chunk-XDLV73DB.js";
import "./chunk-ARTU4L55.js";
import "./chunk-6VL5D5UP.js";
import "./chunk-6QHY54HZ.js";
import "./chunk-GXJJY3ND.js";
import "./chunk-5ONGWFJ3.js";
import "./chunk-PLNHHGHL.js";
import "./chunk-DFK6QMLO.js";
import {
  s as s3
} from "./chunk-BBYMM7CM.js";
import {
  r as r2
} from "./chunk-EM7Y2JZC.js";
import "./chunk-QZQPB5XR.js";
import "./chunk-AQFRVV3U.js";
import {
  n as n5
} from "./chunk-XTZAIV4X.js";
import "./chunk-63LDVRFI.js";
import {
  _ as _3
} from "./chunk-C3FRY5U4.js";
import {
  o as o5
} from "./chunk-JNJX34GB.js";
import "./chunk-3STJRSDT.js";
import "./chunk-67Q6KVC6.js";
import {
  b2 as b4,
  f as f6,
  l3 as l7,
  o as o6
} from "./chunk-23NJHA5Q.js";
import "./chunk-4LA6K4VI.js";
import "./chunk-KEZCWFAR.js";
import "./chunk-JZUJ34RR.js";
import "./chunk-PMGS7UDU.js";
import "./chunk-3GHCGAH2.js";
import {
  B,
  H,
  M as M2,
  Q,
  T as T2,
  b as b2,
  k,
  l as l5,
  q,
  u as u4,
  w as w2
} from "./chunk-HWUOAPTX.js";
import "./chunk-QHCKOBU7.js";
import {
  e as e4
} from "./chunk-K2OZ6WVC.js";
import {
  e2 as e10
} from "./chunk-MC6NAKKX.js";
import "./chunk-TF6255HN.js";
import "./chunk-GD4FJL3C.js";
import {
  i as i4
} from "./chunk-C5OQVQZF.js";
import "./chunk-F7DKSAOI.js";
import "./chunk-4SOQWNPG.js";
import {
  g as g3
} from "./chunk-LTULADK2.js";
import "./chunk-35ST7YRB.js";
import "./chunk-EDA5QFHZ.js";
import "./chunk-CNYNCKEV.js";
import {
  _ as _2,
  a as a3
} from "./chunk-XL5QPCXN.js";
import {
  $ as $2,
  J,
  t as t2
} from "./chunk-2LC2762W.js";
import "./chunk-W6HOAVT4.js";
import {
  o as o2
} from "./chunk-DTZUXJMD.js";
import "./chunk-YLAGKT2D.js";
import "./chunk-6YRQYUCY.js";
import {
  c
} from "./chunk-C5M24ACM.js";
import "./chunk-L4A2QJG4.js";
import "./chunk-ENINOZUZ.js";
import {
  b as b6
} from "./chunk-P6IKJIMO.js";
import "./chunk-MHV23XAQ.js";
import "./chunk-V2X4OKYI.js";
import "./chunk-LPZUGJNG.js";
import {
  h as h3
} from "./chunk-XLOINTMG.js";
import "./chunk-MA3QDRC3.js";
import "./chunk-W6J7XCPU.js";
import "./chunk-ONXWBTTM.js";
import "./chunk-T7F6Q6JJ.js";
import {
  O
} from "./chunk-YDTPM7OQ.js";
import {
  n as n2
} from "./chunk-75XOUSSS.js";
import "./chunk-TH4EQWJJ.js";
import "./chunk-7P2ANHQ3.js";
import "./chunk-XCKT47LJ.js";
import "./chunk-3FUHCAX3.js";
import {
  P
} from "./chunk-PZ5RULLK.js";
import "./chunk-OPJX4KXH.js";
import "./chunk-LTPHDYPK.js";
import "./chunk-3OVERDFX.js";
import {
  K,
  M,
  a as a4,
  g,
  i as i3,
  p,
  s as s4,
  z as z2
} from "./chunk-FPMLKIDB.js";
import {
  l as l4
} from "./chunk-AZXJIEZ6.js";
import "./chunk-Q75WYS7K.js";
import {
  z
} from "./chunk-H74Q4SYB.js";
import {
  U as U2,
  a as a2,
  f as f2,
  h as h2,
  j,
  l as l3,
  w
} from "./chunk-2OFHDVO5.js";
import {
  i as i2,
  l as l2
} from "./chunk-TFJXG32O.js";
import "./chunk-DDOCCRD4.js";
import "./chunk-5UPBUJPC.js";
import "./chunk-THQO67BJ.js";
import "./chunk-4YDOPHTZ.js";
import "./chunk-YY5PITIH.js";
import {
  u as u6
} from "./chunk-CCQFL76O.js";
import {
  u as u3
} from "./chunk-CSMCPN64.js";
import "./chunk-GY6YF4EN.js";
import "./chunk-7H3U4IJR.js";
import {
  o
} from "./chunk-SMWUT52Z.js";
import {
  _
} from "./chunk-AXZMNHTN.js";
import {
  f as f3
} from "./chunk-5T3MJDSR.js";
import {
  E,
  T,
  ne
} from "./chunk-NMQNUPE4.js";
import "./chunk-6KIXN4DJ.js";
import "./chunk-7DGJB37R.js";
import "./chunk-234CIOHE.js";
import "./chunk-V2H77UEV.js";
import "./chunk-WRA2WBYC.js";
import "./chunk-XWE6BM2U.js";
import "./chunk-SOIZOFSB.js";
import "./chunk-XXLHAM2M.js";
import {
  b,
  m
} from "./chunk-5EI5H4QX.js";
import {
  a2 as a,
  e as e2
} from "./chunk-ZIE53VIV.js";
import {
  __decorate
} from "./chunk-SS5CLIUY.js";
import {
  A
} from "./chunk-R54Q5TGA.js";
import "./chunk-6SSZNBOK.js";
import "./chunk-LZ2XTYP2.js";
import "./chunk-45CFSCQX.js";
import {
  r
} from "./chunk-A5XN2VFT.js";
import "./chunk-65HD3WXL.js";
import {
  u
} from "./chunk-4DGC7CBY.js";
import {
  $,
  d,
  e,
  e2 as e3,
  h,
  l2 as l,
  s as s2,
  u2,
  y
} from "./chunk-GNMPGHLQ.js";
import {
  f,
  i3 as i,
  s2 as s
} from "./chunk-QY7XKUIV.js";
import {
  L,
  N,
  U,
  has,
  n
} from "./chunk-AL6YUTZM.js";
import "./chunk-G26ADAPQ.js";

// node_modules/@arcgis/core/views/3d/layers/LayerView3D.js
var l10 = (l15) => {
  const n11 = l15;
  let c11 = class extends n11 {
    constructor() {
      super(...arguments), this.slicePlaneEnabled = false, this.supportsHeightUnitConversion = false;
    }
    postscript() {
      super.postscript(), g5(this.layer) && this.addResolvingPromise(this._validateHeightModelInfo());
    }
    async _validateHeightModelInfo() {
      const o12 = new AbortController(), s18 = o12.signal;
      this.addHandles(e(() => o12.abort())), await j(() => this.view.defaultsFromMap?.heightModelInfoReady, s18), s2(s18);
      const i11 = a8(this.layer, this.view.heightModelInfo, this.supportsHeightUnitConversion);
      if (i11) throw i11;
    }
  };
  return __decorate([m()], c11.prototype, "view", void 0), __decorate([m()], c11.prototype, "slicePlaneEnabled", void 0), c11 = __decorate([a("esri.views.3d.layers.LayerView3D")], c11), c11;
};

// node_modules/@arcgis/core/views/3d/layers/graphics/elevationAlignPointsInFeatures.js
async function l11(l15, m9, d15, j6, u20) {
  const { elevationProvider: v7, renderCoordsHelper: g10 } = l15, { elevationInfo: I3 } = m9, { pointsInFeatures: x4, spatialReference: y5 } = j6, h11 = f3.fromJSON(y5), w6 = d8(I3, true), R2 = await a9(w6, h11, u20);
  s2(u20);
  const S4 = [], b9 = /* @__PURE__ */ new Set(), z5 = /* @__PURE__ */ new Set(), E5 = new o9(), F4 = t4(0, 0, 0, f3.WGS84), P6 = new x(), U5 = n2();
  F4.spatialReference = h11;
  const C = l15.elevationProvider.spatialReference ?? l15.spatialReference;
  for (const { objectId: e22, points: o12 } of x4) {
    const t15 = d15(e22);
    if (null == t15) {
      for (const e23 of o12) S4.push(e23.z ?? 0);
      b9.add(e22);
      continue;
    }
    t15.isDraped && z5.add(e22);
    const i11 = t15.graphic.geometry;
    E5.setFromElevationInfo(l8(i11, I3)), R2 && E5.updateFeatureExpressionInfoContextForGraphic(R2, t15.graphic, m9);
    for (const { x: e23, y: n11, z: a16 } of o12) F4.x = e23, F4.y = n11, F4.z = a16 ?? 0, await c3(F4, U5, C, 0, { signal: u20 }), c6(U5, v7, E5, g10, P6), S4.push(P6.z);
  }
  return { elevations: S4, drapedObjectIds: z5, failedObjectIds: b9 };
}

// node_modules/@arcgis/core/renderers/support/rendererConversion.js
function t9(r15) {
  return null == r15 || "simple" === r15.type || "unique-value" === r15.type || "class-breaks" === r15.type || "dictionary" === r15.type || "heatmap" === r15.type;
}
function s10(r15, n11) {
  if (null == r15) return null;
  if (!t9(r15)) return new s("renderer-conversion-3d:unsupported-renderer", `Unsupported renderer of type '${r15.type}'`, { renderer: r15 });
  switch (r15.type) {
    case "simple":
      return u12(r15, n11);
    case "unique-value":
      return a10(r15, n11);
    case "class-breaks":
      return i6(r15, n11);
    case "dictionary":
    case "heatmap":
      return null;
  }
  return null;
}
function l12(r15, n11) {
  if (!n11) return null;
  if (Array.isArray(n11) || (n11 = [n11]), n11.length > 0) {
    const o12 = n11.map((r16) => r16.details.symbol.type || r16.details.symbol.declaredClass).filter((r16) => !!r16);
    o12.sort();
    const t15 = new Array();
    return o12.forEach((r16, e22) => {
      0 !== e22 && r16 === o12[e22 - 1] || t15.push(r16);
    }), new s("renderer-conversion-3d:unsupported-symbols", `Renderer contains symbols (${t15.join(", ")}) which are not supported in 3D`, { renderer: r15, symbolErrors: n11 });
  }
  return null;
}
function u12(r15, e22) {
  const t15 = { ...g4, ...e22, cimFallbackEnabled: true };
  return l12(r15, u7(r15.symbol, t15).error);
}
function a10(e22, t15) {
  const s18 = { ...g4, ...t15, cimFallbackEnabled: true }, u20 = e22.uniqueValueInfos?.map((r15) => u7(r15.symbol, s18).error).filter(N), a16 = u7(e22.defaultSymbol, s18);
  return a16.error && u20?.unshift(a16.error), l12(e22, u20);
}
function i6(e22, t15) {
  const s18 = { ...g4, ...t15, cimFallbackEnabled: true }, u20 = e22.classBreakInfos.map((r15) => u7(r15.symbol, s18).error).filter(N), a16 = u7(e22.defaultSymbol, s18);
  return a16.error && u20.unshift(a16.error), l12(e22, u20);
}

// node_modules/@arcgis/core/views/3d/layers/graphics/DisplayFeatureLimit.js
var e12 = class {
  constructor(e22, m9, t15) {
    this.maximumTotalNumberOfVertices = e22, this.maximumNumberOfFeatures = m9, this.averageSymbolComplexity = t15;
  }
};

// node_modules/@arcgis/core/views/3d/layers/graphics/ElevationQuery.js
var a11 = class {
  constructor(e22, t15) {
    this.spatialReference = e22, this._view = t15;
  }
  getElevation(e22, t15, r15) {
    return this._view.elevationProvider.getElevation(e22, t15, 0, this.spatialReference, r15);
  }
  async queryElevation(e22, t15, r15, s18, i11) {
    return this._view.elevationProvider.queryElevation(e22, t15, 0, this.spatialReference, i11, r15, s18);
  }
};

// node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DFeatureStore.js
var u14 = u4();
var d11 = class extends b {
  constructor(t15) {
    super(t15), this.events = new i2(), this.hasZ = null, this.hasM = null, this.objectIdField = null, this.featureAdapter = { getAttribute: (t16, e22) => "graphic" in t16 ? t16.graphic.attributes[e22] : e7.getAttribute(t16, e22), getAttributeAsTimestamp(t16, e22) {
      const r15 = this.getAttribute(t16, e22);
      return "number" == typeof r15 ? r15 : new Date(r15).getTime();
    }, getAttributes: (t16) => "graphic" in t16 ? t16.graphic.attributes : e7.getAttributes(t16), getObjectId: (t16) => "graphic" in t16 ? R(t16.graphic, this.objectIdField) ?? void 0 : e7.getObjectId(t16), getGeometry: (t16) => "graphic" in t16 ? t16.getAsOptimizedGeometry(this.hasZ, this.hasM) : e7.getGeometry(t16), getCentroid: (t16, e22) => {
      if ("graphic" in t16) {
        let r15 = null;
        null != t16.centroid ? r15 = t16.centroid : "point" === t16.graphic.geometry.type && $2(t16.graphic.geometry, l13, this.viewSpatialReference) && (r15 = l13);
        const o12 = new Array(2 + (e22.hasZ ? 1 : 0) + (e22.hasM ? 1 : 0));
        return null == r15 ? (o12[0] = 0, o12[1] = 0, o12[2] = 0, o12[3] = 0) : (o12[0] = r15.x, o12[1] = r15.y, e22.hasZ && (o12[2] = r15.hasZ ? r15.z : 0), e22.hasM && (o12[e22.hasZ ? 3 : 2] = r15.hasM ? r15.m : 0)), new e6([], o12);
      }
      return e7.getCentroid(t16, e22);
    }, cloneWithGeometry: (t16, e22) => "graphic" in t16 ? new s5(e22, this.featureAdapter.getAttributes(t16), null, this.featureAdapter.getObjectId(t16)) : e7.cloneWithGeometry(t16, e22) };
  }
  forEachInBounds(t15, e22) {
    this.getSpatialIndex().forEachInBounds(t15, e22);
  }
  forEachBounds(t15, e22) {
    const r15 = this.getSpatialIndex();
    for (const o12 of t15) {
      const t16 = this.featureAdapter.getObjectId(o12);
      null != r15.getBounds(t16, u14) && e22(u14);
    }
  }
};
__decorate([m({ constructOnly: true })], d11.prototype, "getSpatialIndex", void 0), __decorate([m({ constructOnly: true })], d11.prototype, "forEach", void 0), __decorate([m({ constructOnly: true })], d11.prototype, "hasZ", void 0), __decorate([m({ constructOnly: true })], d11.prototype, "hasM", void 0), __decorate([m({ constructOnly: true })], d11.prototype, "objectIdField", void 0), __decorate([m({ constructOnly: true })], d11.prototype, "viewSpatialReference", void 0), __decorate([m({ constructOnly: true })], d11.prototype, "featureSpatialReference", void 0), d11 = __decorate([a("esri.views.3d.layers.graphics.Graphics3DFeatureStore")], d11);
var l13 = { type: "point", x: 0, y: 0, hasZ: false, hasM: false, spatialReference: null };

// node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DGraphicCreationContext.js
var r10 = class {
  constructor(r15, s18, t15) {
    this.graphic = r15, this.renderingInfo = s18, this.layer = t15;
  }
};

// node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DSymbolCreationContext.js
var e13 = class {
  constructor(e22, s18, i11, r15) {
    this.scheduler = e22, this.schedule = s18, this.layerViewUid = i11, this.compressionTracker = r15, this.sharedResources = null, this.streamDataRequester = null, this.elevationProvider = null, this.renderer = null, this.stage = null, this.clippingExtent = null, this.renderCoordsHelper = null, this.overlaySR = null, this.layer = null, this.drapeSourceRenderer = null, this.graphicsCoreOwner = null, this.localOriginFactory = null, this.featureExpressionInfoContext = null, this.screenSizePerspectiveEnabled = true, this.slicePlaneEnabled = false, this.physicalBasedRenderingEnabled = false, this.skipHighSymbolLods = false, this.isAsync = false;
  }
  get spherical() {
    return 1 === this.stage.view.state.viewingMode;
  }
};
var s11 = class {
  constructor() {
    this.renderPriority = 0, this.renderPriorityStep = 1, this.ignoreDrivers = false;
  }
};

// node_modules/@arcgis/core/views/3d/webgl-engine/shaders/LineCalloutTechnique.js
var l14 = class extends m3 {
  constructor(e22, r15) {
    super(e22, r15, new t6(u11, () => import("./LineCallout.glsl-3HRHPVRI.js")), a12.locations);
  }
  initializePipeline(e22) {
    const { hudDepth: t15, terrainDepthTest: r15 } = e22, o12 = { func: r15 ? 519 : 513 };
    return T3(t15 ? { depthTest: o12, depthWrite: c5 } : { blending: e9(1, 770, 771, 771), depthTest: o12, colorWrite: d4 });
  }
};
var a12 = Q2().vec3f("position").vec3f("normal").vec2f16("uv0").vec4f("centerOffsetAndDistance");

// node_modules/@arcgis/core/views/3d/webgl-engine/shaders/LineCalloutTechniqueConfiguration.js
var r11 = class extends e8 {
  constructor(e22) {
    super(), this.spherical = e22, this.screenCenterOffsetUnitsEnabled = false, this.occlusionTestEnabled = true, this.hasVerticalOffset = false, this.hasScreenSizePerspective = false, this.hudDepth = false, this.hudDepthAlignStart = false, this.terrainDepthTest = false, this.draped = false;
  }
};
__decorate([i5()], r11.prototype, "screenCenterOffsetUnitsEnabled", void 0), __decorate([i5()], r11.prototype, "occlusionTestEnabled", void 0), __decorate([i5()], r11.prototype, "hasVerticalOffset", void 0), __decorate([i5()], r11.prototype, "hasScreenSizePerspective", void 0), __decorate([i5()], r11.prototype, "hudDepth", void 0), __decorate([i5()], r11.prototype, "hudDepthAlignStart", void 0), __decorate([i5()], r11.prototype, "terrainDepthTest", void 0);

// node_modules/@arcgis/core/views/3d/webgl-engine/materials/LineCalloutMaterial.js
var m7 = class extends s8 {
  constructor(e22, t15) {
    super(e22, S2), this.intersectDraped = void 0, this.produces = /* @__PURE__ */ new Map([[15, (e23) => o7(e23)], [16, (e23) => o7(e23)]]), this._configuration = new r11(t15), this._uniqueMaterialIdentifier = g6(this.parameters);
  }
  passParameters() {
    return this.parameters;
  }
  getConfiguration(e22, t15) {
    return super.getConfiguration(e22, t15, this._configuration), this._configuration.occlusionTestEnabled = this.parameters.occlusionTest, this._configuration.hasVerticalOffset = null != this.parameters.verticalOffset, this._configuration.hasScreenSizePerspective = null != this.parameters.screenSizePerspective, this._configuration.hudDepth = 16 === t15.slot, this._configuration.hudDepthAlignStart = !!this.parameters.hudDepthAlignStart, this._configuration.screenCenterOffsetUnitsEnabled = "screen" === this.parameters.centerOffsetUnits, this._configuration.hasSlicePlane = this.parameters.hasSlicePlane, this._configuration.terrainDepthTest = t15.terrainDepthTest, this._configuration;
  }
  get visible() {
    return this.parameters.color[3] >= o8 || (this.parameters.borderColor?.[3] ?? 0) >= o8;
  }
  intersect() {
  }
  createGLMaterial(e22) {
    return new d12(e22);
  }
  createBufferWriter() {
    return new $4();
  }
  validateParameters(e22) {
    this._uniqueMaterialIdentifier = g6(e22);
  }
  get uniqueMaterialIdentifier() {
    return this._uniqueMaterialIdentifier;
  }
};
function g6({ renderOccluded: t15, isDecoration: r15, horizontalScreenOffset: i11, color: s18, size: n11, occlusionTest: o12, shaderPolygonOffset: a16, hudDepthAlignStart: c11, centerOffsetUnits: l15, hasSlicePlane: h11, screenSizePerspective: u20, verticalOffset: f12, borderColor: p8 }) {
  return f`${t15}:${r15}:${i11}:[${s18}]:${n11}:${o12}:${a16}:${c11}:${l15}:${h11}:${null != u20}:{${f12?.screenLength}:${f12?.minWorldLength}:${f12?.maxWorldLength}}:[${p8}]`;
}
var d12 = class extends t5 {
  beginSlot(e22) {
    return this.getTechnique(l14, e22);
  }
};
var S2 = class extends a6 {
  constructor() {
    super(...arguments), this.horizontalScreenOffset = 0, this.color = r3(0, 0, 0, 1), this.size = 1, this.occlusionTest = false, this.shaderPolygonOffset = 1e-5, this.hudDepthAlignStart = false, this.centerOffsetUnits = "world", this.hasSlicePlane = false;
  }
};
var O3 = [r4(0, 0), r4(1, 0), r4(0, 1), r4(1, 0), r4(1, 1), r4(0, 1)];
var $4 = class {
  constructor() {
    this.layout = a12;
  }
  elementCount(e22) {
    return 6 * e22.get("position").indices.length;
  }
  write(e22, t15, r15, i11, s18, n11) {
    z4(r15.get("position"), e22, s18.position, n11, 6), S(r15.get("normal"), t15, s18.normal, n11, 6), h5(r15.get("centerOffsetAndDistance"), s18.centerOffsetAndDistance, n11, 6);
    for (let o12 = 0; o12 < O3.length; ++o12) s18.uv0.setVec(n11 + o12, O3[o12]);
    return null;
  }
};

// node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer.js
var _O = class _O extends m5 {
  constructor(e22, t15) {
    super(e22, null, t15, w5), this._elevationOptions = { supportsOffsetAdjustment: true, supportsOnTheGround: false }, this.ensureDrapedStatus(false);
  }
  async doLoad() {
    this._materials[0] = new m7(this._materialParameters, this._context.spherical);
  }
  _perInstanceMaterialParameters(e22) {
    const t15 = this._materialParameters;
    return t15.horizontalScreenOffset = e22.horizontalScreenOffset ?? 0, t15.centerOffsetUnits = e22.centerOffsetUnits || "world", t15;
  }
  get _materialParameters() {
    const r15 = new S2(), n11 = this.symbol, s18 = n11.callout;
    if (s18.color) {
      const t15 = u6.toUnitRGBA(s18.color);
      t15[3] *= this._getLayerOpacity(), r15.color = t15;
    } else r15.color = a5;
    if (r15.size = u3(s18.size || 0), n11.verticalOffset) {
      const { screenLength: e22, minWorldLength: i11, maxWorldLength: s19 } = n11.verticalOffset;
      r15.verticalOffset = { screenLength: u3(e22), minWorldLength: i11 || 0, maxWorldLength: null != s19 ? s19 : 1 / 0 };
    }
    r15.borderColor = null != s18.border?.color ? u6.toUnitRGBA(s18.border.color) : null;
    const a16 = "object" === n11.symbolLayers.at(0).type, o12 = "label-3d" === n11.type;
    return r15.occlusionTest = !a16 && !has("enable-feature:non-occluded-hud"), a16 && (r15.shaderPolygonOffset = 0), r15.hudDepthAlignStart = o12, r15.hasSlicePlane = this._context.slicePlaneEnabled, r15.screenSizePerspective = this._context.screenSizePerspectiveEnabled ? this.view.screenSizePerspective.parameters : null, r15;
  }
  _defaultElevationInfoNoZ() {
    return G2;
  }
  createGraphics3DGraphic(e22, t15) {
    const r15 = e22.renderingInfo, n11 = e22.graphic, i11 = this.createElevationContextForGraphic(n11, r15.elevationOffset || 0), s18 = r15.symbol, o12 = "on-the-ground" === this._elevationContext.mode && ("cim" === s18.type || !s18.symbolLayers.some((e23) => "object" === e23.type || "text" === e23.type));
    if ("label-3d" !== s18.type && o12) return null;
    if ("point-3d" === s18.type && s18.symbolLayers.every((e23) => "text" === e23.type && !l7(e23))) return null;
    const l15 = w3(n11.geometry);
    return null == l15 ? null : this._createAs3DShape(l15, i11, r15, n11.uid, t15);
  }
  layerOpacityChanged() {
    this._materials[0]?.setParameters(this._materialParameters);
  }
  layerScreenSizePerspectiveChanged() {
    const e22 = this._context.screenSizePerspectiveEnabled ? this.view.screenSizePerspective.parameters : null;
    this._materials[0]?.setParameters({ screenSizePerspective: e22 });
  }
  layerElevationInfoChanged(e22, t15, r15) {
    const n11 = this._elevationContext.mode, i11 = f8(_O.elevationModeChangeTypes, r15, n11);
    return 1 !== i11 || e22?.forEach((e23) => {
      const r16 = t15(e23);
      null != r16 && this.graphics3DGraphicLayerElevationInfoChanged(e23.graphic, r16);
    }), i11;
  }
  slicePlaneEnabledChanged() {
    return this._materials[0]?.setParameters({ hasSlicePlane: this._context.slicePlaneEnabled }), true;
  }
  physicalBasedRenderingChanged() {
    return true;
  }
  createElevationContextForGraphic(e22, t15 = 0) {
    const r15 = super.createElevationContextForGraphic(e22);
    return r15.addOffsetRenderUnits(t15), r15;
  }
  updateElevationContextForGraphic(e22, t15, r15 = 0) {
    super.updateElevationContextForGraphic(e22, t15), e22.addOffsetRenderUnits(r15);
  }
  graphics3DGraphicLayerElevationInfoChanged(e22, t15) {
    const { elevationContext: r15, metadata: n11 } = t15;
    this.updateElevationContextForGraphic(r15, e22, n11?.elevationOffset ?? 0), t15.needsElevationUpdates = d7(r15.mode);
  }
  computeComplexity() {
    return new e11({ verticesPerFeature: 6 });
  }
  _getOrCreateMaterial(e22, t15) {
    const r15 = this._perInstanceMaterialParameters(e22), n11 = g6(r15);
    if (n11 === this._materials[0]?.uniqueMaterialIdentifier) return this._materials[0];
    if (t15) {
      let e23 = t15.get(n11);
      return null == e23 && (e23 = new m7(r15, this._context.spherical), t15.set(n11, e23)), e23;
    }
    return new m7(r15, this._context.spherical);
  }
  _createAs3DShape(e22, t15, r15, n11, i11) {
    const s18 = this._context.layerViewUid, a16 = this._context.stage.renderView.getObjectAndLayerIdColor({ graphicUid: n11, layerViewUid: s18 }), l15 = this._getOrCreateMaterial(r15, i11), h11 = new m2(l15, j3(r15), null, 1, a16), d15 = p4(this._context, e22, h11, t15, n11);
    if (null == d15) return null;
    const f12 = new O2(this, d15.object, null, u10, t15);
    return f12.metadata = new t8(r15.elevationOffset), f12.alignedSampledElevation = d15.sampledElevation, f12.needsElevationUpdates = d7(t15.mode), f9(f12, e22, this._context.elevationProvider), f12;
  }
};
_O.elevationModeChangeTypes = { definedChanged: 1, staysOnTheGround: 1, onTheGroundChanged: 2 };
var O4 = _O;
function j3(e22) {
  const { translation: t15, centerOffset: r15 } = e22, n11 = new t3(t15 ? [t15[0], t15[1], t15[2]] : [0, 0, 0], P4, 3, true), i11 = new t3(r15 ? [r15[0], r15[1], r15[2], r15[3]] : [0, 0, 0, 1], P4, 4, true);
  return [["position", n11], ["normal", new t3([0, 0, 1], P4, 3, true)], ["centerOffsetAndDistance", i11]];
}
var P4 = [0];
var G2 = { mode: "relative-to-ground", offset: 0 };
var w5 = { ignoreDrivers: true, renderPriority: 0, renderPriorityStep: 1 };
var E3 = class extends l9 {
  constructor(e22, t15, i11 = n2(), s18 = n3(), a16 = 0, o12 = "world", l15 = 0) {
    super(e22, t15), this.translation = i11, this.centerOffset = s18, this.horizontalScreenOffset = a16, this.centerOffsetUnits = o12, this.elevationOffset = l15;
  }
};

// node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory.js
var t10 = () => i.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");
function e14(o12, l15) {
  if (!o6(o12)) return t10().error("Graphics3DCalloutSymbolLayerFactory#make", `symbol of type '${o12.type}' does not support callouts`), null;
  if (!o12.callout) return null;
  const e22 = a13[o12.callout.type];
  return e22 ? new e22(o12, l15) : (t10().error("Graphics3DCalloutSymbolLayerFactory#make", `unknown or unsupported callout type ${o12.callout.type}`), null);
}
var a13 = { line: O4 };

// node_modules/@arcgis/core/geometry/projection/projectBoundingRect.js
function i7(r15, i11, s18, f12) {
  return null != r15 && (T(i11, f12) ? (a4(s18, r15), true) : (p5[0] = r15[0], p5[1] = r15[1], p5[2] = 0, !!o2(p5, i11, 0, p5, f12, 0) && (s18[0] = p5[0], s18[1] = p5[1], p5[0] = r15[2], p5[1] = r15[3], p5[2] = 0, !!o2(p5, i11, 0, p5, f12, 0) && (s18[2] = p5[0], s18[3] = p5[1], true))));
}
var p5 = n2();

// node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DGraphic.js
var G3 = new e2(() => u4(), (e22) => k(e22, Q), null, 10, 5);
var j4 = i3();
var v3 = class {
  get labelLayers() {
    return this._labelLayers || U;
  }
  get extent() {
    return this._extent;
  }
  get isElevationSource() {
    return this.layers.some((e22) => e22?.isElevationSource);
  }
  constructor(e22, t15, i11) {
    this.graphic = e22, this.graphics3DSymbol = t15, this.layers = i11, this._visibleFlags = 255, ++t15.referenced;
  }
  initialize(e22) {
    this._layer = e22, this._forEachSymbolLayerGraphic((t15) => {
      t15.initialize(e22), t15.setVisibility(this.isVisible());
    });
  }
  destroy() {
    this._forEachSymbolLayerGraphic((e22) => e22.destroy()), this._calloutLayer = null, --this.graphics3DSymbol.referenced, this.graphics3DSymbol = null;
  }
  get destroyed() {
    return null == this.layers;
  }
  clearLabelGraphics() {
    this._forEachLabelGraphic((e22) => e22.destroy()), this._labelLayers = null;
  }
  addLabelGraphic(e22, t15) {
    this._labelLayers || (this._labelLayers = new Array()), this._labelLayers.push(e22), e22.initialize(t15), e22.setVisibility(this.isVisible(16));
  }
  setCalloutGraphic(e22) {
    this._calloutLayer = e22, this._layer && (e22.initialize(this._layer), e22.setVisibility(this.isVisible()));
  }
  get calloutLayer() {
    return this._calloutLayer;
  }
  get isDraped() {
    let e22 = false;
    return this._forEachSymbolLayerGraphic((t15) => {
      "draped" === t15.type && (e22 = true);
    }), e22;
  }
  isVisible(e22 = 1, t15) {
    const i11 = t15 ? this._visibleFlags | t15 | 16 * t15 : this._visibleFlags;
    return 1 === e22 ? !(15 & ~i11) : !(255 & ~i11);
  }
  setVisibilityFlag(e22, t15, i11) {
    const r15 = this.isVisible(e22);
    i11 ? this._visibleFlags |= e22 * t15 : this._visibleFlags &= ~(e22 * t15);
    const s18 = this.isVisible(e22);
    if (r15 === s18) return false;
    if (16 === e22) this._forEachLabelGraphic((e23) => e23.setVisibility(s18));
    else {
      this._forEachSymbolLayerGraphic((e24) => e24.setVisibility(s18));
      const e23 = this.isVisible(16);
      this._forEachLabelGraphic((t16) => t16.setVisibility(e23));
    }
    return true;
  }
  getVisibilityFlag(e22, t15) {
    return 0 !== (this._visibleFlags & e22 * t15);
  }
  computeExtent(e22) {
    if (!this._extent) {
      const t15 = this.graphic.geometry;
      if (null == t15) return false;
      this._extent = i3(), z3(t15, this._extent);
      const i11 = t15.spatialReference;
      if (!T(i11, e22) && !i7(this._extent, i11, this._extent, e22)) return this._extent = null, false;
    }
    return true;
  }
  getAsOptimizedGeometry(e22, t15) {
    return this._optimizedGeometry || (this._optimizedGeometry = this._convertGraphicToOptimizedGeometry(this.graphic, e22, t15)), this._optimizedGeometry;
  }
  _convertGraphicToOptimizedGeometry(e22, t15, i11) {
    let r15 = e22.geometry;
    return "mesh" !== r15.type && "extent" !== r15.type || (r15 = P.fromExtent("mesh" === r15.type ? r15.extent : r15)), ut(r15, t15, i11);
  }
  get usedMemory() {
    let e22 = e5(this.graphic.attributes);
    return this._forEachSymbolLayerGraphic((t15) => e22 += t15.usedMemory), e22;
  }
  computeAttachmentOrigin() {
    const e22 = { render: { origin: n2(), num: 0 }, draped: { origin: n4(), num: 0 } };
    for (const t15 of this.layers) null != t15 && t15.computeAttachmentOrigin(e22);
    return e22.render.num > 1 && g2(e22.render.origin, e22.render.origin, 1 / e22.render.num), e22.draped.num > 1 && l4(e22.draped.origin, e22.draped.origin, 1 / e22.draped.num), e22;
  }
  async getProjectedBoundingBox(e22, i11, r15, s18, a16) {
    return a16 || (a16 = { boundingBox: null, requiresDrapedElevation: false, screenSpaceObjects: [] }), a16.boundingBox ? q(a16.boundingBox) : a16.boundingBox = q(), a16.requiresDrapedElevation = false, await a3(this.layers, async (t15) => {
      if (null == t15) return;
      const o12 = "draped" === t15.type ? i11 : e22, l15 = G3.acquire(), n11 = await t15.getProjectedBoundingBox(o12, r15, a16.screenSpaceObjects, s18, l15);
      isFinite(n11[2]) && isFinite(n11[5]) || (a16.requiresDrapedElevation = true), n11 && M2(a16.boundingBox, l15), G3.release(l15);
    }), T2(a16.boundingBox) || s4(w2(a16.boundingBox, j4)) ? a16 : null;
  }
  needsElevationUpdates() {
    for (const e22 of this.layers) if (null != e22 && ("object3d" === e22.type || "lod-instance" === e22.type) && e22.needsElevationUpdates) return true;
    return this._labelLayers?.some((e22) => e22?.needsElevationUpdates ?? false) ?? false;
  }
  alignWithElevation(e22, t15, i11) {
    this._forEachRenderedGraphic((r15) => {
      "object3d" !== r15.type && "lod-instance" !== r15.type || r15.alignWithElevation(e22, t15, i11);
    });
  }
  alignWithAbsoluteElevation(e22, t15, i11) {
    this._forEachRenderedGraphic((r15) => {
      "object3d" === r15.type && r15.alignWithAbsoluteElevation(e22, t15, i11);
    });
  }
  addObjectStateSet(e22) {
    this._forEachSymbolLayerGraphic((t15) => t15.addObjectState(e22));
  }
  removeObjectState(e22) {
    this._forEachSymbolLayerGraphic((t15) => t15.removeObjectState(e22));
  }
  updateHighlights(e22) {
    this._forEachSymbolLayerGraphic((t15) => t15.updateHighlights(e22));
  }
  _forEachGraphicList(e22, t15) {
    e22?.forEach((e23) => e23 && t15(e23));
  }
  _forEachSymbolLayerGraphic(e22) {
    this._forEachGraphicList(this.layers, e22), this._calloutLayer && e22(this._calloutLayer);
  }
  _forEachLabelGraphic(e22) {
    this._forEachGraphicList(this.labelLayers, e22);
  }
  _forEachRenderedGraphic(e22) {
    this._forEachSymbolLayerGraphic(e22), this._forEachLabelGraphic(e22);
  }
  get test() {
  }
};

// node_modules/@arcgis/core/views/3d/layers/graphics/symbolMemory.js
var e15 = 2216;
var o10 = 4096;
function r12(r15) {
  return e15 + o10 * r15.symbolLayers.length + r15.complexity.memory.resourceBytes;
}

// node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DSymbol.js
var h6 = class extends r9 {
  set symbol(e22) {
    this._symbol = e22, e22.symbolLayers.forEach((t15, r15) => {
      const s18 = this.symbolLayers[r15];
      null != s18 && (s18.symbol = e22, s18.symbolLayer = t15);
    });
  }
  get symbol() {
    return this._symbol;
  }
  constructor(e22, t15, r15) {
    super(t15.schedule), this._symbol = e22, this._context = t15, this._backgroundLayers = r15, this._destroyed = false, this.symbolLayers = new Array(), this.referenced = 0, this._extentPadding = 0;
  }
  async doLoad(e22) {
    let o12 = this._symbol.symbolLayers;
    this._extentPadding = 0, this._backgroundLayers && (o12 = this._backgroundLayers.concat(o12));
    const a16 = o12.length;
    for (; this.symbolLayers.length < o12.length; ) this.symbolLayers.push(null);
    this.symbolLayers.length = o12.length;
    const i11 = [];
    if (!m8) {
      const { make: e23 } = await import("./Graphics3DSymbolLayerFactory-TMTKRGVS.js");
      m8 = e23;
    }
    for (let t15 = 0; t15 < a16; t15++) {
      const s18 = o12.at(t15);
      if (false === s18.enabled) continue;
      c7.renderPriority = 1 - (1 + t15) / a16, c7.renderPriorityStep = 1 / a16, c7.ignoreDrivers = s18.ignoreDrivers;
      const n11 = m8(this.symbol, s18, this._context, c7), l15 = h(e22, () => {
        this.symbolLayers[t15] = null, n11.destroy();
      });
      l15 && i11.push(l15), this.symbolLayers[t15] = n11;
    }
    if (await a3(this.symbolLayers, async (e23, t15) => {
      if (null != e23) try {
        await e23.load(), this._extentPadding += Math.max(this._extentPadding, e23.extentPadding);
      } catch {
        this.symbolLayers[t15] = null;
      }
    }), i11.forEach((e23) => e23.remove()), s2(e22), this.symbolLayers.length && !this.symbolLayers.some((e23) => !!e23)) throw new Error();
  }
  getSymbolLayerSize(e22) {
    const t15 = this.symbolLayers[e22];
    return null != t15 ? t15.getCachedSize() : null;
  }
  get extentPadding() {
    return this._extentPadding;
  }
  get symbologySnappingSupported() {
    return this.symbolLayers.some((e22) => e22?.queryForSnapping);
  }
  get needsUpdateFocus() {
    return this.symbolLayers.some((e22) => true === e22?.needsUpdateFocus);
  }
  createGraphics3DGraphic(e22, t15) {
    const { graphic: r15 } = e22, s18 = this.symbolLayers.map((t16) => t16?.createGraphics3DGraphic(e22) ?? null);
    return new v3(r15, t15 || this, s18);
  }
  get complexity() {
    return F2(this.symbolLayers.map((e22) => e22?.complexity));
  }
  globalPropertyChanged(e22, t15) {
    const r15 = this.symbolLayers.length;
    for (let s18 = 0; s18 < r15; s18++) {
      const r16 = this.symbolLayers[s18], o12 = (e23) => {
        const t16 = e23.layers[s18];
        return t16 instanceof O2 ? t16 : null;
      };
      if (null != r16 && !r16.globalPropertyChanged(e22, t15, o12)) return false;
    }
    return true;
  }
  applyRendererDiff(e22, t15) {
    return 1 !== this.loadStatus ? 0 : this.symbolLayers.reduce((r15, s18) => 0 !== r15 && null != s18 ? Math.min(r15, s18.applyRendererDiff(e22, t15)) : r15, 2);
  }
  prepareSymbolPatch(e22) {
    if (2 === this.loadStatus) return;
    if ("partial" !== e22.diff.type) return;
    const t15 = e22.diff.diff;
    if (!t15.symbolLayers || "partial" !== t15.symbolLayers.type) return;
    const r15 = t15.symbolLayers.diff;
    this.symbolLayers.forEach((t16, s18) => {
      if (null == t16) return;
      const o12 = r15[s18];
      if (o12) {
        const r16 = { diff: o12, graphics3DGraphicPatches: [], symbolLayerStatePatches: [] };
        t16.prepareSymbolLayerPatch(r16), e22.symbolStatePatches.push(...r16.symbolLayerStatePatches), r16.graphics3DGraphicPatches.length && e22.graphics3DGraphicPatches.push((e23, t17) => {
          const o13 = e23.layers[s18];
          null != o13 && r16.graphics3DGraphicPatches.forEach((e24) => e24(o13, t17));
        });
      }
    });
  }
  updateGeometry(e22) {
    return this._updateGeometryOrTransform(e22, (t15, r15) => !!t15.updateGeometry && t15.updateGeometry(e22.graphic, r15));
  }
  updateTransform(e22, t15, r15, s18) {
    return this._updateGeometryOrTransform(e22, (e23, o12) => !!e23.updateTransform && e23.updateTransform(o12, t15, r15, s18));
  }
  _updateGeometryOrTransform(e22, t15) {
    for (let r15 = 0; r15 < this.symbolLayers.length; r15++) {
      const s18 = this.symbolLayers[r15];
      if (null == s18) continue;
      const o12 = e22.layers[r15];
      if (!o12 || !t15(s18, o12)) return false;
    }
    return true;
  }
  onRemoveGraphic(e22) {
    for (let t15 = 0; t15 < this.symbolLayers.length; t15++) {
      const r15 = this.symbolLayers[t15];
      if (null == r15) continue;
      const s18 = e22.layers[t15];
      null != s18 && r15.onRemoveGraphic(s18);
    }
  }
  getFastUpdateStatus() {
    let e22 = false, t15 = false;
    for (const r15 of this.symbolLayers) if (null != r15) {
      if (0 === r15.loadStatus) return 3;
      r15.isFastUpdatesEnabled() ? t15 = true : e22 = true;
    }
    return t15 ? e22 ? 2 : 1 : e22 ? 0 : 4;
  }
  async queryForSnapping(t15, r15, o12, a16) {
    const i11 = this.symbolLayers.filter(N).filter((e22) => null != e22.queryForSnapping).map((e22) => e22.queryForSnapping(t15, r15, o12, a16)), n11 = await Promise.all(i11);
    return s2(a16), n11.flat();
  }
  destroy() {
    if (!this.destroyed) {
      super.destroy();
      for (const e22 of this.symbolLayers) null != e22 && e22.destroy();
      this.symbolLayers.length = 0, this._destroyed = true;
    }
  }
  get destroyed() {
    return this._destroyed;
  }
  get usedMemory() {
    return r12(this);
  }
};
var m8 = null;
var c7 = new s11();

// node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DPointSymbol.js
var s12 = class extends h6 {
  constructor(r15, o12, t15) {
    super(r15, o12, t15), this._calloutSymbolLayer = null, this.symbol.hasVisibleCallout() && (this._calloutSymbolLayer = e14(this.symbol, o12));
  }
  async doLoad(o12) {
    const a16 = this._calloutSymbolLayer ? _2(this._calloutSymbolLayer.load()) : null;
    try {
      await super.doLoad(o12), s2(o12);
    } catch (l15) {
      throw this._calloutSymbolLayer?.abortLoad(), l15;
    }
    a16 && await a16;
  }
  destroy() {
    super.destroy(), this._calloutSymbolLayer = u2(this._calloutSymbolLayer);
  }
  createGraphics3DGraphic(r15, o12) {
    const t15 = super.createGraphics3DGraphic(r15, o12);
    if (null != this._calloutSymbolLayer && null != t15) {
      const o13 = this._createCalloutGraphic(r15);
      o13 && t15.setCalloutGraphic(o13);
    }
    return t15;
  }
  globalPropertyChanged(r15, o12) {
    return !!super.globalPropertyChanged(r15, o12) && (!this._calloutSymbolLayer || this._calloutSymbolLayer.globalPropertyChanged(r15, o12, (r16) => r16.calloutLayer));
  }
  updateGeometry(r15) {
    const o12 = super.updateGeometry(r15);
    if (o12 && this._calloutSymbolLayer) {
      const o13 = r15.calloutLayer;
      if (o13) return this._calloutSymbolLayer.updateGeometry?.(r15.graphic, o13) ?? false;
    }
    return o12;
  }
  _createCalloutGraphic(r15) {
    const o12 = r15.renderingInfo;
    return r15.renderingInfo = new E3(o12.renderer, o12.symbol), this._calloutSymbolLayer.createGraphics3DGraphic(r15);
  }
};

// node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DSymbolFactory.js
function t11(t15, i11, n11) {
  return "point-3d" === t15.type ? new s12(t15, i11, n11) : new h6(t15, i11, n11);
}

// node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DWebStyleSymbol.js
var e16 = class extends r9 {
  constructor(t15, r15, s18) {
    super(r15), this.symbol = t15, this._convert = s18, this.symbologySnappingSupported = false, this.graphics3DSymbol = null, this.referenced = 0;
  }
  getSymbolLayerSize(t15) {
    return null != this.graphics3DSymbol ? this.graphics3DSymbol.getSymbolLayerSize(t15) : null;
  }
  get symbolLayers() {
    return null != this.graphics3DSymbol ? this.graphics3DSymbol.symbolLayers : [];
  }
  get extentPadding() {
    return null != this.graphics3DSymbol ? this.graphics3DSymbol.extentPadding : 0;
  }
  async doLoad(t15) {
    const r15 = await this.symbol.fetchSymbol({ signal: t15 });
    r15.id = this.symbol.id, this.graphics3DSymbol = this._convert(r15), null != this.graphics3DSymbol && await this.graphics3DSymbol.load();
  }
  createGraphics3DGraphic(t15) {
    return null != this.graphics3DSymbol ? this.graphics3DSymbol.createGraphics3DGraphic(t15, this) : null;
  }
  get complexity() {
    return null != this.graphics3DSymbol ? this.graphics3DSymbol.complexity : P3;
  }
  globalPropertyChanged(t15, r15) {
    return null != this.graphics3DSymbol && this.graphics3DSymbol.globalPropertyChanged(t15, r15);
  }
  applyRendererDiff(t15, r15) {
    return null != this.graphics3DSymbol ? this.graphics3DSymbol.applyRendererDiff(t15, r15) : 0;
  }
  prepareSymbolPatch(t15) {
    null != this.graphics3DSymbol && this.graphics3DSymbol.prepareSymbolPatch(t15);
  }
  updateGeometry(t15) {
    return null != this.graphics3DSymbol && this.graphics3DSymbol.updateGeometry(t15);
  }
  updateTransform(t15, r15, s18, e22) {
    return this.graphics3DSymbol?.updateTransform(t15, r15, s18, e22) ?? false;
  }
  onRemoveGraphic() {
  }
  get needsUpdateFocus() {
    return false;
  }
  getFastUpdateStatus() {
    return this.graphics3DSymbol?.getFastUpdateStatus() ?? 3;
  }
  destroy() {
    null != this.graphics3DSymbol && this.graphics3DSymbol.destroy(), this.graphics3DSymbol = void 0, super.destroy();
  }
  get destroyed() {
    return void 0 === this.graphics3DSymbol;
  }
  get usedMemory() {
    return r12(this);
  }
};

// node_modules/@arcgis/core/views/3d/layers/graphics/GraphicsCorePerformanceInfo.js
var s13 = class {
  constructor(s18, i11, t15, h11) {
    this.total = s18, this.visible = i11, this.missing = t15, this.pending = h11;
  }
};

// node_modules/@arcgis/core/views/3d/layers/graphics/GraphicStateTracking.js
var s14 = class {
  constructor(t15) {
    this._graphicsCore = t15, this._idToState = /* @__PURE__ */ new Map(), this._states = /* @__PURE__ */ new Set();
    const i11 = t15.owner.layer?.objectIdField;
    i11 ? (this._getGraphicId = (t16) => R(t16, i11), this._getGraphics3DGraphicById = (t16) => this._graphicsCore.getGraphics3DGraphicByObjectId(t16)) : (this._getGraphicId = (t16) => t16.uid, this._getGraphics3DGraphicById = (t16) => this._graphicsCore.getGraphics3DGraphicById(t16));
  }
  destroy() {
    this._idToState.clear(), this._states.forEach((t15, i11) => this.remove(i11));
  }
  add(t15) {
    const e22 = e(() => this.remove(t15));
    if (this._states.has(t15)) return e22;
    const s18 = this._getGraphicId(t15.graphic), a16 = this._getGraphics3DGraphicById(s18);
    this._states.has(t15) || this._states.add(t15);
    return this._ensureStateList(s18).push(t15), t15.displaying = a16?.isVisible() ?? false, t15.isDraped = a16?.isDraped ?? false, t15.tracking = true, null != a16 && t15.emit("changed"), e22;
  }
  remove(i11) {
    if (this._states.has(i11)) {
      if (this._idToState.size) {
        const e22 = this._getGraphicId(i11.graphic), s18 = this._idToState.get(e22);
        s18 && (L(s18, i11), 0 === s18.length && this._idToState.delete(e22));
      }
      this._states.delete(i11), i11.tracking = false, i11.displaying = false;
    }
  }
  addGraphic(t15) {
    this._forEachState(t15.graphic, (i11) => {
      i11.displaying = t15.isVisible(), i11.isDraped = t15.isDraped, i11.emit("changed");
    });
  }
  removeGraphic(t15) {
    this._forEachState(t15.graphic, (t16) => {
      t16.displaying = false, t16.isDraped = false;
    });
  }
  updateGraphicGeometry(t15) {
    this._forEachState(t15.graphic, (t16) => t16.emit("changed"));
  }
  updateGraphicVisibility(t15) {
    this._forEachState(t15.graphic, (i11) => i11.displaying = t15.isVisible());
  }
  updateGraphicError(t15, i11) {
    this._forEachState(t15, (t16) => t16.error = i11);
  }
  allGraphicsDeleted() {
    this._states.forEach((t15) => t15.displaying = false);
  }
  _ensureStateList(t15) {
    const i11 = this._idToState.get(t15);
    if (i11) return i11;
    const e22 = new Array();
    return this._idToState.set(t15, e22), e22;
  }
  _forEachState(t15, i11) {
    if (0 === this._states.size || 0 === this._idToState.size) return;
    const e22 = this._getGraphicId(t15), s18 = this._idToState.get(e22);
    null != s18 && s18.forEach(i11);
  }
};

// node_modules/@arcgis/core/views/3d/layers/graphics/SpatialIndex2D.js
var d13 = class extends b {
  constructor(t15) {
    super(t15), this._index = new s6(9, has("esri-csp-restrictions") ? (t16) => ({ minX: t16.extent[0], minY: t16.extent[1], maxX: t16.extent[2], maxY: t16.extent[3] }) : [".extent[0]", ".extent[1]", ".extent[2]", ".extent[3]"]), this._missing = /* @__PURE__ */ new Set(), this._boundsByFeature = /* @__PURE__ */ new Map(), this.spatialReference = null, this.hasZ = null, this.hasM = null, this.objectIdField = null, this.updating = false;
  }
  setup(t15) {
    this._addMany(t15);
  }
  destroy() {
    this._missing.clear(), this._index = u2(this._index), this._boundsByFeature.clear(), this._boundsByFeature = null;
  }
  update() {
    this._missing.size > 0 && (this._addMany(Array.from(this._missing.values())), this.updating = false, this._missing.clear());
  }
  get updatingRemaining() {
    return this._missing.size;
  }
  queryGraphicUIDsInExtent(t15, e22, s18) {
    null != e22 && e22.equals(this.spatialReference) && (u15.minX = t15[0], u15.minY = t15[1], u15.maxX = t15[2], u15.maxY = t15[3], this.update(), this._index.search(u15, (t16) => s18(t16.graphic.uid)));
  }
  add(t15) {
    this._missing.add(t15), this.updating = true;
  }
  remove(t15) {
    if (this._missing.delete(t15)) return void (this.updating = this._missing.size > 0);
    if (!t15.extent) return;
    this._index.remove(t15);
    const e22 = R(t15.graphic, this._get("objectIdField"));
    null != e22 && this._boundsByFeature.delete(e22);
  }
  _addMany(t15) {
    if (0 === t15.length) return;
    const e22 = this._get("objectIdField");
    for (const s18 of t15) {
      s18.computeExtent(this.spatialReference);
      const t16 = R(s18.graphic, e22);
      null != t16 && this._boundsByFeature.set(t16, s18.extent);
    }
    this._index.load(t15);
  }
  clear() {
    this._index.clear(), this._missing.clear(), this._boundsByFeature.clear(), this.updating = false;
  }
  forEachInBounds(t15, e22) {
    u15.minX = t15[0], u15.minY = t15[1], u15.maxX = t15[2], u15.maxY = t15[3], this.update(), this._index.search(u15, (t16) => {
      e22(t16);
    });
  }
  getBounds(t15, e22) {
    this.update();
    const s18 = this._boundsByFeature.get(t15);
    return s18 ? B(e22, s18) : null;
  }
};
__decorate([m({ constructOnly: true })], d13.prototype, "spatialReference", void 0), __decorate([m({ constructOnly: true })], d13.prototype, "hasZ", void 0), __decorate([m({ constructOnly: true })], d13.prototype, "hasM", void 0), __decorate([m({ constructOnly: true })], d13.prototype, "objectIdField", void 0), __decorate([m()], d13.prototype, "updating", void 0), __decorate([m({ readOnly: true })], d13.prototype, "updatingRemaining", null), d13 = __decorate([a("esri.views.3d.layers.graphics.SpatialIndex2D")], d13);
var u15 = { minX: 0, minY: 0, maxX: 0, maxY: 0 };

// node_modules/@arcgis/core/views/3d/terrain/ElevationUpdateEvent.js
var e17 = class {
  constructor(e22 = "scene") {
    this.context = e22, this.extent = K(), this.spatialReference = null;
  }
};

// node_modules/@arcgis/core/views/3d/layers/support/StageLayerElevationProvider.js
var u16 = 1;
var f10 = Symbol("layerHandles");
var g7 = class extends l2 {
  get spatialReference() {
    return this.view.spatialReference;
  }
  constructor(e22) {
    super(e22), this._elevationOffset = 0;
  }
  initialize() {
    this._renderCoordsHelper = this.view.renderCoordsHelper, this._intersectLayers = [this.stageLayer], this._intersector = new u8(this.view.state.viewingMode), this._intersector.options.store = 0;
    const e22 = this._computeLayerExtent(this.spatialReference, this.stageLayer);
    this._zmin = e22[2], this._zmax = e22[5];
    const t15 = this.stageLayer.events;
    this.addHandles([t15.on(["layerObjectAdded", "layerObjectRemoved", "transformationChanged", "shaderTransformationChanged"], (e23) => this._objectChanged(e23)), t15.on(["geometryAdded", "geometryRemoved"], ({ object: e23 }) => this._objectChanged(e23)), t15.on("attributesChanged", ({ attribute: e23, object: t16 }) => n8(e23) && this._objectChanged(t16))], f10);
  }
  destroy() {
    this.removeHandles(f10);
  }
  elevationInfoChanged() {
    const e22 = null != this.layer ? this.layer.elevationInfo : null;
    if (null != e22 && "on-the-ground" !== e22.mode) {
      const t15 = ne(this.layer.spatialReference), r15 = n5(e22.unit ?? "meters");
      this._elevationOffset = (e22.offset ?? 0) * r15 / t15;
    } else this._elevationOffset = 0;
  }
  getElevation(e22, t15, o12, s18) {
    if (x2[0] = e22, x2[1] = t15, x2[2] = o12, !this._renderCoordsHelper.toRenderCoords(x2, s18, x2)) return i.getLogger(this).error("could not project point for elevation alignment"), null;
    const i11 = this._elevationOffset, n11 = this._zmin + i11, a16 = this._zmax + i11;
    this._renderCoordsHelper.setAltitude(b7, a16, x2), this._renderCoordsHelper.setAltitude(j5, n11, x2);
    const l15 = (e23) => !!e23.lastValidElevationBB;
    return this._intersector.reset(b7, j5, null), this._intersector.intersect(this._intersectLayers, null, u16, null, l15), this._intersector.results.min.getIntersectionPoint(x2) ? this._renderCoordsHelper.getAltitude(x2) : null;
  }
  _objectChanged(e22) {
    const t15 = this.spatialReference;
    if (!e22.lastValidElevationBB || !t15) return;
    q(_4);
    const r15 = e22.lastValidElevationBB;
    r15.isEmpty() || this._expandExtent(t15, r15.min, r15.max, _4);
    const { min: o12, max: s18 } = e22.boundingVolumeWorldSpace;
    this._expandExtent(t15, o12, s18, _4), w2(_4, v4.extent), this._zmin = Math.min(this._zmin, _4[2]), this._zmax = Math.max(this._zmax, _4[5]), v4.spatialReference = t15, this.emit("elevation-change", v4), v4.spatialReference = null, r15.assignMinMax(o12, s18);
  }
  _computeLayerExtent(e22, t15) {
    return q(_4), null != e22 && t15.objects.forEach((t16) => this._expandExtent(e22, t16.boundingVolumeWorldSpace.min, t16.boundingVolumeWorldSpace.max, _4)), _4;
  }
  _expandExtent(e22, t15, r15, o12) {
    for (let s18 = 0; s18 < 8; ++s18) x2[0] = 1 & s18 ? t15[0] : r15[0], x2[1] = 2 & s18 ? t15[1] : r15[1], x2[2] = 4 & s18 ? t15[2] : r15[2], this._renderCoordsHelper.fromRenderCoords(x2, x2, e22), l5(o12, x2);
    return o12;
  }
};
__decorate([m({ constructOnly: true })], g7.prototype, "layer", void 0), __decorate([m({ constructOnly: true })], g7.prototype, "stageLayer", void 0), __decorate([m({ constructOnly: true })], g7.prototype, "view", void 0), __decorate([m()], g7.prototype, "spatialReference", null), g7 = __decorate([a("esri.views.3d.layers.support.StageLayerElevationProvider")], g7);
var _4 = q();
var v4 = new e17();
var x2 = n2();
var b7 = n2();
var j5 = n2();

// node_modules/@arcgis/core/views/3d/support/extentUtils.js
function u17(l15, m9, u20) {
  if (null == l15 || null == u20) return false;
  let i11 = true;
  return e18[0] = null != l15.xmin ? l15.xmin : 0, e18[1] = null != l15.ymin ? l15.ymin : 0, e18[2] = null != l15.zmin ? l15.zmin : 0, i11 = i11 && o2(e18, l15.spatialReference, 0, e18, u20, 0), m9[0] = e18[0], m9[1] = e18[1], e18[0] = null != l15.xmax ? l15.xmax : 0, e18[1] = null != l15.ymax ? l15.ymax : 0, e18[2] = null != l15.zmax ? l15.zmax : 0, i11 = i11 && o2(e18, l15.spatialReference, 0, e18, u20, 0), m9[2] = e18[0], m9[3] = e18[1], null == l15.xmin && (m9[0] = -1 / 0), null == l15.ymin && (m9[1] = -1 / 0), null == l15.xmax && (m9[2] = 1 / 0), null == l15.ymax && (m9[3] = 1 / 0), i11;
}
var e18 = n2();

// node_modules/@arcgis/core/views/support/TextureCompressionTracker.js
var e19 = class {
  constructor() {
    this._pendingCompressionTasks = r2(0);
  }
  get compressing() {
    return !!this._pendingCompressionTasks.value;
  }
  increment() {
    this._pendingCompressionTasks.value++;
  }
  decrement() {
    this._pendingCompressionTasks.value--;
  }
};

// node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DCore.js
var Fe;
var Te = n2();
var Me = u4();
var _a;
var ke = (_a = class extends b {
  get _viewSpatialReference() {
    return this.owner.view.spatialReference;
  }
  get spatialIndex() {
    return this._spatialIndex || (this._spatialIndex = new d13({ objectIdField: this.owner.layer?.objectIdField, spatialReference: this._viewSpatialReference, hasZ: !!this.hasZ, hasM: !!this.hasM }), this._spatialIndex.setup(Array.from(this.graphics3DGraphics.values()))), this._spatialIndex.update(), this._spatialIndex;
  }
  get deconflictor() {
    return this._deconflictor;
  }
  get labeler() {
    return this._labeler;
  }
  get numberOfGraphics() {
    return this._numberOfGraphics;
  }
  get effectiveUpdatePolicy() {
    return null != this.currentRenderer && "dictionary" === this.currentRenderer.type ? 0 : this._forcedUpdatePolicy ?? this.preferredUpdatePolicy;
  }
  get featureStore() {
    return this._featureStore;
  }
  get initializePromise() {
    return this._initializePromise;
  }
  get scaleVisibility() {
    return this._scaleVisibility;
  }
  get elevationAlignment() {
    return this._elevationAlignment;
  }
  get objectStates() {
    return this._objectStates;
  }
  get filterVisibility() {
    return this._filterVisibility;
  }
  get updating() {
    return !!(this.dataUpdating || this._elevationAlignment?.updating || this._scaleVisibility?.updating || this._filterVisibility?.updating || this._rendererChangeAbortController || this._elevationInfoChangeAbortController || this._frameTaskHandle.updating || this._updateQueue.updating || this.readyToRun);
  }
  get dataUpdating() {
    return !!(this._graphicsWaitingForSymbol.size > 0 || this._pendingUpdates.size > 0 || this._spatialIndex?.updating || this._updatingPendingLoadedGraphicsChange || this._dataUpdateQueue.updating || this._loadingSymbols > 0 || this.compressionTracker.compressing);
  }
  get readyToRun() {
    return this._pendingUpdates.size > 0 || !!this._spatialIndex?.updating || this._dataUpdateQueue.readyToRun || this._updateQueue.readyToRun || this._focusAreasGraphicsQueue.length > 0;
  }
  get suspendedOrOutsideOfView() {
    return this.owner.suspended || !!this.owner.suspendInfo?.outsideOfView;
  }
  get updatingRemaining() {
    return this.updating ? this._pendingUpdates.size + 0.1 * (this._spatialIndex?.updatingRemaining || 0) + 0.1 * (this._elevationAlignment?.updatingRemaining || 0) : 0;
  }
  get displayFeatureLimit() {
    const e22 = this.owner && this.owner.view && this.owner.view.qualitySettings, t15 = e22?.graphics3D.minTotalNumberOfFeatures ?? 0, i11 = e22?.graphics3D.maxTotalNumberOfFeatures ?? 0, r15 = e22?.graphics3D.maxNumberOfDrawCalls ?? 0, s18 = e22?.graphics3D.maxTotalNumberOfVertices ?? 0, a16 = this.averageSymbolComplexity, n11 = Math.max(1, a16?.verticesPerFeature ?? 1), o12 = a16 && a16.drawCallsPerFeature > 0 && r15 > 0 ? r15 / a16.drawCallsPerFeature : i11, l15 = Math.ceil(s18 / n11), h11 = Math.max(t15, Math.min(i11, l15, o12)), d15 = this._get("displayFeatureLimit");
    return d15 && d15.maximumTotalNumberOfVertices === s18 && d15.averageSymbolComplexity === a16 && d15.maximumNumberOfFeatures === h11 ? d15 : new e12(s18, h11, a16);
  }
  get averageSymbolComplexity() {
    const e22 = d9(this._symbolComplexities), t15 = this._get("averageSymbolComplexity");
    return 0 === e22.numComplexities || null != t15 && (e22.estimated && (t15.verticesPerFeature >= e22.verticesPerFeature || t15.verticesPerCoordinate >= e22.verticesPerCoordinate || t15.drawCallsPerFeature >= e22.drawCallsPerFeature) || t15.verticesPerFeature === e22.verticesPerFeature && t15.verticesPerCoordinate === e22.verticesPerCoordinate && t15.drawCallsPerFeature === e22.drawCallsPerFeature) ? t15 : e22;
  }
  get usedMemory() {
    const e22 = this.labelsEnabled ? (this.averageSymbolComplexity?.memory.bytesPerFeatureLabel ?? 0) * this._numberOfGraphics : 0, t15 = this._getSymbolComplexitiesUsed().reduce((e23, t16) => e23 + t16.memory.resourceBytes, 0);
    if (null == this._symbolMaterials) {
      this._symbolMaterials = [];
      for (const e23 of this._symbols.values()) if (null != e23) {
        for (const t16 of e23.symbolLayers) if (t16) for (const e24 of t16.materials) e24 && this._symbolMaterials.push(e24);
      }
    }
    const i11 = this.owner.view.stage.renderer, r15 = this.owner.view.overlayManager.renderer, s18 = this._symbolMaterials.reduce((e23, t16) => e23 + ((i11.getMaterialRenderer(t16) || r15.getMaterialRenderer(t16))?.usedMemory ?? 0), 0);
    return this._usedMemory + e22 + t15 + s18;
  }
  get usedMemoryPerGraphic() {
    if (this._usedMemory && this._numberOfGraphics) {
      const e22 = this._numberOfGraphics / (this._numberOfGraphics + Math.max(this._pendingAdds, this._pendingRemoves));
      return this._usedMemory / this._numberOfGraphics * e22;
    }
    if (null != this.averageSymbolComplexity) {
      const e22 = this.labelsEnabled ? this.averageSymbolComplexity.memory.bytesPerFeatureLabel : 0;
      return this.averageSymbolComplexity.memory.bytesPerFeature + e22;
    }
    return 0;
  }
  get unprocessedMemoryEstimate() {
    return (this._pendingAdds - this._pendingRemoves) * this.usedMemoryPerGraphic;
  }
  get _symbolComplexities() {
    return this.currentRenderer ? this._getSymbolComplexitiesUsedOrRenderer(this.currentRenderer) : this._getSymbolComplexitiesUsed();
  }
  get visible() {
    return this._visible;
  }
  _getConvertedSymbol(e22) {
    const t15 = e22;
    if ("web-style" === t15.type) return t15.clone();
    const i11 = this._symbolConversionCache.get(t15.id);
    if (null != i11) return i11;
    const r15 = u7(t15, { geometryType: this.layer?.geometryType ?? void 0, retainId: true, hasLabelingContext: this._hasLabelingContext(t15), cimFallbackEnabled: true }), a16 = r15.symbol || null;
    return null == a16 && r15.error && i.getLogger(this).error(r15.error.message), this._symbolConversionCache.set(t15.id, a16), a16;
  }
  _getSymbolComplexitiesUsedOrRenderer(e22) {
    if (null == e22) return [];
    const t15 = e22.symbols, i11 = "backgroundFillSymbol" in e22 ? e22.backgroundFillSymbol : null;
    if (!i11 && !t15.length) return [];
    const r15 = [], s18 = this._getSymbolComplexityUsedOrRenderer(i11);
    null != s18 && r15.push(s18);
    for (const a16 of t15) {
      const e23 = this._getSymbolComplexityUsedOrRenderer(a16);
      null != e23 && r15.push(e23);
    }
    return r15;
  }
  _getSymbolComplexityUsedOrRenderer(e22) {
    if (null == e22) return null;
    const t15 = this._symbols.get(e22.id);
    if (null != t15) return t15.complexity;
    const i11 = this._getConvertedSymbol(e22);
    return null != i11 ? m4(i11) : null;
  }
  _getSymbolComplexitiesUsed() {
    const e22 = [];
    return this._symbols.forEach((t15) => {
      null != t15 && e22.push(t15.complexity);
    }), e22;
  }
  get _objectIdField() {
    return this.layer.objectIdField;
  }
  constructor(e22) {
    super(e22), this._propertiesPool = new s9({ computedExtent: () => new z() }, this), this.computedExtent = null, this.currentRenderer = null, this.rendererHasGeometryOperations = false, this._graphicStateTracking = null, this.graphics3DGraphics = /* @__PURE__ */ new Map(), this.stageLayer = null, this.stage = null, this._graphicsDrapedUids = /* @__PURE__ */ new Set(), this._graphicsBySymbol = /* @__PURE__ */ new Map(), this._symbolConversionCache = /* @__PURE__ */ new Map(), this._symbols = /* @__PURE__ */ new Map(), this._graphicsWithoutSymbol = /* @__PURE__ */ new Map(), this._graphicsWaitingForSymbol = /* @__PURE__ */ new Map(), this._graphicsUpdateId = 0, this._frameTaskHandle = G, this._dataUpdateQueue = new l6(), this._updateQueue = new l6(), this._focusAreasGraphicsQueue = new s3(), this._suspendSymbolCleanup = false, this._arcadeOnDemand = null, this._rendererChangeAbortController = null, this._elevationInfoChangeAbortController = null, this._initializeAbortController = null, this._elevationAlignment = null, this._scaleVisibility = null, this._filterVisibility = null, this._spatialIndex = null, this.extentPadding = 0, this._updatingPendingLoadedGraphicsChange = null, this._featureStore = null, this._deconflictor = null, this._labeler = null, this._objectStates = null, this._viewElevationProvider = null, this._stageLayerElevationProvider = null, this._whenGraphics3DGraphicRequests = {}, this._pendingUpdates = /* @__PURE__ */ new Map(), this._numberOfGraphics = 0, this._numberOfGraphicsProvidingElevation = 0, this._pendingAdds = 0, this._pendingRemoves = 0, this._applyPendingRemovesFirst = false, this._loadingSymbols = 0, this.compressionTracker = new e19(), this._symbolWarningLogged = false, this._geometryWarningLogged = false, this._objectIdInvisibleSet = /* @__PURE__ */ new Set(), this._whenSymbolRemoved = new r(), this.preferredUpdatePolicy = 1, this._forcedUpdatePolicy = null, this.elevationFeatureExpressionEnabled = true, this.owner = null, this.layer = null, this.graphicSymbolSupported = true, this.getRenderingInfoWithoutRenderer = false, this.setUidToIdOnAdd = true, this.hasZ = null, this.hasM = null, this._usedMemory = 0, this._visible = false, this._startCreateGraphics = false, this._unusedSymbolsCache = e22.owner.view.resourceController.memoryController.newCache("graphics-3d-unused-symbols", (e23) => e23.destroy()), this.symbolCreationContext = new e13(e22.owner.view.resourceController.scheduler, (e23, t15) => this._updateQueue.push(e23, t15), e22.owner.layerViewUid, this.compressionTracker);
  }
  initialize() {
    this._featureStore = new d11({ objectIdField: this.owner.layer?.objectIdField, hasZ: !!this.hasZ, hasM: !!this.hasM, viewSpatialReference: this._viewSpatialReference, featureSpatialReference: this.owner.featureSpatialReference, getSpatialIndex: () => this.spatialIndex, forEach: (e23) => this.graphics3DGraphics.forEach(e23) });
    const e22 = (e23, t16, i11) => this.spatialIndex.queryGraphicUIDsInExtent(e23, t16, i11), { componentFactories: t15 } = this;
    this._elevationAlignment = t15.elevationAlignment?.(this, e22), this._scaleVisibility = t15.scaleVisibility?.(this, e22), this._filterVisibility = t15.filterVisibility?.({ featureStore: this._featureStore, getFeatureCount: () => this.graphics3DGraphics.size, updateFeatureVisibilities: (e23) => this.modifyGraphics3DGraphicVisibilities((t16) => t16.setVisibilityFlag(1, 4, e23(R(t16.graphic, this._objectIdField)))), setAllFeaturesVisibility: (e23) => this.modifyGraphics3DGraphicVisibilities((t16) => t16.setVisibilityFlag(1, 4, e23)), clearFeaturesVisibility: () => this.modifyGraphics3DGraphicVisibilities((e23) => e23.setVisibilityFlag(1, 4, true)) }), this._deconflictor = t15.deconflictor?.(this), this._labeler = t15.labeler?.(this, this._scaleVisibility), this._objectStates = t15.objectStates?.(this), this._initializeAbortController = new AbortController(), this.addHandles(f2(() => this.owner.view.state.highlights, () => {
      const { highlightOrderMap: e23 } = this.owner.view.state;
      this.graphics3DGraphics.forEach((t16) => t16.updateHighlights(e23));
    })), this._initializePromise = this._initializeAsync();
  }
  async _initializeAsync() {
    const e22 = this._initializeAbortController?.signal, t15 = this.owner.view;
    this._viewElevationProvider = new a11(this._viewSpatialReference, t15), this._initializeStage(t15, this.owner.layerViewUid);
    const i11 = t15.sharedSymbolResources;
    this.symbolCreationContext.sharedResources = i11, null != this.currentRenderer && (this.symbolCreationContext.renderer = this.currentRenderer), this.symbolCreationContext.stage = this.stage, this.symbolCreationContext.streamDataRequester = i11.streamDataRequester, this.symbolCreationContext.renderCoordsHelper = t15.renderCoordsHelper, this.symbolCreationContext.layer = this.layer, this.symbolCreationContext.graphicsCoreOwner = this.owner, this.symbolCreationContext.localOriginFactory = new f7(t15.renderSpatialReference), this.symbolCreationContext.elevationProvider = t15.elevationProvider, this.symbolCreationContext.notifyGraphicGeometryChanged = (e23) => this.notifyGraphicGeometryChanged(e23), this.symbolCreationContext.notifyGraphicVisibilityChanged = (e23) => this.notifyGraphicVisibilityChanged(e23);
    const r15 = d8(this.layer.elevationInfo, this.elevationFeatureExpressionEnabled);
    if (this.symbolCreationContext.featureExpressionInfoContext = await a9(r15, this._viewSpatialReference, e22, i.getLogger(this)), s2(e22), this.symbolCreationContext.screenSizePerspectiveEnabled = n7(this.layer.screenSizePerspectiveEnabled), this.symbolCreationContext.slicePlaneEnabled = !!this.owner.slicePlaneEnabled, this.symbolCreationContext.physicalBasedRenderingEnabled = !!this.owner.view.qualitySettings?.physicallyBasedRenderingEnabled, this.symbolCreationContext.skipHighSymbolLods = !!this.owner.view.qualitySettings?.graphics3D?.skipHighSymbolLods, "drapeSourceType" in this.owner) {
      const { owner: e23 } = this;
      this.symbolCreationContext.drapeSourceRenderer = t15.overlayManager.registerGeometryDrapeSource(e23);
    }
    this.addHandles([l3(() => this.suspendedOrOutsideOfView, () => this._updateQueue.unshift(() => this._updateLayerVisibility(), null).catch(y)), l3(() => n7(this.layer?.screenSizePerspectiveEnabled), (e23) => {
      e23 !== this.symbolCreationContext.screenSizePerspectiveEnabled && (this.symbolCreationContext.screenSizePerspectiveEnabled = e23, this._screenSizePerspectiveEnabledChange());
    }), l3(() => this.owner.slicePlaneEnabled, (e23) => this._slicePlaneEnabledChange(!!e23)), l3(() => this.owner.view.state?.rasterPixelRatio, () => this._pixelRatioChange()), l3(() => !!this.owner.view.qualitySettings?.physicallyBasedRenderingEnabled, (e23) => this._physicalBasedRenderingChange(e23)), l3(() => !!this.owner.view.qualitySettings?.graphics3D?.skipHighSymbolLods, (e23) => this._skipHighSymbolLoDsChange(e23)), l3(() => this.owner.view.focusAreasView?.polygons, () => this._updateFocusedLabels()), l3(() => this.owner.view.map?.focusAreas.style, () => this.recreateAllGraphicsAndSymbols()), f2(() => t15.basemapTerrain?.tilingScheme, (e23) => {
      if (e23.spatialReference.equals(this.symbolCreationContext.overlaySR) || null == t15.basemapTerrain.spatialReference || (this.symbolCreationContext.overlaySR = t15.basemapTerrain.spatialReference), this.hasHandles("loaded-graphics")) this.recreateAllGraphics();
      else {
        const e24 = () => this.owner?.loadedGraphics;
        this.addHandles([a2(e24, "change", (e25) => {
          this._graphicsCollectionChanged(e25), this._signalUpdatingDuringAsyncLoadedGraphicsChange();
        }, { onListenerAdd: () => {
          this.recreateAllGraphics(), this._signalUpdatingDuringAsyncLoadedGraphicsChange();
        } })], "loaded-graphics");
      }
    }, { initial: true }), l3(() => this.effectiveUpdatePolicy, (e23) => {
      null != this.stageLayer && (this.stageLayer.updatePolicy = e23), this.symbolCreationContext.isAsync = 0 === this.effectiveUpdatePolicy, 1 === e23 && this.runTask(F);
    }, w)]), this._frameTaskHandle = t15.resourceController.scheduler.registerTask(f4.GRAPHICS_CORE, this), this.layer && "featureReduction" in this.layer && this.addHandles(l3(() => this.layer.featureReduction, () => this._deconflictor?.featureReductionChange())), this.notifyChange("averageSymbolComplexity"), this.rendererChange(this.owner.renderer).catch(() => {
    }), this._initializeAbortController = null;
  }
  _abortInitialize() {
    this._initializeAbortController = e3(this._initializeAbortController);
  }
  _updateFocusedLabels() {
    this._focusAreasGraphicsQueue.clear(), this.forEachGraphics3DSymbol((e22, t15) => {
      t15 && e22.needsUpdateFocus && t15.forEach((e23) => {
        this._focusAreasGraphicsQueue.push(e23);
      });
    });
  }
  destroy() {
    if (this._unusedSymbolsCache.destroy(), this._abortInitialize(), this._rendererChangeAbortController = e3(this._rendererChangeAbortController), this._abortElevationInfoChange(), this._frameTaskHandle.remove(), this._frameTaskHandle = G, this._dataUpdateQueue.cancelAll(), this._updateQueue.cancelAll(), this._deconflictor = l(this._deconflictor), this._labeler = l(this._labeler), this._elevationAlignment = u2(this._elevationAlignment), this._scaleVisibility = u2(this._scaleVisibility), this._filterVisibility = u2(this._filterVisibility), this._objectStates = u2(this._objectStates), this.clear(), "drapeSourceType" in this.owner) {
      const { owner: e22 } = this;
      this.stage.view.overlayManager.unregisterDrapeSource(e22);
    }
    this._featureStore = u2(this._featureStore), this._updatingPendingLoadedGraphicsChange = l(this._updatingPendingLoadedGraphicsChange), this._graphicStateTracking = u2(this._graphicStateTracking), this.stage && (this.stageLayer = u2(this.stageLayer), this.stage = null), this._set("owner", null);
    for (const e22 in this._whenGraphics3DGraphicRequests) this._whenGraphics3DGraphicRequests[e22].reject(new s("graphic:layer-destroyed", "Layer has been destroyed"));
    this._whenGraphics3DGraphicRequests = null, this._propertiesPool = u2(this._propertiesPool), this._whenSymbolRemoved.prune(), this._symbolConversionCache.clear(), this._objectIdInvisibleSet.clear(), this._spatialIndex = u2(this._spatialIndex), this._symbolMaterials = null;
  }
  clear() {
    this._objectStates?.allGraphicsDeleted(), null != this._graphicStateTracking && this._graphicStateTracking.allGraphicsDeleted(), this.graphics3DGraphics.forEach((e22) => e22.destroy()), this._spatialIndex?.clear(), this.graphics3DGraphics.clear(), this._numberOfGraphics = 0, this._usedMemory = 0, this._updateLayerVisibility(), this._symbols.forEach(u2), this._symbols.clear(), this._symbolMaterials && (this._symbolMaterials.length = 0, this._symbolMaterials = null), this._graphicsBySymbol.clear(), this._graphicsWithoutSymbol.clear(), this._graphicsWaitingForSymbol.clear(), this._pendingUpdates.clear(), this._pendingAdds = 0, this._pendingRemoves = 0, this._applyPendingRemovesFirst = false, this.notifyChange("dataUpdating"), this.notifyChange("readyToRun"), this.notifyChange("updatingRemaining"), this._featureStore.events.emit("changed"), this.owner.notifyContentGeometryUpdate?.();
  }
  _initializeStage(e22, t15) {
    this.stage = e22.stage, this.stageLayer = new d6(this.stage, { visible: !this.suspendedOrOutsideOfView, updatePolicy: this.effectiveUpdatePolicy }, t15);
    const i11 = this.stageLayer.events;
    i11.on("transformationChanged", (e23) => this.notifyGraphicGeometryChanged(e23.graphicUid)), i11.on("shaderTransformationChanged", (e23) => this.notifyGraphicGeometryChanged(e23.graphicUid)), i11.on("visibilityChanged", (e23) => this.notifyGraphicVisibilityChanged(e23.graphicUid)), i11.on("geometryAdded", (e23) => this.notifyGraphicGeometryChanged(e23.object.graphicUid)), i11.on("geometryRemoved", (e23) => this.notifyGraphicGeometryChanged(e23.object.graphicUid)), i11.on("attributesChanged", (e23) => n8(e23.attribute) && this.notifyGraphicGeometryChanged(e23.object.graphicUid));
  }
  notifyGraphicGeometryChanged(e22) {
    if (this.owner.notifyContentGeometryUpdate?.(), null == this._graphicStateTracking || null == e22) return;
    const t15 = this.graphics3DGraphics.get(e22);
    t15 && this._graphicStateTracking.updateGraphicGeometry(t15);
  }
  notifyGraphicVisibilityChanged(e22) {
    if (this.owner.notifyContentGeometryUpdate?.(), null == this._graphicStateTracking || null == e22) return;
    const t15 = this.graphics3DGraphics.get(e22);
    t15 && this._graphicStateTracking.updateGraphicVisibility(t15);
  }
  _updateLayerVisibility() {
    const e22 = this.displayFeatureLimit.maximumNumberOfFeatures, t15 = this._numberOfGraphics > e22 * We, i11 = !this.suspendedOrOutsideOfView && !t15;
    i11 !== this._visible && (this._visible = i11, this._updateStageLayerVisibility());
  }
  _updateStageLayerVisibility() {
    const e22 = this._visible && (null == this.layer.opacity || this.layer.opacity >= o8);
    this.stageLayer.visible !== e22 && (this.stageLayer.visible = e22, e22 ? this.updateGraphicsVisibilities() : this._hideAllGraphics(), this.owner.notifyContentGeometryUpdate?.());
  }
  getGraphics3DGraphicById(e22) {
    return null != e22 ? this.graphics3DGraphics.get(e22) : void 0;
  }
  getGraphics3DGraphicByObjectId(e22) {
    return this.owner.layer?.objectIdField ? this._findGraphics3DGraphicByObjectId(e22) : null;
  }
  _getGraphicObjectID(e22, t15 = this.owner.layer?.objectIdField) {
    return R(e22, t15);
  }
  get graphics3DGraphicsByObjectID() {
    const e22 = this.owner.layer?.objectIdField;
    if (!e22) return;
    const t15 = /* @__PURE__ */ new Map();
    return this.graphics3DGraphics.forEach((i11) => {
      if (!i11) return;
      const r15 = i11.graphic, s18 = this._getGraphicObjectID(r15, e22);
      null != s18 && t15.set(s18, i11);
    }), t15;
  }
  get labelsEnabled() {
    return !!this._labeler?.layerLabelsEnabled();
  }
  async updateLabelingInfo(e22) {
    const t15 = this._deconflictor?.labelingInfoChange(e22), i11 = this._labeler?.labelingInfoChange(e22);
    await Promise.allSettled([t15, i11]);
  }
  updateVisibilityInfo() {
    this._deconflictor?.labelingInfoChange(), this._labeler?.visibilityInfoChange();
  }
  get symbolUpdateType() {
    if (this._pendingUpdates.size > 0) return "unknown";
    let e22 = false, t15 = false;
    for (const [i11, r15] of this._symbols) if (null != r15) {
      switch (r15.getFastUpdateStatus()) {
        case 3:
          return "unknown";
        case 1:
          this._graphicsBySymbol.has(i11) && (t15 = true);
          break;
        case 0:
          this._graphicsBySymbol.has(i11) && (e22 = true);
          break;
        case 2:
          this._graphicsBySymbol.has(i11) && (t15 = e22 = true);
      }
    }
    return t15 ? e22 ? "mixed" : "fast" : e22 ? "slow" : "mixed";
  }
  runTask(e22) {
    if (this._dataUpdateQueue.runTask(e22), this._updateQueue.runTask(e22), this._applyPendingUpdates(e22), this._applyFocusAreasUpdates(e22), this.notifyChange("readyToRun"), this.readyToRun || this.notifyChange("dataUpdating"), this.notifyChange("updatingRemaining"), !e22.hasProgressed) return o3;
  }
  setObjectIdVisibility(e22, t15) {
    t15 ? this._objectIdInvisibleSet.delete(e22) : this._objectIdInvisibleSet.add(e22);
    const i11 = this._findGraphics3DGraphicByObjectId(e22);
    null != i11 && this._updateUserVisibility(i11);
  }
  _findGraphics3DGraphicByObjectId(e22) {
    return u(this.graphics3DGraphics, (t15) => this._getGraphicObjectID(t15.graphic) === e22);
  }
  _updateUserVisibility(e22) {
    if (null == e22) return false;
    const t15 = e22.graphic, i11 = this._getGraphicObjectID(t15), r15 = t15.visible && !this.owner.suspended && this.stageLayer.visible && (null == i11 || !this._objectIdInvisibleSet.has(i11));
    return e22.setVisibilityFlag(1, 1, r15);
  }
  _whenGraphics3DGraphic(e22) {
    const t15 = this.graphics3DGraphics.get(e22.uid);
    if (t15) return Promise.resolve(t15);
    const i11 = this._whenGraphics3DGraphicRequests[e22.uid];
    if (i11) return i11.promise;
    const r15 = $();
    return this._whenGraphics3DGraphicRequests[e22.uid] = r15, r15.promise;
  }
  async _boundsForGraphics3DGraphic(e22, t15) {
    const i11 = this._viewSpatialReference, r15 = this.owner.view.renderSpatialReference, s18 = this.owner.view.basemapTerrain.spatialReference, a16 = (e23, t16, s19) => o2(e23, r15, t16, e23, i11, t16, s19), n11 = (e23, t16, r16) => o2(e23, s18, t16, e23, i11, t16, r16), o12 = this._viewElevationProvider ? { service: this._viewElevationProvider, useViewElevation: null != t15 && !!t15.useViewElevation, minDemResolution: null != t15 ? t15.minDemResolution : null, minDemResolutionForPoints: this.owner.view.resolution } : null, l15 = await e22.getProjectedBoundingBox(a16, n11, o12, t15?.signal);
    if (!l15) return null;
    const h11 = l15.boundingBox;
    if (l15.requiresDrapedElevation) {
      const e23 = this.symbolCreationContext.elevationProvider;
      if (e23) {
        b2(h11, Te);
        const t16 = e23.getElevation(Te[0], Te[1], 0, i11, "ground") ?? 0;
        h11[2] = Math.min(h11[2], t16), h11[5] = Math.max(h11[5], t16);
      }
    }
    return { boundingBox: h11, screenSpaceObjects: l15.screenSpaceObjects };
  }
  async whenGraphicBounds(e22, t15) {
    await j(() => this.owner?.loadedGraphics);
    const i11 = this.owner.layer?.objectIdField, s18 = this.owner.loadedGraphics.find((t16) => t16 === e22 || null != i11 && null != t16.attributes && e22.attributes && t16.attributes[i11] === e22.attributes[i11]);
    if (!s18) throw new s("internal:graphic-not-part-of-view", "Graphic is not part of this view");
    const a16 = await this._whenGraphics3DGraphic(s18);
    return this._boundsForGraphics3DGraphic(a16, t15);
  }
  computeAttachmentOrigin(e22, t15) {
    const i11 = this.graphics3DGraphics.get(e22.uid);
    if (!i11) return null;
    const r15 = i11.computeAttachmentOrigin();
    if (0 === r15.render.num && 0 === r15.draped.num) return null;
    o4(He, 0, 0, 0);
    let s18 = 0;
    if (r15.render.num > 0) {
      if (!n6(r15.render.origin, this.symbolCreationContext.renderCoordsHelper.spatialReference, Be, t15)) return null;
      u5(He, He, Be), s18++;
    }
    if (r15.draped.num > 0) {
      const [e23, i12] = r15.draped.origin, a16 = this._viewElevationProvider.getElevation(e23, i12, "ground") ?? 0;
      if (o4(Be, e23, i12, a16), !n6(Be, this._viewElevationProvider.spatialReference, Be, t15)) return null;
      u5(He, He, Be), s18++;
    }
    return s18 > 1 && g2(He, He, 1 / s18), new _({ x: He[0], y: He[1], z: He[2], spatialReference: t15 });
  }
  getSymbolLayerSize(e22, t15) {
    const i11 = this._symbols.get(e22.id);
    if (null == i11) throw new s("internal:symbol-not-part-of-view", "Symbol is not part of this view");
    const s18 = e22.symbolLayers.indexOf(t15);
    if (-1 === s18) throw new s("internal:missing-symbol-layer", "Symbol layer is not in symbol");
    const a16 = i11.getSymbolLayerSize(s18);
    if (null == a16) throw new s("internal:missing-size", "Symbol layer has no valid size");
    return a16;
  }
  _graphicsCollectionChanged(e22) {
    this._startCreateGraphics && (this.add(e22.added), this.remove(e22.removed));
  }
  graphicUpdateHandler(e22) {
    const t15 = e22.graphic.uid, i11 = this.graphics3DGraphics.get(t15);
    if (null != i11 || null != this._graphicsWithoutSymbol.get(t15)) {
      switch (e22.property) {
        case "visible":
          this._graphicUpdateVisibleHandler(i11);
          break;
        case "geometry":
          this._graphicUpdateGeometryHandler(i11, e22.graphic);
          break;
        case "symbol":
          this._graphicUpdateSymbolHandler(i11, e22);
          break;
        case "attributes":
          {
            const t16 = this.symbolCreationContext.featureExpressionInfoContext;
            t16?.arcade && this._graphicUpdateGeometryHandler(i11, e22.graphic);
          }
          break;
        case "popupTemplate":
          break;
        case "origin-transform":
          this._graphicUpdateTransformHandler(i11, e22);
      }
      this.owner.notifyContentGeometryUpdate?.();
    }
  }
  _graphicUpdateGeometryHandler(e22, t15) {
    this._graphicUpdateGeometryOrTransformHandler(e22, t15, () => !(null == e22 || !e22.graphics3DSymbol.updateGeometry(e22) || !(this._labeler?.updateGraphicGeometry(e22) ?? 1)) && (this._labeler?.setDirty(), true));
    const i11 = t15.geometry;
    null != i11 && this._expandComputedExtent(i11);
  }
  _graphicUpdateTransformHandler(e22, t15) {
    const i11 = t15.graphic.geometry;
    this._graphicUpdateGeometryOrTransformHandler(e22, t15.graphic, () => null != t15.newValue && null != e22 && null != i11 && e22.graphics3DSymbol.updateTransform(e22, i11.spatialReference, t15.newValue, t15.action));
  }
  _graphicUpdateGeometryOrTransformHandler(e22, t15, i11) {
    if (null != t15.geometry) {
      if (null == e22) {
        const e23 = t15.symbol?.id;
        if (e23) {
          const t16 = this._symbols.get(e23);
          if (null != t16 && 0 === t16.loadStatus) return;
        }
        return void this._recreateGraphic(t15);
      }
      i11() || this._recreateGraphic(e22.graphic);
    } else this._recreateGraphic(t15);
  }
  _graphicUpdateSymbolHandler(e22, t15) {
    const i11 = t15.graphic, r15 = null != e22 ? e22.graphics3DSymbol : null != t15.oldValue ? this._symbols.get(t15.oldValue.id) : null;
    if (null == r15 || null == t15.newValue) return void this._recreateGraphic(i11);
    const s18 = r15.symbol, a16 = this._getConvertedSymbol(t15.newValue);
    if (null != a16 && (a16.type !== s18.type || "web-style" === a16.type) || "web-style" === s18.type) return void this._recreateGraphic(i11);
    const n11 = this._graphicsBySymbol.get(s18.id);
    if (n11 && 1 !== n11.size) return void this._recreateGraphic(i11);
    const o12 = y2(s18, a16);
    if (null == o12) return void this._updateSymbolMapping(s18.id, a16);
    const l15 = { diff: o12, graphics3DGraphicPatches: [], symbolStatePatches: [] };
    if (r15.prepareSymbolPatch(l15), !d2(l15.diff)) return void this._recreateGraphic(i11);
    const h11 = this._getRenderingInfo(i11, false);
    if (null == h11) return void this._recreateGraphic(i11);
    const d15 = r15.extentPadding;
    for (const p8 of l15.symbolStatePatches) p8();
    if (d15 !== r15.extentPadding && this._recomputeExtentPadding(), null != e22) for (const p8 of l15.graphics3DGraphicPatches) p8(e22, h11);
    this._updateSymbolMapping(s18.id, a16);
  }
  _graphicUpdateVisibleHandler(e22) {
    this._updateUserVisibility(e22) && (this._labeler?.setDirty(), this._deconflictor?.setDirty());
  }
  recreateGraphics(e22) {
    this._suspendSymbolCleanup = true, this.remove(e22), this.add(e22), this._suspendSymbolCleanup = false, 1 === this.effectiveUpdatePolicy && this._cleanupSymbols();
  }
  _recreateGraphic(e22) {
    this.recreateGraphics([e22]);
  }
  _beginGraphicUpdate(e22) {
    const t15 = this._graphicsUpdateId;
    return this._graphicsUpdateId++, this._graphicsWaitingForSymbol.set(e22.uid, t15), 1 === this._graphicsWaitingForSymbol.size && this.notifyChange("dataUpdating"), t15;
  }
  _endGraphicUpdate(e22, t15) {
    e22 && (t15 && this._graphicStateTracking?.updateGraphicError(e22, t15), this._graphicsWaitingForSymbol.delete(e22.uid), 0 === this._graphicsWaitingForSymbol.size && (this._cleanupSymbols(), this.notifyChange("dataUpdating")));
  }
  _recomputeExtentPadding() {
    let e22 = 0;
    this._symbols.forEach((t15) => {
      null != t15 && (e22 = Math.max(e22, t15.extentPadding));
    }), this._set("extentPadding", e22);
  }
  _expandComputedExtent(e22) {
    const t15 = Me, i11 = e22.spatialReference;
    v(e22, t15);
    const r15 = this._viewSpatialReference, s18 = Fe.tmpVec;
    if (T(i11, r15) || t2(t15[0], t15[1], 0, i11, s18, r15) && (t15[0] = s18[0], t15[1] = s18[1], t2(t15[3], t15[4], 0, i11, s18, r15), t15[3] = s18[0], t15[4] = s18[1]), !(isFinite(t15[0]) && isFinite(t15[3]) && isFinite(t15[1]) && isFinite(t15[4]))) return;
    const a16 = this.computedExtent;
    let n11 = null;
    const o12 = isFinite(t15[2]) && isFinite(t15[5]), l15 = o12 && (null == a16?.zmin || t15[2] < a16.zmin), h11 = o12 && (null == a16?.zmax || t15[5] > a16.zmax);
    if (a16) {
      (t15[0] < a16.xmin || t15[1] < a16.ymin || t15[3] > a16.xmax || t15[4] > a16.ymax || l15 || h11) && (n11 = this._propertiesPool.get("computedExtent"), n11.xmin = Math.min(t15[0], a16.xmin), n11.ymin = Math.min(t15[1], a16.ymin), n11.xmax = Math.max(t15[3], a16.xmax), n11.ymax = Math.max(t15[4], a16.ymax), n11.spatialReference = r15);
    } else n11 = this._propertiesPool.get("computedExtent"), n11.xmin = t15[0], n11.ymin = t15[1], n11.xmax = t15[3], n11.ymax = t15[4], n11.spatialReference = r15;
    n11 && (l15 && (n11.zmin = t15[2]), h11 && (n11.zmax = t15[5]), this._set("computedExtent", n11));
  }
  _abortElevationInfoChange() {
    this._elevationInfoChangeAbortController && (this._elevationInfoChangeAbortController.abort(), this._elevationInfoChangeAbortController = null);
  }
  async elevationInfoChange() {
    this._abortElevationInfoChange();
    const e22 = new AbortController();
    this._elevationInfoChangeAbortController = e22;
    const t15 = d8(this.layer.elevationInfo, this.elevationFeatureExpressionEnabled);
    this.symbolCreationContext.featureExpressionInfoContext = await a9(t15, this._viewSpatialReference, e22.signal, i.getLogger(this)), s2(e22.signal), this._elevationInfoChangeAbortController = null, this._labeler?.elevationInfoChange(), this.forEachGraphics3DSymbol((e23, t16, i11) => {
      e23.globalPropertyChanged("elevationInfo", t16) ? t16?.forEach((e24) => {
        const t17 = e24.graphic, i12 = e24.labelLayers;
        for (const r15 of i12) {
          r15.graphics3DSymbolLayer.graphics3DGraphicLayerElevationInfoChanged(t17, r15);
        }
      }) : this._recreateSymbol(i11);
    }), this.updateStageLayerElevationProvider(), this._elevationAlignment?.elevationInfoChange();
  }
  updateStageLayerElevationProvider() {
    this._stageLayerElevationProvider ? (this.layer.elevationInfo && "relative-to-scene" === this.layer.elevationInfo.mode || 0 === this._numberOfGraphicsProvidingElevation) && (this.owner.view.elevationProvider.unregister(this._stageLayerElevationProvider), this._stageLayerElevationProvider = u2(this._stageLayerElevationProvider)) : (!this.layer.elevationInfo || this.layer.elevationInfo && "relative-to-scene" !== this.layer.elevationInfo.mode) && this._numberOfGraphicsProvidingElevation > 0 && (this._stageLayerElevationProvider = new g7({ layer: this.layer, stageLayer: this.stageLayer, view: this.owner.view }), this.owner.view.elevationProvider.register(2, this._stageLayerElevationProvider));
  }
  _clearSymbolsAndGraphics() {
    this.clear(), null != this._filterVisibility && this._filterVisibility.clear(), this._labeler?.reset(), this._deconflictor?.clear(), this._elevationAlignment?.clear(), this.stageLayer?.invalidateSpatialQueryAccelerator(), this._stageLayerElevationProvider && (this.owner.view.elevationProvider.unregister(this._stageLayerElevationProvider), this._stageLayerElevationProvider = u2(this._stageLayerElevationProvider));
  }
  startCreateGraphics() {
    this._startCreateGraphics = true, this.recreateAllGraphics();
  }
  recreateAllGraphics() {
    this._recreateAllGraphics(false);
  }
  recreateAllGraphicsAndSymbols() {
    this._recreateAllGraphics(true);
  }
  _recreateAllGraphics(e22 = false) {
    if (!this._startCreateGraphics) return;
    const { loadedGraphics: t15, view: i11 } = this.owner, r15 = i11.basemapTerrain?.tilingScheme && t15?.length ? t15.toArray() : null;
    !e22 && r15 || this._clearSymbolsAndGraphics(), this.symbolCreationContext.screenSizePerspectiveEnabled = n7(this.layer.screenSizePerspectiveEnabled), this.symbolCreationContext.slicePlaneEnabled = !!this.owner.slicePlaneEnabled, this._set("computedExtent", null), r15 && (e22 ? this.add(r15) : this.recreateGraphics(r15));
  }
  _recreateSymbol(e22) {
    const t15 = this._graphicsBySymbol.get(e22), i11 = [];
    t15 && (t15.forEach((e23, t16) => {
      const r16 = e23.usedMemory;
      this._conditionalRemove(e23, t16), this._spatialIndex?.remove(e23), i11.push(e23.graphic), e23.destroy(), this._removeGraphics3DGraphic(t16, r16), this._updateLayerVisibility(), this._featureStore.events.emit("changed"), this.owner.notifyContentGeometryUpdate?.();
    }), this._graphicsBySymbol.set(e22, /* @__PURE__ */ new Map()));
    const r15 = this._symbols.get(e22);
    u2(r15), this._symbols.delete(e22), this._symbolMaterials = null, u2(this._unusedSymbolsCache.pop(e22)), this.add(i11);
  }
  _recreateGraphicsForSymbol(e22) {
    const t15 = this._graphicsBySymbol.get(e22);
    if (t15) {
      const e23 = [];
      t15.forEach((t16) => e23.push(t16.graphic)), this.recreateGraphics(e23);
    }
  }
  _conditionalRemove(e22, t15) {
    this._graphicsDrapedUids.delete(t15), this._objectStates?.removeGraphic(e22), this._labeler?.removeGraphic(e22), this._deconflictor?.removeGraphic(e22), null != this._graphicStateTracking && this._graphicStateTracking.removeGraphic(e22);
  }
  add(e22) {
    e22 && 0 !== e22.length && (this.owner.view.basemapTerrain?.tilingScheme ? (0 === this._updatePolicyForGraphics(e22) ? this._addDelayed(e22) : this._addImmediate(e22), this.notifyChange("dataUpdating")) : i.getLogger(this).error("#add()", "Cannot add graphics before terrain surface has been initialized"));
  }
  _updatePolicyForGraphics(e22) {
    if (1 === this.effectiveUpdatePolicy && ("mesh" === this.layer.geometryType || null == this.layer.geometryType)) {
      for (const t15 of e22) if (null != t15.geometry && "mesh" === t15.geometry.type && !t15.geometry.loaded) return 0;
    }
    return this.effectiveUpdatePolicy;
  }
  _addImmediate(e22) {
    this._geometryWarningLogged = false, this._symbolWarningLogged = false;
    for (const t15 of e22) this._addGraphic(t15, this._getRenderingInfo(t15), 1);
    this._cleanupSymbols(), this._labeler?.setDirty(), this._deconflictor?.setDirty();
  }
  _addDelayed(e22) {
    for (const t15 of e22) {
      const e23 = t15.uid;
      let i11 = this._pendingUpdates.get(e23);
      i11 ? i11.add ? 0 !== i11.state && i11.abortController?.abort() : this._pendingAdds++ : (i11 = new ze(), this._pendingAdds++, this._pendingUpdates.set(e23, i11)), i11.add = t15;
    }
    this.notifyChange("readyToRun"), this.notifyChange("updatingRemaining"), this.notifyChange("dataUpdating");
  }
  remove(e22) {
    0 === this.effectiveUpdatePolicy ? this._removeDelayed(e22) : this._removeImmediate(e22), this.notifyChange("dataUpdating");
  }
  _removeImmediate(e22) {
    for (const t15 of e22) this._removeGraphic(t15);
    this._cleanupSymbols(), this._labeler?.setDirty(), this._deconflictor?.setDirty();
  }
  _removeDelayed(e22) {
    for (const t15 of e22) {
      const e23 = t15.uid, i11 = this._pendingUpdates.get(e23);
      if (i11) i11.add && (i11.remove ? i11.add = null : this._pendingUpdates.delete(e23), 1 === i11.state && i11.abortController?.abort(), this._pendingAdds--);
      else {
        const i12 = new ze();
        i12.remove = t15, this._pendingUpdates.set(e23, i12), this._pendingRemoves++, this._applyPendingRemovesFirst = true;
      }
    }
    0 === this._pendingUpdates.size && this._finishPendingUpdates(), this.notifyChange("readyToRun"), this.notifyChange("updatingRemaining"), this.notifyChange("dataUpdating");
  }
  _finishPendingUpdates() {
    this._cleanupSymbols(), (this._pendingAdds || this._pendingRemoves) && i.getLogger(this).warn("pendingAdds/Removes in inconsistent state!"), this._pendingAdds = 0, this._pendingRemoves = 0, this._applyPendingRemovesFirst = false;
  }
  _applyFocusAreasUpdates(e22) {
    for (; this._focusAreasGraphicsQueue.length > 0 && !e22.done; ) {
      e22.madeProgress();
      const t15 = this._focusAreasGraphicsQueue.pop(), i11 = d10(t15.graphic.geometry);
      if (null == i11) continue;
      const r15 = this.stage.view.focusAreasView?.containsGeometry(i11) ?? true;
      t15.layers.forEach((e23) => {
        if (e23.stageObject) {
          e23.stageObject.geometries.some((e24) => e24.material instanceof ie && e24.material.parameters.isFocused !== r15) && this.recreateGraphics([t15.graphic]);
        }
      });
    }
    0 === this._focusAreasGraphicsQueue.length && this.notifyChange("readyToRun");
  }
  _applyPendingUpdates(e22) {
    if (this._geometryWarningLogged = false, this._symbolWarningLogged = false, 0 === this._pendingUpdates.size && this._spatialIndex?.updating) return this._spatialIndex.update(), void e22.madeProgress();
    if (this._applyPendingRemovesFirst) {
      this._applyPendingRemovesFirst = false;
      for (const [t15, i11] of this._pendingUpdates) {
        if (e22.done) {
          this._applyPendingRemovesFirst = true;
          break;
        }
        if (i11.remove && !i11.add && (this._pendingRemoves--, e22.madeProgress(), this._removeGraphic(i11.remove), i11.remove = null, this._pendingUpdates.delete(t15), 0 === this._pendingRemoves)) break;
      }
    }
    for (const [t15, i11] of this._pendingUpdates) {
      if (e22.done) break;
      i11.add && 0 === i11.state && this._processPendingUpdateNew(i11);
      let r15 = this.effectiveUpdatePolicy;
      if (!i11.remove || i11.add && 2 !== i11.state || (this._pendingRemoves--, e22.madeProgress(), this._removeGraphic(i11.remove), i11.remove = null, r15 = 1), i11.add) switch (i11.state) {
        case 2:
          this._addGraphic(i11.add, i11.renderingInfo, r15), i11.add = null, this._pendingAdds--, e22.madeProgress();
          break;
        case 3:
          i11.add = null, this._pendingAdds--;
      }
      null == i11.remove && null == i11.add && this._pendingUpdates.delete(t15);
    }
    0 === this._pendingUpdates.size && (this._finishPendingUpdates(), this.notifyChange("readyToRun"), this.notifyChange("dataUpdating"));
  }
  _processPendingUpdateNew(e22) {
    if (!e22.add) return void (e22.state = 2);
    const t15 = e22.add.geometry;
    null == t15 || "mesh" !== t15.type || t15.loaded ? this._processPendingUpdateNewRenderingInfo(e22) : this._processPendingUpdateNewMesh(e22, t15);
  }
  async _processPendingUpdateNewMesh(e22, t15) {
    e22.state = 1, e22.abortController = new AbortController();
    const i11 = e22.abortController.signal;
    try {
      await t15.load({ signal: i11 });
    } catch (r15) {
      return this._processPendingUpdateNewError(e22, r15);
    }
    e22.abortController = null, this._processPendingUpdateNewRenderingInfo(e22);
  }
  _processPendingUpdateNewError(e22, t15) {
    e22.abortController = null, d(t15) ? e22.state = 0 : e22.state = 3;
  }
  async _processPendingUpdateNewRenderingInfo(e22) {
    if (null == this.layer.renderer || "dictionary" !== this.layer.renderer.type) return e22.renderingInfo = this._getRenderingInfo(e22.add), void (e22.state = 2);
    e22.state = 1, e22.abortController = new AbortController();
    let t15 = null;
    try {
      t15 = await this._getRenderingInfoAsync(e22.add, { signal: e22.abortController.signal });
    } catch (i11) {
      return e22.abortController = null, void (d(i11) ? e22.state = 0 : e22.state = 3);
    }
    null == t15?.symbol ? (this._symbolWarningLogged || (this._symbolWarningLogged = true, i.getLogger(this).warn(`Graphic in layer ${this.layer.id} has no symbol and will not render`)), e22.renderingInfo = null) : e22.renderingInfo = t15, e22.state = 2;
  }
  _addGraphic(e22, t15, i11) {
    if (this._graphicsWithoutSymbol.set(e22.uid, e22), null == t15?.symbol || !b3(e22)) return;
    const r15 = this.stage.renderView.olidRenderHelper;
    if (r15 && this.setUidToIdOnAdd) {
      const t16 = c(this.owner.view, this.owner.layerViewUid);
      r15.setUidToObjectAndLayerId(e22.objectId, e22.uid, this.layer.id, this.owner.layerViewUid, o5(this.layer) && !!this.layer.popupEnabled && !t16 && u9(this.layer, this.owner.view.popup?.defaultPopupTemplateEnabled));
    }
    const s18 = t15.symbol, a16 = this.getOrCreateGraphics3DSymbol(s18, t15.renderer);
    if (null == a16) return;
    this._expandComputedExtent(e22.geometry);
    const n11 = this._beginGraphicUpdate(e22), o12 = new r10(e22, t15, this.layer);
    let l15 = false;
    const h11 = (e23) => {
      e23 === a16.symbol.id && (l15 = true);
    };
    this._whenSymbolRemoved.push(h11);
    const d15 = () => {
      if (--this._loadingSymbols, this.destroyed) return;
      this._whenSymbolRemoved.removeUnordered(h11);
      if (this._graphicsWaitingForSymbol.get(e22.uid) !== n11 || l15 || a16.destroyed || this.graphicSymbolSupported && e22.symbol && e22.symbol.id !== a16.symbol.id) --a16.referenced, this._cleanupSymbols();
      else {
        const t16 = this._createGraphics3DGraphic(a16, o12);
        this._spatialIndex && null != t16 && this._spatialIndex.add(t16), --a16.referenced, this._endGraphicUpdate(e22);
      }
      this._featureStore.events.emit("changed"), this.owner.notifyContentGeometryUpdate?.(), this._labeler?.setDirty();
    }, p8 = (t16) => {
      --this._loadingSymbols, this.destroyed || (this._whenSymbolRemoved.removeUnordered(h11), l15 || (d(t16) ? this.add([e22]) : a16.destroyed || this._endGraphicUpdate(e22, t16)));
    };
    ++this._loadingSymbols, 0 === i11 ? a16.load(() => this._dataUpdateQueue.push(d15, null).catch(y), (e23) => this._dataUpdateQueue.push(() => p8(e23), null).catch(y)) : a16.load(d15, p8);
  }
  _removeGraphic(e22) {
    const t15 = e22.uid, i11 = this.graphics3DGraphics.get(t15);
    if (i11) {
      i11.graphics3DSymbol.onRemoveGraphic(i11);
      const e23 = i11.usedMemory, r15 = i11.isElevationSource;
      this._conditionalRemove(i11, t15), this._spatialIndex?.remove(i11);
      const s18 = i11.graphics3DSymbol.symbol.id;
      this._graphicsBySymbol.get(s18)?.delete(t15), this._graphicsWithoutSymbol.delete(t15), this._removeGraphics3DGraphic(t15, e23, r15), i11.destroy(), this._featureStore.events.emit("changed"), this.owner.notifyContentGeometryUpdate?.();
    } else this._graphicsWithoutSymbol.delete(t15), this._graphicsWaitingForSymbol.delete(t15), 0 === this._graphicsWaitingForSymbol.size && (this._cleanupSymbols(), this.notifyChange("dataUpdating"));
  }
  _hasLabelingContext(e22) {
    if (e22 instanceof f6 || e22 instanceof g3) {
      const t15 = this.symbolCreationContext.layer;
      return !!t15.labelingInfo && t15.labelingInfo.some((t16) => t16.symbol === e22);
    }
    return false;
  }
  _hasValidSymbolCreationContext(e22) {
    return !(e22 instanceof f6 && !this._hasLabelingContext(e22)) || (i.getLogger(this).error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."), false);
  }
  _getRenderingInfo(e22, t15 = true) {
    const i11 = e22.geometry;
    if (null == i11) return t15 && !this._geometryWarningLogged && (this._geometryWarningLogged = true, i.getLogger(this).warn(`Graphic in layer ${this.layer.id} has no geometry and will not render`)), null;
    if (!J(i11.spatialReference, this._viewSpatialReference)) return t15 && !this._geometryWarningLogged && (this._geometryWarningLogged = true, i.getLogger(this).warn(`Graphic in layer ${this.layer.id} has incompatible spatial reference and will not render`)), null;
    if (!this.graphicSymbolSupported && null != e22.symbol) return t15 && !this._symbolWarningLogged && (this._symbolWarningLogged = true, i.getLogger(this).warn(`Graphic in layer ${this.layer.id} is not allowed to have a symbol, use a renderer instead`)), null;
    const r15 = this.rendererHasGeometryOperations ? c4(e22, this.layer, null) : e22;
    let a16;
    if (this.owner.getRenderingInfo && (this.getRenderingInfoWithoutRenderer || null != this.currentRenderer)) a16 = this.owner.getRenderingInfo(r15, this.currentRenderer, this._arcadeOnDemand);
    else {
      const e23 = r15.symbol || d3(r15.geometry);
      a16 = new l9(null, e23);
    }
    return null == a16?.symbol ? (t15 && !this._symbolWarningLogged && (this._symbolWarningLogged = true, i.getLogger(this).warn(`Graphic in layer ${this.layer.id} has no symbol and will not render`)), null) : a16;
  }
  _getRenderingInfoAsync(e22, t15) {
    if (null == e22.geometry) return this._geometryWarningLogged || (this._geometryWarningLogged = true, i.getLogger(this).warn(`Graphic in layer ${this.layer.id} has no geometry and will not render`)), null;
    if (!this.graphicSymbolSupported && null != e22.symbol) return this._symbolWarningLogged || (this._symbolWarningLogged = true, i.getLogger(this).warn(`Graphic in layer ${this.layer.id} is not allowed to have a symbol, use a renderer instead`)), null;
    const i11 = this.rendererHasGeometryOperations ? c4(e22, this.layer, null) : e22;
    return this.owner.getRenderingInfoAsync(i11, this.currentRenderer, this._arcadeOnDemand, t15);
  }
  _createGraphics3DSymbol(e22, t15) {
    if (!this._hasValidSymbolCreationContext(e22)) return null;
    const i11 = this._getConvertedSymbol(e22);
    if (!i11) return null;
    let r15;
    if (null != t15 && "backgroundFillSymbol" in t15 && t15.backgroundFillSymbol) {
      const e23 = u7(t15.backgroundFillSymbol, { ignoreDrivers: true });
      null != e23.symbol && (r15 = e23.symbol.symbolLayers);
    }
    const s18 = t11(i11, this.symbolCreationContext, r15);
    return s18.load(() => {
      const e23 = s18.extentPadding;
      e23 > this.extentPadding && this._set("extentPadding", e23), this.notifyChange("averageSymbolComplexity");
    }, () => {
    }), s18;
  }
  getOrCreateGraphics3DSymbol(e22, t15) {
    let i11 = this._symbols.get(e22.id);
    if (void 0 === i11) {
      const r15 = this._unusedSymbolsCache.pop(e22.id);
      i11 = null != r15 ? r15 : e22 instanceof b4 ? new e16(e22, (e23) => this._dataUpdateQueue.push(e23, null), (e23) => this._createGraphics3DSymbol(e23, t15)) : this._createGraphics3DSymbol(e22, t15), this._symbols.set(e22.id, i11), this._symbolMaterials = null;
    }
    return null != i11 && ++i11.referenced, i11;
  }
  trackGraphicState(e22) {
    return null == this._graphicStateTracking && (this._graphicStateTracking = new s14(this)), this._graphicStateTracking.add(e22);
  }
  _addGraphics3DGraphic(e22) {
    this._usedMemory += e22.usedMemory, this.graphics3DGraphics.set(e22.graphic.uid, e22), this._numberOfGraphics++, e22.isElevationSource && (this._numberOfGraphicsProvidingElevation++, this.updateStageLayerElevationProvider()), this._updateLayerVisibility();
  }
  _removeGraphics3DGraphic(e22, t15, i11 = false) {
    this._usedMemory -= t15, this.graphics3DGraphics.delete(e22), this._numberOfGraphics--, i11 && (this._numberOfGraphicsProvidingElevation--, this.updateStageLayerElevationProvider()), this._updateLayerVisibility();
  }
  _createGraphics3DGraphic(e22, t15) {
    const { graphic: i11 } = t15;
    if (this._graphicsWithoutSymbol.delete(i11.uid), !this._symbols.has(e22.symbol.id)) return this.add([i11]), null;
    if (this.graphics3DGraphics.has(i11.uid)) return null;
    const r15 = e22.createGraphics3DGraphic(t15);
    if (null == r15) return null;
    this._addGraphics3DGraphic(r15);
    const s18 = e22.symbol.id;
    this._graphicsBySymbol.has(s18) || this._graphicsBySymbol.set(s18, /* @__PURE__ */ new Map()), this._graphicsBySymbol.get(s18).set(i11.uid, r15);
    if (r15.isDraped && this._graphicsDrapedUids.add(i11.uid), r15.centroid = null, null != i11.geometry && "point" !== i11.geometry.type && (r15.centroid = w3(i11.geometry, this._viewSpatialReference)), this._updateUserVisibility(r15), null != this._scaleVisibility && this._scaleVisibility.updateVisibility(r15), null != this._filterVisibility) {
      const { defaultVisibility: e23 } = this._filterVisibility;
      r15.setVisibilityFlag(1, 4, e23), e23 || this._filterVisibility.reapply();
    }
    this._deconflictor?.addGraphic(r15), this._labeler?.addGraphic(r15), this._objectStates?.addGraphic(r15), r15.initialize(this.stageLayer), null != this._graphicStateTracking && this._graphicStateTracking.addGraphic(r15);
    const a16 = this._whenGraphics3DGraphicRequests[i11.uid];
    return a16 && (delete this._whenGraphics3DGraphicRequests[i11.uid], a16.resolve(r15)), this._symbolMaterials = null, r15;
  }
  async rendererChange(e22) {
    if (this._rendererChangeAbortController = e3(this._rendererChangeAbortController), e22 !== this.currentRenderer) if (this._validateRenderer(e22), null == e22 && this._currentRendererChange(null, false), t9(e22)) if (e22?.arcadeRequired) {
      const t15 = new AbortController();
      this._rendererChangeAbortController = t15;
      const { arcadeUtils: i11 } = await this._ensureArcade();
      s2(t15);
      const r15 = i11.hasGeometryOperations(e22);
      r15 && (await i11.enableGeometryOperations(), s2(t15)), 0 === this.effectiveUpdatePolicy ? await this._updateQueue.push(() => this._currentRendererChange(e22, r15), t15.signal) : this._currentRendererChange(e22, r15), this._rendererChangeAbortController = null;
    } else if (0 === this.effectiveUpdatePolicy) {
      const t15 = new AbortController();
      this._rendererChangeAbortController = t15, await this._updateQueue.push(() => this._currentRendererChange(e22, false), t15.signal), this._rendererChangeAbortController = null;
    } else this._currentRendererChange(e22, false);
    else this._currentRendererChange(e22, false);
  }
  async _ensureArcade() {
    return null == this._arcadeOnDemand ? (this._arcadeOnDemand = await e10(), this._arcadeOnDemand) : this._arcadeOnDemand;
  }
  _currentRendererChange(e22, t15) {
    this.currentRenderer = e22, this.rendererHasGeometryOperations = t15, this.symbolCreationContext.arcade = this._arcadeOnDemand;
    const i11 = this.symbolCreationContext.renderer;
    if (e22 === i11) return;
    if (this._symbolConversionCache.clear(), this._unusedSymbolsCache.clear(), null == e22) return this.symbolCreationContext.renderer = null, void this.recreateAllGraphicsAndSymbols();
    const r15 = y2(i11, e22);
    this._updateUnchangedSymbolMappings(r15, e22, i11), this.symbolCreationContext.renderer = e22, null != r15 && ("complete" === r15.type ? this.recreateAllGraphicsAndSymbols() : "partial" === r15.type && (this._applyRendererDiff(r15, e22, i11) ? this._labeler?.reset() : this.recreateAllGraphicsAndSymbols()), this.notifyChange("averageSymbolComplexity"));
  }
  _diffHasSymbolChange(e22) {
    for (const t15 in e22.diff) switch (t15) {
      case "visualVariables":
      case "defaultSymbol":
      case "uniqueValueInfos":
        break;
      case "uniqueValueGroups":
      case "authoringInfo":
      case "fieldDelimiter":
        delete e22.diff[t15];
        break;
      default:
        return true;
    }
    return false;
  }
  _applySymbolSetDiff(e22, t15, i11) {
    e22 = e22 || [], t15 = t15 || [];
    const r15 = [];
    for (const s18 of t15) {
      const t16 = this._graphicsBySymbol.get(s18.id);
      t16 && t16.forEach((a16, n11) => {
        const o12 = a16.graphic, l15 = this.layer instanceof b6 ? this.layer : null, h11 = this._arcadeOnDemand;
        if (s18 === i11.defaultSymbol && i11.getSymbol(c4(o12, l15, null), { arcade: h11 }) === i11.defaultSymbol) return;
        const d15 = a16.usedMemory;
        e22.length || i11.defaultSymbol ? r15.push(o12) : this._graphicsWithoutSymbol.set(n11, o12);
        const p8 = this.graphics3DGraphics.get(n11);
        this._conditionalRemove(p8, n11), a16.destroy(), t16.delete(n11), this._removeGraphics3DGraphic(n11, d15), this._updateLayerVisibility();
      }), this._whenSymbolRemoved.forAll((e23) => e23(s18.id));
    }
    (e22.length || r15.length) && (this._graphicsWithoutSymbol.forEach((e23) => r15.push(e23)), this._graphicsWithoutSymbol.clear(), this.add(r15)), this._cleanupSymbols(), this._labeler?.setDirty(), this._deconflictor?.setDirty();
  }
  _applyUniqueValueRendererDiff(e22, t15, r15) {
    const s18 = e22.diff.defaultSymbol, a16 = e22.diff.uniqueValueInfos;
    if (s18 || a16) {
      const n11 = a16?.changed, o12 = a16?.unchanged;
      if (n11 && o12 && n11.some((e23) => o12.some((t16) => t16.oldValue.symbol?.id === e23.oldValue.symbol?.id))) return false;
      const l15 = a16 ? a16.added.map((e23) => e23.symbol).filter(N) : [], h11 = a16 ? a16.removed.map((e23) => e23.symbol).filter(N) : [];
      if (n11) for (let e23 = 0; e23 < n11.length; e23++) l15.push(n11[e23].newValue.symbol), h11.push(n11[e23].oldValue.symbol);
      return s18 ? (r15.defaultSymbol && h11.push(r15.defaultSymbol), t15.defaultSymbol && l15.push(t15.defaultSymbol)) : r15.defaultSymbol && l15.length && h11.push(t15.defaultSymbol), this._applySymbolSetDiff(l15, h11, t15), delete e22.diff.defaultSymbol, delete e22.diff.uniqueValueInfos, true;
    }
    return false;
  }
  _calculateUnchangedSymbolMapping(e22, t15, i11) {
    if ("unique-value" !== t15?.type || "unique-value" !== i11?.type || null != e22 && "partial" !== e22.type) return [];
    const r15 = (e23) => null != e23 ? e23.id : null, s18 = e22 && e22.diff, a16 = s18?.defaultSymbol, n11 = s18 && s18.uniqueValueInfos;
    let o12;
    if (n11) o12 = n11.unchanged.map((e23) => ({ oldId: r15(e23.oldValue.symbol), newId: r15(e23.newValue.symbol) }));
    else {
      o12 = [];
      for (const e23 of i11.uniqueValueInfos ?? []) {
        const i12 = r15(e23.symbol), s19 = t15.uniqueValueInfos?.find((t16) => t16.value === e23.value);
        s19 && i12 !== r15(s19.symbol) && o12.push({ oldId: i12, newId: r15(s19.symbol) });
      }
    }
    return !a16 && i11.defaultSymbol && o12.push({ oldId: r15(i11.defaultSymbol), newId: r15(t15.defaultSymbol) }), o12;
  }
  _updateSymbolMapping(e22, t15) {
    const i11 = null != t15 && t15 ? "string" == typeof t15 ? t15 : t15.id : null;
    if (null == e22 || e22 === i11) return;
    const r15 = this._graphicsBySymbol.get(e22);
    this._graphicsBySymbol.delete(e22), void 0 !== r15 && this._graphicsBySymbol.set(i11, r15);
    const s18 = this._symbols.get(e22);
    if (void 0 !== s18 && (this._symbols.delete(e22), this._symbols.set(i11, s18), this._symbolMaterials = null, null != s18)) {
      const e23 = "string" == typeof t15 ? null : t15;
      null != e23 ? s18.symbol = e23 : s18.symbol.id = i11;
    }
  }
  _updateUnchangedSymbolMappings(e22, t15, i11) {
    const r15 = this._calculateUnchangedSymbolMapping(e22, t15, i11);
    for (const { oldId: s18, newId: a16 } of r15) this._updateSymbolMapping(s18, a16);
  }
  _applyRendererDiff(e22, t15, i11) {
    if (this._diffHasSymbolChange(e22)) return false;
    if (t15 instanceof $3 && i11 instanceof $3 && this._applyUniqueValueRendererDiff(e22, t15, i11) && 0 === Object.keys(e22.diff).length) return true;
    for (const r15 of this._graphicsBySymbol.keys()) {
      const i12 = this._symbols.get(r15);
      if (null != i12) switch (i12.applyRendererDiff(e22, t15)) {
        case 0:
          this._recreateSymbol(r15);
          break;
        case 1:
          this._recreateGraphicsForSymbol(r15);
      }
    }
    return true;
  }
  opacityChange() {
    this._updateStageLayerVisibility(), this.forEachGraphics3DSymbol((e22, t15) => e22.globalPropertyChanged("opacity", t15));
  }
  _screenSizePerspectiveEnabledChange() {
    this.forEachGraphics3DSymbol((e22, t15) => e22.globalPropertyChanged("screenSizePerspectiveEnabled", t15)), this._labeler?.screenSizePerspectiveEnabledChanged(), this._deconflictor?.screenSizePerspectiveEnabledChanged();
  }
  _slicePlaneEnabledChange(e22) {
    e22 !== this.symbolCreationContext.slicePlaneEnabled && (this.symbolCreationContext.slicePlaneEnabled = e22, this.stageLayer.sliceable = e22, this.forEachGraphics3DSymbol((e23, t15) => e23.globalPropertyChanged("slicePlaneEnabled", t15)), this._deconflictor?.slicePlaneEnabledChange(), this._labeler?.slicePlaneEnabledChange());
  }
  _physicalBasedRenderingChange(e22) {
    this.symbolCreationContext.physicalBasedRenderingEnabled = e22, this.forEachGraphics3DSymbol((e23, t15, i11) => {
      e23.globalPropertyChanged("physicalBasedRenderingEnabled", t15) || this._recreateSymbol(i11);
    });
  }
  _skipHighSymbolLoDsChange(e22) {
    this.symbolCreationContext.skipHighSymbolLods = e22, this.forEachGraphics3DSymbol((e23, t15, i11) => {
      e23.globalPropertyChanged("skipHighSymbolLods", t15) || this._recreateSymbol(i11);
    });
  }
  _pixelRatioChange() {
    this.forEachGraphics3DSymbol((e22, t15, i11) => {
      e22.globalPropertyChanged("pixelRatio", t15) || this._recreateSymbol(i11);
    });
  }
  _signalUpdatingDuringAsyncLoadedGraphicsChange() {
    this._updatingPendingLoadedGraphicsChange && this._updatingPendingLoadedGraphicsChange.remove(), this._updatingPendingLoadedGraphicsChange = A(() => {
      this._updatingPendingLoadedGraphicsChange = null;
    });
  }
  setClippingExtent(e22, t15) {
    const i11 = this.symbolCreationContext.clippingExtent, r15 = i3();
    return u17(e22, r15, t15) ? this.symbolCreationContext.clippingExtent = B(u4(), r15) : this.symbolCreationContext.clippingExtent = null, !H(this.symbolCreationContext.clippingExtent, i11);
  }
  modifyGraphics3DGraphicVisibilities(e22) {
    if (this.destroyed) return;
    let t15 = false;
    this.graphics3DGraphics.forEach((i11) => {
      e22(i11) && (t15 = true);
    }), t15 && (this._labeler?.setDirty(), this._deconflictor?.setDirty());
  }
  forEachGraphics3DSymbol(e22, t15) {
    for (const [i11, r15] of this._symbols) {
      if (null == r15) return;
      e22(r15, this._graphicsBySymbol.get(i11) || qe, i11);
    }
    if (!t15?.excludeUnused) for (const i11 of this._unusedSymbolsCache) e22(i11, void 0, i11.symbol.id);
  }
  updateGraphicsVisibilities() {
    null != this._filterVisibility && this._filterVisibility.reapply(), this.modifyGraphics3DGraphicVisibilities((e22) => {
      const t15 = this._updateUserVisibility(e22), i11 = !!this._scaleVisibility?.updateVisibility(e22);
      return t15 || i11;
    });
  }
  _hideAllGraphics() {
    this.modifyGraphics3DGraphicVisibilities((e22) => e22.setVisibilityFlag(1, 1, false));
  }
  _validateRenderer(e22) {
    const t15 = () => `'${this.layer.title ? `${this.layer.title}, ` : ""}id:${this.layer.id}'`, i11 = s10(e22, { geometryType: this.layer?.geometryType, logWarning: (e23, i12) => i.getLogger(this).warn(e23, `Symbology conversion for layer ${t15()}: ${i12}`) });
    if (i11) {
      const e23 = `Renderer for layer ${t15} is not supported in a SceneView`;
      i.getLogger(this).warn(e23, i11.message);
    }
  }
  _cleanupSymbols() {
    if (this._graphicsWaitingForSymbol.size > 0 || this._suspendSymbolCleanup) return;
    let e22 = false;
    this._symbols.forEach((t15, i11) => {
      if (null == t15 || t15.referenced > 0) return;
      const r15 = this._graphicsBySymbol.get(i11);
      r15 && 0 !== r15.size || (this._graphicsBySymbol.delete(i11), this._symbols.delete(i11), this._symbolMaterials = null, this._unusedSymbolsCache.put(i11, t15, t), e22 = true);
    }), e22 && (this._recomputeExtentPadding(), this.notifyChange("averageSymbolComplexity"));
  }
  get test() {
  }
  get performanceInfo() {
    return new s13(this.graphics3DGraphics.size, Array.from(this.graphics3DGraphics.values()).reduce((e22, t15) => e22 + (t15.isVisible() ? 1 : 0), 0), this._graphicsWithoutSymbol.size, this._pendingUpdates.size);
  }
}, Fe = _a, _a.tmpVec = n2(), _a);
__decorate([m({ readOnly: true })], ke.prototype, "computedExtent", void 0), __decorate([m()], ke.prototype, "currentRenderer", void 0), __decorate([m()], ke.prototype, "rendererHasGeometryOperations", void 0), __decorate([m()], ke.prototype, "_frameTaskHandle", void 0), __decorate([m()], ke.prototype, "_dataUpdateQueue", void 0), __decorate([m()], ke.prototype, "_updateQueue", void 0), __decorate([m({ readOnly: true })], ke.prototype, "_viewSpatialReference", null), __decorate([m()], ke.prototype, "_rendererChangeAbortController", void 0), __decorate([m()], ke.prototype, "_elevationInfoChangeAbortController", void 0), __decorate([m()], ke.prototype, "_initializeAbortController", void 0), __decorate([m()], ke.prototype, "_elevationAlignment", void 0), __decorate([m()], ke.prototype, "_scaleVisibility", void 0), __decorate([m()], ke.prototype, "_filterVisibility", void 0), __decorate([m()], ke.prototype, "_initializePromise", void 0), __decorate([m()], ke.prototype, "_spatialIndex", void 0), __decorate([m({ readOnly: true })], ke.prototype, "extentPadding", void 0), __decorate([m()], ke.prototype, "_updatingPendingLoadedGraphicsChange", void 0), __decorate([m()], ke.prototype, "_featureStore", void 0), __decorate([m()], ke.prototype, "_objectStates", void 0), __decorate([m()], ke.prototype, "_loadingSymbols", void 0), __decorate([m({ constructOnly: true })], ke.prototype, "compressionTracker", void 0), __decorate([m()], ke.prototype, "preferredUpdatePolicy", void 0), __decorate([m()], ke.prototype, "_forcedUpdatePolicy", void 0), __decorate([m({ readOnly: true })], ke.prototype, "effectiveUpdatePolicy", null), __decorate([m({ constructOnly: true })], ke.prototype, "elevationFeatureExpressionEnabled", void 0), __decorate([m({ constructOnly: true })], ke.prototype, "owner", void 0), __decorate([m({ constructOnly: true })], ke.prototype, "layer", void 0), __decorate([m({ constructOnly: true })], ke.prototype, "graphicSymbolSupported", void 0), __decorate([m({ constructOnly: true })], ke.prototype, "getRenderingInfoWithoutRenderer", void 0), __decorate([m({ constructOnly: true })], ke.prototype, "componentFactories", void 0), __decorate([m({ constructOnly: true })], ke.prototype, "setUidToIdOnAdd", void 0), __decorate([m()], ke.prototype, "featureStore", null), __decorate([m()], ke.prototype, "initializePromise", null), __decorate([m()], ke.prototype, "scaleVisibility", null), __decorate([m()], ke.prototype, "elevationAlignment", null), __decorate([m()], ke.prototype, "objectStates", null), __decorate([m()], ke.prototype, "filterVisibility", null), __decorate([m({ readOnly: true })], ke.prototype, "updating", null), __decorate([m({ readOnly: true })], ke.prototype, "dataUpdating", null), __decorate([m({ readOnly: true })], ke.prototype, "readyToRun", null), __decorate([m({ readOnly: true })], ke.prototype, "suspendedOrOutsideOfView", null), __decorate([m({ readOnly: true, dependsOn: [] })], ke.prototype, "updatingRemaining", null), __decorate([m({ readOnly: true })], ke.prototype, "displayFeatureLimit", null), __decorate([m({ readOnly: true, dependsOn: [] })], ke.prototype, "averageSymbolComplexity", null), __decorate([m({ constructOnly: true })], ke.prototype, "hasZ", void 0), __decorate([m({ constructOnly: true })], ke.prototype, "hasM", void 0), __decorate([m()], ke.prototype, "_objectIdField", null), ke = Fe = __decorate([a("esri.views.3d.layers.graphics.Graphics3DCore")], ke);
var ze = class {
  constructor() {
    this.add = null, this.renderingInfo = null, this.state = 0, this.abortController = null, this.remove = null;
  }
  clear() {
    this.add = null, this.renderingInfo = null, this.state = 0, this.abortController = null, this.remove = null;
  }
};
var We = 10;
var He = n2();
var Be = n2();
var qe = /* @__PURE__ */ new Map();

// node_modules/@arcgis/core/views/3d/layers/graphics/ExtentSet.js
var h7 = 0.05;
var a14 = class {
  constructor() {
    this._extents = new r({ allocator: (t15) => t15 || i3() }), this._tmpExtent = i3(), this._dirty = false;
  }
  destroy() {
    this._extents.prune();
  }
  get empty() {
    return 0 === this._extents.length;
  }
  get size() {
    return this._extents.length;
  }
  clear() {
    this._extents.clear();
  }
  add(t15) {
    this._contains(t15) || (this._removeContained(t15), a4(this._extents.pushNew(), t15), this._dirty = true);
  }
  pop() {
    return this._dirty && this._mergeTight(), this._extents.pop();
  }
  merge(t15) {
    return this._mergeTight(t15), t15.hasProgressed;
  }
  _mergeTight(t15 = F) {
    const e22 = this._extents, o12 = /* @__PURE__ */ new Set();
    let a16 = 0;
    for (; a16 !== e22.length; ) {
      e22.sort((t16, e23) => t16[0] - e23[0]), a16 = e22.length, o12.clear();
      for (let i11 = 0; i11 < e22.length; ++i11) {
        if (t15.done) return;
        const a17 = e22.at(i11);
        if (a17) {
          for (let t16 = i11 + 1; t16 < e22.length; ++t16) {
            const r15 = e22.at(t16);
            if (null == r15 || r15[0] >= a17[2]) break;
            o12.add(r15);
          }
          o12.forEach((i12) => {
            if (a17 === i12) return;
            if (i12[2] <= a17[0]) return void o12.delete(i12);
            const l15 = p(a17), _5 = p(i12), d15 = this._tmpExtent;
            M(a17, i12, d15);
            const c11 = l15 + _5;
            (p(d15) - c11) / c11 < h7 && (a4(a17, d15), o12.delete(i12), e22.remove(i12), t15.madeProgress());
          }), o12.add(a17);
        }
      }
    }
    this._dirty = false;
  }
  _contains(t15) {
    return this._extents.some((e22) => z2(e22, t15));
  }
  _removeContained(t15) {
    this._extents.filterInPlace((e22) => !z2(t15, e22));
  }
  get test() {
  }
};

// node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DElevationAlignment.js
var h8 = class extends b {
  constructor(t15) {
    super(t15), this._dirtyExtents = new a14(), this._globalDirty = false, this._averageExtentUpdateSize = 0, this._dirtyGraphicsSet = /* @__PURE__ */ new Set(), this._updateElevation = false, this.graphicsCoreOwner = null, this.graphicsCore = null, this.events = new i2();
  }
  initialize() {
    const t15 = this.elevationProvider, e22 = this.graphicsCoreOwner.view.resourceController.scheduler;
    this._task = e22.registerTask(p6(this.graphicsCore.layer.elevationInfo?.mode), this), this.addHandles([t15.on("elevation-change", (t16) => this._elevationChanged(t16)), l3(() => this.graphicsCoreOwner.suspended, () => this._suspendedChange()), this._task, l3(() => p6(this.graphicsCore.layer.elevationInfo?.mode), (t16) => this._task.priority = t16)]);
  }
  destroy() {
    this._dirtyGraphicsSet.clear(), this.graphicsCoreOwner = null, this.graphicsCore = null, this.queryGraphicUIDsInExtent = null, this.elevationProvider = null, this._dirtyExtents.destroy();
  }
  clear() {
    this._dirtyGraphicsSet.clear(), this.notifyChange("updating");
  }
  _suspendedChange() {
    true === this.graphicsCoreOwner.suspended ? this._updateElevation = false : false === this.graphicsCoreOwner.suspended && this._updateElevation && (this._globalDirty = true, this.notifyChange("updating"));
  }
  elevationInfoChange() {
    this._globalDirty = true, this.notifyChange("updating");
  }
  get updating() {
    return this.readyToRun;
  }
  get readyToRun() {
    return this._dirtyGraphicsSet.size > 0 || this._dirtyExtents && !this._dirtyExtents.empty || this._globalDirty;
  }
  get updatingRemaining() {
    return this._dirtyGraphicsSet.size + this._dirtyExtents.size * this._averageExtentUpdateSize;
  }
  runTask(t15) {
    for (this._globalDirty && (this._markAllGraphicsElevationDirty(), this._globalDirty = false, t15.madeProgress()), t15.run(() => this._dirtyExtents.merge(t15)); this.readyToRun && !t15.done; ) this._updateDirtyGraphics(t15), this._updateDirtyExtents(t15);
    this.notifyChange("updating");
  }
  _updateDirtyGraphics(t15) {
    const e22 = this.graphicsCoreOwner.view.renderCoordsHelper, i11 = 0 === this.graphicsCore.effectiveUpdatePolicy;
    for (const r15 of this._dirtyGraphicsSet.keys()) {
      const s18 = this.graphicsCore.getGraphics3DGraphicById(r15);
      if (this._dirtyGraphicsSet.delete(r15), null != s18 && (s18.alignWithElevation(this.elevationProvider, e22, i11), this.graphicsCore.deconflictor?.setDirty(), t15.madeProgress()), t15.done) return;
    }
  }
  _updateDirtyExtents(t15) {
    for (; !this._dirtyExtents.empty && !t15.done; ) {
      const e22 = this._dirtyExtents.pop(), i11 = this.elevationProvider.spatialReference;
      this.events.emit("invalidate-elevation", { extent: e22, spatialReference: i11 });
      const r15 = this._dirtyGraphicsSet.size;
      this.queryGraphicUIDsInExtent(e22, i11, (t16) => {
        const e23 = this.graphicsCore.getGraphics3DGraphicById(t16);
        null != e23 && e23.needsElevationUpdates() && this._dirtyGraphicsSet.add(t16);
      }), this._averageExtentUpdateSize = 0.1 * (this._dirtyGraphicsSet.size - r15) + 0.9 * this._averageExtentUpdateSize, t15.madeProgress();
    }
  }
  _markAllGraphicsElevationDirty() {
    this._dirtyExtents.clear(), this._dirtyGraphicsSet.clear(), this.graphicsCore.graphics3DGraphics.forEach((t15, e22) => this._dirtyGraphicsSet.add(e22));
  }
  _elevationChanged(t15) {
    if ("scene" === t15.context && (!this.graphicsCore.layer.elevationInfo || "relative-to-scene" !== this.graphicsCore.layer.elevationInfo.mode)) return;
    const e22 = t15.extent;
    if (this.graphicsCoreOwner.suspended) {
      if (!this._updateElevation) {
        const t16 = this.graphicsCore.computedExtent;
        t16 && e22[2] > t16.xmin && e22[0] < t16.xmax && e22[3] > t16.ymin && e22[1] < t16.ymax && (this._updateElevation = true);
      }
      this.events.emit("invalidate-elevation", t15);
    } else e22[0] === -1 / 0 ? this._globalDirty = true : this._dirtyExtents.add(e22), this.notifyChange("updating");
  }
};
function p6(t15) {
  return null == t15 ? f4.ELEVATION_ALIGNMENT : "relative-to-scene" === t15 ? f4.ELEVATION_ALIGNMENT_SCENE : f4.ELEVATION_ALIGNMENT;
}
__decorate([m()], h8.prototype, "graphicsCoreOwner", void 0), __decorate([m()], h8.prototype, "graphicsCore", void 0), __decorate([m()], h8.prototype, "queryGraphicUIDsInExtent", void 0), __decorate([m()], h8.prototype, "elevationProvider", void 0), __decorate([m({ readOnly: true })], h8.prototype, "updating", null), __decorate([m({ readOnly: true })], h8.prototype, "updatingRemaining", null), h8 = __decorate([a("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")], h8);

// node_modules/@arcgis/core/views/3d/support/intersectionUtils.js
function g8(r15, n11, t15, i11) {
  return x3(r15, n11, t15, h9(i11, n11, t15, true));
}
var b8 = { dir: n2(), len: 0, clip: n4() };
function h9(r15, c11, o12, f12) {
  const l15 = b8;
  return r15 ? (o12 && f12 && (l15.len = p2(c11, o12)), s7(l15.dir, r15)) : f12 ? (l15.len = p2(c11, o12), c2(l15.dir, o12, c11), g2(l15.dir, l15.dir, 1 / l15.len)) : (c2(l15.dir, o12, c11), A2(l15.dir, l15.dir)), l15;
}
function v5(r15, n11, t15) {
  const i11 = P2(k2(r15), t15.dir), e22 = -X(r15, n11);
  if (e22 < 0 && i11 >= 0) return false;
  if (i11 > -1e-6 && i11 < 1e-6) return e22 > 0;
  if ((e22 < 0 || i11 < 0) && !(e22 < 0 && i11 < 0)) return true;
  const o12 = e22 / i11;
  return i11 > 0 ? o12 < t15.clip[1] && (t15.clip[1] = o12) : o12 > t15.clip[0] && (t15.clip[0] = o12), t15.clip[0] <= t15.clip[1];
}
function x3(r15, n11, t15, i11) {
  i11.clip[0] = 0, i11.clip[1] = t15 ? i11.len : Number.MAX_VALUE;
  for (let e22 = 0; e22 < r15.length; e22++) if (!v5(r15[e22], n11, i11)) return false;
  return true;
}

// node_modules/@arcgis/core/views/3d/support/FrustumExtentIntersection.js
var A3 = 0.5 * Math.PI;
var E4 = A3 / Math.PI * 180;
var G4 = class {
  constructor(t15) {
    this._extent = new Array(4), this._planes = new Array(6), this._maxSpan = 0, this._center = { origin: n2(), direction: n2() }, this._renderCoordsHelper = t15.renderCoordsHelper;
    for (let e22 = 0; e22 < 4; e22++) this._extent[e22] = { origin: n2(), direction: n2(), cap: { next: null, direction: n2() } }, this._planes[e22] = j2();
    this._planes[4] = j2(), this._planes[5] = j2(), this._planesWithoutFar = this._planes.slice(0, 5);
  }
  update(t15, e22, i11, r15 = true) {
    const a16 = this._extent;
    this._toRenderBoundingExtent(t15, e22, i11), u5(this._center.origin, a16[0].origin, a16[2].origin), g2(this._center.origin, this._center.origin, 0.5), this._renderCoordsHelper.worldUpAtPosition(this._center.origin, this._center.direction), r15 || g2(this._center.direction, this._center.direction, -1);
    for (let n11 = 0; n11 < 4; n11++) {
      const t16 = a16[n11];
      this._renderCoordsHelper.worldUpAtPosition(t16.origin, t16.direction);
      const e23 = a16[3 === n11 ? 0 : n11 + 1];
      t16.cap.next = e23.origin, K2(t16.cap.direction, t16.origin, e23.origin), I(t16.direction, t16.cap.direction, t16.origin, this._planes[n11]), r15 || g2(t16.direction, t16.direction, -1);
    }
    I(a16[0].cap.direction, a16[1].cap.direction, a16[0].origin, this._planes[4]), r15 ? H2(this._planes[4], this._planes[5]) : (y3(this._planes[5], this._planes[4]), H2(this._planes[4], this._planes[4])), this._maxSpan = Math.max(Math.abs(t15[0] - t15[2]), Math.abs(t15[1] - t15[3])), this._maxSpanSpatialReference = e22, this._minGlobalAltitude = 0.9 * E(this._maxSpanSpatialReference).radius;
  }
  isVisibleInFrustum(t15, e22, i11 = false) {
    if (null == t15) return false;
    if (1 === this._renderCoordsHelper.viewingMode) {
      const i12 = this._maxSpanSpatialReference.isGeographic ? E4 : A3 * e22;
      if (this._maxSpan > i12) return true;
      if (null != t15.altitude && t15.altitude >= this._minGlobalAltitude) return this._isVisibleInFrustumGlobal(t15);
    }
    if (0 === this._maxSpan) {
      const e23 = this._extent[0];
      return !(i11 || !t15.intersectsRay(k3(e23.origin, e23.direction)));
    }
    for (let n11 = 0; n11 < this._extent.length; n11++) {
      const e23 = this._extent[n11];
      if (!i11 && t15.intersectsRay(k3(e23.origin, e23.direction))) return true;
      if (t15.intersectsLineSegment(b5(e23.origin, e23.cap.next, k4), e23.cap.direction)) return true;
    }
    const r15 = i11 ? this._planes : this._planesWithoutFar;
    for (let n11 = 0; n11 < t15.lines.length; n11++) {
      const e23 = t15.lines[n11];
      if (g8(r15, e23.origin, e23.endpoint, e23.direction)) return true;
    }
    return false;
  }
  _toRenderBoundingExtentGlobal(t15, r15, n11) {
    const o12 = 5;
    g(t15, v6), v6[2] = n11, f5(r15, v6, F3, this._renderCoordsHelper.spatialReference), h3(I2, F3), q(V);
    for (const { x0: i11, x1: s18, y0: c11, y1: l15 } of U4) for (let p8 = 0; p8 < o12; p8++) {
      const h11 = p8 / (o12 - 1);
      v6[0] = o(t15[i11], t15[s18], h11), v6[1] = o(t15[c11], t15[l15], h11), v6[2] = n11, n6(v6, r15, v6, this._renderCoordsHelper.spatialReference), E2(v6, v6, I2), l5(V, v6);
    }
    o4(this._extent[0].origin, V[0], V[1], V[2]), o4(this._extent[1].origin, V[3], V[1], V[2]), o4(this._extent[2].origin, V[3], V[4], V[2]), o4(this._extent[3].origin, V[0], V[4], V[2]);
    for (let e22 = 0; e22 < 4; ++e22) E2(this._extent[e22].origin, this._extent[e22].origin, F3);
  }
  _toRenderBoundingExtentLocal(t15, e22, i11) {
    i7(t15, e22, P5, this._renderCoordsHelper.spatialReference), o4(this._extent[0].origin, P5[0], P5[1], i11), o4(this._extent[1].origin, P5[2], P5[1], i11), o4(this._extent[2].origin, P5[2], P5[3], i11), o4(this._extent[3].origin, P5[0], P5[3], i11);
  }
  _toRenderBoundingExtent(e22, i11, r15) {
    switch (this._renderCoordsHelper.viewingMode) {
      case 1:
        this._toRenderBoundingExtentGlobal(e22, i11, r15);
        break;
      case 2:
        this._toRenderBoundingExtentLocal(e22, i11, r15);
        break;
      default:
        n(this._renderCoordsHelper.viewingMode);
    }
  }
  _isVisibleInFrustumGlobal(t15) {
    if (X(t15.planes[4], this._center.origin) < 0 && P2(this._center.direction, t15.direction) < 0) return true;
    for (let e22 = 0; e22 < 4; e22++) {
      const i11 = this._extent[e22];
      if (X(t15.planes[4], i11.origin) < 0 && P2(i11.direction, t15.direction) < 0) return true;
    }
    return false;
  }
};
var U4 = [{ x0: 0, y0: 1, x1: 2, y1: 1 }, { x0: 0, y0: 3, x1: 2, y1: 3 }, { x0: 0, y0: 1, x1: 0, y1: 3 }, { x0: 2, y0: 1, x1: 2, y1: 3 }];
var v6 = n2();
var F3 = e4();
var I2 = e4();
var V = u4();
var P5 = i3();
var k4 = v2();

// node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DFrustumVisibility.js
var h10 = 1.2;
var u18 = class extends b {
  constructor(e22) {
    super(e22), this.suspended = false, this._extent = null, this._extentIntersectionDirty = true, this._isVisibleBelowSurfaceInternal = false, this.graphicsCoreOwner = null, this.updating = true;
  }
  initialize() {
    const { graphicsCoreOwner: e22 } = this;
    this._extentIntersection = new G4({ renderCoordsHelper: e22.view.renderCoordsHelper });
    const t15 = e22.view, n11 = t15.basemapTerrain, o12 = t15.resourceController.scheduler;
    this.addHandles([t15.on("resize", () => this._viewChange()), l3(() => t15.state.camera, () => this._viewChange(), U2), o12.registerTask(f4.FRUSTUM_VISIBILITY, this), l3(() => n11.visibleElevationBounds, () => this._elevationBoundsChange())]), "local" === t15.viewingMode ? this._isVisibleBelowSurface = true : this.addHandles([l3(() => [n11.baseOpacity, n11.wireframe, t15.map?.ground?.navigationConstraint?.type], () => this._updateIsVisibleBelowSurface(), h2)]);
  }
  destroy() {
    this._set("graphicsCoreOwner", null), this._extent = null, this._extentIntersection = null;
  }
  _setDirty() {
    this.updating || this._set("updating", true);
  }
  setExtent(e22) {
    this._extent = e22, this._extentIntersectionDirty = true, this._setDirty();
  }
  _viewChange() {
    this._setDirty();
  }
  _elevationBoundsChange() {
    this._setDirty(), this._extentIntersectionDirty = true;
  }
  set _isVisibleBelowSurface(e22) {
    this._isVisibleBelowSurfaceInternal = e22, this._setDirty(), this._extentIntersectionDirty = true;
  }
  _updateIsVisibleBelowSurface() {
    const e22 = this.graphicsCoreOwner.view, t15 = e22.basemapTerrain, s18 = "local" === e22.viewingMode, i11 = "none" === e22.map.ground?.navigationConstraint?.type;
    this._isVisibleBelowSurface = s18 || !t15.opaque || i11;
  }
  _updateExtentIntersection() {
    if (!this._extentIntersectionDirty) return;
    this._extentIntersectionDirty = false;
    const e22 = this.graphicsCoreOwner.view;
    let t15;
    if (this._isVisibleBelowSurfaceInternal) t15 = -0.3 * E(e22.spatialReference).radius;
    else {
      const { min: s18, max: i11 } = e22.basemapTerrain.visibleElevationBounds;
      t15 = s18 - Math.max(1, (i11 - s18) * (h10 - 1));
    }
    this._extentIntersection.update(this._extent, e22.spatialReference, t15);
  }
  get readyToRun() {
    return this.updating;
  }
  runTask(e22) {
    if (this._set("updating", false), !this._extent) return this._set("suspended", false), o3;
    this._updateExtentIntersection();
    const t15 = this.graphicsCoreOwner.view.frustum, s18 = E(this.graphicsCoreOwner.view.spatialReference).radius;
    this._set("suspended", !this._extentIntersection.isVisibleInFrustum(t15, s18)), e22.madeProgress();
  }
};
__decorate([m({ readOnly: true })], u18.prototype, "suspended", void 0), __decorate([m({ constructOnly: true })], u18.prototype, "graphicsCoreOwner", void 0), __decorate([m({ readOnly: true })], u18.prototype, "updating", void 0), u18 = __decorate([a("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")], u18);

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/Object3DStateSet.js
var e20 = class {
};
var t12 = class extends e20 {
  constructor(e22, t15) {
    super(), this.objectStateId = e22, this.object = t15;
  }
  remove() {
    this.object.removeStateID(this.objectStateId);
  }
};
var s15 = class extends e20 {
  constructor(e22, t15, s18) {
    super(), this.objectStateId = e22, this.object = t15, this.owner = s18;
  }
  remove() {
    this.owner.removeRenderGeometryObjectState(this.object, this.objectStateId);
  }
};
var o11 = class extends e20 {
  constructor(e22, t15) {
    super(), this.objectStateId = e22, this._removeCallback = t15, this.object = null;
  }
  remove() {
    this._removeCallback(this.objectStateId);
  }
};
var r13 = class {
  constructor() {
    this._items = [];
  }
  addObject(e22, s18) {
    this._items.push(new t12(s18, e22));
  }
  addRenderGeometry(e22, t15, o12) {
    this._items.push(new s15(t15, e22, o12));
  }
  addExternal(e22, t15) {
    this._items.push(new o11(t15, e22));
  }
  remove(e22) {
    this._remove((t15) => t15.objectStateId === e22);
  }
  removeByObject(e22) {
    this._remove((t15) => t15.object === e22);
  }
  removeAll() {
    this._items.forEach((e22) => e22.remove()), this._items = [];
  }
  _remove(e22) {
    const { _items: t15 } = this;
    for (let s18 = t15.length - 1; s18 >= 0; --s18) {
      const o12 = t15[s18];
      e22(o12) && (o12.remove(), t15.splice(s18, 1));
    }
  }
};
var c8 = class extends r13 {
  constructor() {
    super(...arguments), this.stateType = 1;
  }
};
var i8 = class extends r13 {
  constructor(e22) {
    super(), this.highlightName = e22, this.stateType = 0;
  }
};

// node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DObjectStateSet.js
var s16 = class {
  constructor(t15) {
    this.objectIdField = t15, this.ids = /* @__PURE__ */ new Set(), this.paused = false;
  }
  hasGraphic(t15) {
    const e22 = this.objectIdField ? t15.graphic.attributes[this.objectIdField] : t15.graphic.uid;
    return this.ids.has(e22);
  }
};
var i9 = class extends s16 {
  constructor(e22) {
    super(e22), this.stateType = 1, this.objectStateSet = new c8();
  }
};
var c9 = class extends s16 {
  constructor(t15, s18) {
    super(s18), this.highlightName = t15, this.stateType = 0, this.objectStateSet = new i8(t15);
  }
};

// node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DObjectStates.js
var a15 = class {
  constructor(t15) {
    this._graphicsCore = t15, this._stateSets = new Array();
  }
  destroy() {
    this.reset(), this._stateSets = null;
  }
  reset() {
    this._stateSets && (this._stateSets.forEach((t15) => t15.objectStateSet.removeAll()), this._stateSets.length = 0);
  }
  acquireOccludeeSet(s18) {
    const a16 = new i9(s18);
    this._stateSets.push(a16);
    const i11 = e(() => this.releaseSet(a16));
    return { set: a16, handle: i11 };
  }
  acquireHighlightSet(e22, a16) {
    const i11 = new c9(e22, a16);
    this._stateSets.push(i11);
    const c11 = e(() => this.releaseSet(i11));
    return { set: i11, handle: c11 };
  }
  releaseSet(t15) {
    t15.objectStateSet.removeAll();
    const e22 = this._stateSets ? this._stateSets.indexOf(t15) : -1;
    -1 !== e22 && this._stateSets.splice(e22, 1);
  }
  setUid(t15, e22) {
    t15.ids.add(e22);
    const s18 = this._graphicsCore.graphics3DGraphics.get(e22);
    s18 && s18.addObjectStateSet(t15.objectStateSet);
  }
  setUids(t15, e22) {
    e22.forEach((e23) => this.setUid(t15, e23));
  }
  setObjectIds(t15, e22) {
    e22.forEach((e23) => t15.ids.add(e23)), this._initializeSet(t15);
  }
  addGraphic(t15) {
    this._stateSets.forEach((e22) => {
      !e22.paused && e22.hasGraphic(t15) && t15.addObjectStateSet(e22.objectStateSet);
    });
  }
  removeGraphic(t15) {
    this._stateSets.forEach((e22) => {
      e22.hasGraphic(t15) && t15.removeObjectState(e22.objectStateSet);
    });
  }
  allGraphicsDeleted() {
    this._stateSets && this._stateSets.forEach((t15) => t15.objectStateSet.removeAll());
  }
  _initializeSet(t15) {
    const e22 = this._graphicsCore.graphics3DGraphics;
    t15.objectIdField ? e22.forEach((e23) => {
      e23 && t15.hasGraphic(e23) && e23.addObjectStateSet(t15.objectStateSet);
    }) : t15.ids.forEach((s18) => {
      const a16 = e22.get(s18);
      a16 && a16.addObjectStateSet(t15.objectStateSet);
    });
  }
  get test() {
  }
};

// node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DScaleVisibility.js
var p7 = class extends b {
  constructor(e22) {
    super(e22), this._scaleRangeActive = false, this._layerScaleRangeVisibilityQuery = false, this._extent = null, this._updatingHandles = new h4(), this.graphicsCoreOwner = null, this.layer = null, this.queryGraphicUIDsInExtent = null, this.graphicsCore = null, this.basemapTerrain = null, this.layerScaleEnabled = true, this.suspended = false, this._dirty = true;
  }
  initialize() {
    this.updateScaleRangeActive();
    const e22 = this.graphicsCoreOwner.view.resourceController.scheduler;
    this.addHandles(e22.registerTask(f4.SCALE_VISIBILITY, this)), this._updatingHandles.add(() => this.layer.effectiveScaleRange, () => this.layerMinMaxScaleChangeHandler());
  }
  destroy() {
    this._updatingHandles.destroy(), this.removeHandles(), this._dirty = false, this._extent = null, this.graphicsCoreOwner = null, this.layer = null, this.queryGraphicUIDsInExtent = null, this.graphicsCore = null, this.basemapTerrain = null;
  }
  get updating() {
    return this._dirty || this._updatingHandles.updating;
  }
  _setDirty() {
    this._dirty = true;
  }
  setExtent(e22) {
    const i11 = this.graphicsCoreOwner.view.spatialReference, t15 = this.graphicsCoreOwner.view.basemapTerrain.spatialReference;
    if (i11 === t15) this._extent = e22 ?? null;
    else {
      const r15 = i3();
      i7(e22, i11, r15, t15) ? this._extent = r15 : this._extent = null;
    }
    this._setDirty();
  }
  scaleRangeActive() {
    return this._scaleRangeActive;
  }
  updateScaleRangeActive() {
    const e22 = this.layer, i11 = e22.effectiveScaleRange;
    let t15 = this.layerScaleEnabled && null != i11 && d14(i11.minScale, i11.maxScale);
    e22.labelingInfo && !t15 && (t15 = e22.labelingInfo.some((e23) => e23 && d14(e23.minScale ?? 0, e23.maxScale ?? 0)));
    const r15 = this._scaleRangeActive !== t15;
    return this._scaleRangeActive = t15, t15 && !this.hasHandles(u19) && this.basemapTerrain ? (this.addHandles(this.basemapTerrain.on("scale-change", (e23) => this._scaleUpdateHandler(e23)), u19), this.layerScaleEnabled && this.addHandles(this.basemapTerrain.on("tiles-visibility-changed", () => this._setDirty()), u19)) : !t15 && this.hasHandles(u19) && this.removeHandles(u19), r15;
  }
  get readyToRun() {
    return !(!this.graphicsCoreOwner.view.basemapTerrain || !this.updating);
  }
  runTask(e22) {
    const i11 = this.graphicsCoreOwner.view.basemapTerrain;
    if (this._extent && i11 && i11.ready && this._scaleRangeActive && this.layerScaleEnabled) {
      if (this._layerScaleRangeVisibilityQuery) return o3;
      {
        this._layerScaleRangeVisibilityQuery = true;
        const { minScale: e23, maxScale: t15 } = this.layer.effectiveScaleRange;
        i11.queryVisibleScaleRange(this._extent, e23, t15, (e24) => this._finishUpdate(e24));
      }
    } else this._finishUpdate(true);
    e22.madeProgress();
  }
  _finishUpdate(e22) {
    this._layerScaleRangeVisibilityQuery = false, this._set("suspended", !e22), this._dirty = false;
  }
  _visibleAtLayerScale(e22) {
    const i11 = this.layer.effectiveScaleRange;
    return !this.layerScaleEnabled || r5(e22, i11.minScale || 0, i11.maxScale || 0);
  }
  _visibleAtLabelScale(e22, i11) {
    return r5(e22, i11.minScale || 0, i11.maxScale || 0);
  }
  _graphicScale(e22) {
    let i11;
    if (null != e22.centroid ? i11 = e22.centroid : null != e22.graphic.geometry && "point" === e22.graphic.geometry.type && (i11 = e22.graphic.geometry), i11) {
      return this.graphicsCoreOwner.view.basemapTerrain ? this.graphicsCoreOwner.view.basemapTerrain.getScale(i11) : 1;
    }
    return null;
  }
  _graphicVisible(e22) {
    if (!this.layerScaleEnabled) return true;
    const i11 = this._graphicScale(e22);
    return this._visibleAtLayerScale(i11);
  }
  updateVisibility(e22) {
    if (!this._scaleRangeActive) return false;
    const i11 = this._graphicVisible(e22);
    return e22.setVisibilityFlag(1, 2, i11);
  }
  updateGraphicLabelScaleVisibility(e22) {
    if (!this._scaleRangeActive) return false;
    if (!e22.labelLayers.length) return false;
    const i11 = this._graphicScale(e22), t15 = this._updateLabelScaleVisibility(e22, i11);
    return t15 && (this.graphicsCore.deconflictor?.setDirty(), this.graphicsCore.labeler?.setDirty()), t15;
  }
  _updateLabelScaleVisibility(e22, i11) {
    if (!e22.labelLayers.length) return false;
    const t15 = e22.labelLayers[0].labelClass;
    if (null != t15?.minScale && null != t15.maxScale) {
      const r15 = this._visibleAtLabelScale(i11, t15);
      if (e22.setVisibilityFlag(16, 2, r15)) return true;
    }
    return false;
  }
  _scaleUpdateHandler(e22) {
    if (this._setDirty(), !this.graphicsCore.visible) return;
    const i11 = e22.extent, r15 = e22.scale, s18 = this._visibleAtLayerScale(r15);
    let a16 = false;
    const n11 = this.graphicsCoreOwner.view.spatialReference, c11 = e22.spatialReference;
    if (null == c11) return void i.getLogger(this).error("scaleUpdate: Internal error, no SpatialReference given for tiles");
    const o12 = !c11.equals(n11);
    if (o12) {
      if (!i7(i11, c11, g9, n11)) return void i.getLogger(this).error("scaleUpdate: Internal error, cannot project AABR from " + c11 + " to wkid " + n11);
    }
    const h11 = o12 ? g9 : i11;
    this.queryGraphicUIDsInExtent(h11, n11, (e23) => {
      const t15 = this.graphicsCore.getGraphics3DGraphicById(e23);
      if (null == t15) return;
      const l15 = t15.centroid;
      null != l15 && (i11[0] > l15.x || i11[1] > l15.y || i11[2] < l15.x || i11[3] < l15.y) || (t15.setVisibilityFlag(1, 2, s18) && (a16 = true), this._updateLabelScaleVisibility(t15, r15) && (a16 = true));
    }), a16 && (this.graphicsCore.deconflictor?.setDirty(), this.graphicsCore.labeler?.setDirty());
  }
  layerMinMaxScaleChangeHandler() {
    this.updateScaleRangeActive() && !this._scaleRangeActive ? this.graphicsCore.modifyGraphics3DGraphicVisibilities((e22) => e22.setVisibilityFlag(1, 2, true)) : this._scaleRangeActive && this.graphicsCore.updateGraphicsVisibilities(), this._setDirty();
  }
};
function d14(e22, i11) {
  return e22 > 0 || i11 > 0;
}
__decorate([m()], p7.prototype, "graphicsCoreOwner", void 0), __decorate([m()], p7.prototype, "layer", void 0), __decorate([m()], p7.prototype, "queryGraphicUIDsInExtent", void 0), __decorate([m()], p7.prototype, "graphicsCore", void 0), __decorate([m()], p7.prototype, "basemapTerrain", void 0), __decorate([m({ constructOnly: true })], p7.prototype, "layerScaleEnabled", void 0), __decorate([m({ readOnly: true })], p7.prototype, "suspended", void 0), __decorate([m({ readOnly: true })], p7.prototype, "updating", null), __decorate([m()], p7.prototype, "_dirty", void 0), p7 = __decorate([a("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")], p7);
var u19 = "terrain-events";
var g9 = i3();

// node_modules/@arcgis/core/views/3d/layers/support/highlightUtils.js
function e21(o12) {
  return O.isCollection(o12) ? o12.toArray() : Array.isArray(o12) ? o12 : i10(o12) || i4(o12) || c10(o12) ? [o12] : n10;
}
function i10(r15) {
  return "number" == typeof r15 || "string" == typeof r15;
}
var n10 = [];
var s17 = e();
function c10(r15) {
  return "esri.views.3d.layers.i3s.PointCloudGraphic" === r15.declaredClass;
}

// node_modules/@arcgis/core/views/3d/layers/graphics/GraphicsProcessor.js
var S3 = class extends b {
  constructor(i11) {
    super(i11), this.drapeSourcePriorityOffset = 0, this.type = "graphics-3d", this.graphicsCore = null, this.drapeSourceType = 1, this.scaleVisibilityEnabled = false, this.frustumVisibilityEnabled = false, this._suspendResumeExtent = null, this._updatingHandles = new h4();
  }
  initialize() {
    const { layer: i11 } = this, t15 = "effectiveScaleRange" in i11 ? i11 : null, e22 = !a7() && this.scaleVisibilityEnabled && null != t15, r15 = new ke({ owner: this, layer: this.owner.layer, preferredUpdatePolicy: 1, graphicSymbolSupported: true, componentFactories: { elevationAlignment: (i12, t16) => new h8({ graphicsCoreOwner: this, graphicsCore: i12, queryGraphicUIDsInExtent: t16, elevationProvider: this.view.elevationProvider }), scaleVisibility: e22 ? (i12, e23) => new p7({ graphicsCoreOwner: this, layer: t15, queryGraphicUIDsInExtent: e23, graphicsCore: i12, basemapTerrain: this.owner.view.basemapTerrain }) : null, objectStates: (i12) => new a15(i12) } });
    if (this._set("graphicsCore", r15), this.frustumVisibilityEnabled && this._set("frustumVisibility", new u18({ graphicsCoreOwner: this })), "fullOpacity" in this.owner) {
      const i12 = this.owner;
      this._updatingHandles.add(() => i12.fullOpacity, () => this.graphicsCore.opacityChange());
    }
    if ("elevationInfo" in i11) {
      const t16 = i11;
      this._updatingHandles.add(() => t16.elevationInfo, (i12, t17) => {
        y2(i12, t17) && this._updatingHandles.addPromise(this.graphicsCore.elevationInfoChange());
      });
    }
    this._set("initializePromise", this._initializeAsync()), this._updatingHandles.addPromise(this.initializePromise);
  }
  async _initializeAsync() {
    try {
      await this.graphicsCore.initializePromise;
    } catch (i11) {
      if (d(i11)) return;
      throw i11;
    }
    this.destroyed || (this.addHandles(l3(() => this.view.clippingArea, () => this._updateClippingExtent(), U2)), this._updateClippingExtent(), this._setupSuspendResumeExtent(), this.graphicsCore.startCreateGraphics());
  }
  destroy() {
    this._updatingHandles.destroy(), this._set("frustumVisibility", u2(this.frustumVisibility)), this._set("graphicsCore", u2(this.graphicsCore));
  }
  get layer() {
    return this.owner.layer;
  }
  get layerViewUid() {
    return this.owner.uid;
  }
  get view() {
    return this.owner.view;
  }
  get scaleVisibility() {
    return this.graphicsCore?.scaleVisibility;
  }
  get elevationAlignment() {
    return this.graphicsCore?.elevationAlignment;
  }
  get scaleVisibilitySuspended() {
    return !(null == this.scaleVisibility || !this.scaleVisibility.suspended);
  }
  get frustumVisibilitySuspended() {
    return null != this.frustumVisibility && this.frustumVisibility.suspended;
  }
  get suspended() {
    return this.owner.suspended ?? false;
  }
  get updating() {
    return !!(this.graphicsCore?.updating || null != this.scaleVisibility && this.scaleVisibility.updating || null != this.frustumVisibility && this.frustumVisibility.updating || this._updatingHandles.updating);
  }
  get graphics3DGraphics() {
    return this.graphicsCore?.graphics3DGraphics;
  }
  get graphics3DGraphicsByObjectID() {
    return this.graphicsCore?.graphics3DGraphicsByObjectID;
  }
  get loadedGraphics() {
    return this.owner.loadedGraphics;
  }
  get fullOpacity() {
    return this.owner.fullOpacity ?? 1;
  }
  get slicePlaneEnabled() {
    return this.owner.slicePlaneEnabled;
  }
  get updatePolicy() {
    return this.owner.updatePolicy;
  }
  notifyGraphicGeometryChanged(i11) {
    this.graphicsCore.notifyGraphicGeometryChanged(i11);
  }
  notifyGraphicVisibilityChanged(i11) {
    this.graphicsCore.notifyGraphicVisibilityChanged(i11);
  }
  notifyContentGeometryUpdate() {
    this.owner.notifyContentGeometryUpdate?.();
  }
  getRenderingInfo(i11, t15, e22) {
    const r15 = r7(i11, { renderer: t15, arcade: e22 });
    if (r15?.color) {
      const i12 = r15.color;
      i12[0] = i12[0] / 255, i12[1] = i12[1] / 255, i12[2] = i12[2] / 255;
    }
    return r15;
  }
  getRenderingInfoAsync(i11, t15, e22, r15) {
    return n9(i11, { renderer: t15, arcade: e22, ...r15 });
  }
  getHit(i11, t15) {
    if (this.owner.loadedGraphics) {
      const e22 = this.owner.loadedGraphics.find((t16) => t16.uid === i11);
      if (e22) {
        const i12 = this.layer instanceof b6 ? this.layer : null, r15 = c4(e22, i12, t15);
        return { type: "graphic", graphic: r15, layer: r15.layer };
      }
    }
    return null;
  }
  whenGraphicBounds(i11, t15) {
    return this.graphicsCore ? this.graphicsCore.whenGraphicBounds(i11, t15) : Promise.reject();
  }
  computeAttachmentOrigin(i11, t15) {
    return this.graphicsCore ? this.graphicsCore.computeAttachmentOrigin(i11, t15) : null;
  }
  getSymbolLayerSize(i11, t15) {
    return this.graphicsCore ? this.graphicsCore.getSymbolLayerSize(i11, t15) : null;
  }
  maskOccludee(i11) {
    const t15 = this.graphicsCore?.objectStates;
    if (!t15) return e();
    const { set: e22, handle: s18 } = t15.acquireOccludeeSet(null);
    return t15.setUid(e22, i11.uid), s18;
  }
  highlight(i11, e22) {
    const r15 = this.graphicsCore?.objectStates;
    if (!r15) return O5;
    const s18 = e21(i11);
    if (0 === s18.length) return O5;
    if (s18[0] instanceof _3) {
      const i12 = s18.map((i13) => i13.uid), { set: t15, handle: n11 } = r15.acquireHighlightSet(e22, null);
      return r15.setUids(t15, i12), n11;
    }
    if ("number" == typeof s18[0]) {
      const i12 = s18, { set: t15, handle: n11 } = r15.acquireHighlightSet(e22, null);
      return r15.setObjectIds(t15, i12), n11;
    }
    return O5;
  }
  _setupSuspendResumeExtent() {
    const { scaleVisibility: i11, frustumVisibility: t15 } = this;
    if (null == i11 && null == t15) return;
    const e22 = ({ computedExtent: e23, extentPadding: r15 }) => {
      this._suspendResumeExtent = U3(e23, this._suspendResumeExtent, r8, r15), null != i11 && i11.setExtent(this._suspendResumeExtent), null != t15 && t15.setExtent(this._suspendResumeExtent);
    };
    this.addHandles(l3(() => ({ computedExtent: this.graphicsCore?.computedExtent, extentPadding: this.graphicsCore?.extentPadding }), (i12) => e22(i12), w));
  }
  _updateClippingExtent() {
    const i11 = this.view.clippingArea;
    this.graphicsCore.setClippingExtent(i11, this.view.spatialReference) && this.graphicsCore.recreateAllGraphics();
  }
};
__decorate([m()], S3.prototype, "drapeSourcePriorityOffset", void 0), __decorate([m()], S3.prototype, "type", void 0), __decorate([m({ constructOnly: true })], S3.prototype, "owner", void 0), __decorate([m()], S3.prototype, "layer", null), __decorate([m()], S3.prototype, "layerViewUid", null), __decorate([m()], S3.prototype, "view", null), __decorate([m({ constructOnly: true })], S3.prototype, "graphicsCore", void 0), __decorate([m()], S3.prototype, "scaleVisibility", null), __decorate([m({ constructOnly: true })], S3.prototype, "frustumVisibility", void 0), __decorate([m()], S3.prototype, "elevationAlignment", null), __decorate([m()], S3.prototype, "scaleVisibilitySuspended", null), __decorate([m({ readOnly: true })], S3.prototype, "frustumVisibilitySuspended", null), __decorate([m()], S3.prototype, "suspended", null), __decorate([m({ readOnly: true })], S3.prototype, "updating", null), __decorate([m()], S3.prototype, "loadedGraphics", null), __decorate([m()], S3.prototype, "fullOpacity", null), __decorate([m()], S3.prototype, "slicePlaneEnabled", null), __decorate([m()], S3.prototype, "drapeSourceType", void 0), __decorate([m()], S3.prototype, "updatePolicy", null), __decorate([m({ constructOnly: true })], S3.prototype, "scaleVisibilityEnabled", void 0), __decorate([m({ constructOnly: true })], S3.prototype, "frustumVisibilityEnabled", void 0), __decorate([m()], S3.prototype, "initializePromise", void 0), S3 = __decorate([a("esri.views.3d.layers.graphics.GraphicsProcessor")], S3);
var O5 = e();

// node_modules/@arcgis/core/views/3d/layers/graphics/queryForSymbologySnapping.js
async function r14(r15, a16, s18) {
  if (null == r15 || 0 === a16.candidates.length) return t13;
  const i11 = r15.graphics3DGraphicsByObjectID ?? r15.graphics3DGraphics, o12 = [], c11 = [], { renderer: d15 } = r15, l15 = null != d15 && "arcadeRequired" in d15 && d15.arcadeRequired ? e10() : null, p8 = async (e22, { graphic: n11, graphics3DSymbol: t15 }) => {
    const a17 = await l15, i12 = await r15.getRenderingInfoAsync(n11, d15, a17, { signal: s18 });
    return null == i12 ? [] : t15.queryForSnapping(e22, g10, i12, s18);
  }, { candidates: u20, spatialReference: g10 } = a16;
  for (let e22 = 0; e22 < u20.length; ++e22) {
    const n11 = u20[e22], { objectId: r16 } = n11, t15 = "number" == typeof r16 ? i11?.get(r16) : void 0;
    if (null == t15) continue;
    const { graphics3DSymbol: a17 } = t15;
    a17.symbologySnappingSupported && (o12.push(p8(n11, t15)), c11.push(e22));
  }
  if (0 === o12.length) return t13;
  const h11 = await Promise.all(o12);
  s2(s18);
  const f12 = [], m9 = [];
  for (let e22 = 0; e22 < h11.length; ++e22) {
    const n11 = h11[e22], r16 = c11[e22];
    for (const e23 of n11) f12.push(e23), m9.push(r16);
  }
  return { candidates: f12, sourceCandidateIndices: m9 };
}
var t13 = { candidates: [], sourceCandidateIndices: [] };

// node_modules/@arcgis/core/views/3d/layers/support/LayerViewPerformanceInfo.js
var t14 = class {
  constructor(t15, e22 = 0, s18 = 0, r15 = 0, i11 = 0, o12 = null) {
    this.usedMemory = t15, this.displayedFeatures = e22, this.totalFeatures = s18, this.maximumFeatures = r15, this.nodes = i11, this.core = o12;
  }
};

// node_modules/@arcgis/core/views/3d/layers/GraphicsLayerView3D.js
var y4 = class extends l10(d5) {
  constructor() {
    super(...arguments), this.type = "graphics-3d", this.symbologySnappingSupported = true, this._slicePlaneEnabled = false, this.fullExtentInLocalViewSpatialReference = null, this.ignoresMemoryFactor = true;
  }
  get highlightOptions() {
    return null;
  }
  initialize() {
    this._set("processor", new S3({ owner: this, scaleVisibilityEnabled: true, frustumVisibilityEnabled: true })), this.addResolvingPromise(this.processor.initializePromise), this.addHandles(this.layer.on("graphic-update", (e22) => this.processor.graphicsCore.graphicUpdateHandler(e22))), this.layer.internal ? this.notifyChange("updating") : ("local" === this.view.viewingMode && this.addResolvingPromise((async () => this.fullExtentInLocalViewSpatialReference = await p3(this.layer.fullExtent, this.view.spatialReference))()), this.addHandles(f2(() => this.view?.basemapTerrain?.ready, () => () => this.notifyChange("updating"), { once: true })));
  }
  destroy() {
    this._updatingHandles.removeAll(), this._set("processor", u2(this.processor));
  }
  get loadedGraphics() {
    return this.layer.graphics;
  }
  get legendEnabled() {
    return this.canResume() && !this.processor?.frustumVisibilitySuspended;
  }
  get visibleAtCurrentScale() {
    return a7() ? t7(this.layer.effectiveScaleRange, this.view.scale) : !this.processor?.scaleVisibilitySuspended;
  }
  get slicePlaneEnabled() {
    const e22 = this.layer.internal;
    return this._slicePlaneEnabled && !e22;
  }
  set slicePlaneEnabled(e22) {
    this._slicePlaneEnabled = e22;
  }
  getSuspendInfo() {
    const e22 = super.getSuspendInfo();
    return e22.outsideOfView = this.processor?.frustumVisibilitySuspended ?? false, e22;
  }
  getHit(e22) {
    return this.processor.getHit(e22, null);
  }
  whenGraphicBounds(e22, r15) {
    return this.processor.whenGraphicBounds(e22, r15);
  }
  computeAttachmentOrigin(e22, r15) {
    return this.processor?.computeAttachmentOrigin(e22, r15);
  }
  getSymbolLayerSize(e22, r15) {
    return this.processor.getSymbolLayerSize(e22, r15);
  }
  queryGraphics() {
    return Promise.resolve(this.loadedGraphics);
  }
  maskOccludee(e22) {
    return this.processor.maskOccludee(e22);
  }
  highlight(e22, r15) {
    return this.processor.highlight(e22, r6(r15));
  }
  notifyContentGeometryUpdate() {
    this.emit("visible-geometry-changed");
  }
  async elevationAlignPointsInFeatures(e22, s18) {
    const { processor: t15 } = this;
    if (null == t15?.graphics3DGraphics) throw new s("graphicslayerview3d:missing-processor", "A Graphics3D processor is needed to resolve graphics elevation.");
    const { graphics3DGraphics: i11 } = t15, o12 = (e23) => "number" == typeof e23 ? i11.get(e23) : void 0;
    return l11(this.view, this.layer, o12, e22, s18);
  }
  async queryForSymbologySnapping(e22, r15) {
    return r14(this.processor, e22, r15);
  }
  get updatePolicy() {
    return this.processor?.graphicsCore.effectiveUpdatePolicy || 1;
  }
  isUpdating() {
    return this.view && this.layer && !(!this.processor?.updating && (this.layer.internal || this.view.basemapTerrain?.ready));
  }
  get performanceInfo() {
    return new t14(this.usedMemory, this.loadedGraphics.length, -1, -1);
  }
  get usedMemory() {
    return this.processor?.graphicsCore?.usedMemory ?? 0;
  }
  get unloadedMemory() {
    return this.processor?.graphicsCore?.unprocessedMemoryEstimate;
  }
  get test() {
    return { graphics3DProcessor: this.processor, loadedGraphics: this.loadedGraphics };
  }
};
__decorate([m()], y4.prototype, "highlightOptions", null), __decorate([m()], y4.prototype, "loadedGraphics", null), __decorate([m({ readOnly: true })], y4.prototype, "legendEnabled", null), __decorate([m()], y4.prototype, "layer", void 0), __decorate([m({ readOnly: true })], y4.prototype, "processor", void 0), __decorate([m({ readOnly: true })], y4.prototype, "visibleAtCurrentScale", null), __decorate([m()], y4.prototype, "_slicePlaneEnabled", void 0), __decorate([m({ type: Boolean })], y4.prototype, "slicePlaneEnabled", null), y4 = __decorate([a("esri.views.3d.layers.GraphicsLayerView3D")], y4);
var f11 = y4;
export {
  f11 as default
};
//# sourceMappingURL=GraphicsLayerView3D-HZH7HNVH.js.map
