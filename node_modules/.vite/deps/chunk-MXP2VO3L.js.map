{
  "version": 3,
  "sources": ["../../@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{translate as e}from\"../../../../../core/libs/gl-matrix-2/math/mat4.js\";import{create as s}from\"../../../../../core/libs/gl-matrix-2/factories/mat4f64.js\";import{g as i,t as a,e as l,j as c}from\"../../../../../chunks/vec32.js\";import{ZEROS as n,create as o}from\"../../../../../core/libs/gl-matrix-2/factories/vec3f64.js\";import{Float3DrawUniform as r}from\"../shaderModules/Float3DrawUniform.js\";import{Float3PassUniform as t}from\"../shaderModules/Float3PassUniform.js\";import{glsl as f}from\"../shaderModules/glsl.js\";import{NoParameters as d}from\"../../../../webgl/NoParameters.js\";class u extends d{constructor(e){super(),this.slicePlaneLocalOrigin=e}}function P(e,s){B(e,s,new t(\"slicePlaneOrigin\",(e,i)=>h(s,e,i)),new t(\"slicePlaneBasis1\",(e,i)=>y(s,e,i,i.slicePlane?.basis1)),new t(\"slicePlaneBasis2\",(e,i)=>y(s,e,i,i.slicePlane?.basis2)))}function p(e,s){B(e,s,new r(\"slicePlaneOrigin\",(e,i)=>h(s,e,i)),new r(\"slicePlaneBasis1\",(e,i)=>y(s,e,i,i.slicePlane?.basis1)),new r(\"slicePlaneBasis2\",(e,i)=>y(s,e,i,i.slicePlane?.basis2)))}function m(e,s){v(e,s,new r(\"slicePlaneOrigin\",(e,i)=>h(s,e,i)),new r(\"slicePlaneBasis1\",(e,i)=>y(s,e,i,i.slicePlane?.basis1)),new r(\"slicePlaneBasis2\",(e,i)=>y(s,e,i,i.slicePlane?.basis2)))}const b=f`struct SliceFactors {\nfloat front;\nfloat side0;\nfloat side1;\nfloat side2;\nfloat side3;\n};\nSliceFactors calculateSliceFactors(vec3 pos) {\nvec3 rel = pos - slicePlaneOrigin;\nvec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);\nfloat slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);\nfloat basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);\nfloat basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);\nfloat basis1Dot = dot(slicePlaneBasis1, rel);\nfloat basis2Dot = dot(slicePlaneBasis2, rel);\nreturn SliceFactors(\ndot(slicePlaneNormal, pos) + slicePlaneW,\n-basis1Dot - basis1Len2,\nbasis1Dot - basis1Len2,\n-basis2Dot - basis2Len2,\nbasis2Dot - basis2Len2\n);\n}\nbool sliceByFactors(SliceFactors factors) {\nreturn factors.front < 0.0\n&& factors.side0 < 0.0\n&& factors.side1 < 0.0\n&& factors.side2 < 0.0\n&& factors.side3 < 0.0;\n}\nbool sliceEnabled() {\nreturn dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;\n}\nbool sliceByPlane(vec3 pos) {\nreturn sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));\n}\nbool rejectBySlice(vec3 pos) {\nreturn sliceByPlane(pos);\n}`;function v(e,s,...i){s.hasSlicePlane?(e.uniforms.add(...i),e.code.add(b)):e.code.add(\"bool rejectBySlice(vec3 pos) { return false; }\")}function B(e,s,...i){v(e,s,...i),s.hasSlicePlane?e.code.add(\"\\n    void discardBySlice(vec3 pos) {\\n      if (sliceByPlane(pos)) {\\n        discard;\\n      }\\n    }\\n\\n    vec4 applySliceOutline(vec4 color, vec3 pos) {\\n      SliceFactors factors = calculateSliceFactors(pos);\\n\\n      factors.front /= 2.0 * fwidth(factors.front);\\n      factors.side0 /= 2.0 * fwidth(factors.side0);\\n      factors.side1 /= 2.0 * fwidth(factors.side1);\\n      factors.side2 /= 2.0 * fwidth(factors.side2);\\n      factors.side3 /= 2.0 * fwidth(factors.side3);\\n\\n      // return after calling fwidth, to avoid aliasing caused by discontinuities in the input to fwidth\\n      if (sliceByFactors(factors)) {\\n        return color;\\n      }\\n\\n      float outlineFactor = (1.0 - step(0.5, factors.front))\\n        * (1.0 - step(0.5, factors.side0))\\n        * (1.0 - step(0.5, factors.side1))\\n        * (1.0 - step(0.5, factors.side2))\\n        * (1.0 - step(0.5, factors.side3));\\n\\n      return mix(color, vec4(vec3(0.0), color.a), outlineFactor * 0.3);\\n    }\\n\\n    vec4 applySlice(vec4 color, vec3 pos) {\\n      return sliceEnabled() ? applySliceOutline(color, pos) : color;\\n    }\\n  \"):e.code.add(f`void discardBySlice(vec3 pos) { }\nvec4 applySlice(vec4 color, vec3 pos) { return color; }`)}function w(e,s,i){return e.instancedDoublePrecision?c(F,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]):s.slicePlaneLocalOrigin}function S(e,s){return null!=e?l(j,s.origin,e):s.origin}function g(s,i,a){return s.hasSliceTranslatedView?null!=i?e(O,a.camera.viewMatrix,i):a.camera.viewMatrix:null}function h(e,s,i){if(null==i.slicePlane)return n;const l=w(e,s,i),c=S(l,i.slicePlane),o=g(e,l,i);return null!=o?a(j,c,o):c}function y(e,s,c,o){if(null==o||null==c.slicePlane)return n;const r=w(e,s,c),t=S(r,c.slicePlane),f=g(e,r,c);return null!=f?(i(x,o,t),a(j,t,f),a(x,x,f),l(x,x,j)):o}const F=o(),j=o(),x=o(),O=s();export{m as RejectBySlice,p as SliceDraw,P as SlicePass,u as SlicePlaneParameters};\n"],
  "mappings": "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",
  "names": ["e", "i", "a", "c", "o", "t"]
}
