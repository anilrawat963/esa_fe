{
  "version": 3,
  "sources": ["../../@arcgis/core/core/mapCollectionUtils.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{createTask as e}from\"./asyncUtils.js\";import t from\"./Collection.js\";import{removeIfHandle as o,destroyHandle as s}from\"./handleUtils.js\";import{isAborted as r,createAbortError as n,ignoreAbortErrors as i}from\"./promiseUtils.js\";import{on as a}from\"./reactiveUtils.js\";function c(e,o,s){const r=s?.createCollection?.()??new t,n=!!s?.recycleItems?new d:null,i=(e,t=0)=>{if(!e?.length)return;const o=r.splice(t,e.length);n?n.processRemoved(e):o.forEach(m)},c=(e,t=0)=>{if(!e?.length)return;const s=[];for(const r of e){const e=n?.use(r);if(e)s.push(e);else{const e=o(r);n?.register(r,e),s.push(e)}}r.addMany(s,t)},l=a(e,\"after-splice\",({added:e,start:t,removed:o})=>{i(o,t),c(e,t)},{sync:!0,onListenerRemove:e=>i(e.items),onListenerAdd:e=>c(e.items)});return r.addHandles(l),r}class d{constructor(){this._originalToMapped=new Map,this._removedItemCandidates=new Set,this._garbageCollectionQueued=!1}processRemoved(e){if(!e?.length)return;const{_removedItemCandidates:t}=this;for(const o of e)this._getItem(o)?.markRemoved()&&(t.add(o),this._queueGarbageCollection())}use(e){const t=this._getItem(e);return t&&(t.removed=!1),t?.item}register(e,t){this._originalToMapped.set(e,new l(t))}_getItem(e){return this._originalToMapped.get(e)}_queueGarbageCollection(){this._garbageCollectionQueued||(this._garbageCollectionQueued=!0,queueMicrotask(()=>this._garbageCollectCandidates()))}_garbageCollectCandidates(){this._garbageCollectionQueued=!1;const{_removedItemCandidates:e}=this,t=Array.from(e);e.clear(),t.forEach(e=>this._garbageCollectIfRemoved(e))}_garbageCollectIfRemoved(e){const{_originalToMapped:t}=this,o=this._getItem(e);o?.removed&&(m(o.item),t.delete(e))}}class l{constructor(e){this.item=e,this.removed=!1}markRemoved(){return this.removed=!0,!0}}function m(e){\"object\"==typeof e&&e&&(\"destroy\"in e&&\"function\"==typeof e.destroy?e.destroy():o(e))}function u(o,a,d){const l=new t,u=c(o,t=>e(async e=>{const o=await a(t,e);if(r(e))throw m(o),n();return o}),d),f=()=>null,g=async e=>{const t=await e.promise,o=u.indexOf(e);o<0||l.splice(o,1,t)};l.addMany(u.items.map(f));for(const e of u)i(g(e));const h=u.on(\"after-splice\",({added:e,start:t,deleteCount:o})=>{const s=l.splice(t,o);for(const r of s)m(r);if(e?.length){l.addMany(e.map(f),t);for(const t of e)i(g(t))}});return l.addHandles([s(u),h]),l}export{c as mapCollection,u as mapCollectionAsync};\n"],
  "mappings": "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",
  "names": ["c", "d", "e", "o", "s", "r", "l", "a", "u", "t"]
}
