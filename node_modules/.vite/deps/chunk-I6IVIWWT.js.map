{
  "version": 3,
  "sources": ["../../@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/shaders/OverlayShader.js", "../../@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/overlay/OverlayTechnique.js", "../../@arcgis/core/views/2d/engine/webgl/OverlayContainer.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{__decorate as t,__param as o}from\"tslib\";import{GraphShaderModule as e,FragmentOutput as r,location as p,uniform as i,input as s,VertexInput as n,UniformGroup as d,FragmentInput as l}from\"../../GraphShaderModule.js\";import{Float as v,dot as a,Vec3 as y,Vec2 as c,Vec4 as u,texture2D as f,Mat3 as h,Sampler2D as m}from\"../../graph/glsl.js\";class x extends n{}t([p(0,c)],x.prototype,\"pos\",void 0),t([p(1,c)],x.prototype,\"uv\",void 0);class g extends l{}class w extends d{}t([i(h)],w.prototype,\"dvs\",void 0);class S extends d{}t([i(c)],S.prototype,\"perspective\",void 0),t([i(c)],S.prototype,\"texSize\",void 0),t([i(v)],S.prototype,\"wrapAroundShift\",void 0),t([i(v)],S.prototype,\"opacity\",void 0),t([i(m)],S.prototype,\"texture\",void 0);class j extends e{constructor(){super(...arguments),this.type=\"OverlayShader\"}vertex(t){const o=t.uv.divide(this.config.texSize),e=new v(1).add(a(o,this.config.perspective)),r=new y(t.pos.add(new c(this.config.wrapAroundShift,0)),1),p=this.transform.dvs.multiply(r);return{uv:o,glPosition:new u(p.xy.multiply(e),0,e)}}fragment(t){const o=f(this.config.texture,t.uv).multiply(this.config.opacity),e=new r;return e.fragColor=o,e}}t([i(w)],j.prototype,\"transform\",void 0),t([i(S)],j.prototype,\"config\",void 0),t([o(0,s(x))],j.prototype,\"vertex\",null),t([o(0,s(g))],j.prototype,\"fragment\",null);export{j as OverlayShader};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{destroyMaybe as e}from\"../../../../../../../core/maybe.js\";import{Mesh as t}from\"../../../meshing/Mesh.js\";import{simplePipelineState as s}from\"../../utils.js\";import{Technique as i}from\"../Technique.js\";import{OverlayShader as r}from\"../shaders/OverlayShader.js\";import{PrimitiveType as n,DataType as o}from\"../../../../../../webgl/enums.js\";import{VertexElementDescriptor as a}from\"../../../../../../webgl/VertexElementDescriptor.js\";class h extends i{constructor(){super(...arguments),this.type=25,this._mesh=null,this.shaders={overlay:new r}}render(e,t){const{context:i,painter:r}=e,n=this._getMesh(e,t);r.setPipelineState(s);const{isWrapAround:o,wrapAroundShift:a}=t.config,h={...t.config,wrapAroundShift:0},p={shader:this.shaders.overlay,uniforms:{transform:t.transform,config:h},defines:null,optionalAttributes:null,useComputeBuffer:!1};r.setPipelineState({...s,stencil:{write:!1,test:{compare:514,op:{fail:7680,zFail:7680,zPass:7681},mask:255}}}),r.submitDrawMeshUntyped(i,p,n,{stencilRef:0}),o&&(h.wrapAroundShift=a,r.submitDrawMeshUntyped(i,p,n,{stencilRef:0}))}shutdown(){e(this._mesh)}_getMesh(e,s){const{context:i}=e;if(this._mesh){const e=this._mesh.vertexBuffers.get(\"positions\");if(!e)throw new Error(\"Buffer not found\");e.setData(s.position)}else{const e=null!=s.index?s.index.length:s.position.length/2;this._mesh=new t(i,{vertex:{positions:{data:s.position,layout:[new a(\"pos\",2,o.FLOAT,0,8)]},uvs:{data:s.tex,layout:[new a(\"uv\",2,o.UNSIGNED_SHORT,0,4)]}},index:null!=s.index?{index:{data:s.index}}:void 0,groups:[{index:null!=s.index?\"index\":void 0,primitive:n.TRIANGLE_STRIP}],parts:[{group:0,start:0,count:e}]})}return this._mesh}}export{h as OverlayTechnique};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{toRadian as t}from\"../../../../core/libs/gl-matrix-2/math/common.js\";import{identity as e,multiply as r,translate as i,scale as o,rotate as s}from\"../../../../core/libs/gl-matrix-2/math/mat3.js\";import{create as a}from\"../../../../core/libs/gl-matrix-2/factories/mat3f32.js\";import{fromValues as n}from\"../../../../core/libs/gl-matrix-2/factories/vec2f32.js\";import{fromValues as l}from\"../../../../core/libs/gl-matrix-2/factories/vec3f32.js\";import{normalizeMapX as c}from\"../../../../geometry/support/normalizeUtils.js\";import{getInfo as h}from\"../../../../geometry/support/spatialReferenceUtils.js\";import{getWorldWidth as d}from\"../../viewpointUtils.js\";import m from\"./WGLContainer.js\";import{OverlayTechnique as p}from\"./shaderGraph/techniques/overlay/OverlayTechnique.js\";class f extends m{constructor(){super(...arguments),this._viewStateId=-1,this._dvsMat3=a(),this._overlayTechnique=new p}get dvsMat3(){return this._dvsMat3}beforeRender(t){this._updateMatrices(t),this._updateOverlays(t,this.children);for(const e of this.children)e.beforeRender(t)}doRender(t){if(1!==t.drawPhase||!this.visible)return;super.doRender(t);const e=this._overlayTechnique;for(const r of this.children)r.draw(t,e)}onDetach(){this._overlayTechnique.shutdown()}_updateMatrices(a){const{state:h}=a,{id:d,size:m,pixelRatio:p,resolution:f,rotation:u,viewpoint:v,displayMat3:_}=h;if(this._viewStateId===d)return;const g=t(u),y=p*m[0],M=p*m[1];this._localOrigin=v.targetGeometry.clone();const{x:w,y:x}=this._localOrigin,b=c(w,h.spatialReference);this._localOrigin.x=b,this._localOrigin.y=x;const j=f*y,O=f*M,R=e(this._dvsMat3);r(R,R,_),i(R,R,n(y/2,M/2)),o(R,R,l(y/j,-M/O,1)),s(R,R,-g),this._viewStateId=d}_updateOverlays(e,r){const{state:i}=e,{rotation:o,spatialReference:s,worldScreenWidth:a,size:n,viewpoint:l}=i,c=this._localOrigin;let m,p=0;const f=h(s);if(f&&s.isWrappable){const e=n[0],r=n[1],c=t(o),h=Math.abs(Math.cos(c)),u=Math.abs(Math.sin(c)),v=Math.round(e*h+r*u),[_,g]=f.valid,y=d(s),{x:M,y:w}=l.targetGeometry,x=[M,w],b=[0,0];i.toScreen(b,x);const j=[0,0];let O;O=v>a?.5*a:.5*v;const R=Math.floor((M+.5*y)/y),q=_+R*y,S=g+R*y,G=[b[0]+O,0];i.toMap(j,G),j[0]>S&&(p=y),G[0]=b[0]-O,i.toMap(j,G),j[0]<q&&(p=-y),m={worldWidth:y,xBounds:[_,g]}}for(const t of r)t.updateDrawCoords(c,p,i,m)}}export{f as default};\n"],
  "mappings": "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",
  "names": ["C", "f", "w", "S", "t", "o", "e", "r", "_", "h", "e", "t", "i", "r", "o", "s", "f", "i", "h", "t", "e", "r", "m", "u", "v", "_", "g", "M", "w", "x", "j", "R", "o", "s", "l", "c", "S", "G"]
}
