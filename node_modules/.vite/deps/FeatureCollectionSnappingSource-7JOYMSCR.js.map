{
  "version": 3,
  "sources": ["../../@arcgis/core/views/interactive/snapping/featureSources/FeatureCollectionSnappingSource.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{__decorate as e}from\"tslib\";import t from\"../../../../core/Accessor.js\";import{memoize as i}from\"../../../../core/memoize.js\";import{throwIfAborted as r,whenOrAbort as n}from\"../../../../core/promiseUtils.js\";import{watch as o,on as a,initial as s}from\"../../../../core/reactiveUtils.js\";import{sqlAnd as l}from\"../../../../core/sql.js\";import{property as p}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/Logger.js\";import\"../../../../core/RandomLCG.js\";import{subclass as y}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{elevationContextAffectsAlignment as c}from\"../../../../support/elevationInfoUtils.js\";import{makeSnappingQuery as u}from\"../snappingUtils.js\";import{makeGetGroundElevation as g,convertSnappingCandidate as h}from\"./queryEngineUtils.js\";import{getSnappingCandidateElevationAligner as m}from\"./snappingCandidateElevationAlignment.js\";import{getSnappingCandidateElevationFilter as d}from\"./snappingCandidateElevationFilter.js\";import{getSymbologySnappingCandidatesFetcher as v}from\"./symbologySnappingCandidates.js\";let f=class extends t{get availability(){return 1}get _snappingElevationAligner(){const{view:e}=this,{layer:t}=this.layerSource,i=null!=e&&\"3d\"===e.type;if(!i||\"subtype-group\"===t.type)return m();const r=async(i,r)=>(await n(e.whenLayerView(t),r)).elevationAlignPointsInFeatures(i,r);return m(i,{elevationInfo:t.elevationInfo,alignPointsInFeatures:r})}get _snappingElevationFilter(){const{view:e}=this,t=null!=e&&\"3d\"===e.type&&\"subtype-group\"!==this.layerSource.layer.type;return d(t)}get _symbologySnappingFetcher(){const{view:e}=this,{layer:t}=this.layerSource;return null!=e&&\"3d\"===e.type&&\"subtype-group\"!==t.type?v(this._symbologySnappingSupported,async(i,n)=>{const o=await e.whenLayerView(t);return r(n),o.queryForSymbologySnapping({candidates:i,spatialReference:e.spatialReference},n)}):v()}get _layerView(){const{view:e}=this;if(null==e)return null;const{layer:t}=this.layerSource;return e.allLayerViews.find(e=>e.layer===t)}get _layerView3D(){const{view:e}=this;return null==e||\"2d\"===e.type?null:this._layerView}get _symbologySnappingSupported(){return null!=this._layerView3D&&this._layerView3D.symbologySnappingSupported}initialize(){const{view:e}=this,{layer:t}=this.layerSource;null!=e&&\"3d\"===e.type&&\"subtype-group\"!==t.type&&this.addHandles([e.elevationProvider.on(\"elevation-change\",({context:e})=>{const{elevationInfo:i}=t;c(e,i)&&this._snappingElevationAligner.notifyElevationSourceChange()}),o(()=>t.elevationInfo,()=>this._snappingElevationAligner.notifyElevationSourceChange(),s),o(()=>null!=this._layerView3D?this._layerView3D.layer?.renderer:null,()=>this._symbologySnappingFetcher.notifySymbologyChange(),s),a(()=>this._layerView3D?.layer,[\"edits\",\"apply-edits\"],()=>this._symbologySnappingFetcher.notifySymbologyChange())])}constructor(e){super(e),this.view=null,this.updating=!1,this._memoizedMakeGetGroundElevation=i(g)}refresh(){}async fetchCandidates(e,t){const{layer:i}=this.layerSource,{source:n}=i;if(!n?.querySnapping)return[];const o=i.createQuery();this._layerView&&\"effectiveDisplayFilter\"in this._layerView&&(o.where=l(o.where,this._layerView.effectiveDisplayFilter?.where));const a=\"returnZ\"in i?i.returnZ:void 0,s=u({parameters:e,mode:this.view?.type??\"2d\",returnZ:a,filter:o}),p=await n.querySnapping(s,{signal:t});r(t);const y=e.coordinateHelper.spatialReference,c=await this._snappingElevationAligner.alignCandidates(p.candidates,y,t);r(t);const g=await this._symbologySnappingFetcher.fetch(c,t);r(t);const m=0===g.length?c:[...c,...g],d=this._snappingElevationFilter.filter(s,m),v=this._memoizedMakeGetGroundElevation(this.view,y);return d.map(e=>h(e,v))}};e([p({constructOnly:!0})],f.prototype,\"layerSource\",void 0),e([p({constructOnly:!0})],f.prototype,\"view\",void 0),e([p()],f.prototype,\"_snappingElevationAligner\",null),e([p()],f.prototype,\"_snappingElevationFilter\",null),e([p()],f.prototype,\"_symbologySnappingFetcher\",null),e([p()],f.prototype,\"_layerView\",null),e([p()],f.prototype,\"_layerView3D\",null),e([p()],f.prototype,\"_symbologySnappingSupported\",null),f=e([y(\"esri.views.interactive.snapping.featureSources.FeatureCollectionSnappingSource\")],f);export{f as FeatureCollectionSnappingSource};\n"],
  "mappings": "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",
  "names": ["t", "i", "r", "n", "o", "e", "a", "l", "s", "h", "p", "m"]
}
