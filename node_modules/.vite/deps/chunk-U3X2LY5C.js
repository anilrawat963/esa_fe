import {
  p
} from "./chunk-JRCD3NNE.js";
import {
  i
} from "./chunk-NPYFNHY2.js";
import {
  x
} from "./chunk-JW6DU3OK.js";
import {
  n
} from "./chunk-QF7FRVN6.js";
import {
  Tt,
  V,
  Y,
  Z,
  f,
  g,
  it,
  m,
  v,
  y
} from "./chunk-V2H77UEV.js";
import {
  j,
  r3 as r
} from "./chunk-5EI5H4QX.js";
import {
  o
} from "./chunk-ZIE53VIV.js";
import {
  s2 as s
} from "./chunk-QY7XKUIV.js";

// node_modules/@arcgis/core/core/accessorSupport/decorators/persistable.js
function j2(r2) {
  const t = r2?.origins ?? [void 0];
  return (e, o2) => {
    const s2 = v2(r2, e, o2);
    for (const r3 of t) {
      const t2 = j(e, r3, o2);
      for (const r4 in s2) t2[r4] = s2[r4];
    }
  };
}
function v2(r2, t, e) {
  if ("resource" === r2?.type) return U(r2, t, e);
  switch (r2?.type ?? "other") {
    case "other":
      return { read: true, write: true };
    case "url": {
      const { read: r3, write: t2 } = y;
      return { read: r3, write: t2 };
    }
  }
}
function U(r2, t, n2) {
  const i2 = o(t, n2);
  return { type: String, read: (r3, t2, e) => {
    const o2 = f(r3, t2, e);
    return i2.type === String ? o2 : "function" == typeof i2.type ? new i2.type({ url: o2 }) : void 0;
  }, write: { isRequired: i2.json?.write?.isRequired, writer(t2, p2, c, u) {
    if (!u?.resources) return "string" == typeof t2 ? void (p2[c] = m(t2, u)) : void (p2[c] = t2.write({}, u));
    const l = S(t2), m2 = m(l, { ...u, verifyItemRelativeUrls: u?.verifyItemRelativeUrls ? { writtenUrls: u.verifyItemRelativeUrls.writtenUrls, rootPath: void 0 } : void 0 }, 1), y2 = i2.type !== String && (!i(this) || u?.origin && this.originIdOf(n2) > r(u.origin)), g2 = { object: this, propertyName: n2, value: t2, targetUrl: m2, dest: p2, targetPropertyName: c, context: u, params: r2 };
    u?.portalItem && m2 && !Y(m2) ? y2 && r2?.contentAddressed ? w(g2) : y2 ? I(g2) : P(g2) : u?.portalItem && (null == m2 || null != v(m2) || Z(m2) || y2) ? w(g2) : p2[c] = m2;
  } } };
}
function w(e) {
  const { targetUrl: o2, params: p2, value: u, context: a, dest: l, targetPropertyName: d } = e;
  if (!a.portalItem) return;
  const f2 = g(o2), y2 = N(u, o2, a);
  if (p2?.contentAddressed && "json" !== y2.type) return void a.messages?.push(new s("persistable:contentAddressingUnsupported", `Property "${d}" is trying to serializing a resource with content of type ${y2.type} with content addressing. Content addressing is only supported for json resources.`, { content: y2 }));
  const h = p2?.contentAddressed && "json" === y2.type ? x(y2.jsonString) : f2?.filename ?? n(), j3 = V(p2?.prefix ?? f2?.prefix, h), v3 = `${j3}.${p(y2)}`;
  if (p2?.contentAddressed && a.resources && "json" === y2.type) {
    const r2 = a.resources.toKeep.find(({ resource: r3 }) => r3.path === v3) ?? a.resources.toAdd.find(({ resource: r3 }) => r3.path === v3);
    if (r2) return void (l[d] = r2.resource.itemRelativeUrl);
  }
  const U2 = a.portalItem.resourceFromPath(v3);
  Z(o2) && a.resources && a.resources.pendingOperations.push(it(o2).then((r2) => {
    U2.path = `${j3}.${p({ type: "blob", blob: r2 })}`, l[d] = U2.itemRelativeUrl;
  }).catch(() => {
  }));
  const w2 = p2?.compress ?? false;
  a.resources && b({ ...e, resource: U2, content: y2, compress: w2, updates: a.resources.toAdd }), l[d] = U2.itemRelativeUrl;
}
function I(r2) {
  const { context: t, targetUrl: e, params: o2, value: s2, dest: n2, targetPropertyName: i2 } = r2;
  if (!t.portalItem) return;
  const c = t.portalItem.resourceFromPath(e), u = N(s2, e, t), a = p(u), l = Tt(c.path), d = o2?.compress ?? false;
  a === l ? (t.resources && b({ ...r2, resource: c, content: u, compress: d, updates: t.resources.toUpdate }), n2[i2] = e) : w(r2);
}
function P({ context: r2, targetUrl: t, dest: e, targetPropertyName: o2 }) {
  r2.portalItem && r2.resources && (r2.resources.toKeep.push({ resource: r2.portalItem.resourceFromPath(t), compress: false }), e[o2] = t);
}
function b({ object: r2, propertyName: t, updates: e, resource: o2, content: s2, compress: n2 }) {
  const i2 = (e2) => {
    x2(r2, t, e2);
  };
  e.push({ resource: o2, content: s2, compress: n2, finish: i2 });
}
function N(r2, t, e) {
  return "string" == typeof r2 ? { type: "url", url: t } : { type: "json", jsonString: JSON.stringify(r2.toJSON(e)) };
}
function S(r2) {
  return null == r2 ? null : "string" == typeof r2 ? r2 : r2.url;
}
function x2(r2, t, e) {
  "string" == typeof r2[t] ? r2[t] = e.url : r2[t].url = e.url;
}

export {
  j2 as j
};
//# sourceMappingURL=chunk-U3X2LY5C.js.map
