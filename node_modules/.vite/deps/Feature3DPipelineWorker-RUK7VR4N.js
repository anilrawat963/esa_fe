import {
  i as i2
} from "./chunk-KGQOTLJQ.js";
import {
  S
} from "./chunk-LBWWJ76V.js";
import {
  v
} from "./chunk-FHDNFE7V.js";
import {
  A as A2,
  D,
  ie,
  pt,
  ut
} from "./chunk-KDOWKZ3H.js";
import {
  i as i3,
  s as s8,
  u as u5
} from "./chunk-NH6F2I5R.js";
import "./chunk-6WSJV2UJ.js";
import "./chunk-2EBLSEHZ.js";
import "./chunk-EC56NYYL.js";
import {
  A2 as A3,
  P as P2,
  j as j3
} from "./chunk-3RNQTFH6.js";
import {
  e as e6,
  h as h4
} from "./chunk-VIIQX37N.js";
import "./chunk-BRGWF4BT.js";
import "./chunk-UR6CZJPX.js";
import "./chunk-JS3I6GIR.js";
import "./chunk-QTS3W27E.js";
import "./chunk-3RABUJDL.js";
import "./chunk-IFKJBQCK.js";
import "./chunk-V5R3CDPU.js";
import "./chunk-6GZZL5MR.js";
import "./chunk-HZVRMY4D.js";
import "./chunk-YTJAN3CY.js";
import {
  o as o5
} from "./chunk-T6CRNJ3D.js";
import "./chunk-Z4KE5G4E.js";
import "./chunk-KEMYAF6M.js";
import "./chunk-CYVJEU2B.js";
import "./chunk-7YJLACUB.js";
import "./chunk-HETHJJO6.js";
import "./chunk-KOVWXXQR.js";
import "./chunk-ECKVUXN3.js";
import "./chunk-CHC4AAHW.js";
import "./chunk-S2SKSSUG.js";
import "./chunk-FDSAQJ3R.js";
import "./chunk-KDGDF37U.js";
import "./chunk-I4DSU5MJ.js";
import "./chunk-66AADZ63.js";
import "./chunk-6HNBANDZ.js";
import "./chunk-MCWHCMX6.js";
import "./chunk-SESXYKK5.js";
import "./chunk-HAR63DI2.js";
import "./chunk-A3JORY5L.js";
import "./chunk-JNASI2YX.js";
import "./chunk-P355ISZZ.js";
import "./chunk-FCDWKXLA.js";
import "./chunk-AUP2E2QB.js";
import "./chunk-NDWECAKM.js";
import "./chunk-KTMKDXZP.js";
import "./chunk-F43BIMML.js";
import "./chunk-CT7HOWYG.js";
import "./chunk-CW4AXF3Q.js";
import "./chunk-BZBDEPRV.js";
import "./chunk-MXP2VO3L.js";
import "./chunk-OWSUTT7E.js";
import "./chunk-WNQORCSA.js";
import "./chunk-CIIRREHX.js";
import "./chunk-COMSADUT.js";
import "./chunk-66Y6I5GR.js";
import "./chunk-U5J3MCMX.js";
import "./chunk-D7KJNSAT.js";
import "./chunk-BZV32YR7.js";
import "./chunk-IT62DCG6.js";
import "./chunk-SZ5DGQ75.js";
import "./chunk-3PAAA3FK.js";
import "./chunk-EGPAQBOO.js";
import "./chunk-W6L6ZQPE.js";
import "./chunk-6GHQTYW5.js";
import "./chunk-WJ3E33GQ.js";
import "./chunk-YOYO2XMY.js";
import "./chunk-SZTZNZQW.js";
import "./chunk-AJG2ZYEA.js";
import "./chunk-CFXCM2NO.js";
import {
  n as n7
} from "./chunk-B3BLJNSM.js";
import "./chunk-ALKEERWI.js";
import "./chunk-F75XORHS.js";
import {
  t as t3
} from "./chunk-ME5HHRVQ.js";
import "./chunk-6KSMNSLR.js";
import "./chunk-JBTWCDRR.js";
import "./chunk-U6CJFTOF.js";
import {
  o as o4
} from "./chunk-7VJQTJLO.js";
import "./chunk-RS755KXS.js";
import "./chunk-TMUM75KQ.js";
import "./chunk-UOYGMZIS.js";
import "./chunk-RXH2WNPA.js";
import "./chunk-TWU3GKHX.js";
import "./chunk-BGIBV6LL.js";
import "./chunk-UQXJMFRI.js";
import "./chunk-DY7N5RAZ.js";
import "./chunk-WX3525ER.js";
import "./chunk-FHCV4NTV.js";
import "./chunk-2JMKFI2D.js";
import "./chunk-QYAMBIRP.js";
import "./chunk-NH6FXYCM.js";
import "./chunk-YE4E5JCT.js";
import "./chunk-SXZO7ULH.js";
import "./chunk-GVMCGYZ6.js";
import "./chunk-JHV6OBEB.js";
import "./chunk-QTRET3PG.js";
import "./chunk-FMOL5XMB.js";
import "./chunk-VNSHGTPN.js";
import "./chunk-OEBAFVQK.js";
import "./chunk-2AOVWXAQ.js";
import "./chunk-ALR6N4CF.js";
import "./chunk-4X4BOGIG.js";
import "./chunk-7QPS6ATI.js";
import {
  A,
  e as e5
} from "./chunk-YYXR3KOD.js";
import "./chunk-WHHIH5YU.js";
import {
  f as f3
} from "./chunk-MEDXVTKR.js";
import "./chunk-5LMH6D7V.js";
import "./chunk-BZLHV37L.js";
import "./chunk-V6V3WWJF.js";
import "./chunk-NDFIZYZY.js";
import "./chunk-TLTSPUO7.js";
import {
  c as c2
} from "./chunk-QNW4D2V2.js";
import "./chunk-XAI6T5FU.js";
import "./chunk-QNDHLVDC.js";
import "./chunk-ZT4KW2M5.js";
import {
  b as b4,
  h as h3
} from "./chunk-FHQNDU7E.js";
import {
  n as n5
} from "./chunk-IOJ4QFRL.js";
import "./chunk-EK7HOTRR.js";
import {
  W as W2
} from "./chunk-3VXANCFN.js";
import "./chunk-MBQEPUQX.js";
import "./chunk-ODQ5APZK.js";
import "./chunk-G5IXTUNN.js";
import "./chunk-ZNQKJRCD.js";
import "./chunk-BA6HYZ35.js";
import "./chunk-GCTH5LET.js";
import {
  b as b2,
  s as s7
} from "./chunk-Q7VRQYAO.js";
import "./chunk-SJB744AD.js";
import "./chunk-WM2VG5F2.js";
import "./chunk-IXFJYDA2.js";
import "./chunk-TTLSEJNG.js";
import "./chunk-U73R3I4U.js";
import {
  u as u3
} from "./chunk-VGXUPJSS.js";
import {
  a as a4,
  s as s6
} from "./chunk-ZVTEFYZX.js";
import "./chunk-LPUPM55U.js";
import "./chunk-DLM5SBNY.js";
import "./chunk-EKZRA6TO.js";
import "./chunk-M5SP6ZBM.js";
import "./chunk-FAA2FDN5.js";
import {
  Z
} from "./chunk-2HGIYEIL.js";
import "./chunk-XX3OKYJS.js";
import "./chunk-OTCNIJ2H.js";
import {
  n as n4
} from "./chunk-JGA5YJWL.js";
import {
  e as e4
} from "./chunk-GCI4MA3M.js";
import {
  a as a3,
  n as n3,
  s as s5,
  t
} from "./chunk-SJ2OBYX2.js";
import "./chunk-MDJNYPVI.js";
import "./chunk-Z6VKIQV2.js";
import "./chunk-4PXNA4MD.js";
import "./chunk-U55FA2EK.js";
import "./chunk-GBN36VHC.js";
import "./chunk-7HTU7ZUX.js";
import "./chunk-QNVJVDYZ.js";
import "./chunk-WDTGOP77.js";
import "./chunk-VYMBX5H5.js";
import {
  b as b3
} from "./chunk-647DAMHU.js";
import "./chunk-O6G3PPOK.js";
import "./chunk-ZKNZTIAS.js";
import "./chunk-OJMISN3F.js";
import "./chunk-EFV6H5NA.js";
import "./chunk-XDLV73DB.js";
import "./chunk-ARTU4L55.js";
import "./chunk-6VL5D5UP.js";
import "./chunk-6QHY54HZ.js";
import "./chunk-GXJJY3ND.js";
import "./chunk-5ONGWFJ3.js";
import "./chunk-PLNHHGHL.js";
import "./chunk-DFK6QMLO.js";
import {
  s as s3
} from "./chunk-4WTOIJXV.js";
import "./chunk-EM7Y2JZC.js";
import "./chunk-QZQPB5XR.js";
import "./chunk-AQFRVV3U.js";
import "./chunk-63LDVRFI.js";
import "./chunk-C3FRY5U4.js";
import "./chunk-JNJX34GB.js";
import "./chunk-3STJRSDT.js";
import "./chunk-67Q6KVC6.js";
import {
  b as b5,
  d3,
  j as j2,
  n2 as n6,
  p as p2
} from "./chunk-23NJHA5Q.js";
import {
  c as c3,
  t as t2
} from "./chunk-4LA6K4VI.js";
import "./chunk-KEZCWFAR.js";
import "./chunk-JZUJ34RR.js";
import "./chunk-PMGS7UDU.js";
import "./chunk-3GHCGAH2.js";
import {
  a as a2,
  p,
  u as u2
} from "./chunk-HWUOAPTX.js";
import "./chunk-QHCKOBU7.js";
import {
  e as e3
} from "./chunk-K2OZ6WVC.js";
import "./chunk-MC6NAKKX.js";
import "./chunk-TF6255HN.js";
import "./chunk-GD4FJL3C.js";
import "./chunk-C5OQVQZF.js";
import "./chunk-F7DKSAOI.js";
import "./chunk-4SOQWNPG.js";
import "./chunk-LTULADK2.js";
import "./chunk-35ST7YRB.js";
import "./chunk-EDA5QFHZ.js";
import "./chunk-CNYNCKEV.js";
import {
  d
} from "./chunk-XL5QPCXN.js";
import {
  N as N2,
  W
} from "./chunk-2LC2762W.js";
import "./chunk-W6HOAVT4.js";
import {
  o as o3
} from "./chunk-DTZUXJMD.js";
import "./chunk-YLAGKT2D.js";
import "./chunk-6YRQYUCY.js";
import "./chunk-C5M24ACM.js";
import "./chunk-L4A2QJG4.js";
import "./chunk-ENINOZUZ.js";
import "./chunk-P6IKJIMO.js";
import "./chunk-MHV23XAQ.js";
import "./chunk-V2X4OKYI.js";
import "./chunk-LPZUGJNG.js";
import {
  f as f2,
  h as h2,
  n as n2,
  o as o2,
  s as s4
} from "./chunk-XLOINTMG.js";
import "./chunk-MA3QDRC3.js";
import "./chunk-W6J7XCPU.js";
import "./chunk-ONXWBTTM.js";
import "./chunk-T7F6Q6JJ.js";
import "./chunk-YDTPM7OQ.js";
import {
  _,
  n,
  u
} from "./chunk-75XOUSSS.js";
import "./chunk-TH4EQWJJ.js";
import "./chunk-7P2ANHQ3.js";
import "./chunk-XCKT47LJ.js";
import "./chunk-3FUHCAX3.js";
import "./chunk-PZ5RULLK.js";
import "./chunk-OPJX4KXH.js";
import "./chunk-LTPHDYPK.js";
import "./chunk-3OVERDFX.js";
import {
  c,
  d as d2,
  g,
  o
} from "./chunk-FPMLKIDB.js";
import "./chunk-AZXJIEZ6.js";
import "./chunk-Q75WYS7K.js";
import {
  z
} from "./chunk-H74Q4SYB.js";
import {
  h,
  j,
  l as l2
} from "./chunk-2OFHDVO5.js";
import {
  i,
  l
} from "./chunk-TFJXG32O.js";
import "./chunk-DDOCCRD4.js";
import "./chunk-5UPBUJPC.js";
import "./chunk-THQO67BJ.js";
import "./chunk-4YDOPHTZ.js";
import "./chunk-YY5PITIH.js";
import {
  u as u4
} from "./chunk-CCQFL76O.js";
import "./chunk-CSMCPN64.js";
import "./chunk-GY6YF4EN.js";
import "./chunk-7H3U4IJR.js";
import "./chunk-SMWUT52Z.js";
import "./chunk-AXZMNHTN.js";
import {
  f
} from "./chunk-5T3MJDSR.js";
import "./chunk-NMQNUPE4.js";
import "./chunk-6KIXN4DJ.js";
import "./chunk-7DGJB37R.js";
import "./chunk-234CIOHE.js";
import "./chunk-V2H77UEV.js";
import "./chunk-WRA2WBYC.js";
import "./chunk-XWE6BM2U.js";
import "./chunk-SOIZOFSB.js";
import "./chunk-XXLHAM2M.js";
import {
  b,
  e4 as e2,
  m as m2
} from "./chunk-5EI5H4QX.js";
import {
  a2 as a
} from "./chunk-ZIE53VIV.js";
import {
  __addDisposableResource,
  __decorate,
  __disposeResources
} from "./chunk-SS5CLIUY.js";
import {
  P
} from "./chunk-R54Q5TGA.js";
import "./chunk-6SSZNBOK.js";
import "./chunk-LZ2XTYP2.js";
import "./chunk-45CFSCQX.js";
import "./chunk-A5XN2VFT.js";
import "./chunk-65HD3WXL.js";
import "./chunk-4DGC7CBY.js";
import {
  $,
  e,
  m,
  m2 as m3,
  s as s2
} from "./chunk-GNMPGHLQ.js";
import {
  s2 as s
} from "./chunk-QY7XKUIV.js";
import {
  N,
  has
} from "./chunk-AL6YUTZM.js";
import "./chunk-G26ADAPQ.js";

// node_modules/@arcgis/core/views/3d/layers/graphics/pipeline/PipelineCommand.js
var e7 = class _e {
  constructor(e12, n13, t5) {
    this.renderCommandContext = e12, this.renderCommandBuffer = n13, this.pipelineStateCommands = t5;
  }
  append(e12) {
    this.appendRenderCommands(e12.renderCommandBuffer), this.appendPipelineStateCommands(e12.pipelineStateCommands);
  }
  appendRenderCommands(e12) {
    this.renderCommandBuffer.commands.push(...e12.commands), this.renderCommandBuffer.transferList.push(...e12.transferList);
  }
  appendPipelineStateCommand(e12) {
    this.pipelineStateCommands.push(e12);
  }
  appendPipelineStateCommands(e12) {
    for (const n13 of e12) this.appendPipelineStateCommand(n13);
  }
  async execute() {
    for (const e12 of this.pipelineStateCommands) e12();
    await this.renderCommandContext.dispatchRenderCommands(this.renderCommandBuffer);
  }
  static create(n13, t5 = []) {
    return new _e(n13, n13.createRenderCommandBuffer(), t5);
  }
};
function n8(e12) {
  if (0 === e12.length) return null;
  return e12.reduce((e13, n13) => (e13.append(n13), e13));
}

// node_modules/@arcgis/core/views/3d/layers/graphics/pipeline/symbolization/factoryUtils.js
function t4() {
  return new b5({ material: new p2({ color: new u4("red") }) });
}
function n9() {
  return new n6();
}

// node_modules/@arcgis/core/views/3d/layers/graphics/pipeline/featureData/processingUtils.js
function n10(r4) {
  const { featureCount: e12 } = r4;
  if (0 === e12) return new Uint32Array();
  const t5 = new Uint32Array(e12);
  return r4.getObjectIdsArray(t5), t5;
}
function a5(r4) {
  const { featureCount: e12 } = r4;
  if (0 === e12) return new Float64Array();
  const t5 = new Float64Array(3 * e12);
  return r4.getCoordinatesArray(t5), t5;
}
function c4(r4, t5) {
  const o7 = r4.length / 3, n13 = t5.viewSpatialReference, a10 = t5.renderSpatialReference, i5 = new Float64Array(3 * o7);
  if (!o3(r4, n13, 0, i5, a10, 0, o7)) throw new Error("Failed to project coordinates");
  return i5;
}
function f4(e12, n13) {
  const a10 = n13.viewSpatialReference, i5 = n13.renderSpatialReference, { extent: c8 } = e12, f8 = g(c8), u9 = n();
  return n7([f8[0], f8[1], 0], a10, u9, i5), u9;
}

// node_modules/@arcgis/core/views/3d/layers/graphics/pipeline/symbolization/symbolizationUtils.js
function e8(e12) {
  const n13 = /* @__PURE__ */ new Map();
  for (const [t5, r4] of e12) n13.set(t5, { ...r4, indices: e5(r4.indices) });
  return n13;
}

// node_modules/@arcgis/core/views/3d/layers/graphics/pipeline/symbolization/IconSymbolLayerRenderer.js
var h5 = class {
  constructor(e12, t5) {
    this._context = null, this._symbolLayer = null, this._draped = false, this._loaded = false, this._loadingPromise = null, this._iconTextureID = null, this._materialId = null, this._context = t5, this._symbolLayer = e12;
  }
  get loaded() {
    return this._loaded;
  }
  load() {
    return null == this._loadingPromise && (this._loadingPromise = this._load()), this._loadingPromise;
  }
  _destroy() {
    this._iconTextureID = null;
  }
  async _load() {
    const e12 = this._context.renderCommandContext, t5 = await e12.createTexture(() => i3("circle"));
    this._iconTextureID = t5;
    const r4 = { anchorPosition: i2.center, occlusionTest: true, hasSlicePlane: false, color: this._getFillColor(), outlineColor: this._getOutlineColor(), outlineSize: 1, distanceFieldBoundingBox: u5, textureId: t5, textureIsSignedDistanceField: true, sampleSignedDistanceFieldTexelCenter: s8("circle") }, i5 = new Uint8Array(8), n13 = 0, o7 = 255;
    i5[0] = n13, i5[1] = n13, i5[2] = n13, i5[3] = o7, i5[4] = o7, i5[5] = n13, i5[6] = o7, i5[7] = o7, this._materialId = await e12.createMaterial({ type: "hud", parameters: r4 }), await e12.createDirectRenderer(this._materialId), await e12.setBaseInstance(this._materialId, { data: i5.buffer, elementCount: 4 }), this._loaded = true;
  }
  async createAddCommand(e12) {
    const { _materialId: t5, _context: r4 } = this, { renderCommandContext: i5 } = r4;
    if (null == t5) throw new Error("expected material not to be null");
    const n13 = await this._createGeometry(e12);
    if (null == n13) return r4.createPipelineCommand();
    const o7 = f4(e12, r4), a10 = true;
    return r4.createPipelineCommand(i5.addDirectRendererGeometry(e12.id, n13, o7, a10));
  }
  async _createGeometry(e12) {
    const { _materialId: r4, _context: i5 } = this, { mainThreadDelegate: n13 } = i5, { featureCount: o7 } = e12;
    if (0 === o7 || null == r4) return null;
    const a10 = n10(e12), l6 = a5(e12), s13 = await n13.applyElevationAlignmentTo(l6), y = c4(s13, i5), p4 = new Float64Array([0, 0, 1]), _3 = new Float64Array([255, 255, 255, 255]), h8 = new Float64Array([24, 24]), f8 = new Float64Array([0, 0, 0, 1]), g6 = new Float64Array([0]), x2 = new Uint32Array(o7);
    for (let t5 = 0; t5 < o7; ++t5) x2[t5] = t5;
    const w4 = new Uint32Array(o7);
    for (let t5 = 0; t5 < o7; ++t5) w4[t5] = 0;
    const b6 = [["position", new t3(y, x2, 3, true)], ["normal", new t3(p4, w4, 3, true)], ["color", new t3(_3, w4, 4, true)], ["rotation", new t3(g6, w4, 1, true)], ["size", new t3(h8, w4, 2, true)], ["centerOffsetAndDistance", new t3(f8, w4, 4, true)]], I = new Uint8Array(o7);
    e12.getVisibilityArray(I);
    return { attributes: e8(b6), olidColor: void 0, transformation: e3(), materialId: r4, objectIds: a10, visibilities: I };
  }
  async createRemoveCommand(e12) {
    const { _materialId: t5, _context: r4 } = this, i5 = r4.renderCommandContext;
    return null == t5 ? r4.createPipelineCommand() : r4.createPipelineCommand(i5.removeDirectRendererGeometryBuffer(t5, e12));
  }
  async createUpdateVisibilityCommand(e12) {
    const { _materialId: t5, _context: r4 } = this, i5 = r4.renderCommandContext;
    if (null == t5) return r4.createPipelineCommand();
    const n13 = new Uint8Array(e12.featureCount);
    return e12.getVisibilityArray(n13), r4.createPipelineCommand(i5.updateVisibility(t5, e12.id, n13));
  }
  async createUpdateLayerViewOpacityCommand(e12) {
    const { _context: t5, _materialId: r4 } = this, i5 = t5.renderCommandContext;
    return null == r4 ? t5.createPipelineCommand() : t5.createPipelineCommand(i5.updateMaterial({ type: "hud", materialId: r4, parameters: { color: this._getFillColor(), outlineColor: this._getOutlineColor() } }));
  }
  async createUpdateElevationCommand(e12) {
    const { _materialId: t5, _context: r4 } = this, { renderCommandContext: i5 } = r4, { featureCount: n13, id: o7 } = e12;
    if (null == t5 || 0 === n13) return r4.createPipelineCommand();
    const a10 = await this._createGeometry(e12);
    if (null == a10) return r4.createPipelineCommand();
    const l6 = f4(e12, r4), m7 = true;
    return r4.createPipelineCommand(i5.updateDirectRendererGeometry(o7, a10, l6, m7));
  }
  async createDestroyCommand() {
    const { _iconTextureID: e12, _context: t5 } = this, r4 = t5.renderCommandContext;
    let i5;
    return i5 = null != e12 ? await r4.releaseTexture(e12) : e7.create(r4), i5.appendPipelineStateCommand(() => this._destroy()), i5;
  }
  _getOutlineColor() {
    const t5 = this._getLayerOpacity(), r4 = this._symbolLayer, i5 = r4?.outline?.color;
    if (null != i5) {
      const r5 = u4.toUnitRGB(i5), n13 = i5.a * t5;
      return [r5[0], r5[1], r5[2], n13];
    }
    return [0, 0, 0, 0];
  }
  _getFillColor() {
    if (f5(this._getPrimitive())) return w;
    const e12 = null == this._getPrimitive(), t5 = this._symbolLayer?.material?.color;
    return this._getCombinedOpacityAndColor(t5, { hasIntrinsicColor: e12 });
  }
  _getLayerOpacity() {
    return this._context.layerViewInfo.fullOpacity;
  }
  _getCombinedOpacity(e12, t5 = x) {
    const r4 = this._draped ? 1 : this._getLayerOpacity();
    return e12 ? r4 * e12.a : t5.hasIntrinsicColor ? r4 : 0;
  }
  _getCombinedOpacityAndColor(t5, i5 = x) {
    const n13 = this._getCombinedOpacity(t5, i5), a10 = null != t5 ? u4.toUnitRGB(t5) : _;
    return A2(a10, n13);
  }
  _getPrimitive() {
    return g2(this._symbolLayer);
  }
};
function f5(e12) {
  return null != e12 && ("cross" === e12 || "x" === e12);
}
function g2(e12) {
  return e12.resource?.href ? null : e12.resource?.primitive ?? j2;
}
var x = { hasIntrinsicColor: false };
var w = a4;

// node_modules/@arcgis/core/views/3d/layers/graphics/pipeline/symbolization/Point3DSymbolRenderer.js
var e9 = class {
  constructor(e12, o7) {
    this._loaded = false, this._loadingPromise = null, this._context = null, this._symbol = null, this._symbolLayerRenderers = [], this._context = o7, this._symbol = e12;
  }
  _destroy() {
  }
  get loaded() {
    return this._loaded;
  }
  load() {
    return null == this._loadingPromise && (this._loadingPromise = this._load()), this._loadingPromise;
  }
  async _load() {
    const { _context: e12, _symbol: o7, _symbolLayerRenderers: t5 } = this, s13 = [];
    for (const a10 of o7.symbolLayers) {
      const o8 = e12.symbolRendererFactory.createSymbolRendererFromSymbolLayer(a10);
      null != o8 && (s13.push(o8.load()), t5.push(o8));
    }
    await Promise.all(s13), this._loaded = true;
  }
  async createDestroyCommand() {
    const { _context: e12, _symbolLayerRenderers: o7 } = this, t5 = [];
    for (const a10 of o7) t5.push(a10.createDestroyCommand());
    const s13 = e12.joinPipelineCommands(await Promise.all(t5));
    return s13.appendPipelineStateCommand(() => this._destroy()), s13;
  }
  async createAddCommand(e12) {
    const { _context: o7, _symbolLayerRenderers: t5 } = this, s13 = [];
    for (const a10 of t5) s13.push(a10.createAddCommand(e12));
    return o7.joinPipelineCommands(await Promise.all(s13));
  }
  async createRemoveCommand(e12) {
    const { _context: o7, _symbolLayerRenderers: t5 } = this, s13 = [];
    for (const a10 of t5) s13.push(a10.createRemoveCommand(e12));
    return o7.joinPipelineCommands(await Promise.all(s13));
  }
  async createUpdateVisibilityCommand(e12) {
    const { _context: o7, _symbolLayerRenderers: t5 } = this, s13 = [];
    for (const a10 of t5) s13.push(a10.createUpdateVisibilityCommand(e12));
    return o7.joinPipelineCommands(await Promise.all(s13));
  }
  async createUpdateLayerViewOpacityCommand(e12) {
    const { _context: o7, _symbolLayerRenderers: t5 } = this, s13 = [];
    for (const a10 of t5) s13.push(a10.createUpdateLayerViewOpacityCommand(e12));
    return o7.joinPipelineCommands(await Promise.all(s13));
  }
  async createUpdateElevationCommand(e12) {
    const { _context: o7, _symbolLayerRenderers: t5 } = this, s13 = [];
    for (const a10 of t5) s13.push(a10.createUpdateElevationCommand(e12));
    return o7.joinPipelineCommands(await Promise.all(s13));
  }
};

// node_modules/@arcgis/core/views/3d/layers/graphics/pipeline/symbolization/SimpleFeatureRenderer.js
var e10 = class {
  constructor(e12, t5) {
    this._symbol = null, this._featureData = /* @__PURE__ */ new Map(), this._loaded = false, this._loadingPromise = null, this._renderer = null, this._context = t5, this._renderer = e12;
  }
  async load() {
    return null == this._loadingPromise && (this._loadingPromise = this._load()), this._loadingPromise;
  }
  async _load() {
    const { _renderer: e12, _context: t5 } = this;
    this._symbol = t5.symbolRendererFactory.createSymbolRendererFromSymbol(e12.symbol), this._loaded = true;
  }
  get loaded() {
    return this._loaded;
  }
  async createAddCommand(e12) {
    const t5 = this._context, a10 = await this._provisionSymbol(), n13 = null == a10 ? t5.createPipelineCommand() : await a10.createAddCommand(e12);
    return n13.appendPipelineStateCommand(() => this._featureData.set(e12.id, e12)), n13;
  }
  async createRemoveCommand(e12) {
    const t5 = this._context, a10 = await this._provisionSymbol(), n13 = null == a10 ? t5.createPipelineCommand() : await a10.createRemoveCommand(e12);
    return n13.appendPipelineStateCommand(() => this._featureData.delete(e12)), n13;
  }
  async createUpdateVisibilityCommand(e12) {
    const t5 = this._context, a10 = await this._provisionSymbol();
    return null == a10 ? t5.createPipelineCommand() : await a10.createUpdateVisibilityCommand(e12);
  }
  async createUpdateLayerViewOpacityCommand(e12) {
    const t5 = this._context, a10 = await this._provisionSymbol();
    return null == a10 ? t5.createPipelineCommand() : await a10.createUpdateLayerViewOpacityCommand(e12);
  }
  async createUpdateElevationCommand() {
    const { _featureData: e12, _context: t5 } = this, a10 = await this._provisionSymbol();
    if (null == a10) return t5.createPipelineCommand();
    const n13 = [];
    for (const i5 of e12.values()) n13.push(a10.createUpdateElevationCommand(i5));
    const o7 = await Promise.all(n13);
    return t5.joinPipelineCommands(o7);
  }
  async createDestroyCommand() {
    const { _symbol: e12, _context: t5, _featureData: a10 } = this;
    if (!e12) return t5.createPipelineCommand();
    const n13 = [];
    for (const i5 of a10.keys()) n13.push(this.createRemoveCommand(i5));
    n13.push(e12.createDestroyCommand());
    const o7 = await Promise.all(n13);
    return t5.joinPipelineCommands(o7);
  }
  async _provisionSymbol() {
    const e12 = this._symbol;
    return e12 ? (e12.loaded || await e12.load(), e12) : null;
  }
};

// node_modules/@arcgis/core/views/3d/layers/graphics/pipeline/symbolization/primitiveObjectUtils.js
function a6(t5, a10) {
  const o7 = (t6, n13, i5 = false) => ({ levels: t6.map((t7) => {
    const o8 = e8(n13(t7.tesselation));
    i5 && s9(o8);
    return { components: [{ attributes: o8, olidColor: void 0, transformation: null, materialId: a10, visibilities: new Uint8Array([1]), objectIds: new Uint32Array([-1]) }], minScreenSpaceRadius: t7.minScreenSpaceRadius };
  }) });
  switch (t5) {
    case "cone":
      return o7(r, (e12) => pt(1, 0.5, e12, false), true);
    case "sphere":
      return o7([{ tesselation: 0, minScreenSpaceRadius: 0 }, { tesselation: 1, minScreenSpaceRadius: 8 }, { tesselation: 2, minScreenSpaceRadius: 16 }, { tesselation: 3, minScreenSpaceRadius: 50 }, { tesselation: 4, minScreenSpaceRadius: 250 }], (e12) => ut(0.5, e12, true));
    case "cube":
    case "inverted-cone":
    case "cylinder":
    case "tetrahedron":
    case "diamond":
      throw new Error("not implemented");
    default:
      return;
  }
}
function s9(e12) {
  const t5 = e12, n13 = t5.get("position").data, i5 = t5.get("normal").data;
  if (i5) {
    const t6 = o6(e12, "normal").data;
    for (let e13 = 0; e13 < i5.length; e13 += 3) {
      const n14 = i5[e13 + 1];
      t6[e13 + 1] = -i5[e13 + 2], t6[e13 + 2] = n14;
    }
  }
  if (n13) {
    const t6 = o6(e12, "position").data;
    for (let e13 = 0; e13 < n13.length; e13 += 3) {
      const i6 = n13[e13 + 1];
      t6[e13 + 1] = -n13[e13 + 2], t6[e13 + 2] = i6;
    }
  }
}
function o6(e12, n13) {
  let i5 = e12.get(n13);
  return i5 && !i5.exclusive && (i5 = { ...i5, exclusive: true, data: e6(i5.data) }, e12.set(n13, i5)), i5;
}
var r = [{ tesselation: 6, minScreenSpaceRadius: 0 }, { tesselation: 18, minScreenSpaceRadius: 7 }, { tesselation: 64, minScreenSpaceRadius: 65 }];

// node_modules/@arcgis/core/views/3d/layers/graphics/pipeline/symbolization/ObjectSymbolLayerRenderer.js
var v2 = class {
  constructor(e12, t5) {
    this._loaded = false, this._loadingPromise = null, this._primitiveMaterialId = null, this._lodRendererId = null, this._context = null, this._symbolLayer = null, this._primitive = null, this._context = t5, this._symbolLayer = e12;
  }
  _destroy() {
    this._lodRendererId = null, this._primitiveMaterialId = null;
  }
  get loaded() {
    return this._loaded;
  }
  get _isPrimitive() {
    return null != this._primitive;
  }
  load() {
    return null == this._loadingPromise && (this._loadingPromise = this._load()), this._loadingPromise;
  }
  async _load() {
    const e12 = this._context.renderCommandContext, t5 = { physicalBasedRenderingEnabled: true, slicePlaneEnabled: false, castShadows: true }, r4 = this._getLayerOpacity();
    let a10 = { usePBR: t5.physicalBasedRenderingEnabled, isSchematic: true, mrrFactors: o5, ambient: _, diffuse: _, hasSlicePlane: t5.slicePlaneEnabled, castShadows: t5.castShadows, layerOpacity: r4, offsetTransparentBackfaces: false, screenSizePerspective: {} };
    if (a10.externalColor = s6, a10.instanced = true, this._isPrimitive) {
      const e13 = new j3();
      e13.layerOpacity = r4, a10 = { ...a10, cullFace: w2(A3(e13)) };
    }
    const n13 = await e12.createMaterial({ type: "default", parameters: a10 }), s13 = this._symbolLayer.resource;
    this._primitive = s13 && S(s13?.primitive) ? s13.primitive : d3;
    const l6 = a6(this._primitive, n13);
    this._lodRendererId = await e12.createLodRenderer(l6), this._primitiveMaterialId = n13, this._loaded = true;
  }
  async createDestroyCommand() {
    const { _lodRendererId: e12, _primitiveMaterialId: t5, _context: r4 } = this, i5 = r4.renderCommandContext, a10 = [];
    return null != e12 && a10.push(i5.destroyLodRenderer(e12)), null != t5 && a10.push(i5.destroyMaterial(t5)), new e7(i5, i5.mergeRenderCommandBuffers(a10), [() => this._destroy()]);
  }
  async createAddCommand(e12) {
    const t5 = this._context, { renderCommandContext: r4, mainThreadDelegate: i5 } = t5;
    if (null == this._lodRendererId) throw new Error("expected lod renderer id to not be null");
    const { featureCount: n13 } = e12;
    if (0 === n13) return t5.createPipelineCommand();
    const o7 = this._isPrimitive, s13 = this._primitive || d3, u9 = u2(c3(s13)), h8 = u(p(u9)), y = u(t2(h8, { isPrimitive: o7, width: 100, depth: null, height: null })), C2 = new Float64Array(16 * n13), b6 = new Float64Array(16 * n13), g6 = a5(e12), x2 = await i5.applyElevationAlignmentTo(g6);
    for (let a10 = 0; a10 < n13; ++a10) {
      const e13 = a10, t6 = x2[3 * a10 + 0], r5 = x2[3 * a10 + 1], i6 = x2[3 * a10 + 2], n14 = this._computeGlobalTransform(t6, r5, i6, this._context.viewSpatialReference, j4), o8 = this._computeLocalTransform(y, h8, T);
      this._writeMatrixToTypedBuffer(C2, e13, o8), this._writeMatrixToTypedBuffer(b6, e13, n14);
    }
    const v4 = n10(e12), w4 = new Uint8Array(n13);
    e12.getVisibilityArray(w4);
    const P4 = { featureIds: new Uint32Array(v4), visibility: w4, localTransforms: C2, globalTransforms: b6 };
    return t5.createPipelineCommand(r4.addLodInstances(this._lodRendererId, e12.id, P4));
  }
  async createRemoveCommand(e12) {
    const { _context: t5, _lodRendererId: r4 } = this, i5 = t5.renderCommandContext;
    return null == r4 ? t5.createPipelineCommand() : t5.createPipelineCommand(i5.removeLodInstances(r4, e12));
  }
  async createUpdateVisibilityCommand(e12) {
    const { _lodRendererId: t5, _context: r4 } = this, i5 = r4.renderCommandContext;
    if (null == t5) return r4.createPipelineCommand();
    const a10 = new Uint8Array(e12.featureCount);
    return e12.getVisibilityArray(a10), r4.createPipelineCommand(i5.updateVisibility(t5, e12.id, a10));
  }
  async createUpdateLayerViewOpacityCommand(e12) {
    const { _context: t5 } = this, r4 = t5.renderCommandContext, i5 = this._primitiveMaterialId;
    if (null == i5) return t5.createPipelineCommand();
    const a10 = this._getLayerOpacity();
    let n13 = { layerOpacity: a10 };
    if (this._isPrimitive) {
      const e13 = new j3();
      e13.layerOpacity = a10, n13 = { ...n13, cullFace: w2(A3(e13)) };
    }
    return t5.createPipelineCommand(r4.updateMaterial({ type: "default", materialId: i5, parameters: n13 }));
  }
  async createUpdateElevationCommand(e12) {
    const { _context: t5, _lodRendererId: r4 } = this, { renderCommandContext: i5, mainThreadDelegate: a10 } = t5, { featureCount: n13, id: o7 } = e12;
    if (null == r4 || 0 === n13) return t5.createPipelineCommand();
    const s13 = new Float64Array(16 * n13), l6 = a5(e12), m7 = await a10.applyElevationAlignmentTo(l6);
    for (let d5 = 0; d5 < n13; ++d5) {
      const e13 = d5, t6 = m7[3 * d5 + 0], r5 = m7[3 * d5 + 1], i6 = m7[3 * d5 + 2], a11 = this._computeGlobalTransform(t6, r5, i6, this._context.viewSpatialReference, j4);
      this._writeMatrixToTypedBuffer(s13, e13, a11);
    }
    return t5.createPipelineCommand(i5.updateLodInstancesData(r4, o7, s13));
  }
  _writeMatrixToTypedBuffer(e12, t5, r4) {
    let i5 = 16 * t5;
    for (let a10 = 0; a10 < 16; a10++) e12[i5++] = r4[a10];
  }
  _computeGlobalTransform(e12, t5, r4, i5, a10) {
    return P3[0] = e12, P3[1] = t5, P3[2] = r4, f3(i5, P3, a10, this._context.renderSpatialReference), a10;
  }
  _computeLocalTransform(t5, r4, i5) {
    return o2(i5), this._applyObjectScale(t5, r4, i5), i5;
  }
  _applyObjectScale(e12, r4, i5) {
    const a10 = D(e12, e12, r4, this._context.renderCoordsHelper.unitInMeters);
    1 === a10[0] && 1 === a10[1] && 1 === a10[2] || f2(i5, i5, a10);
  }
  _getLayerOpacity() {
    return this._context.layerViewInfo.fullOpacity;
  }
};
function w2(e12) {
  return e12 ? 0 : 2;
}
var P3 = n();
var T = e3();
var j4 = e3();

// node_modules/@arcgis/core/views/3d/layers/graphics/pipeline/symbolization/UniqueValueFeatureRenderer.js
var s10 = class {
  constructor(t5, e12) {
    this._symbols = new Array(), this._featureDataPartitioning = /* @__PURE__ */ new Map(), this._loaded = false, this._loadingPromise = null, this._renderer = null, this._context = e12, this._renderer = t5;
  }
  async load() {
    return null == this._loadingPromise && (this._loadingPromise = this._load()), this._loadingPromise;
  }
  async _load() {
    this._symbols[0] = new h5(t4(), this._context), this._symbols[1] = new v2(n9(), this._context), this._loaded = true;
  }
  get loaded() {
    return this._loaded;
  }
  async createAddCommand(t5) {
    const e12 = this._context, n13 = this._partition(t5), a10 = await Promise.all(n13.map(async ({ index: t6, features: e13 }) => {
      const n14 = await this._provisionSymbol(t6);
      return await n14?.createAddCommand(e13);
    })), o7 = e12.joinPipelineCommands(a10);
    return o7.appendPipelineStateCommand(() => this._featureDataPartitioning.set(t5.id, n13)), o7;
  }
  async createRemoveCommand(e12) {
    const { _featureDataPartitioning: n13, _context: a10 } = this, o7 = a10.renderCommandContext, i5 = n13.get(e12);
    if (null == i5) return new e7(o7, o7.createRenderCommandBuffer(), []);
    const s13 = await Promise.all(i5.map(async ({ index: t5, features: e13 }) => {
      const n14 = this._getLoadedSymbol(t5);
      return await n14?.createRemoveCommand(e13.id);
    })), r4 = a10.joinPipelineCommands(s13);
    return r4.appendPipelineStateCommand(() => n13.delete(e12)), r4;
  }
  async createUpdateVisibilityCommand(e12) {
    const { _featureDataPartitioning: n13, _context: a10 } = this, o7 = a10.renderCommandContext, i5 = n13.get(e12.id);
    if (null == i5) return new e7(o7, o7.createRenderCommandBuffer(), []);
    const s13 = await Promise.all(i5.map(async ({ index: t5, features: e13 }) => {
      const n14 = this._getLoadedSymbol(t5);
      return await n14?.createUpdateVisibilityCommand(e13);
    }));
    return a10.joinPipelineCommands(s13);
  }
  async createUpdateLayerViewOpacityCommand(t5) {
    const e12 = this._context, n13 = [];
    for (let o7 = 0; o7 < this._symbols.length; ++o7) {
      const e13 = this._symbols[o7];
      null != e13 && e13.loaded && n13.push(e13.createUpdateLayerViewOpacityCommand(t5));
    }
    const a10 = await Promise.all(n13);
    return e12.joinPipelineCommands(a10);
  }
  async createUpdateElevationCommand() {
    const { _featureDataPartitioning: t5, _context: e12 } = this, n13 = [];
    for (const o7 of t5.values()) {
      const t6 = o7.map(async ({ index: t7, features: e13 }) => {
        const n14 = this._getLoadedSymbol(t7);
        return await n14?.createUpdateElevationCommand(e13);
      });
      n13.push(...t6);
    }
    const a10 = await Promise.all(n13);
    return e12.joinPipelineCommands(a10);
  }
  async createDestroyCommand() {
    const { _featureDataPartitioning: t5, _context: e12 } = this, n13 = [];
    for (const o7 of t5.keys()) n13.push(this.createRemoveCommand(o7));
    for (const o7 of this._symbols) n13.push(o7.createDestroyCommand());
    const a10 = await Promise.all(n13);
    return e12.joinPipelineCommands(a10);
  }
  async _provisionSymbol(t5) {
    if (null == t5) return null;
    const e12 = this._symbols[t5];
    return e12 ? (e12.loaded || await e12.load(), e12) : null;
  }
  _getLoadedSymbol(t5) {
    if (null == t5) return null;
    const e12 = this._symbols[t5];
    return null != e12 && e12.loaded ? e12 : null;
  }
  _partition(t5) {
    const n13 = n10(t5);
    if (null == n13) throw new Error("unable to fetch objectIds");
    const { featureCount: a10 } = t5, o7 = [[], []];
    for (let e12 = 0; e12 < a10; ++e12) {
      o7[n13[e12] % 2].push(e12);
    }
    return o7.map((e12, n14) => new r2(n14, t5.subset(new Uint32Array(e12)))).filter((t6) => t6.features.featureCount > 0);
  }
};
var r2 = class {
  constructor(t5, e12) {
    this.index = t5, this.features = e12;
  }
};

// node_modules/@arcgis/core/views/3d/layers/graphics/pipeline/FeatureProcessingContext.js
var a7 = class {
  constructor(e12, r4, t5, o7, n13, i5, s13) {
    this.viewSpatialReference = e12, this.renderSpatialReference = r4, this.mainThreadDelegate = t5, this.renderCoordsHelper = o7, this.renderCommandContext = n13, this.layerInfo = i5, this.layerViewInfo = s13, this.symbolRendererFactory = new m4(this);
  }
  createPipelineCommand(e12 = this.renderCommandContext.createRenderCommandBuffer(), t5 = []) {
    return new e7(this.renderCommandContext, e12, t5);
  }
  joinPipelineCommands(e12) {
    if (0 === e12.length) return this.createPipelineCommand();
    return e12.filter((e13) => null != e13).reduce((e13, r4) => (e13.append(r4), e13));
  }
};
var m4 = class {
  constructor(e12) {
    this.context = e12;
  }
  createSymbolRendererFromJSON(r4) {
    const t5 = o4(r4 ?? l3) ?? void 0;
    if (!t5) throw new Error("Failed to create renderer");
    const o7 = t5.type;
    switch (o7) {
      case "simple":
        return new e10(t5, this.context);
      case "unique-value":
        return new s10(t5, this.context);
      default:
        return console.warn(`Unable to create symbolrenderer for renderer of ${o7}`), this.createSymbolRendererFromJSON(l3);
    }
  }
  createSymbolRendererFromSymbol(e12) {
    const r4 = e12?.type;
    switch (r4) {
      case "point-3d":
        return new e9(e12, this.context);
      case "picture-marker":
      case "simple-marker":
        return new h5(t4(), this.context);
      default:
        return console.warn(`Unable to create symbolrenderer for symbol of ${r4}`), null;
    }
  }
  createSymbolRendererFromSymbolLayer(e12) {
    const r4 = e12.type;
    return "icon" === r4 ? new h5(e12, this.context) : (console.warn(`Unable to create symbolrenderer for symbolLayer of ${r4}`), null);
  }
};
var l3 = { type: "simple" };

// node_modules/@arcgis/core/views/3d/layers/graphics/pipeline/utils.js
function r3(t5 = "") {
  return `${t5}${e2()}`;
}
var c5 = new Float64Array(3);

// node_modules/@arcgis/core/views/3d/layers/graphics/pipeline/featureData/FeatureDataSubset.js
var s11 = class _s {
  constructor(t5, s13) {
    this._parent = t5, this._subsetIndices = s13, this.id = r3(`featureDataSubset-${t5.id}-`);
  }
  get tileId() {
    return this._parent.tileId;
  }
  get extent() {
    return this._parent.extent;
  }
  get featureCount() {
    return this._subsetIndices.length;
  }
  get usedMemory() {
    return this._parent.usedMemory + s5 + this._subsetIndices.byteLength;
  }
  get isFullyEnabled() {
    for (const t5 of this._subsetIndices) if (!this._parent.getEnabled(t5)) return false;
    return true;
  }
  getObjectId(t5) {
    return this._parent.getObjectId(this._subsetIndices[t5]);
  }
  getAttribute(t5, e12) {
    return this._parent.getAttribute(this._subsetIndices[t5], e12);
  }
  getAttributeAsTimestamp(t5, e12) {
    return this._parent.getAttribute(this._subsetIndices[t5], e12);
  }
  getAttributes(t5) {
    return this._parent.getAttributes(this._subsetIndices[t5]);
  }
  getCoordinates(t5, e12, s13) {
    return this._parent.getCoordinates(this._subsetIndices[t5], e12, s13);
  }
  getOptimizedGeometry(t5) {
    return this._parent.getOptimizedGeometry(this._subsetIndices[t5]);
  }
  getCentroid(t5, e12) {
    return this._parent.getCentroid(this._subsetIndices[t5], e12);
  }
  getBounds(t5) {
    return this._parent.getBounds(this._subsetIndices[t5]);
  }
  getBoundingBox(t5) {
    return this._parent.getBoundingBox(this._subsetIndices[t5]);
  }
  getObjectIdsArray(t5, e12, s13) {
    return this._parent.getObjectIdsArray(t5, this._translatedIndices(e12), s13);
  }
  getCoordinatesArray(t5, e12, s13) {
    return this._parent.getCoordinatesArray(t5, this._translatedIndices(e12), s13);
  }
  objectIds(t5) {
    return this._parent.objectIds(this._translatedIndices(t5));
  }
  subset(t5) {
    const { _subsetIndices: e12 } = this, r4 = new Uint32Array(t5.length);
    for (let s13 = 0; s13 < r4.length; ++s13) r4[s13] = e12[t5[s13]];
    return new _s(this._parent, r4);
  }
  disableObjectIds(t5) {
    if (0 === t5.size) return;
    const { featureCount: e12 } = this, s13 = new Array();
    for (let r4 = 0; r4 < e12; ++r4) this.getEnabled(r4) && t5.has(this.getObjectId(r4)) && s13.push(r4);
    if (0 !== s13.length) for (const r4 of s13) this.setEnabled(r4, false);
  }
  setEnabled(t5, e12) {
    this._parent.setEnabled(this._subsetIndices[t5], e12);
  }
  getEnabled(t5) {
    return this._parent.getEnabled(this._subsetIndices[t5]);
  }
  enableAll() {
    const { _subsetIndices: t5, _parent: e12 } = this;
    for (const s13 of t5) e12.setEnabled(s13, true);
  }
  getVisibilityArray(t5, e12, s13) {
    return this._parent.getVisibilityArray(t5, this._translatedIndices(e12), s13);
  }
  enabledObjectIds(t5) {
    return this._parent.enabledObjectIds(this._translatedIndices(t5));
  }
  *_translatedIndices(t5) {
    const { _subsetIndices: e12 } = this;
    if (null != t5) for (const s13 of t5) yield e12[s13];
    else yield* e12;
  }
};

// node_modules/@arcgis/core/views/3d/layers/graphics/pipeline/featureData/FeatureData.js
var s12 = class {
  constructor(t5) {
    this._tile = t5, this.id = r3(`featureData-${t5.id}-`), this._enabled = new Array(t5.featureCount).fill(true);
  }
  get tileId() {
    return this._tile.id;
  }
  get featureCount() {
    return this._tile.featureCount;
  }
  get usedMemory() {
    return s5 + t(this.id);
  }
  get extent() {
    return this._tile.descriptor.extent;
  }
  get isFullyEnabled() {
    return this._enabled.every((t5) => t5);
  }
  getObjectId(t5) {
    return this._tile.getObjectId(t5);
  }
  getAttribute(t5, e12) {
    return this._tile.getAttribute(t5, e12);
  }
  getAttributeAsTimestamp(t5, e12) {
    return this._tile.getAttribute(t5, e12);
  }
  getAttributes(t5) {
    return this._tile.getAttributes(t5);
  }
  getCoordinates(t5, e12, r4) {
    return this._tile.getCoordinates(t5, e12, r4);
  }
  getOptimizedGeometry(t5) {
    return this._tile.getOptimizedGeometry(t5);
  }
  getCentroid(t5, e12) {
    return this._tile.getCentroid(t5, e12);
  }
  getBounds(t5) {
    return this._tile.getBounds(t5);
  }
  getBoundingBox(t5) {
    return this._tile.getBoundingBox(t5);
  }
  getObjectIdsArray(t5, e12, r4) {
    return this._tile.getObjectIdsArray(t5, e12, r4);
  }
  getCoordinatesArray(t5, e12, r4) {
    return this._tile.getCoordinatesArray(t5, e12, r4);
  }
  objectIds(t5) {
    return this._tile.objectIds(t5);
  }
  subset(t5) {
    return new s11(this, t5);
  }
  disableObjectIds(t5) {
    if (0 === t5.size) return;
    const { _enabled: e12 } = this, r4 = new Array();
    for (const i5 of this._allFeatureIndices()) e12[i5] && t5.has(this.getObjectId(i5)) && r4.push(i5);
    if (0 !== r4.length) for (const i5 of r4) e12[i5] = false;
  }
  setEnabled(t5, e12) {
    this._enabled[t5] = e12;
  }
  getEnabled(t5) {
    return this._enabled[t5];
  }
  enableAll() {
    this._enabled.fill(true);
  }
  getVisibilityArray(t5, e12 = this._allFeatureIndices(), r4 = 0) {
    const { _enabled: i5 } = this;
    for (const s13 of e12) t5[r4++] = Number(i5[s13]);
    return r4;
  }
  *enabledObjectIds(t5 = this._allFeatureIndices()) {
    const { _enabled: e12 } = this;
    for (const r4 of t5) e12[r4] && (yield this.getObjectId(r4));
  }
  *_allFeatureIndices() {
    const { featureCount: t5 } = this;
    for (let e12 = 0; e12 < t5; ++e12) yield e12;
  }
};

// node_modules/@arcgis/core/views/3d/layers/graphics/pipeline/Tile3DManager.js
var _2 = class extends b {
  constructor(t5) {
    super(t5), this.extent = null, this._tileHandles = new s3(), this._wanted = new s3(), this._updateRequested = false, this._synchronizationTask = null, this._requestedTiles = new Array();
  }
  destroy() {
    this._tileHandles.clear(), this._wanted.clear();
  }
  get updating() {
    return this._updateRequested || !(this._synchronizationTask?.finished ?? 1);
  }
  get _boundingRect() {
    const { extent: t5 } = this;
    return null == t5 ? null : o(t5);
  }
  get _missingTiles() {
    const t5 = new Array(), e12 = this._wanted, s13 = this._tileHandles;
    for (const o7 of e12.values()) null == s13.get(o7.id)?.featureData && t5.push(o7);
    return t5;
  }
  onTileTreeChange({ tiles: t5 }) {
    this._requestedTiles = t5, this._scheduleTilesSync();
  }
  _scheduleTilesSync() {
    if (this._updateRequested) return;
    this._updateRequested = true;
    const t5 = this._synchronizationTask, e12 = d(async () => {
      try {
        await j(() => t5?.finished ?? true), await P(), this._updateRequested = false, await this._synchronizeTiles();
      } finally {
        this._synchronizationTask === e12 && (this._synchronizationTask = null);
      }
    });
    this._synchronizationTask = e12;
  }
  async _synchronizeTiles() {
    const t5 = this._requestedTiles, e12 = this._tileHandles, s13 = new Array();
    for (const u9 of t5) e12.has(u9.id) || s13.push(u9);
    const o7 = new Array();
    for (const u9 of e12.values()) {
      const { id: e13 } = u9;
      t5.every((t6) => t6.id !== e13) && o7.push(u9.descriptor);
    }
    const a10 = this._tileHandles, { _boundingRect: i5 } = this, r4 = null != i5 ? s13.filter((t6) => !t6.extent || d2(i5, t6.extent)) : s13, n13 = this._wanted, l6 = new Array();
    for (const { id: u9 } of o7) n13.delete(u9);
    for (const u9 of r4) n13.set(u9.id, u9);
    const c8 = this._missingTiles;
    for (const u9 of o7) {
      const { id: t6 } = u9;
      if (c8.some((t7) => w3(t7, u9) || w3(u9, t7))) continue;
      const e13 = a10.get(t6);
      null != e13 && l6.push(this._removeTile(e13));
    }
    for (const u9 of r4) l6.push(this._addTile(u9));
    const d5 = await Promise.allSettled(l6);
    for (const u9 of d5) "rejected" === u9.status && console.error(u9.reason);
  }
  forEachTile(t5) {
    for (const e12 of this._tileHandles.values()) {
      const s13 = e12.featureData;
      null != s13 && t5(s13);
    }
  }
  *loadedTiles() {
    for (const t5 of this._tileHandles.values()) {
      const e12 = t5.featureData;
      null != e12 && (yield e12);
    }
  }
  async _removeTile(s13) {
    s13.loadTask.abort(), this._tileHandles.delete(s13.id), this._validate();
    const { featureData: o7 } = s13;
    if (null != o7) {
      const s14 = { stack: [], error: void 0, hasError: false };
      try {
        __addDisposableResource(s14, await this.tileLocks.lock([o7.tileId]), false);
        const e12 = await this.createRemoveCommand(o7.id);
        await e12?.execute();
      } catch (a10) {
        s14.error = a10, s14.hasError = true;
      } finally {
        __disposeResources(s14);
      }
    }
  }
  async _addTile(t5) {
    const { _tileHandles: e12 } = this, s13 = e12.get(t5.id);
    if (null != s13) {
      if (!T2(s13) || s13.featureData.isFullyEnabled) return;
      return s13.featureData.enableAll(), void await this._onTileLoad(s13);
    }
    const o7 = new v3(t5, d(async (e13) => {
      const s14 = await this.loadTile(t5, e13);
      return s2(e13), new s12(s14);
    }));
    this._tileHandles.set(o7.id, o7);
    try {
      await o7.loadTask.promise;
    } catch (a10) {
      return void m3(a10);
    }
    g3(o7), await this._onTileLoad(o7);
  }
  async _onTileLoad(s13) {
    const o7 = { stack: [], error: void 0, hasError: false };
    try {
      const { _wanted: e12, _tileHandles: i5, _missingTiles: r4 } = this, n13 = s13.descriptor, l6 = new Array(), c8 = new Array(), d5 = new Array(), u9 = /* @__PURE__ */ new Set();
      for (const t5 of i5.values()) {
        if (t5 === s13) continue;
        const { descriptor: o8, id: a10 } = t5;
        if (!(e12.has(a10) || r4.some((t6) => w3(t6, o8) || w3(o8, t6)))) {
          i5.delete(a10), t5.loadTask.abort();
          const { featureData: e13 } = t5;
          null != e13 && l6.push(e13);
          continue;
        }
        if (T2(t5)) {
          if (w3(n13, o8)) {
            const e13 = t5.featureData;
            for (const t6 of e13.objectIds()) u9.add(t6);
          }
          if (w3(o8, n13)) {
            const { featureData: e13 } = t5;
            c8.push(e13);
          }
        }
      }
      u9.size > 0 && (s13.featureData.disableObjectIds(u9), this._validateRemoval(s13.featureData, u9)), this._validate(), d5.push(s13.featureData);
      const h8 = [...d5, ...l6, ...c8].map((t5) => t5.tileId);
      __addDisposableResource(o7, await this.tileLocks.lock(h8), false);
      if (0 !== c8.length) {
        const t5 = s13.featureData, e13 = new Set(t5.objectIds());
        for (const s14 of c8) s14.disableObjectIds(e13), this._validateRemoval(s14, e13);
      }
      const f8 = l6.map((t5) => this.createRemoveCommand(t5.id)), p4 = d5.map((t5) => this.createAddCommand(t5)), y = c8.map((t5) => this.createUpdateCommand(t5)), _3 = await Promise.all([...f8, ...p4, ...y]), v4 = n8(_3.filter(N));
      await v4?.execute();
    } catch (i5) {
      o7.error = i5, o7.hasError = true;
    } finally {
      __disposeResources(o7);
    }
  }
  _validate() {
    if (!has("feature-pipeline-3d-test-validation")) return;
    const t5 = new Array();
    for (const e12 of this._tileHandles.values()) {
      if (!T2(e12)) continue;
      const { featureData: s13 } = e12;
      t5.push({ featureData: s13, objectIds: new Set(s13.enabledObjectIds()) });
    }
    for (let e12 = 0; e12 < t5.length; ++e12) {
      const { featureData: s13, objectIds: o7 } = t5[e12];
      for (let a10 = e12 + 1; a10 < t5.length; ++a10) {
        const { featureData: e13, objectIds: i5 } = t5[a10];
        for (const t6 of i5) if (o7.has(t6)) throw new Error(`${s13.id} and ${e13.id} both contain ${t6}.`);
      }
    }
  }
  _validateRemoval(t5, e12) {
    if (has("feature-pipeline-3d-test-validation")) {
      for (const s13 of t5.enabledObjectIds()) if (e12.has(s13)) throw new Error(`Failed to remove ${s13} from ${t5.id}!`);
    }
  }
};
function w3({ lij: [t5, e12, s13] }, { lij: [o7, a10, i5] }) {
  const r4 = o7 - t5;
  return r4 >= 0 && e12 === a10 >> r4 && s13 === i5 >> r4;
}
__decorate([m2()], _2.prototype, "updating", null), __decorate([m2({ constructOnly: true })], _2.prototype, "loadTile", void 0), __decorate([m2({ constructOnly: true })], _2.prototype, "createAddCommand", void 0), __decorate([m2({ constructOnly: true })], _2.prototype, "createRemoveCommand", void 0), __decorate([m2({ constructOnly: true })], _2.prototype, "createUpdateCommand", void 0), __decorate([m2({ constructOnly: true })], _2.prototype, "tileLocks", void 0), __decorate([m2()], _2.prototype, "extent", void 0), __decorate([m2()], _2.prototype, "_boundingRect", null), __decorate([m2()], _2.prototype, "_missingTiles", null), __decorate([m2()], _2.prototype, "_updateRequested", void 0), __decorate([m2()], _2.prototype, "_synchronizationTask", void 0), _2 = __decorate([a("esri.views.3d.layers.graphics.pipeline.Tile3DManager")], _2);
var v3 = class {
  constructor(t5, e12) {
    this.descriptor = t5, this.loadTask = e12;
  }
  get id() {
    return this.descriptor.id;
  }
  get featureData() {
    return this.loadTask.value;
  }
};
function T2(t5) {
  return null != t5.featureData;
}
function g3(t5) {
  if (!T2(t5)) throw new Error();
}

// node_modules/@arcgis/core/views/3d/layers/graphics/pipeline/TileLocks.js
var e11 = class {
  constructor() {
    this._previousActions = /* @__PURE__ */ new Map();
  }
  async lock(e12) {
    const { _previousActions: i5 } = this, l6 = e12.map((o7) => i5.get(o7)).filter(N), c8 = Promise.allSettled(l6), a10 = $(), n13 = e(() => a10.resolve()), m7 = a10.promise.finally(() => {
      for (const o7 of e12) i5.get(o7) === m7 && i5.delete(o7);
    });
    for (const o7 of e12) i5.set(o7, m7);
    return await c8, m(n13);
  }
};

// node_modules/@arcgis/core/views/3d/layers/graphics/pipeline/featureSet/TiledFeatureStore.js
var u6 = class {
  constructor(t5, e12) {
    this._index = t5, this._view = e12;
  }
  get usedMemory() {
    return s5 + n3;
  }
  getObjectId() {
    return this._view.getObjectId(this._index);
  }
  getAttribute(t5) {
    return this._view.getAttribute(this._index, t5);
  }
  getAttributeAsTimestamp(t5) {
    return this._view.getAttributeAsTimestamp(this._index, t5);
  }
  getAttributes() {
    return this._view.getAttributes(this._index);
  }
  getOptimizedGeometry() {
    return this._view.getOptimizedGeometry(this._index);
  }
  getCentroid(t5) {
    return this._view.getCentroid(this._index, t5);
  }
  getBounds() {
    return this._view.getBounds(this._index);
  }
  getBoundingBox() {
    return this._view.getBoundingBox(this._index);
  }
  cloneWithGeometry(t5) {
    return new d4(this._index, this._view, t5);
  }
};
var d4 = class extends u6 {
  constructor(t5, e12, i5) {
    super(t5, e12), this._geometryOverride = i5;
  }
  getOptimizedGeometry() {
    return this._geometryOverride;
  }
  getCentroid(t5) {
    return n4(new e4(), this._geometryOverride, t5.hasZ, t5.hasM);
  }
};
var a8 = class {
  constructor(t5, e12) {
    this.featureData = t5, this.bounds = e12;
  }
};
var h6 = class {
  constructor() {
    this._tileBounds = /* @__PURE__ */ new Map(), this.events = new i(), this.featureAdapter = m5.shared;
  }
  get usedMemory() {
    return s5 + s5 * this._tileBounds.size;
  }
  addTile(t5) {
    const { featureCount: e12 } = t5;
    if (0 === e12) return;
    const i5 = new s7(9, (e13) => t5.getBounds(e13)), s13 = new Array();
    for (let r4 = 0; r4 < e12; ++r4) s13[r4] = r4;
    i5.load(s13), this._tileBounds.set(t5.id, new a8(t5, i5)), this.events.emit("changed");
  }
  removeTile(t5) {
    this._tileBounds.delete(t5), this.events.emit("changed");
  }
  clear() {
    this._tileBounds.clear(), this.events.emit("changed");
  }
  forEach(t5) {
    for (const { featureData: e12, bounds: i5 } of this._tileBounds.values()) i5.all((i6) => {
      e12.getEnabled(i6) && t5(new u6(i6, e12));
    });
  }
  forEachInBounds(t5, e12) {
    g4.minX = t5[0], g4.minY = t5[1], g4.maxX = t5[2], g4.maxY = t5[3];
    for (const { featureData: i5, bounds: r4 } of this._tileBounds.values()) r4.search(g4, (t6) => {
      i5.getEnabled(t6) && e12(new u6(t6, i5));
    });
  }
  forEachBounds(t5, e12) {
    for (const i5 of t5) e12(i5.getBoundingBox());
  }
  getFullExtent(t5) {
    let e12 = 1 / 0, i5 = 1 / 0, r4 = -1 / 0, s13 = -1 / 0;
    for (const { bounds: n13 } of this._tileBounds.values()) {
      const { minX: t6, minY: o7, maxX: u9, maxY: d5 } = n13.toJSON();
      e12 = Math.min(e12, t6), i5 = Math.min(i5, o7), r4 = Math.min(r4, u9), s13 = Math.min(s13, d5);
    }
    return { xmin: e12, ymin: i5, xmax: r4, ymax: s13, spatialReference: t5 };
  }
};
var _m = class _m {
  getObjectId(t5) {
    return t5.getObjectId();
  }
  getAttribute(t5, e12) {
    return t5.getAttribute(e12);
  }
  getAttributeAsTimestamp(t5, e12) {
    return t5.getAttributeAsTimestamp(e12);
  }
  getAttributes(t5) {
    return t5.getAttributes();
  }
  getGeometry(t5) {
    return t5.getOptimizedGeometry();
  }
  getCentroid(t5, e12) {
    return t5.getCentroid(e12);
  }
  cloneWithGeometry(t5, e12) {
    return t5.cloneWithGeometry(e12);
  }
};
_m.shared = new _m();
var m5 = _m;
var g4 = new b2();

// node_modules/@arcgis/core/views/3d/layers/graphics/pipeline/Tile.js
var n11 = class {
  constructor(n13, a10, r4) {
    this.descriptor = n13, this._pages = a10, this._pageSize = r4;
    const i5 = a3 + a10.reduce((e12, { usedMemory: t5 }) => e12 + t5, 0), d5 = 3 * n3;
    this.usedMemory = s5 + i5 + d5, this.featureCount = a10.reduce((e12, t5) => e12 + t5.featureCount, 0);
  }
  get id() {
    return this.descriptor.id;
  }
  getObjectId(e12) {
    const { pageIndex: t5, featurePageIndex: s13 } = this._translateIndex(e12);
    return this._pages[t5].getObjectId(s13);
  }
  getAttribute(e12, t5) {
    const { pageIndex: s13, featurePageIndex: n13 } = this._translateIndex(e12);
    return this._pages[s13].getAttribute(n13, t5);
  }
  getAttributeAsTimestamp(e12, t5) {
    const { pageIndex: s13, featurePageIndex: n13 } = this._translateIndex(e12);
    return this._pages[s13].getAttributeAsTimestamp(n13, t5);
  }
  getAttributes(e12) {
    const { pageIndex: t5, featurePageIndex: s13 } = this._translateIndex(e12);
    return this._pages[t5].getAttributes(s13);
  }
  getCoordinates(e12, t5, s13) {
    const { pageIndex: n13, featurePageIndex: a10 } = this._translateIndex(e12);
    this._pages[n13].getCoordinates(a10, t5, s13);
  }
  getOptimizedGeometry(e12) {
    const { pageIndex: t5, featurePageIndex: s13 } = this._translateIndex(e12);
    return this._pages[t5].getOptimizedGeometry(s13);
  }
  getCentroid(e12, t5) {
    const { pageIndex: s13, featurePageIndex: n13 } = this._translateIndex(e12);
    return this._pages[s13].getCentroid(n13, t5);
  }
  getBounds(e12) {
    const { pageIndex: t5, featurePageIndex: s13 } = this._translateIndex(e12);
    return this._pages[t5].getBounds(s13);
  }
  getBoundingBox(e12) {
    const { pageIndex: t5, featurePageIndex: s13 } = this._translateIndex(e12);
    return this._pages[t5].getBoundingBox(s13);
  }
  getObjectIdsArray(e12, t5 = this._allFeatureIndices(), s13 = 0) {
    let n13 = s13;
    for (const { page: a10, indices: r4 } of this._batchPageIndices(t5)) n13 = a10.getObjectIdsArray(e12, r4, n13);
    return n13;
  }
  getCoordinatesArray(e12, t5 = this._allFeatureIndices(), s13 = 0) {
    let n13 = s13;
    for (const { page: a10, indices: r4 } of this._batchPageIndices(t5)) n13 = a10.getCoordinatesArray(e12, r4, n13);
    return n13;
  }
  *objectIds(e12 = this._allFeatureIndices()) {
    for (const { page: t5, indices: s13 } of this._batchPageIndices(e12)) for (const e13 of t5.objectIds(s13)) yield e13;
  }
  *_allFeatureIndices() {
    const { featureCount: e12 } = this;
    for (let t5 = 0; t5 < e12; ++t5) yield t5;
  }
  _translateIndex(e12) {
    const { _pageSize: t5 } = this;
    return { pageIndex: Math.floor(e12 / t5), featurePageIndex: e12 % t5 };
  }
  *_batchPageIndices(e12) {
    const t5 = new Array();
    {
      let s14 = 0, n13 = new Array();
      for (const a10 of e12) {
        const { pageIndex: e13, featurePageIndex: r4 } = this._translateIndex(a10);
        s14 !== e13 && (0 !== n13.length && t5.push({ pageIndex: s14, indices: n13 }), s14 = e13, n13 = []), n13.push(r4);
      }
      0 !== n13.length && t5.push({ pageIndex: s14, indices: n13 });
    }
    const { _pages: s13 } = this;
    for (const { pageIndex: n13, indices: a10 } of t5) yield { page: s13[n13], indices: a10 };
  }
};

// node_modules/@arcgis/core/views/3d/layers/graphics/pipeline/featureSet/PBFPointFeatureSetView.js
var u7 = class {
  constructor(e12) {
    this._reader = new n5(new Uint8Array(e12), new DataView(e12)), this._index = g5(this._reader);
  }
  get featureCount() {
    return this._index.featureIndices.length;
  }
  get exceededTransferLimit() {
    return this._index.exceededTransferLimit;
  }
  get usedMemory() {
    return this._reader.usedMemory;
  }
  getObjectId(e12) {
    return this.getAttribute(e12, this._index.objectIdFieldName);
  }
  getAttribute(e12, t5) {
    const { _index: { fieldsIndex: r4, attributeIndices: s13 } } = this, n13 = r4.get(t5)?.index;
    if (null == n13) return;
    const o7 = s13[e12 * r4.fields.length + n13], i5 = this._reader;
    return i5.move(o7), m6(i5);
  }
  getAttributeAsTimestamp(e12, t5) {
    const r4 = this.getAttribute(e12, t5);
    return "string" == typeof r4 ? new Date(r4).getTime() : "number" == typeof r4 || null == r4 ? r4 : null;
  }
  getAttributes(e12) {
    const { _index: { fieldsIndex: t5, attributeIndices: r4 } } = this, s13 = e12 * t5.fields.length, n13 = this._reader, o7 = {};
    for (const i5 of t5.fields) {
      const e13 = r4[s13 + i5.index];
      n13.move(e13), o7[i5.name] = m6(n13);
    }
    return o7;
  }
  getCoordinates(e12, t5, r4 = 0) {
    const s13 = this._reader, { transform: n13, featureIndices: o7 } = this._index, { scale: i5, translate: a10 } = n13;
    s13.move(o7[e12]), this._readCoordinates(i5, a10, t5, r4);
  }
  getOptimizedGeometry(e12) {
    const t5 = n();
    return this.getCoordinates(e12, t5), new e4([], t5);
  }
  getCentroid(e12, { hasZ: t5, hasM: r4 }) {
    this.getCoordinates(e12, p3);
    const [s13, n13, o7] = p3, a10 = [s13, n13];
    return t5 && (a10[3] = o7), r4 && (a10[t5 ? 4 : 3] = 0), new e4([], a10);
  }
  getBounds(e12) {
    this.getCoordinates(e12, p3);
    const [t5, r4] = p3, n13 = new b2();
    return n13.minX = t5, n13.minY = r4, n13.maxX = t5, n13.maxY = r4, n13;
  }
  getBoundingBox(e12) {
    this.getCoordinates(e12, p3);
    const [t5, r4, s13] = p3;
    return a2(t5, r4, s13, t5, r4, s13);
  }
  getObjectIdsArray(e12, t5 = this._allFeatureIndices(), r4 = 0) {
    const s13 = this._reader, { objectIdFieldName: n13, attributeIndices: o7, fieldsIndex: i5 } = this._index, a10 = i5.get(n13).index, d5 = i5.fields.length;
    for (const c8 of t5) {
      const t6 = o7[c8 * d5 + a10];
      s13.move(t6), e12[r4++] = m6(s13);
    }
    return r4;
  }
  getCoordinatesArray(e12, t5 = this._allFeatureIndices(), r4 = 0) {
    const s13 = this._reader, { transform: n13, featureIndices: o7 } = this._index, { scale: i5, translate: a10 } = n13;
    for (const d5 of t5) {
      const t6 = o7[d5];
      s13.move(t6), r4 = this._readCoordinates(i5, a10, e12, r4);
    }
    return r4;
  }
  *objectIds(e12 = this._allFeatureIndices()) {
    const t5 = this._reader, { objectIdFieldName: r4, attributeIndices: s13, fieldsIndex: n13 } = this._index, o7 = n13.get(r4).index, i5 = n13.fields.length;
    for (const a10 of e12) {
      const e13 = s13[a10 * i5 + o7];
      t5.move(e13), yield m6(t5);
    }
  }
  *_allFeatureIndices() {
    const { featureCount: e12 } = this;
    for (let t5 = 0; t5 < e12; ++t5) yield t5;
  }
  _readCoordinates([e12, t5, r4], [s13, n13, o7], i5, a10) {
    const d5 = 2, c8 = 3, u9 = this._reader, g6 = u9.getLength(), l6 = u9.pos() + g6;
    for (; u9.pos() < l6 && u9.next(); ) switch (u9.tag()) {
      case d5: {
        const d6 = u9.getLength(), g7 = u9.pos() + d6;
        for (; u9.pos() < g7 && u9.next(); ) if (u9.tag() === c8) u9.getUInt32(), i5[a10++] = s13 + e12 * u9.getSInt64(), i5[a10++] = n13 + t5 * u9.getSInt64(), i5[a10++] = o7 + r4 * u9.getSInt64();
        else u9.skip();
        break;
      }
      default:
        u9.skip();
    }
    return a10;
  }
};
function g5(e12) {
  const t5 = 2;
  for (; e12.next(); ) {
    if (e12.tag() === t5) return l4(e12.getMessage());
    e12.skip();
  }
  h7();
}
function l4(e12) {
  const t5 = 1;
  for (; e12.next(); ) {
    if (e12.tag() === t5) return f6(e12.getMessage());
    e12.skip();
  }
  h7();
}
function f6(e12) {
  const t5 = 9, r4 = 12, s13 = 13, n13 = 15, i5 = 7, u9 = 0, g6 = 10, l6 = 1, f8 = 1;
  let m7, p4, x2 = false, I = false, b6 = 0;
  const _3 = new Array(), w4 = new Array(), y = new Array();
  for (; e12.next(); ) switch (e12.tag()) {
    case f8:
      p4 = e12.getString();
      break;
    case i5:
      e12.getEnum() !== u9 && h7();
      break;
    case t5:
      x2 = e12.getBool() ?? false;
      break;
    case r4:
      m7 = u3(e12.processMessage(h3));
      break;
    case s13: {
      const t6 = e12.processMessage(b4);
      t6.index = b6++, _3.push(t6);
      break;
    }
    case n13: {
      w4.push(e12.pos());
      const t6 = e12.getUInt32(), r5 = e12.pos() + t6;
      for (; e12.pos() < r5 && e12.next(); ) if (e12.tag() === l6) y.push(e12.pos()), e12.skip();
      else e12.skip();
      break;
    }
    case g6:
      I = e12.getBool() ?? false;
      break;
    default:
      e12.skip();
  }
  const j6 = new Z(_3);
  return null != m7 && I && null != p4 && j6.has(p4) || h7(), { transform: m7, exceededTransferLimit: x2, fieldsIndex: j6, objectIdFieldName: p4, featureIndices: w4, attributeIndices: y };
}
function h7() {
  const t5 = new s("pbf-parsing-failed", "Error while parsing PBF", new Error());
  throw console.error(t5), t5;
}
function m6(e12) {
  const t5 = 1, r4 = 2, s13 = 3, n13 = 4, o7 = 5, i5 = 6, a10 = 7, d5 = 8, c8 = 9, u9 = e12.getLength(), g6 = e12.pos() + u9;
  for (; e12.pos() < g6 && e12.next(); ) switch (e12.tag()) {
    case t5:
      return e12.getString();
    case r4:
      return e12.getFloat();
    case s13:
      return e12.getDouble();
    case n13:
      return e12.getSInt32();
    case o7:
      return e12.getUInt32();
    case i5:
      return e12.getInt64();
    case a10:
      return e12.getUInt64();
    case d5:
      return e12.getSInt64();
    case c8:
      return e12.getBool();
    default:
      return e12.skip(), null;
  }
  return null;
}
var p3 = n();

// node_modules/@arcgis/core/views/3d/layers/graphics/pipeline/fetching/Tile3DFetcher.js
var i4 = 8e3;
var a9 = 4;
var n12 = 4;
var c6 = class {
  constructor(e12, t5, r4, o7, s13) {
    this.spatialReference = e12, this.url = r4, this.objectIdField = o7, this.capabilities = s13;
    const { supportsMaxRecordCountFactor: n13, maxRecordCount: c8 } = this.capabilities.query, u9 = n13 ? a9 : 1, p4 = (c8 ?? i4) * u9;
    this._pageSize = Math.min(i4, p4);
    const l6 = t5.clone();
    l6.cacheHint = true, l6.resultType = "tile", l6.outSpatialReference = e12, l6.returnGeometry = true, l6.returnZ = true, l6.maxRecordCountFactor = u9, l6.num = this._pageSize, l6.outFields = [o7], this._baseQuery = l6;
  }
  async fetch(r4, s13) {
    const { spatialReference: i5, _pageSize: a10 } = this, c8 = c(r4.extent, i5), u9 = this._baseQuery.clone();
    u9.geometry = c8;
    const p4 = new Array();
    let l6 = 0, h8 = false, m7 = 1;
    for (; !h8; ) {
      const t5 = [];
      for (let e12 = 0; e12 < m7; ++e12) t5.push(this._fetchPage(u9, l6++, s13));
      const r5 = await Promise.all(t5);
      s2(s13);
      for (const e12 of r5) {
        const t6 = 0 !== e12.featureCount;
        h8 ||= !e12.exceededTransferLimit || !t6, t6 && p4.push(e12);
      }
      m7 = Math.min(m7 + 1, n12);
    }
    return new n11(r4, p4, a10);
  }
  async _fetchPage(t5, o7, i5) {
    const a10 = t5.clone();
    a10.start = o7 * this._pageSize;
    const n13 = (await c2(this.url, a10, { signal: i5 })).data;
    return s2(i5), new u7(n13);
  }
};

// node_modules/@arcgis/core/views/3d/layers/graphics/pipeline/rendering/RenderCommandContext.js
var f7 = class {
  constructor(e12, r4) {
    this._mainThreadDelegate = r4, this._bufferWriters = /* @__PURE__ */ new Map(), this.globalViewingMode = 1 === e12;
  }
  createRenderCommandBuffer(e12 = [], r4 = []) {
    return { commands: e12, transferList: r4 };
  }
  mergeRenderCommandBuffers(e12) {
    const r4 = this.createRenderCommandBuffer();
    for (const t5 of e12) null != t5 && (r4.commands.push(...t5.commands), r4.transferList.push(...t5.transferList));
    return r4;
  }
  async createTexture(e12) {
    const { data: r4, parameters: t5 } = e12();
    return await this._mainThreadDelegate.createTexture(r4, t5);
  }
  async releaseTexture(e12) {
    const r4 = this._destroyTexture(e12);
    return new e7(this, r4, []);
  }
  _destroyTexture(e12) {
    return { commands: [{ id: "destroy-texture", textureId: e12 }], transferList: [] };
  }
  async createMaterial(e12) {
    const { type: r4, parameters: t5 } = e12, n13 = r3("material");
    let a10, i5;
    switch (r4) {
      case "default":
        a10 = new P2(e12.parameters, { spherical: this.globalViewingMode }), i5 = { type: r4, materialId: n13, parameters: e12.parameters };
        break;
      case "hud":
        a10 = new ie(t5, this.globalViewingMode), i5 = { type: r4, materialId: n13, parameters: e12.parameters };
    }
    return this._bufferWriters.set(n13, a10.createBufferWriter()), await this._mainThreadDelegate.createMaterial(i5), n13;
  }
  destroyMaterial(e12) {
    return { commands: [{ id: "destroy-material", materialId: e12 }], transferList: [] };
  }
  updateMaterial(e12) {
    return { commands: [{ ...e12, id: "update-material" }], transferList: [] };
  }
  async createDirectRenderer(e12) {
    return await this._mainThreadDelegate.createDirectRenderer(e12), e12;
  }
  async destroyDirectRenderer(e12) {
    await this._mainThreadDelegate.destroyDirectRenderer(e12);
  }
  addDirectRendererGeometry(e12, r4, t5, n13) {
    const { materialId: a10 } = r4;
    if (null == this._bufferWriters.get(a10)) throw new Error(`no bufferwriter found for material ${a10}`);
    const { renderGeometryBuffer: i5, renderGeometryBufferItems: s13 } = this.createRenderGeometryBuffer(r4, t5, n13);
    return this.addDirectRendererGeometryBuffer(a10, e12, i5, s13, t5);
  }
  updateDirectRendererGeometry(e12, r4, t5, n13) {
    const { materialId: a10 } = r4;
    if (null == this._bufferWriters.get(a10)) throw new Error(`no bufferwriter found for material ${a10}`);
    const { renderGeometryBuffer: i5, renderGeometryBufferItems: s13 } = this.createRenderGeometryBuffer(r4, t5, n13);
    return this.updateDirectRendererGeometryBuffer(a10, e12, i5, s13, t5);
  }
  addDirectRendererGeometryBuffer(e12, r4, t5, n13, a10) {
    const { objectIds: i5, visibilities: s13 } = n13;
    return { commands: [{ id: "add-direct-renderer-geometry-buffer", rendererId: e12, groupId: r4, renderGeometryBuffer: t5, renderGeometryBufferItems: n13, localOrigin: a10 }], transferList: [t5.data, i5.buffer, s13.buffer] };
  }
  updateDirectRendererGeometryBuffer(e12, r4, t5, n13, a10) {
    const { objectIds: i5, visibilities: s13 } = n13;
    return { commands: [{ id: "update-direct-renderer-geometry-buffer", rendererId: e12, groupId: r4, renderGeometryBuffer: t5, renderGeometryBufferItems: n13, localOrigin: a10 }], transferList: [t5.data, i5.buffer, s13.buffer] };
  }
  removeDirectRendererGeometryBuffer(e12, r4) {
    return { commands: [{ id: "remove-direct-renderer-geometry-buffer", rendererId: e12, groupId: r4 }], transferList: [] };
  }
  async createLodRenderer(e12) {
    const r4 = r3("lod-renderer"), t5 = /* @__PURE__ */ new Set(), n13 = { levels: e12.levels.map((e13) => ({ components: e13.components.map((e14) => {
      const r5 = e14.attributes.get("position");
      if (!r5 || 0 === r5.indices.length) throw new Error("positions attribute expected");
      const n14 = 3, i5 = A(r5.indices.length / n14), s13 = new h4(i5, n14, r5);
      if (null == this._bufferWriters.get(e14.materialId)) throw new Error("writer not found");
      const { renderGeometryBuffer: d5 } = this.createRenderGeometryBuffer(e14, null);
      t5.add(d5.data);
      return { materialId: e14.materialId, renderGeometryBuffer: d5, boundingInfo: { bbMax: s13.bbMax, bbMin: s13.bbMin } };
    }), minScreenSpaceRadius: e13.minScreenSpaceRadius })) };
    return await this._mainThreadDelegate.createLodRenderer(r4, n13, Array.from(t5)), r4;
  }
  destroyLodRenderer(e12) {
    return { commands: [{ id: "destroy-lod-renderer", rendererId: e12 }], transferList: [] };
  }
  addLodInstances(e12, r4, t5) {
    return { commands: [{ id: "add-lod-instances", rendererId: e12, groupId: r4, data: t5 }], transferList: [t5.featureIds.buffer, t5.globalTransforms.buffer, t5.localTransforms.buffer, t5.visibility.buffer] };
  }
  removeLodInstances(e12, r4) {
    return { commands: [{ id: "remove-lod-instances", rendererId: e12, groupId: r4 }], transferList: [] };
  }
  updateLodInstancesData(e12, r4, t5) {
    return { commands: [{ id: "update-lod-instance-data", rendererId: e12, groupId: r4, globalTransforms: t5 }], transferList: [t5.buffer] };
  }
  updateVisibility(e12, r4, t5) {
    return { commands: [{ id: "update-visibility", rendererId: e12, groupId: r4, visibility: t5 }], transferList: [t5.buffer] };
  }
  async dispatchRenderCommands(e12) {
    0 !== e12.commands.length && await this._mainThreadDelegate.executeRenderCommands(e12);
  }
  createRenderGeometryBuffer(n13, a10, i5) {
    const { materialId: s13, visibilities: o7, objectIds: d5 } = n13, m7 = this._bufferWriters.get(s13);
    if (null == m7) throw new Error("no registered bufferWriter for material found");
    let f8 = null;
    if (n13.transformation && a10) n2(u8, n13.transformation), u8[12] -= a10[0], u8[13] -= a10[1], u8[14] -= a10[2], f8 = u8;
    else {
      if (a10) throw new Error("not implemented");
      n13.transformation && (f8 = n13.transformation);
    }
    let b6 = null;
    f8 && (h2(l5, u8), s4(l5, l5), b6 = l5);
    const y = n13.attributes, h8 = m7.elementCount(y), p4 = i5 ? m7.instanceLayout : m7.layout;
    if (!p4) throw new Error("Missing layout");
    const g6 = p4.stride / 4;
    h8 > Math.floor(c7 / g6) && console.warn("geometry with very large number of elements encountered");
    const I = p4.createBuffer(h8), w4 = 0, B = m7.write(f8, b6, y, n13.olidColor, I, w4);
    if (null == B) throw new Error("Bufferwriter.write does not provide item information.");
    if (o7.length !== B.numItems || d5.length !== B.numItems) throw new Error("Unexpected mismatch between number of RenderGeometryBufferItems and provided objectIds/visibility flags.");
    return { renderGeometryBuffer: { data: I.buffer, elementCount: h8 }, renderGeometryBufferItems: { objectIds: d5, visibilities: o7, ranges: { numVertices: B.numVerticesPerItem, numItems: B.numItems } } };
  }
  async setBaseInstance(e12, r4) {
    await this._mainThreadDelegate.setBaseInstance(e12, r4);
  }
};
var u8 = e3();
var l5 = e3();
var c7 = 16777216 / 4;

// node_modules/@arcgis/core/views/3d/layers/graphics/pipeline/Feature3DPipelineWorker.js
var R = class extends l {
  constructor() {
    super(...arguments), this.remoteClient = null, this._featureStore = new h6(), this._tileLocks = new e11(), this._tileManager = null, this._renderer = null, this._fetcher = null, this._queryEngine = null, this._defaultQueryJSON = null, this._mainThreadDelegate = null, this._viewSpatialReference = null, this._renderCommandContext = null, this._context = null;
  }
  get updating() {
    return this._tileManager.updating;
  }
  destroy() {
    this._featureStore.clear(), this._tileManager?.destroy();
  }
  async setup({ viewSpatialReference: e12, renderSpatialReference: t5, viewingMode: r4, layerInfo: a10, layerViewInfo: n13 }) {
    const o7 = f.fromJSON(e12);
    this._viewSpatialReference = o7;
    const l6 = f.fromJSON(t5);
    this._fetcher = new c6(this._viewSpatialReference, b3.fromJSON(a10.baseQuery), a10.url, a10.objectIdField, a10.capabilities), this._queryEngine = new W2({ hasZ: true, hasM: false, geometryType: "esriGeometryPoint", featureIdInfo: { type: "object-id", fieldName: a10.objectIdField }, fieldsIndex: a10.fieldIndex, availableFields: [a10.objectIdField], spatialReference: e12, featureStore: this._featureStore, timeInfo: a10.timeInfo }), this._mainThreadDelegate = { createTexture: async (e13, t6) => {
      const r5 = { data: e13, parameters: t6 };
      return await this.remoteClient.invoke("createTexture", r5, { transferList: [e13.buffer] });
    }, releaseTexture: async (e13) => {
      const t6 = { uid: e13 };
      await this.remoteClient.invoke("releaseTexture", t6);
    }, createMaterial: async (e13) => {
      const t6 = { materialJSON: e13 };
      await this.remoteClient.invoke("createMaterial", t6);
    }, destroyMaterial: async (e13) => {
      const t6 = { materialId: e13 };
      await this.remoteClient.invoke("destroyMaterial", t6);
    }, createDirectRenderer: async (e13) => {
      const t6 = { materialId: e13 };
      await this.remoteClient.invoke("createDirectRenderer", t6);
    }, destroyDirectRenderer: async (e13) => {
      const t6 = { materialId: e13 };
      await this.remoteClient.invoke("destroyDirectRenderer", t6);
    }, createLodRenderer: async (e13, t6, r5) => {
      const a11 = { rendererId: e13, lodRenderGeometry: t6 };
      await this.remoteClient.invoke("createLoDRenderer", a11, { transferList: r5 });
    }, destroyLodRenderer: async (e13) => {
      const t6 = { rendererId: e13 };
      await this.remoteClient.invoke("destroyLoDRenderer", t6);
    }, executeRenderCommands: async (e13) => {
      const t6 = { commands: e13.commands };
      await this.remoteClient.invoke("dispatchRenderCommands", t6, { transferList: e13.transferList });
    }, applyElevationAlignmentTo: async (e13) => {
      const t6 = { mapPoints: e13 };
      return await this.remoteClient.invoke("applyElevationAlignment", t6, { transferList: [e13.buffer] });
    }, setBaseInstance: async (e13, t6) => {
      const r5 = { rendererId: e13, baseInstance: t6 };
      await this.remoteClient.invoke("setBaseInstance", r5, { transferList: null != t6 ? [t6.data] : void 0 });
    } };
    const f8 = v.create(r4, l6), C2 = new f7(r4, this._mainThreadDelegate);
    this._renderCommandContext = C2;
    const w4 = new a7(o7, l6, this._mainThreadDelegate, f8, C2, a10, n13);
    this._context = w4, this._renderer = w4.symbolRendererFactory.createSymbolRendererFromJSON(a10.renderer), this._defaultQueryJSON = new b3({ outSpatialReference: o7 }).toJSON();
    let R2 = null;
    if (null != a10.fullExtent) {
      const e13 = z.fromJSON(a10.fullExtent);
      await N2(e13.spatialReference, o7), R2 = W(e13, o7);
    }
    return this._tileManager = new _2({ loadTile: (e13, t6) => this._fetcher.fetch(e13, t6), createAddCommand: (e13, t6) => this._createAddFeatureDataCommand(e13, t6), createRemoveCommand: (e13) => this._createRemoveFeatureDataCommand(e13), createUpdateCommand: (e13, t6) => this._createUpdateFeatureDataVisibilityCommand(e13, t6), tileLocks: this._tileLocks, extent: R2 }), this.addHandles(l2(() => this.updating, (e13) => {
      this.emit("notify-updating", { updating: e13 });
    }), h), null != this._renderer && await this._renderer.load(), j5;
  }
  async executeQuery(e12, t5) {
    return { result: await this._queryEngine.executeQuery(this._ensureQuery(e12), t5) };
  }
  async executeQueryForIds(e12, t5) {
    const r4 = await this._queryEngine.executeQueryForIdSet(this._ensureQuery(e12), t5);
    return { result: Array.from(r4) };
  }
  async executeQueryForCount(e12, t5) {
    return { result: await this._queryEngine.executeQueryForCount(this._ensureQuery(e12), t5) };
  }
  async executeQueryForExtent(e12, t5) {
    return { result: await this._queryEngine.executeQueryForExtent(this._ensureQuery(e12), t5) };
  }
  async executeQueryForLatestObservations(e12, t5) {
    return { result: await this._queryEngine.executeQueryForLatestObservations(this._ensureQuery(e12), t5) };
  }
  async executeAttributeBinsQuery(e12, t5) {
    return { result: await this._queryEngine.executeAttributeBinsQuery(e12, t5) };
  }
  onTileTreeChange(e12) {
    return this._tileManager.onTileTreeChange(e12), Promise.resolve(j5);
  }
  async onElevationChange(e12) {
    return j5;
  }
  async onLayerViewOpacityChange(e12) {
    const { _context: t5, _renderer: r4 } = this;
    if (t5.layerViewInfo.fullOpacity = e12, null == r4) return j5;
    const a10 = await r4.createUpdateLayerViewOpacityCommand(e12);
    return await a10.execute(), j5;
  }
  async onRendererChange(r4) {
    const { _context: a10 } = this, n13 = a10.symbolRendererFactory.createSymbolRendererFromJSON(r4);
    await n13.load();
    const i5 = this._renderer;
    this._renderer = n13;
    const s13 = [...this._tileManager.loadedTiles()], o7 = s13.map((e12) => e12.tileId);
    {
      const r5 = { stack: [], error: void 0, hasError: false };
      try {
        __addDisposableResource(r5, await this._tileLocks.lock(o7), false);
        const t5 = s13.flatMap((e12) => [i5.createRemoveCommand(e12.id), n13.createAddCommand(e12)]), l7 = await Promise.all(t5), c8 = a10.joinPipelineCommands(l7);
        await c8.execute();
      } catch (c8) {
        r5.error = c8, r5.hasError = true;
      } finally {
        __disposeResources(r5);
      }
    }
    const l6 = await i5.createDestroyCommand();
    return await l6.execute(), j5;
  }
  async _createAddFeatureDataCommand(e12, t5) {
    const r4 = this._featureStore, a10 = this._renderer;
    let i5;
    return i5 = null != a10 ? await a10.createAddCommand(e12) : e7.create(this._renderCommandContext), s2(t5), i5.appendPipelineStateCommand(() => {
      r4.addTile(e12);
    }), i5;
  }
  async _createRemoveFeatureDataCommand(e12) {
    const t5 = this._featureStore, r4 = this._renderer;
    let a10;
    return a10 = null != r4 ? await r4.createRemoveCommand(e12) : e7.create(this._renderCommandContext), a10.appendPipelineStateCommand(() => {
      t5.removeTile(e12);
    }), a10;
  }
  async _createUpdateFeatureDataVisibilityCommand(e12, t5) {
    const r4 = this._renderer;
    let a10;
    return a10 = null != r4 ? await r4.createUpdateVisibilityCommand(e12) : e7.create(this._renderCommandContext), s2(t5), a10;
  }
  _ensureQuery(e12) {
    return e12 ?? this._defaultQueryJSON;
  }
};
__decorate([m2()], R.prototype, "updating", null), R = __decorate([a("esri.views.3d.layers.graphics.pipeline.Feature3DPipelineWorker")], R);
var S2 = R;
var j5 = { result: void 0 };
export {
  S2 as default
};
//# sourceMappingURL=Feature3DPipelineWorker-RUK7VR4N.js.map
