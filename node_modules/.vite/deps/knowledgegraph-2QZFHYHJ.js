import {
  n as n3,
  p as p2
} from "./chunk-ENONBBCJ.js";
import {
  p as p4
} from "./chunk-URFJA5XM.js";
import {
  e as e2,
  i,
  p as p3,
  p2 as p5
} from "./chunk-UOYGNM27.js";
import {
  l
} from "./chunk-6UYFHUML.js";
import {
  t
} from "./chunk-OOOA6BWY.js";
import {
  K,
  Ke,
  U,
  ee,
  ge,
  ie,
  ne,
  oe,
  p,
  re,
  z
} from "./chunk-AH42IBBP.js";
import "./chunk-ZGTANDVY.js";
import "./chunk-5LMO3VQI.js";
import "./chunk-ZHSPVODX.js";
import "./chunk-MDJNYPVI.js";
import "./chunk-Z6VKIQV2.js";
import {
  n
} from "./chunk-4PXNA4MD.js";
import "./chunk-GXJJY3ND.js";
import "./chunk-PLNHHGHL.js";
import "./chunk-QZQPB5XR.js";
import "./chunk-AQFRVV3U.js";
import "./chunk-GD4FJL3C.js";
import {
  c as c2,
  e,
  n as n2,
  o
} from "./chunk-C5OQVQZF.js";
import {
  G,
  L,
  W
} from "./chunk-2LC2762W.js";
import "./chunk-W6HOAVT4.js";
import "./chunk-DTZUXJMD.js";
import "./chunk-YLAGKT2D.js";
import "./chunk-6YRQYUCY.js";
import {
  k
} from "./chunk-W75DBJD7.js";
import "./chunk-75XOUSSS.js";
import "./chunk-TH4EQWJJ.js";
import {
  M
} from "./chunk-7P2ANHQ3.js";
import "./chunk-XCKT47LJ.js";
import "./chunk-3FUHCAX3.js";
import "./chunk-PZ5RULLK.js";
import "./chunk-OPJX4KXH.js";
import "./chunk-LTPHDYPK.js";
import "./chunk-3OVERDFX.js";
import "./chunk-FPMLKIDB.js";
import "./chunk-AZXJIEZ6.js";
import "./chunk-Q75WYS7K.js";
import "./chunk-H74Q4SYB.js";
import "./chunk-5UPBUJPC.js";
import "./chunk-4YDOPHTZ.js";
import "./chunk-YY5PITIH.js";
import "./chunk-7H3U4IJR.js";
import "./chunk-SMWUT52Z.js";
import {
  S,
  c,
  j
} from "./chunk-AXZMNHTN.js";
import {
  f
} from "./chunk-5T3MJDSR.js";
import "./chunk-NMQNUPE4.js";
import "./chunk-6KIXN4DJ.js";
import "./chunk-7DGJB37R.js";
import "./chunk-234CIOHE.js";
import "./chunk-V2H77UEV.js";
import "./chunk-WRA2WBYC.js";
import "./chunk-XWE6BM2U.js";
import "./chunk-SOIZOFSB.js";
import "./chunk-XXLHAM2M.js";
import "./chunk-5EI5H4QX.js";
import "./chunk-ZIE53VIV.js";
import "./chunk-SS5CLIUY.js";
import "./chunk-R54Q5TGA.js";
import "./chunk-6SSZNBOK.js";
import "./chunk-LZ2XTYP2.js";
import "./chunk-45CFSCQX.js";
import "./chunk-A5XN2VFT.js";
import "./chunk-65HD3WXL.js";
import "./chunk-4DGC7CBY.js";
import "./chunk-GNMPGHLQ.js";
import {
  s
} from "./chunk-QY7XKUIV.js";
import "./chunk-AL6YUTZM.js";
import "./chunk-G26ADAPQ.js";

// node_modules/@arcgis/core/arcade/functions/knowledgegraph.js
var J = null;
async function N(r) {
  const t2 = s.geometryServiceUrl ?? "";
  if (!t2) {
    G() || await L();
    for (const e3 of r) e3.container[e3.indexer] = W(e3.container[e3.indexer], f.WGS84);
    return;
  }
  const n4 = r.map((e3) => e3.container[e3.indexer]), o2 = new p2({ geometries: n4, outSpatialReference: f.WGS84 }), a = await n3(t2, o2);
  for (let e3 = 0; e3 < a.length; e3++) {
    const t3 = r[e3];
    t3.container[t3.indexer] = a[e3];
  }
}
async function F(e3, r) {
  const t2 = new k({ portal: e3, id: r });
  return await t2.load(), null === J && (J = await import("./knowledgeGraphService-R36XOM6E.js")), await J.fetchKnowledgeGraph(t2.url);
}
function M2(e3, r, t2, n4, o2) {
  if (null === e3) return null;
  if (e(e3) || n2(e3)) return e3;
  if (ne(e3)) return e3.toJSDate();
  if (ne(e3)) return e3.toJSDate();
  if (re(e3)) return e3.toStorageFormat();
  if (ie(e3)) return e3.toStorageString();
  if (K(e3)) {
    const a = {};
    for (const i2 of e3.keys()) a[i2] = M2(e3.field(i2), r, t2, n4, o2), a[i2] instanceof c && o2.push({ container: a, indexer: i2 });
    return a;
  }
  if (o(e3)) {
    const a = e3.map((e4) => M2(e4, r, t2, n4, o2));
    for (let e4 = 0; e4 < a.length; e4++) a[e4] instanceof c && o2.push({ container: a, indexer: e4 });
    return a;
  }
  return U(e3) ? e3.spatialReference.isWGS84 ? e3 : e3.spatialReference.isWebMercator && r ? S(e3) : e3 : void 0;
}
function Q(e3, r) {
  if (!e3) return e3;
  if (e3.spatialReference.isWGS84 && r.spatialReference.isWebMercator) return j(e3);
  if (e3.spatialReference.equals(r.spatialReference)) return e3;
  throw new n(r, "WrongSpatialReference", null);
}
function B(e3, r) {
  if (!e3) return null;
  const t2 = {};
  for (const n4 in e3) t2[n4] = E(e3[n4], r);
  return t2;
}
function E(e3, r) {
  return null === e3 ? null : o(e3) ? e3.map((e4) => E(e4, r)) : e3 instanceof p3 ? { graphTypeName: e3.typeName, id: e3.id, graphType: "entity", properties: B(e3.properties, r) } : e3 instanceof e2 ? { graphType: "object", properties: B(e3.properties, r) } : e3 instanceof i ? { graphTypeName: e3.typeName, id: e3.id, graphType: "relationship", originId: e3.originId ?? null, destinationId: e3.destinationId ?? null, properties: B(e3.properties, r) } : e3 instanceof p5 ? { graphType: "path", path: e3.path ? e3.path.map((e4) => E(e4, r)) : null } : U(e3) ? Q(e3, r) : e(e3) || n2(e3) || c2(e3) ? e3 : null;
}
function K2(e3) {
  "async" === e3.mode && (e3.functions.knowledgegraphbyportalitem = function(t2, i2) {
    return e3.standardFunctionAsync(t2, i2, (e4, s2, p6) => {
      if (oe(p6, 2, 2, t2, i2), null === p6[0]) throw new n(t2, "PortalRequired", i2);
      if (p6[0] instanceof t) {
        const e5 = ge(p6[1]);
        let r;
        r = t2.services?.portal ? t2.services.portal : M.getDefault();
        return F(l(p6[0], r), e5);
      }
      if (false === e(p6[0])) throw new n(t2, "InvalidParameter", i2);
      const l2 = ge(p6[0]);
      return F(t2.services?.portal ?? M.getDefault(), l2);
    });
  }, e3.signatures.push({ name: "knowledgegraphbyportalitem", min: 2, max: 2 }), e3.functions.querygraph = function(r, a) {
    return e3.standardFunctionAsync(r, a, async (e4, l2, c3) => {
      oe(c3, 2, 4, r, a);
      const f2 = c3[0];
      if (!ee(f2)) throw new n(r, "InvalidParameter", a);
      const u = c3[1];
      if (!e(u)) throw new n(r, "InvalidParameter", a);
      null === J && (J = await import("./knowledgeGraphService-R36XOM6E.js"));
      let m = null;
      const d = z(c3[2], null);
      if (!(d instanceof p || null === d)) throw new n(r, "InvalidParameter", a);
      if (d) {
        let e5 = [];
        m = M2(d, true, false, r, e5), e5 = e5.filter((e6) => !e6.container[e6.indexer].spatialReference.isWGS84), e5.length > 0 && await N(e5);
      }
      const h = z(c3[3], false), g = new p4({ openCypherQuery: u, bindParameters: m, provenanceBehavior: h ? "include" : "exclude" });
      (f2?.serviceDefinition?.currentVersion ?? 11.3) > 11.2 && (g.outputSpatialReference = r.spatialReference);
      const w = (await J.executeQueryStreaming(f2, g)).resultRowsStream.getReader(), y = [];
      try {
        for (; ; ) {
          const { done: e5, value: t2 } = await w.read();
          if (e5) break;
          if (o(t2)) for (const n4 of t2) y.push(E(n4, r));
          else {
            const e6 = [];
            for (const n4 of t2) e6.push(E(t2[n4], r));
            y.push(e6);
          }
        }
      } catch (j2) {
        throw j2;
      }
      return p.convertJsonToArcade(y, Ke(r), false, true);
    });
  }, e3.signatures.push({ name: "querygraph", min: 2, max: 4 }));
}
export {
  K2 as registerFunctions
};
//# sourceMappingURL=knowledgegraph-2QZFHYHJ.js.map
