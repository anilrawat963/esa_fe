import {
  S
} from "./chunk-ZP6KSK4N.js";
import "./chunk-6KSMNSLR.js";
import {
  b,
  j,
  v
} from "./chunk-JBTWCDRR.js";
import {
  I,
  lt,
  q2,
  z
} from "./chunk-U6CJFTOF.js";
import "./chunk-2JMKFI2D.js";
import "./chunk-QYAMBIRP.js";
import "./chunk-JHV6OBEB.js";
import {
  g as g2
} from "./chunk-RJMNQ6EU.js";
import "./chunk-XPA3C4DZ.js";
import "./chunk-2AOVWXAQ.js";
import "./chunk-ALR6N4CF.js";
import "./chunk-4X4BOGIG.js";
import "./chunk-Y4O7HJXV.js";
import "./chunk-7QPS6ATI.js";
import "./chunk-YYXR3KOD.js";
import "./chunk-NDFIZYZY.js";
import "./chunk-TLTSPUO7.js";
import "./chunk-ZVTEFYZX.js";
import "./chunk-LPUPM55U.js";
import "./chunk-QNVJVDYZ.js";
import "./chunk-WDTGOP77.js";
import {
  g,
  p,
  q,
  u
} from "./chunk-VYMBX5H5.js";
import "./chunk-K2OZ6WVC.js";
import "./chunk-XLOINTMG.js";
import {
  n,
  t
} from "./chunk-75XOUSSS.js";
import "./chunk-LTPHDYPK.js";
import "./chunk-3OVERDFX.js";
import "./chunk-AZXJIEZ6.js";
import "./chunk-Q75WYS7K.js";
import "./chunk-SMWUT52Z.js";
import {
  a2 as a
} from "./chunk-ZIE53VIV.js";
import {
  __decorate
} from "./chunk-SS5CLIUY.js";
import "./chunk-6SSZNBOK.js";
import "./chunk-LZ2XTYP2.js";
import "./chunk-A5XN2VFT.js";
import "./chunk-4DGC7CBY.js";
import {
  s
} from "./chunk-GNMPGHLQ.js";
import "./chunk-QY7XKUIV.js";
import "./chunk-AL6YUTZM.js";
import "./chunk-G26ADAPQ.js";

// node_modules/@arcgis/core/views/interactive/snapping/featureSources/sceneLayerSource/sceneLayerSnappingUtils.js
var n2 = 1e3;
function a2(t2, n3, a3) {
  const m = i;
  g(m, t2, 0.5), q(m, m, n3, 0.5);
  const f = p(m, t2);
  return u(m, m, a3), q2(m, f);
}
var i = n();

// node_modules/@arcgis/core/views/interactive/snapping/featureSources/sceneLayerSource/SceneLayerSnappingSourceWorker.js
var _ = class {
  constructor() {
    this._idToComponent = /* @__PURE__ */ new Map(), this._components = new S((e) => e.bounds), this._edges = new S((e) => e.bounds), this._tmpLineSegment = v(), this._tmpP1 = n(), this._tmpP2 = n(), this._tmpP3 = n(), this.remoteClient = null;
  }
  async fetchCandidates(e, o) {
    await Promise.resolve(), s(o), await this._ensureEdgeLocations(e, o);
    const s2 = [];
    return this._edges.forEachNeighbor((t2) => (this._addCandidates(e, t2, s2), s2.length < n2), e.bounds), { result: { candidates: s2 } };
  }
  async _ensureEdgeLocations(e, t2) {
    const o = [];
    if (this._components.forEachNeighbor((e2) => {
      if (null == e2.info) {
        const { id: t3, uid: s3 } = e2;
        o.push({ id: t3, uid: s3 });
      }
      return true;
    }, e.bounds), !o.length) return;
    const s2 = { components: o }, n3 = await this.remoteClient.invoke("fetchAllEdgeLocations", s2, t2 ?? {});
    for (const i2 of n3.components) this._setFetchEdgeLocations(i2);
  }
  async add(e) {
    const t2 = new w(e.id, e.bounds);
    return this._idToComponent.set(t2.id, t2), this._components.add([t2]), { result: {} };
  }
  async remove(e) {
    const t2 = this._idToComponent.get(e.id);
    if (t2) {
      const e2 = [];
      this._edges.forEachNeighbor((o) => (o.component === t2 && e2.push(o), true), t2.bounds), this._edges.remove(e2), this._components.remove([t2]), this._idToComponent.delete(t2.id);
    }
    return { result: {} };
  }
  _setFetchEdgeLocations(e) {
    const t2 = this._idToComponent.get(e.id);
    if (null == t2 || e.uid !== t2.uid) return;
    const o = g2.createView(e.locations), s2 = new Array(o.count), n3 = n(), r = n();
    for (let i2 = 0; i2 < o.count; i2++) {
      o.position0.getVec(i2, n3), o.position1.getVec(i2, r);
      const c2 = a2(n3, r, e.origin), d2 = new C(t2, i2, c2);
      s2[i2] = d2;
    }
    this._edges.add(s2);
    const { objectIds: c, origin: d } = e;
    t2.info = { locations: o, objectIds: c, origin: d };
  }
  _addCandidates(e, t2, o) {
    const { info: n3 } = t2.component, { origin: i2, objectIds: r } = n3, c = n3.locations, d = c.position0.getVec(t2.index, this._tmpP1), a3 = c.position1.getVec(t2.index, this._tmpP2);
    u(d, d, i2), u(a3, a3, i2);
    const p2 = r[c.componentIndex.get(t2.index)];
    this._addEdgeCandidate(e, p2, d, a3, o), j2(e, p2, d, o), j2(e, p2, a3, o);
  }
  _addEdgeCandidate(e, t2, o, s2, i2) {
    if (!e.returnEdge) return;
    const c = z(e.bounds, E), u2 = b(o, s2, this._tmpLineSegment), h = j(u2, c, this._tmpP3);
    lt(e.bounds, h) && i2.push({ type: "edge", objectId: t2, target: t(h), distance: p(c, h), start: t(o), end: t(s2) });
  }
};
_ = __decorate([a("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker")], _);
var b2 = _;
function j2(e, t2, o, s2) {
  e.returnVertex && lt(e.bounds, o) && s2.push({ type: "vertex", objectId: t2, target: t(o), distance: p(I(e.bounds), o) });
}
var _w = class _w {
  constructor(e, t2) {
    this.id = e, this.bounds = t2, this.info = null, this.uid = ++_w.uid;
  }
};
_w.uid = 0;
var w = _w;
var C = class {
  constructor(e, t2, o) {
    this.component = e, this.index = t2, this.bounds = o;
  }
};
var E = n();
export {
  b2 as default
};
//# sourceMappingURL=SceneLayerSnappingSourceWorker-SJYMYFA2.js.map
