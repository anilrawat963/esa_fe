import {
  n,
  o as o2,
  r as r2
} from "./chunk-JSXEZOD4.js";
import {
  P,
  S,
  i as i4
} from "./chunk-VAWLO3Y4.js";
import {
  r as r3
} from "./chunk-QCJFPBRP.js";
import {
  o
} from "./chunk-GD2WNXFD.js";
import "./chunk-JQJENO7I.js";
import "./chunk-P77QHDEC.js";
import "./chunk-2I7JAYEU.js";
import "./chunk-KRLDYUK3.js";
import {
  O as O2
} from "./chunk-UQ4NKDVH.js";
import {
  r as r4
} from "./chunk-ZS4Q4DJE.js";
import "./chunk-6SXRWZMX.js";
import "./chunk-N3OIGAM3.js";
import "./chunk-E77VVW2C.js";
import "./chunk-PG3227VO.js";
import "./chunk-62W3XEE6.js";
import "./chunk-2XM57LB5.js";
import {
  i as i3
} from "./chunk-UXLDVCDU.js";
import "./chunk-JGWZMI5Q.js";
import "./chunk-43423NKQ.js";
import {
  b
} from "./chunk-T5PAMHK6.js";
import {
  d as d2
} from "./chunk-PZZ55S55.js";
import "./chunk-ALLCMCHO.js";
import "./chunk-NNZE65VM.js";
import "./chunk-RZOWZMPW.js";
import "./chunk-7LPDSYJP.js";
import "./chunk-MJIAJDWR.js";
import "./chunk-RRK2YVM5.js";
import "./chunk-VIDAPS4J.js";
import "./chunk-INJCHY4H.js";
import "./chunk-G7FTSXBC.js";
import "./chunk-QTS3W27E.js";
import "./chunk-3RABUJDL.js";
import "./chunk-FDSAQJ3R.js";
import "./chunk-WJ3E33GQ.js";
import "./chunk-CFXCM2NO.js";
import "./chunk-U3B7YMY7.js";
import "./chunk-XMUWUWWP.js";
import "./chunk-F75XORHS.js";
import "./chunk-2U5X5TIX.js";
import "./chunk-27W5ILTF.js";
import "./chunk-2GRS3IMC.js";
import "./chunk-YYGF76T3.js";
import "./chunk-GVFNGMIY.js";
import "./chunk-RQGBRVDD.js";
import "./chunk-JPZOLUPV.js";
import "./chunk-DRHU543D.js";
import "./chunk-F7RQDGE7.js";
import "./chunk-GG4AQJJO.js";
import "./chunk-OGWYK5MD.js";
import "./chunk-4V63WUXV.js";
import "./chunk-TWE24CRT.js";
import "./chunk-Y3GEZC7J.js";
import "./chunk-U5TTP5E5.js";
import "./chunk-CXUJAI27.js";
import "./chunk-VR2ODL2Y.js";
import "./chunk-QENBEP2X.js";
import "./chunk-VZQ643XD.js";
import "./chunk-SMJWJAIA.js";
import "./chunk-WFCLXKCE.js";
import "./chunk-FHCV4NTV.js";
import "./chunk-M5JMVUW2.js";
import "./chunk-SIUG2XLL.js";
import "./chunk-XTEXJOLG.js";
import "./chunk-NH6FXYCM.js";
import "./chunk-YE4E5JCT.js";
import "./chunk-SXZO7ULH.js";
import "./chunk-VNSHGTPN.js";
import "./chunk-S5ZM63JC.js";
import "./chunk-XHNYLMJC.js";
import "./chunk-NHFKDWOM.js";
import "./chunk-ALR6N4CF.js";
import "./chunk-4X4BOGIG.js";
import "./chunk-IOJ4QFRL.js";
import "./chunk-EK7HOTRR.js";
import "./chunk-ODQ5APZK.js";
import "./chunk-BA6HYZ35.js";
import "./chunk-VGXUPJSS.js";
import "./chunk-ZVTEFYZX.js";
import "./chunk-LPUPM55U.js";
import "./chunk-IRBX64M6.js";
import "./chunk-2HGIYEIL.js";
import "./chunk-XX3OKYJS.js";
import "./chunk-OTCNIJ2H.js";
import "./chunk-JGA5YJWL.js";
import "./chunk-GCI4MA3M.js";
import "./chunk-SJ2OBYX2.js";
import "./chunk-MDJNYPVI.js";
import "./chunk-Z6VKIQV2.js";
import "./chunk-4PXNA4MD.js";
import "./chunk-73FJYU43.js";
import "./chunk-3BNOOWTA.js";
import "./chunk-AIJLLSRB.js";
import "./chunk-IXRRTVLJ.js";
import "./chunk-EKM7KERW.js";
import "./chunk-WKTI47FV.js";
import "./chunk-T3SYSTKO.js";
import "./chunk-HOJHSMLY.js";
import "./chunk-6RE6OSTE.js";
import "./chunk-QSGJ3ECU.js";
import "./chunk-LQPKVYW2.js";
import "./chunk-U55FA2EK.js";
import "./chunk-GBN36VHC.js";
import {
  p,
  r
} from "./chunk-ZSZK67ZL.js";
import "./chunk-IPWH4LK2.js";
import {
  h
} from "./chunk-7CDU3B2L.js";
import "./chunk-B5A4L35M.js";
import "./chunk-52SEOH5H.js";
import {
  e as e2
} from "./chunk-JUZ3H47H.js";
import "./chunk-UYMV6HXW.js";
import "./chunk-AJGINJLG.js";
import "./chunk-JE2NJSBU.js";
import "./chunk-QNVJVDYZ.js";
import "./chunk-WDTGOP77.js";
import "./chunk-VYMBX5H5.js";
import "./chunk-BPTFV5VM.js";
import "./chunk-647DAMHU.js";
import "./chunk-O6G3PPOK.js";
import "./chunk-ZKNZTIAS.js";
import "./chunk-OJMISN3F.js";
import "./chunk-EFV6H5NA.js";
import {
  f
} from "./chunk-XDLV73DB.js";
import "./chunk-ARTU4L55.js";
import "./chunk-6VL5D5UP.js";
import "./chunk-6QHY54HZ.js";
import "./chunk-GXJJY3ND.js";
import "./chunk-5ONGWFJ3.js";
import "./chunk-PLNHHGHL.js";
import "./chunk-DFK6QMLO.js";
import "./chunk-4WTOIJXV.js";
import "./chunk-BBYMM7CM.js";
import "./chunk-EM7Y2JZC.js";
import "./chunk-QZQPB5XR.js";
import "./chunk-AQFRVV3U.js";
import "./chunk-BUQC3CLV.js";
import "./chunk-63LDVRFI.js";
import {
  i as i2
} from "./chunk-TJTOV6JD.js";
import "./chunk-C3FRY5U4.js";
import "./chunk-JNJX34GB.js";
import "./chunk-3STJRSDT.js";
import "./chunk-67Q6KVC6.js";
import "./chunk-23NJHA5Q.js";
import "./chunk-4LA6K4VI.js";
import "./chunk-KEZCWFAR.js";
import "./chunk-JZUJ34RR.js";
import "./chunk-PMGS7UDU.js";
import "./chunk-3GHCGAH2.js";
import "./chunk-HWUOAPTX.js";
import "./chunk-QHCKOBU7.js";
import "./chunk-K2OZ6WVC.js";
import "./chunk-MC6NAKKX.js";
import "./chunk-TF6255HN.js";
import "./chunk-GD4FJL3C.js";
import "./chunk-C5OQVQZF.js";
import "./chunk-F7DKSAOI.js";
import "./chunk-4SOQWNPG.js";
import "./chunk-LTULADK2.js";
import "./chunk-35ST7YRB.js";
import "./chunk-EDA5QFHZ.js";
import "./chunk-XL5QPCXN.js";
import "./chunk-2LC2762W.js";
import "./chunk-W6HOAVT4.js";
import "./chunk-DTZUXJMD.js";
import "./chunk-YLAGKT2D.js";
import "./chunk-6YRQYUCY.js";
import "./chunk-UDHS2MGH.js";
import "./chunk-MHV23XAQ.js";
import "./chunk-V2X4OKYI.js";
import "./chunk-LPZUGJNG.js";
import "./chunk-XLOINTMG.js";
import "./chunk-MA3QDRC3.js";
import "./chunk-W6J7XCPU.js";
import "./chunk-ONXWBTTM.js";
import "./chunk-T7F6Q6JJ.js";
import "./chunk-YDTPM7OQ.js";
import "./chunk-75XOUSSS.js";
import "./chunk-TH4EQWJJ.js";
import "./chunk-7P2ANHQ3.js";
import "./chunk-XCKT47LJ.js";
import "./chunk-3FUHCAX3.js";
import "./chunk-PZ5RULLK.js";
import "./chunk-OPJX4KXH.js";
import "./chunk-LTPHDYPK.js";
import "./chunk-3OVERDFX.js";
import "./chunk-FPMLKIDB.js";
import "./chunk-AZXJIEZ6.js";
import "./chunk-Q75WYS7K.js";
import "./chunk-H74Q4SYB.js";
import "./chunk-2OFHDVO5.js";
import "./chunk-TFJXG32O.js";
import "./chunk-DDOCCRD4.js";
import "./chunk-5UPBUJPC.js";
import "./chunk-THQO67BJ.js";
import "./chunk-4YDOPHTZ.js";
import "./chunk-YY5PITIH.js";
import "./chunk-CCQFL76O.js";
import "./chunk-CSMCPN64.js";
import "./chunk-GY6YF4EN.js";
import "./chunk-7H3U4IJR.js";
import "./chunk-SMWUT52Z.js";
import "./chunk-AXZMNHTN.js";
import "./chunk-5T3MJDSR.js";
import {
  T
} from "./chunk-NMQNUPE4.js";
import "./chunk-6KIXN4DJ.js";
import "./chunk-7DGJB37R.js";
import "./chunk-234CIOHE.js";
import "./chunk-V2H77UEV.js";
import "./chunk-WRA2WBYC.js";
import "./chunk-XWE6BM2U.js";
import "./chunk-SOIZOFSB.js";
import "./chunk-XXLHAM2M.js";
import {
  m
} from "./chunk-5EI5H4QX.js";
import {
  a2 as a
} from "./chunk-ZIE53VIV.js";
import {
  __decorate
} from "./chunk-SS5CLIUY.js";
import "./chunk-R54Q5TGA.js";
import "./chunk-6SSZNBOK.js";
import "./chunk-LZ2XTYP2.js";
import "./chunk-45CFSCQX.js";
import "./chunk-A5XN2VFT.js";
import "./chunk-65HD3WXL.js";
import "./chunk-4DGC7CBY.js";
import {
  O,
  d,
  e
} from "./chunk-GNMPGHLQ.js";
import {
  i3 as i
} from "./chunk-QY7XKUIV.js";
import "./chunk-AL6YUTZM.js";
import "./chunk-G26ADAPQ.js";

// node_modules/@arcgis/core/views/2d/layers/TileLayerView2D.js
var I = [0, 0];
var P2 = class extends i3(r2(b(d2))) {
  constructor() {
    super(...arguments), this._fetchQueue = null, this._highlightGraphics = new i2(), this._highlightView = null, this._popupHighlightHelper = null, this._tileStrategy = null, this.layer = null;
  }
  get resampling() {
    return !("resampling" in this.layer) || false !== this.layer.resampling;
  }
  get tilemapCache() {
    return "tilemapCache" in this.layer ? this.layer.tilemapCache : null;
  }
  update(e3) {
    this._fetchQueue.pause(), this._fetchQueue.state = e3.state, this._tileStrategy.update(e3), this._fetchQueue.resume(), this._highlightView?.processUpdate(e3);
  }
  attach() {
    const e3 = "tileServers" in this.layer ? this.layer.tileServers : null, i5 = this.tilemapCache;
    if (this._tileInfoView = new h(this.layer.tileInfo, this.layer.fullExtent, i5?.effectiveMinLOD, i5?.effectiveMaxLOD), this._fetchQueue = new p({ tileInfoView: this._tileInfoView, concurrency: e3 && 10 * e3.length || 10, process: (e4, i6) => this.fetchTile(e4, i6), scheduler: this.scheduler, priority: f.MAPVIEW_FETCH_QUEUE }), this._tileStrategy = new r({ cachePolicy: "keep", resampling: this.resampling, acquireTile: (e4) => this.acquireTile(e4), releaseTile: (e4) => this.releaseTile(e4), tileInfoView: this._tileInfoView }), S(this, this.layer)) {
      const e4 = this._highlightView = new O2({ view: this.view, graphics: this._highlightGraphics, requestUpdateCallback: () => this.requestUpdate(), container: new o(this.view.featuresTilingScheme), defaultPointSymbolEnabled: false });
      this.container.addChild(this._highlightView.container), this._popupHighlightHelper = new P({ createFetchPopupFeaturesQueryGeometry: (e5, i6) => r3(e5, i6, this.view), highlightGraphics: this._highlightGraphics, highlightGraphicUpdated: ({ graphic: i6, property: t }) => e4.graphicUpdateHandler({ graphic: i6, property: t }), layerView: this, updatingHandles: this._updatingHandles });
    }
    this.requestUpdate(), this.addAttachHandles(this._updatingHandles.add(() => this.resampling, () => {
      this.doRefresh();
    })), super.attach();
  }
  detach() {
    super.detach(), this._tileStrategy.destroy(), this._fetchQueue.clear(), this.container.removeAllChildren(), this._popupHighlightHelper?.destroy(), this._highlightView?.destroy(), this._fetchQueue = this._tileStrategy = this._tileInfoView = this._popupHighlightHelper = null;
  }
  async fetchPopupFeaturesAtLocation(e3, i5) {
    return this._popupHighlightHelper ? this._popupHighlightHelper.fetchPopupFeaturesAtLocation(e3, i5) : [];
  }
  highlight(e3, t) {
    const s = i4(e3);
    if (0 === s.length) return e();
    const r5 = r4(t);
    return this._addHighlightGraphics(s, r5), e(() => !this.destroyed && this._removeHighlightGraphics(s, r5));
  }
  _processHighlight() {
    const e3 = this._getHighlights();
    this._highlightView?.setHighlight(e3);
  }
  _addHighlightGraphics(e3, i5) {
    this._highlightGraphics.addMany(e3), this._addHighlights(e3.map((e4) => e4.uid), i5);
  }
  _removeHighlightGraphics(e3, i5) {
    this._highlightGraphics.removeMany(e3), this._removeHighlights(e3.map((e4) => e4.uid), i5);
  }
  viewChange() {
    this.requestUpdate();
  }
  moveEnd() {
    this.requestUpdate();
  }
  supportsSpatialReference(e3) {
    return T(this.layer.tileInfo?.spatialReference, e3);
  }
  async doRefresh() {
    if (this.attached) {
      if (this.suspended) return this._tileStrategy.clear(), void this.requestUpdate();
      this._fetchQueue.reset(), this._tileStrategy.refresh((e3) => this._updatingHandles.addPromise(this._enqueueTileFetch(e3)));
    }
  }
  acquireTile(e3) {
    const i5 = this._bitmapView.createTile(e3), t = i5.bitmap;
    return [t.x, t.y] = this._tileInfoView.getTileCoords(I, i5.key), t.resolution = this._tileInfoView.getTileResolution(i5.key), [t.width, t.height] = this._tileInfoView.tileInfo.size, this._updatingHandles.addPromise(this._enqueueTileFetch(i5)), this._bitmapView.addChild(i5), this.requestUpdate(), i5;
  }
  releaseTile(e3) {
    this._fetchQueue.abort(e3.key.id), this._bitmapView.removeChild(e3), e3.once("detach", () => e3.destroy()), this.requestUpdate();
  }
  async fetchTile(e3, i5 = {}) {
    return this.tilemapCache ? this._fetchTileWithTilemapCache(e3, i5) : this._fetchTileWithoutTilemapCache(e3, i5);
  }
  async _fetchTileWithoutTilemapCache(e3, i5 = {}) {
    const { signal: t, resamplingLevel: r5 = 0 } = i5;
    try {
      return await this._fetchImage(e3, t);
    } catch (o3) {
      if (d(o3)) throw o3;
      if (!this.resampling) return o2(this._tileInfoView.tileInfo.size);
      if (r5 < 3) {
        const t2 = this._tileInfoView.getTileParentId(e3.id);
        if (t2) {
          const s = new e2(t2), o4 = await this._fetchTileWithoutTilemapCache(s, { ...i5, resamplingLevel: r5 + 1 });
          return n(this._tileInfoView, o4, s, e3);
        }
      }
      return o2(this._tileInfoView.tileInfo.size);
    }
  }
  async _fetchTileWithTilemapCache(e3, i5 = {}) {
    const t = this.tilemapCache, { signal: o3, resamplingLevel: l = 0 } = i5, h2 = new e2(0, 0, 0, 0);
    let a2, p2 = null;
    try {
      if (p2 = await t.fetchAvailabilityUpsample(e3.level, e3.row, e3.col, h2, { signal: o3 }), !this.resampling && h2.level !== e3.level) return await O(i5), o2(this._tileInfoView.tileInfo.size);
      a2 = await this._fetchImage(h2, o3);
    } catch (n2) {
      if (d(n2)) throw n2;
      if (this.resampling && "unknown" === p2 && l < 3) {
        const t2 = this._tileInfoView.getTileParentId(e3.id);
        if (t2) {
          h2.set(t2);
          try {
            a2 = await this._fetchTileWithTilemapCache(h2, { ...i5, resamplingLevel: l + 1 });
          } catch {
          }
        }
      }
    }
    return a2 ? this.resampling ? n(this._tileInfoView, a2, h2, e3) : a2 : o2(this._tileInfoView.tileInfo.size);
  }
  async _enqueueTileFetch(e3) {
    if (!this._fetchQueue.has(e3.key.id)) {
      try {
        const i5 = await this._fetchQueue.push(e3.key);
        e3.bitmap.source = i5, e3.bitmap.width = this._tileInfoView.tileInfo.size[0], e3.bitmap.height = this._tileInfoView.tileInfo.size[1], e3.once("attach", () => this.requestUpdate());
      } catch (i5) {
        d(i5) || i.getLogger(this).error(i5);
      }
      this.requestUpdate();
    }
  }
  async _fetchImage(e3, i5) {
    return this.layer.fetchImageBitmapTile(e3.level, e3.row, e3.col, { signal: i5 });
  }
};
__decorate([m()], P2.prototype, "resampling", null), __decorate([m()], P2.prototype, "tilemapCache", null), P2 = __decorate([a("esri.views.2d.layers.TileLayerView2D")], P2);
var v = P2;
export {
  v as default
};
//# sourceMappingURL=TileLayerView2D-VJEFORLO.js.map
