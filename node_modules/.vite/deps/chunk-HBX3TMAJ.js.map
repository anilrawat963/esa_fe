{
  "version": 3,
  "sources": ["../../@arcgis/core/chunks/Pattern.glsl.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{SliceDraw as e}from\"../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl.js\";import{Transform as o}from\"../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl.js\";import{ObjectAndLayerIdColor as r}from\"../views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl.js\";import{VertexColor as t}from\"../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl.js\";import{terrainDepthTest as a}from\"../views/3d/webgl-engine/core/shaderLibrary/shading/TerrainDepthTest.glsl.js\";import{VisualVariables as i}from\"../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl.js\";import{ColorConversion as n}from\"../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl.js\";import{addProjViewLocalOrigin as l,addCameraPosition as c}from\"../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl.js\";import{Float4PassUniform as d}from\"../views/3d/webgl-engine/core/shaderModules/Float4PassUniform.js\";import{FloatBindUniform as s}from\"../views/3d/webgl-engine/core/shaderModules/FloatBindUniform.js\";import{glsl as v,If as p}from\"../views/3d/webgl-engine/core/shaderModules/glsl.js\";import{outputColorHighlightOID as m}from\"../views/3d/webgl-engine/shaders/OutputColorHighlightOID.glsl.js\";import{ShaderBuilder as g}from\"../views/webgl/ShaderBuilder.js\";const u=.70710678118,f=u,w=.08715574274,b=10,h=1;function y(y){const x=new g,{vertex:j,fragment:C,attributes:V,varyings:R}=x,P=9===y.output;l(j,y),x.include(o),x.include(t,y),x.include(i,y),x.include(r,y),x.fragment.include(e,y),x.include(m,y),x.include(a,y),y.draped?j.uniforms.add(new s(\"worldToScreenRatio\",e=>1/e.screenToPCSRatio)):V.add(\"boundingRect\",\"mat3\"),V.add(\"position\",\"vec3\"),V.add(\"uvMapSpace\",\"vec4\"),y.hasVVColor&&V.add(\"colorFeatureAttribute\",\"float\"),y.hasVertexColors||R.add(\"vColor\",\"vec4\"),R.add(\"vpos\",\"vec3\",{invariant:!0}),R.add(\"vuv\",\"vec2\"),j.uniforms.add(new d(\"uColor\",e=>e.color));const T=3===y.style||4===y.style||5===y.style;return T&&j.code.add(v`\n      const mat2 rotate45 = mat2(${v.float(u)}, ${v.float(-f)},\n                                 ${v.float(f)}, ${v.float(u)});\n    `),y.draped||(c(j,y),j.uniforms.add(new s(\"worldToScreenPerDistanceRatio\",e=>1/e.camera.perScreenPixelRatio)),j.code.add(v`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {\nfloat projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);\nreturn center + halfVector * clamp(projectedLength, -1.0, 1.0);\n}`),j.code.add(v`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {\nfloat d = dot(planeNormal, planePoint);\nfloat t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);\nreturn rayOrigin + t * rayDir;\n}`),j.code.add(v`\n      float boundingRectDistanceToCamera() {\n        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);\n        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);\n        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);\n        vec3 n = normalize(cross(halfU, halfV));\n\n        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);\n\n        float viewAngle = dot(viewDir, n);\n        float minViewAngle = ${v.float(w)};\n\n        if (abs(viewAngle) < minViewAngle) {\n          // view direction is (almost) parallel to plane -> clamp it to min angle\n          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;\n          viewDir = normalize(viewDir + normalComponent * n);\n        }\n\n        // intersect view direction with infinite plane that contains bounding rect\n        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);\n\n        // clip to bounds by projecting to u and v line segments individually\n        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);\n        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);\n\n        // use to calculate the closest point to camera on bounding rect\n        vec3 closestPoint = uProjected + vProjected - center;\n\n        return length(closestPoint - cameraPosition);\n      }\n    `)),j.code.add(v`\n    vec2 scaledUV() {\n      vec2 uv = uvMapSpace.xy ${p(T,\" * rotate45\")};\n      vec2 uvCellOrigin = uvMapSpace.zw ${p(T,\" * rotate45\")};\n\n      ${p(!y.draped,v`float distanceToCamera = boundingRectDistanceToCamera();\n               float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;`)}\n\n      // Logarithmically discretize ratio to avoid jittering\n      float step = 0.1;\n      float discreteWorldToScreenRatio = log(worldToScreenRatio);\n      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;\n      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);\n\n      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${v.float(b)});\n      return uvOffset + (uv * discreteWorldToScreenRatio);\n    }\n  `),j.main.add(v`\n    vuv = scaledUV();\n    vpos = position;\n    forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);\n    forwardNormalizedVertexColor();\n    forwardObjectAndLayerIdColor();\n    ${y.hasVertexColors?\"vColor *= uColor;\":y.hasVVColor?\"vColor = uColor * interpolateVVColor(colorFeatureAttribute);\":\"vColor = uColor;\"}\n    gl_Position = transformPosition(proj, view, vpos);\n  `),C.include(n),y.draped&&C.uniforms.add(new s(\"texelSize\",e=>1/e.camera.pixelRatio)),P||(C.code.add(v`\n      const float lineWidth = ${v.float(h)};\n      const float spacing = ${v.float(b)};\n      const float spacingINV = ${v.float(1/b)};\n\n      float coverage(float p, float txlSize) {\n        p = mod(p, spacing);\n\n        float halfTxlSize = txlSize / 2.0;\n\n        float start = p - halfTxlSize;\n        float end = p + halfTxlSize;\n\n        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;\n        coverage -= min(lineWidth, mod(start, spacing));\n        coverage -= max(lineWidth - mod(end, spacing), 0.0);\n\n        return coverage / txlSize;\n      }\n    `),y.draped||C.code.add(v`const int maxSamples = 5;\nfloat sampleAA(float p) {\nvec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));\nfloat fwidth = dxdy.x + dxdy.y;\nivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));\nvec2 invSamples = 1.0 / vec2(samples);\nfloat accumulator = 0.0;\nfor (int j = 0; j < maxSamples; j++) {\nif(j >= samples.y) {\nbreak;\n}\nfor (int i = 0; i < maxSamples; i++) {\nif(i >= samples.x) {\nbreak;\n}\nvec2 step = vec2(i,j) * invSamples - 0.5;\naccumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);\n}\n}\naccumulator /= float(samples.x * samples.y);\nreturn accumulator;\n}`)),C.main.add(v`\n    discardBySlice(vpos);\n    discardByTerrainDepth();\n    vec4 color = vColor;\n    ${p(!P,v`color.a *= ${S(y)};`)}\n    outputColorHighlightOID(color, vpos, color.rgb);\n  `),x}function S(e){function o(o){return e.draped?v`coverage(vuv.${o}, texelSize)`:v`sampleAA(vuv.${o})`}switch(e.style){case 3:case 0:return o(\"y\");case 4:case 1:return o(\"x\");case 5:case 2:return v`1.0 - (1.0 - ${o(\"x\")}) * (1.0 - ${o(\"y\")})`;default:return\"0.0\"}}const x=Object.freeze(Object.defineProperty({__proto__:null,build:y},Symbol.toStringTag,{value:\"Module\"}));export{x as P,y as b};\n"],
  "mappings": "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",
  "names": ["u", "f", "y", "x", "r", "d", "n", "e", "o"]
}
