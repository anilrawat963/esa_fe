import {
  O,
  _
} from "./chunk-K5O7EA6J.js";
import {
  R,
  j as j2,
  w
} from "./chunk-GD72EK2J.js";
import "./chunk-NFPLS75J.js";
import {
  a as a3,
  d as d2,
  d2 as d3,
  u
} from "./chunk-GG6AO7V3.js";
import "./chunk-WVAXXVEK.js";
import "./chunk-NJSGYS3K.js";
import "./chunk-A7O5R67Z.js";
import {
  s as s4
} from "./chunk-RGWH5UES.js";
import {
  o as o3
} from "./chunk-SL3GC7WV.js";
import {
  l as l3
} from "./chunk-CJZPTLIZ.js";
import {
  d
} from "./chunk-UVDECGZC.js";
import {
  o as o2,
  s as s2
} from "./chunk-VKFTCFFM.js";
import {
  s as s3
} from "./chunk-ZETARPSI.js";
import {
  b2 as b,
  d as d4,
  l as l4,
  m as m3
} from "./chunk-CZOYDK6P.js";
import "./chunk-BGIBV6LL.js";
import "./chunk-UQXJMFRI.js";
import {
  j
} from "./chunk-6TCXGIIN.js";
import {
  l
} from "./chunk-NP2TBOXH.js";
import "./chunk-HROH5C5D.js";
import "./chunk-H34D76ZQ.js";
import "./chunk-CBCHZD3F.js";
import "./chunk-2HGIYEIL.js";
import "./chunk-Z6VKIQV2.js";
import "./chunk-ET5EDAFM.js";
import {
  m as m2
} from "./chunk-QZQPB5XR.js";
import "./chunk-AQFRVV3U.js";
import {
  t
} from "./chunk-W5S3VUFT.js";
import "./chunk-7YH7T6CS.js";
import "./chunk-3T4IXPP4.js";
import "./chunk-XTZAIV4X.js";
import "./chunk-63LDVRFI.js";
import {
  i4 as i2,
  n2,
  q
} from "./chunk-JNJX34GB.js";
import "./chunk-3STJRSDT.js";
import "./chunk-67Q6KVC6.js";
import "./chunk-MC6NAKKX.js";
import "./chunk-TF6255HN.js";
import "./chunk-C5OQVQZF.js";
import "./chunk-NPYFNHY2.js";
import "./chunk-CNYNCKEV.js";
import "./chunk-XL5QPCXN.js";
import "./chunk-2LC2762W.js";
import "./chunk-W6HOAVT4.js";
import "./chunk-DTZUXJMD.js";
import "./chunk-YLAGKT2D.js";
import "./chunk-6YRQYUCY.js";
import "./chunk-W75DBJD7.js";
import "./chunk-QF7FRVN6.js";
import {
  b as b2
} from "./chunk-P6IKJIMO.js";
import "./chunk-MHV23XAQ.js";
import "./chunk-LPZUGJNG.js";
import "./chunk-W6J7XCPU.js";
import "./chunk-ONXWBTTM.js";
import {
  l as l2
} from "./chunk-T7F6Q6JJ.js";
import "./chunk-YDTPM7OQ.js";
import "./chunk-75XOUSSS.js";
import "./chunk-TH4EQWJJ.js";
import "./chunk-7P2ANHQ3.js";
import "./chunk-XCKT47LJ.js";
import "./chunk-3FUHCAX3.js";
import "./chunk-PZ5RULLK.js";
import "./chunk-OPJX4KXH.js";
import "./chunk-LTPHDYPK.js";
import "./chunk-3OVERDFX.js";
import "./chunk-FPMLKIDB.js";
import "./chunk-AZXJIEZ6.js";
import "./chunk-Q75WYS7K.js";
import "./chunk-H74Q4SYB.js";
import "./chunk-2OFHDVO5.js";
import "./chunk-TFJXG32O.js";
import "./chunk-DDOCCRD4.js";
import "./chunk-5UPBUJPC.js";
import "./chunk-THQO67BJ.js";
import "./chunk-4YDOPHTZ.js";
import "./chunk-YY5PITIH.js";
import "./chunk-CCQFL76O.js";
import "./chunk-GY6YF4EN.js";
import {
  r as r2
} from "./chunk-7H3U4IJR.js";
import "./chunk-SMWUT52Z.js";
import "./chunk-AXZMNHTN.js";
import "./chunk-5T3MJDSR.js";
import "./chunk-NMQNUPE4.js";
import "./chunk-6KIXN4DJ.js";
import "./chunk-7DGJB37R.js";
import "./chunk-234CIOHE.js";
import {
  H2 as H,
  V
} from "./chunk-V2H77UEV.js";
import "./chunk-WRA2WBYC.js";
import {
  o
} from "./chunk-XWE6BM2U.js";
import {
  r
} from "./chunk-SOIZOFSB.js";
import {
  n
} from "./chunk-XXLHAM2M.js";
import {
  m
} from "./chunk-5EI5H4QX.js";
import {
  a2,
  x
} from "./chunk-ZIE53VIV.js";
import {
  __decorate
} from "./chunk-SS5CLIUY.js";
import "./chunk-R54Q5TGA.js";
import "./chunk-6SSZNBOK.js";
import "./chunk-LZ2XTYP2.js";
import "./chunk-45CFSCQX.js";
import "./chunk-A5XN2VFT.js";
import "./chunk-65HD3WXL.js";
import "./chunk-4DGC7CBY.js";
import {
  f2 as f
} from "./chunk-GNMPGHLQ.js";
import {
  a,
  e,
  i3 as i,
  s2 as s
} from "./chunk-QY7XKUIV.js";
import "./chunk-AL6YUTZM.js";
import "./chunk-G26ADAPQ.js";

// node_modules/@arcgis/core/graphic/isPointCloudGraphicOrigin.js
var i3 = Symbol("isPointCloudGraphicOrigin");

// node_modules/@arcgis/core/graphic/PointCloudGraphicOrigin.js
var o4;
var s5 = class extends s2 {
  get [(o4 = i3, n2)]() {
    return this.layer;
  }
  get [o2]() {
    return this.layer;
  }
  constructor(r3) {
    super(), this[o4] = true, this.type = "point-cloud", this.layer = r3;
  }
  get id() {
    return this.layer.id;
  }
};

// node_modules/@arcgis/core/layers/pointCloudFilters/PointCloudFilter.js
var s6 = class extends n {
  constructor(o5) {
    super(o5), this.field = null, this.type = null;
  }
  clone() {
    return console.warn(".clone() is not implemented for " + this.declaredClass), null;
  }
};
__decorate([m({ type: String, json: { write: { enabled: true, isRequired: true } } })], s6.prototype, "field", void 0), __decorate([m({ readOnly: true, nonNullable: true, json: { read: false, write: { isRequired: true } } })], s6.prototype, "type", void 0), s6 = __decorate([a2("esri.layers.pointCloudFilters.PointCloudFilter")], s6);
var i4 = s6;

// node_modules/@arcgis/core/layers/pointCloudFilters/PointCloudBitfieldFilter.js
var d5;
var p = d5 = class extends i4 {
  constructor(e3) {
    super(e3), this.requiredClearBits = null, this.requiredSetBits = null, this.type = "bitfield";
  }
  clone() {
    return new d5({ field: this.field, requiredClearBits: a(this.requiredClearBits), requiredSetBits: a(this.requiredSetBits) });
  }
};
__decorate([m({ type: [x], json: { write: { enabled: true, overridePolicy() {
  return { enabled: true, isRequired: !this.requiredSetBits };
} } } })], p.prototype, "requiredClearBits", void 0), __decorate([m({ type: [x], json: { write: { enabled: true, overridePolicy() {
  return { enabled: true, isRequired: !this.requiredClearBits };
} } } })], p.prototype, "requiredSetBits", void 0), __decorate([r2({ pointCloudBitfieldFilter: "bitfield" })], p.prototype, "type", void 0), p = d5 = __decorate([a2("esri.layers.pointCloudFilters.PointCloudBitfieldFilter")], p);
var u2 = p;

// node_modules/@arcgis/core/layers/pointCloudFilters/PointCloudReturnFilter.js
var n3;
var p2 = n3 = class extends i4 {
  constructor(r3) {
    super(r3), this.includedReturns = [], this.type = "return";
  }
  clone() {
    return new n3({ field: this.field, includedReturns: a(this.includedReturns) });
  }
};
__decorate([m({ type: [["firstOfMany", "last", "lastOfMany", "single"]], json: { write: { enabled: true, isRequired: true } } })], p2.prototype, "includedReturns", void 0), __decorate([r2({ pointCloudReturnFilter: "return" })], p2.prototype, "type", void 0), p2 = n3 = __decorate([a2("esri.layers.pointCloudFilters.PointCloudReturnFilter")], p2);
var l5 = p2;

// node_modules/@arcgis/core/layers/pointCloudFilters/PointCloudValueFilter.js
var l6;
var p3 = l6 = class extends i4 {
  constructor(e3) {
    super(e3), this.mode = "exclude", this.type = "value", this.values = [];
  }
  clone() {
    return new l6({ field: this.field, mode: this.mode, values: a(this.values) });
  }
};
__decorate([m({ type: ["exclude", "include"], json: { write: { enabled: true, isRequired: true } } })], p3.prototype, "mode", void 0), __decorate([r2({ pointCloudValueFilter: "value" })], p3.prototype, "type", void 0), __decorate([m({ type: [Number], json: { write: { enabled: true, isRequired: true } } })], p3.prototype, "values", void 0), p3 = l6 = __decorate([a2("esri.layers.pointCloudFilters.PointCloudValueFilter")], p3);
var u3 = p3;

// node_modules/@arcgis/core/layers/pointCloudFilters/typeUtils.js
var e2 = { key: "type", base: i4, typeMap: { value: u3, bitfield: u2, return: l5 } };

// node_modules/@arcgis/core/renderers/PointCloudRGBRenderer.js
var p4;
var c = p4 = class extends u {
  constructor(r3) {
    super(r3), this.type = "point-cloud-rgb", this.field = null;
  }
  clone() {
    return new p4({ ...this.cloneProperties(), field: a(this.field) });
  }
};
__decorate([r2({ pointCloudRGBRenderer: "point-cloud-rgb" })], c.prototype, "type", void 0), __decorate([m({ type: String, json: { write: { isRequired: true } } })], c.prototype, "field", void 0), c = p4 = __decorate([a2("esri.renderers.PointCloudRGBRenderer")], c);
var n4 = c;

// node_modules/@arcgis/core/renderers/support/pointCloud/typeUtils.js
var i5 = { key: "type", base: u, typeMap: { "point-cloud-class-breaks": d2, "point-cloud-rgb": n4, "point-cloud-stretch": a3, "point-cloud-unique-value": d3 }, errorContext: "renderer" };

// node_modules/@arcgis/core/layers/PointCloudLayer.js
var K = s4();
var V2 = class extends _(l3(b(j(t(l(s3(o3(l2(b2))))))))) {
  constructor(...e3) {
    super(...e3), this.operationalLayerType = "PointCloudLayer", this.popupEnabled = true, this.popupTemplate = null, this.opacity = 1, this.filters = [], this.fields = null, this.fieldsIndex = null, this.outFields = null, this.path = null, this.legendEnabled = true, this.renderer = null, this.type = "point-cloud", this.graphicOrigin = new s5(this), this.rootPagePromise = null;
  }
  normalizeCtorArgs(e3, r3) {
    return "string" == typeof e3 ? { url: e3, ...r3 } : e3;
  }
  get defaultPopupTemplate() {
    return this.attributeStorageInfo ? this.createPopupTemplate() : null;
  }
  getFieldDomain(e3) {
    const r3 = this.fieldsIndex.get(e3);
    return r3?.domain ? r3.domain : null;
  }
  readServiceFields(e3, r3, t2) {
    return Array.isArray(e3) ? e3.map((e4) => {
      const r4 = new m2();
      return "FieldTypeInteger" === e4.type && ((e4 = a(e4)).type = "esriFieldTypeInteger"), r4.read(e4, t2), r4;
    }) : Array.isArray(r3.attributeStorageInfo) ? r3.attributeStorageInfo.map((e4) => new m2({ name: e4.name, type: "ELEVATION" === e4.name ? "double" : "integer" })) : null;
  }
  set elevationInfo(e3) {
    null != e3 && "absolute-height" !== e3.mode || this._set("elevationInfo", e3), this._validateElevationInfo(e3);
  }
  writeRenderer(e3, r3, t2, o5) {
    e("layerDefinition.drawingInfo.renderer", e3.write({}, o5), r3);
  }
  load(e3) {
    return this.addResolvingPromise(this._load(e3)), Promise.resolve(this);
  }
  async _load(e3) {
    await this.loadFromPortal({ supportedTypes: ["Scene Service"] }, e3).catch(f), await this._fetchService(e3?.signal), await this._fetchRootPageAndUpdateExtent(e3?.signal);
  }
  async _fetchRootPageAndUpdateExtent(e3) {
    this.rootPagePromise = this._fetchRootPage(e3);
    const { fullExtent: r3 } = this;
    if (null != r3 && !r3.hasZ) {
      const e4 = await this.rootPagePromise;
      O(r3, e4?.nodes?.[0]?.obb);
    }
  }
  async _fetchRootPage(e3) {
    const r3 = `${this.parsedUrl?.path ?? ""}/nodepages/0`;
    try {
      return (await H(r3, { query: { f: "json", ...this.customParameters, token: this.apiKey }, responseType: "json", signal: e3 })).data;
    } catch (o5) {
      throw new s("pointcloudlayer:root-page-missing", "Root page missing.", { error: o5, url: r3 });
    }
  }
  createPopupTemplate(e3) {
    const r3 = d(this, e3);
    return r3 && (this._formatPopupTemplateReturnsField(r3), this._formatPopupTemplateRGBField(r3)), r3;
  }
  _formatPopupTemplateReturnsField(e3) {
    const r3 = this.fieldsIndex.get("RETURNS");
    if (!r3) return;
    const t2 = e3.fieldInfos?.find((e4) => e4.fieldName === r3.name);
    if (!t2) return;
    const o5 = new i2({ name: "pcl-returns-decoded", title: r3.alias || r3.name, expression: `
        var returnValue = $feature.${r3.name};
        return (returnValue % 16) + " / " + Floor(returnValue / 16);
      ` });
    e3.expressionInfos = [...e3.expressionInfos || [], o5], t2.fieldName = "expression/pcl-returns-decoded";
  }
  _formatPopupTemplateRGBField(e3) {
    const r3 = this.fieldsIndex.get("RGB");
    if (!r3) return;
    const t2 = e3.fieldInfos?.find((e4) => e4.fieldName === r3.name);
    if (!t2) return;
    const o5 = new i2({ name: "pcl-rgb-decoded", title: r3.alias || r3.name, expression: `
        var rgb = $feature.${r3.name};
        var red = Floor(rgb / 65536, 0);
        var green = Floor((rgb - (red * 65536)) / 256,0);
        var blue = rgb - (red * 65536) - (green * 256);

        return "rgb(" + red + "," + green + "," + blue + ")";
      ` });
    e3.expressionInfos = [...e3.expressionInfos || [], o5], t2.fieldName = "expression/pcl-rgb-decoded";
  }
  async queryCachedStatistics(e3, r3) {
    if (await this.load(r3), !this.attributeStorageInfo) throw new s("scenelayer:no-cached-statistics", "Cached statistics are not available for this layer");
    const o5 = this.fieldsIndex.get(e3);
    if (!o5) throw new s("pointcloudlayer:field-unexisting", `Field '${e3}' does not exist on the layer`);
    for (const i6 of this.attributeStorageInfo) if (i6.name === o5.name) {
      const e4 = V(this.parsedUrl?.path ?? "", `./statistics/${i6.key}`);
      return H(e4, { query: { f: "json", ...this.customParameters, token: this.apiKey }, responseType: "json", signal: r3 ? r3.signal : null }).then((e5) => e5.data);
    }
    throw new s("pointcloudlayer:no-cached-statistics", "Cached statistics for this attribute are not available");
  }
  async saveAs(e3, r3) {
    return this._debouncedSaveOperations(1, { ...r3, getTypeKeywords: () => this._getTypeKeywords(), portalItemLayerType: "point-cloud" }, e3);
  }
  async save() {
    const e3 = { getTypeKeywords: () => this._getTypeKeywords(), portalItemLayerType: "point-cloud" };
    return this._debouncedSaveOperations(0, e3);
  }
  validateLayer(e3) {
    if (e3.layerType && "PointCloud" !== e3.layerType) throw new s("pointcloudlayer:layer-type-not-supported", "PointCloudLayer does not support this layer type", { layerType: e3.layerType });
    if (isNaN(this.version.major) || isNaN(this.version.minor)) throw new s("layer:service-version-not-supported", "Service version is not supported.", { serviceVersion: this.version.versionString, supportedVersions: "1.x-2.x" });
    if (this.version.major > 2) throw new s("layer:service-version-too-new", "Service version is too new.", { serviceVersion: this.version.versionString, supportedVersions: "1.x-2.x" });
  }
  hasCachedStatistics(e3) {
    return null != this.attributeStorageInfo && this.attributeStorageInfo.some((r3) => r3.name === e3);
  }
  _getTypeKeywords() {
    return ["PointCloud"];
  }
  _validateElevationInfo(e3) {
    j2(i.getLogger(this), w("Point cloud layers", "absolute-height", e3)), j2(i.getLogger(this), R("Point cloud layers", e3));
  }
};
__decorate([m({ type: ["PointCloudLayer"] })], V2.prototype, "operationalLayerType", void 0), __decorate([m(l4)], V2.prototype, "popupEnabled", void 0), __decorate([m({ type: q, json: { name: "popupInfo", write: true } })], V2.prototype, "popupTemplate", void 0), __decorate([m({ readOnly: true, json: { read: false } })], V2.prototype, "defaultPopupTemplate", null), __decorate([m({ readOnly: true, json: { write: false, read: false, origins: { "web-document": { write: false, read: false } } } })], V2.prototype, "opacity", void 0), __decorate([m({ type: ["show", "hide"] })], V2.prototype, "listMode", void 0), __decorate([m({ types: [e2], json: { origins: { service: { read: { source: "filters" } } }, name: "layerDefinition.filters", write: true } })], V2.prototype, "filters", void 0), __decorate([m({ type: [m2] })], V2.prototype, "fields", void 0), __decorate([m(K.fieldsIndex)], V2.prototype, "fieldsIndex", void 0), __decorate([o("service", "fields", ["fields", "attributeStorageInfo"])], V2.prototype, "readServiceFields", null), __decorate([m(K.outFields)], V2.prototype, "outFields", void 0), __decorate([m({ readOnly: true })], V2.prototype, "attributeStorageInfo", void 0), __decorate([m(m3)], V2.prototype, "elevationInfo", null), __decorate([m({ type: String, json: { origins: { "web-scene": { read: true, write: true }, "portal-item": { read: true, write: true } }, read: false } })], V2.prototype, "path", void 0), __decorate([m(d4)], V2.prototype, "legendEnabled", void 0), __decorate([m({ types: i5, json: { origins: { service: { read: { source: "drawingInfo.renderer" } } }, name: "layerDefinition.drawingInfo.renderer", write: { target: { "layerDefinition.drawingInfo.renderer": { types: i5 }, "layerDefinition.drawingInfo.transparency": { type: Number } } } } })], V2.prototype, "renderer", void 0), __decorate([r("renderer")], V2.prototype, "writeRenderer", null), __decorate([m({ json: { read: false }, readOnly: true })], V2.prototype, "type", void 0), __decorate([m({ readOnly: true })], V2.prototype, "graphicOrigin", void 0), V2 = __decorate([a2("esri.layers.PointCloudLayer")], V2);
var $ = V2;
export {
  $ as default
};
//# sourceMappingURL=PointCloudLayer-AXT5YW4P.js.map
